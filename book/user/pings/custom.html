<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Adding new custom pings - Glean SDKs - Cross-platform Telemetry Libraries</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
                <link rel="stylesheet" href="../../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
                <link rel="stylesheet" href="../../../shared/glean.css">
                <link rel="stylesheet" href="../../../shared/mermaid.css">
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../index.html">Glean</a></li><li class="chapter-item affix "><li class="part-title">User Guides</li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/index.html"><strong aria-hidden="true">1.</strong> Adding Glean to your project</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/kotlin.html"><strong aria-hidden="true">1.1.</strong> Kotlin</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/swift.html"><strong aria-hidden="true">1.2.</strong> Swift</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/python.html"><strong aria-hidden="true">1.3.</strong> Python</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/javascript.html"><strong aria-hidden="true">1.4.</strong> JavaScript</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/qt.html"><strong aria-hidden="true">1.5.</strong> Qt/QML</a></li></ol></li><li class="chapter-item "><a href="../../user/integrating-glean-for-product-managers.html"><strong aria-hidden="true">2.</strong> Integrating Glean for project managers</a></li><li class="chapter-item "><a href="../../user/metrics/adding-new-metrics.html"><strong aria-hidden="true">3.</strong> Metrics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/metrics/adding-new-metrics.html"><strong aria-hidden="true">3.1.</strong> Adding new metrics</a></li><li class="chapter-item "><a href="../../user/metrics/testing-metrics.html"><strong aria-hidden="true">3.2.</strong> Testing metrics</a></li><li class="chapter-item "><a href="../../user/metrics/error-reporting.html"><strong aria-hidden="true">3.3.</strong> Error reporting</a></li><li class="chapter-item "><a href="../../user/collected-metrics/metrics.html"><strong aria-hidden="true">3.4.</strong> Metrics collected by the Glean SDKs</a></li></ol></li><li class="chapter-item expanded "><a href="../../user/pings/index.html"><strong aria-hidden="true">4.</strong> Pings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user/pings/custom.html" class="active"><strong aria-hidden="true">4.1.</strong> Adding new custom pings</a></li><li class="chapter-item "><a href="../../user/pings/testing-custom-pings.html"><strong aria-hidden="true">4.2.</strong> Testing custom pings</a></li><li class="chapter-item "><a href="../../user/pings/sent-by-glean.html"><strong aria-hidden="true">4.3.</strong> Pings sent by Glean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/pings/baseline.html"><strong aria-hidden="true">4.3.1.</strong> Baseline Ping</a></li><li class="chapter-item "><a href="../../user/pings/deletion-request.html"><strong aria-hidden="true">4.3.2.</strong> Deletion Request Ping</a></li><li class="chapter-item "><a href="../../user/pings/events.html"><strong aria-hidden="true">4.3.3.</strong> Events Ping</a></li><li class="chapter-item "><a href="../../user/pings/metrics.html"><strong aria-hidden="true">4.3.4.</strong> Metrics Ping</a></li><li class="chapter-item "><a href="../../user/pings/ping-schedules-and-timings.html"><strong aria-hidden="true">4.3.5.</strong> Schedules and timings overview</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../user/debugging/index.html"><strong aria-hidden="true">5.</strong> Debugging products using Glean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/debugging/android.html"><strong aria-hidden="true">5.1.</strong> Android</a></li><li class="chapter-item "><a href="../../user/debugging/ios.html"><strong aria-hidden="true">5.2.</strong> iOS</a></li><li class="chapter-item "><a href="../../user/debugging/python.html"><strong aria-hidden="true">5.3.</strong> Python</a></li><li class="chapter-item "><a href="../../user/debugging/javascript.html"><strong aria-hidden="true">5.4.</strong> JavaScript</a></li></ol></li><li class="chapter-item "><li class="part-title">API Reference</li><li class="chapter-item "><a href="../../reference/yaml/index.html"><strong aria-hidden="true">6.</strong> YAML Registry Format</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/yaml/metrics.html"><strong aria-hidden="true">6.1.</strong> Metrics</a></li><li class="chapter-item "><a href="../../reference/yaml/pings.html"><strong aria-hidden="true">6.2.</strong> Pings</a></li><li class="chapter-item "><a href="../../reference/yaml/tags.html"><strong aria-hidden="true">6.3.</strong> Tags</a></li></ol></li><li class="chapter-item "><a href="../../reference/general/index.html"><strong aria-hidden="true">7.</strong> General API</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/general/initializing.html"><strong aria-hidden="true">7.1.</strong> Initializing</a></li><li class="chapter-item "><a href="../../reference/general/toggling-upload-status.html"><strong aria-hidden="true">7.2.</strong> Toggling upload status</a></li><li class="chapter-item "><a href="../../reference/general/experiments-api.html"><strong aria-hidden="true">7.3.</strong> Annotating experiments</a></li><li class="chapter-item "><a href="../../reference/general/register-custom-pings.html"><strong aria-hidden="true">7.4.</strong> Registering custom pings</a></li><li class="chapter-item "><a href="../../reference/general/shutdown.html"><strong aria-hidden="true">7.5.</strong> Shut down</a></li></ol></li><li class="chapter-item "><a href="../../reference/debug/index.html"><strong aria-hidden="true">8.</strong> Debugging</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/debug/logPings.html"><strong aria-hidden="true">8.1.</strong> Log pings</a></li><li class="chapter-item "><a href="../../reference/debug/debugViewTag.html"><strong aria-hidden="true">8.2.</strong> Debug View Tag</a></li><li class="chapter-item "><a href="../../reference/debug/sourceTags.html"><strong aria-hidden="true">8.3.</strong> Source Tags</a></li></ol></li><li class="chapter-item "><a href="../../reference/metrics/index.html"><strong aria-hidden="true">9.</strong> Metric types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/metrics/boolean.html"><strong aria-hidden="true">9.1.</strong> Boolean</a></li><li class="chapter-item "><a href="../../reference/metrics/labeled_booleans.html"><strong aria-hidden="true">9.2.</strong> Labeled Booleans</a></li><li class="chapter-item "><a href="../../reference/metrics/counter.html"><strong aria-hidden="true">9.3.</strong> Counter</a></li><li class="chapter-item "><a href="../../reference/metrics/labeled_counters.html"><strong aria-hidden="true">9.4.</strong> Labeled Counters</a></li><li class="chapter-item "><a href="../../reference/metrics/string.html"><strong aria-hidden="true">9.5.</strong> String</a></li><li class="chapter-item "><a href="../../reference/metrics/labeled_strings.html"><strong aria-hidden="true">9.6.</strong> Labeled Strings</a></li><li class="chapter-item "><a href="../../reference/metrics/string_list.html"><strong aria-hidden="true">9.7.</strong> String List</a></li><li class="chapter-item "><a href="../../reference/metrics/timespan.html"><strong aria-hidden="true">9.8.</strong> Timespan</a></li><li class="chapter-item "><a href="../../reference/metrics/timing_distribution.html"><strong aria-hidden="true">9.9.</strong> Timing Distribution</a></li><li class="chapter-item "><a href="../../reference/metrics/memory_distribution.html"><strong aria-hidden="true">9.10.</strong> Memory Distribution</a></li><li class="chapter-item "><a href="../../reference/metrics/uuid.html"><strong aria-hidden="true">9.11.</strong> UUID</a></li><li class="chapter-item "><a href="../../reference/metrics/url.html"><strong aria-hidden="true">9.12.</strong> URL</a></li><li class="chapter-item "><a href="../../reference/metrics/datetime.html"><strong aria-hidden="true">9.13.</strong> Datetime</a></li><li class="chapter-item "><a href="../../reference/metrics/event.html"><strong aria-hidden="true">9.14.</strong> Event</a></li><li class="chapter-item "><a href="../../reference/metrics/custom_distribution.html"><strong aria-hidden="true">9.15.</strong> Custom Distribution</a></li><li class="chapter-item "><a href="../../reference/metrics/quantity.html"><strong aria-hidden="true">9.16.</strong> Quantity</a></li><li class="chapter-item "><a href="../../reference/metrics/rate.html"><strong aria-hidden="true">9.17.</strong> Rate</a></li><li class="chapter-item "><a href="../../reference/metrics/text.html"><strong aria-hidden="true">9.18.</strong> Text</a></li></ol></li><li class="chapter-item "><a href="../../reference/pings/index.html"><strong aria-hidden="true">10.</strong> Pings</a></li><li class="chapter-item affix "><li class="part-title">SDK Specific Information</li><li class="chapter-item "><a href="../../language-bindings/index.html"><strong aria-hidden="true">11.</strong> Overview</a></li><li class="chapter-item "><a href="../../language-bindings/android/index.html"><strong aria-hidden="true">12.</strong> Android</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/android/android-build-configuration-options.html"><strong aria-hidden="true">12.1.</strong> Android build configuration options</a></li><li class="chapter-item "><a href="../../language-bindings/android/android-offline-builds.html"><strong aria-hidden="true">12.2.</strong> Android offline builds</a></li><li class="chapter-item "><a href="../../language-bindings/android/instrument-android-crashes-example.html"><strong aria-hidden="true">12.3.</strong> Instrumenting Android crashes with Glean</a></li></ol></li><li class="chapter-item "><a href="../../language-bindings/ios/index.html"><strong aria-hidden="true">13.</strong> iOS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/ios/ios-build-configuration-options.html"><strong aria-hidden="true">13.1.</strong> iOS build configuration options</a></li></ol></li><li class="chapter-item "><a href="../../language-bindings/javascript/index.html"><strong aria-hidden="true">14.</strong> JavaScript</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/javascript/plugins/index.html"><strong aria-hidden="true">14.1.</strong> Plugins</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/javascript/plugins/encryption.html"><strong aria-hidden="true">14.1.1.</strong> Ping Encryption Plugin</a></li></ol></li></ol></li><li class="chapter-item "><li class="part-title">Appendix</li><li class="chapter-item "><a href="../../appendix/glossary.html"><strong aria-hidden="true">15.</strong> Glossary</a></li><li class="chapter-item "><a href="../../appendix/changelog/index.html"><strong aria-hidden="true">16.</strong> Changelog</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../appendix/changelog/sdk.html"><strong aria-hidden="true">16.1.</strong> mozilla/glean</a></li><li class="chapter-item "><a href="../../appendix/changelog/js.html"><strong aria-hidden="true">16.2.</strong> mozilla/glean.js</a></li></ol></li><li class="chapter-item "><a href="../../appendix/twig.html"><strong aria-hidden="true">17.</strong> This Week in Glean</a></li><li class="chapter-item "><a href="../../appendix/contribution-guidelines.html"><strong aria-hidden="true">18.</strong> Contribution Guidelines</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Glean SDKs - Cross-platform Telemetry Libraries</h1>

                    <div class="right-buttons">
                                                <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/mozilla/glean" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="custom-pings"><a class="header" href="#custom-pings">Custom pings</a></h1>
<p>Applications can define metrics that are sent in custom pings. Unlike the built-in pings, custom pings are sent explicitly by the application.</p>
<p>This is useful when the scheduling of the built-in pings (<a href="metrics.html">metrics</a>, <a href="baseline.html">baseline</a> and <a href="events.html">events</a>) are not appropriate for your data.  Since the timing of the submission of custom pings is handled by the application, the measurement window is under the application's control.</p>
<p>This is especially useful when metrics need to be tightly related to one another, for example when you need to measure the distribution of frame paint times when a particular rendering backend is in use.  If these metrics were in different pings, with different measurement windows, it is much harder to do that kind of reasoning with much certainty.</p>
<h2 id="defining-a-custom-ping"><a class="header" href="#defining-a-custom-ping">Defining a custom ping</a></h2>
<p>Custom pings must be defined in a <a href="../../reference/yaml/pings.html"><code>pings.yaml</code> file</a>, placed in the same directory alongside your app's <code>metrics.yaml</code> file.</p>
<p>For example, to define a custom ping called <code>search</code> specifically for search information:</p>
<pre><code class="language-YAML">$schema: moz://mozilla.org/schemas/glean/pings/2-0-0

search:
  description: &gt;
    A ping to record search data.
  metadata:
    tags:
      - Search
  include_client_id: false
  notification_emails:
    - CHANGE-ME@example.com
  bugs:
    - http://bugzilla.mozilla.org/123456789/
  data_reviews:
    - http://example.com/path/to/data-review
</code></pre>
<p>Tags are an optional feature you can use to provide an additional layer of categorization to pings.
Any tags specified in the <code>metadata</code> section of a ping <em>must</em> have a corresponding entry in a <a href="../../reference/yaml/tags.html">tags YAML registry</a> for your project.</p>
<p>Refer to the <a href="../../reference/yaml/pings.html">pings YAML registry format</a> for a full reference
on the <code>pings.yaml</code> file structure.</p>
<h2 id="sending-metrics-in-a-custom-ping"><a class="header" href="#sending-metrics-in-a-custom-ping">Sending metrics in a custom ping</a></h2>
<p>To send a metric on a custom ping, you add the custom ping's name to the <code>send_in_pings</code> parameter in the <code>metrics.yaml</code> file.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h3 id="ping-metadata-must-be-loaded-before-sending"><a class="header" href="#ping-metadata-must-be-loaded-before-sending">Ping metadata must be loaded before sending!</a></h3>
<blockquote>
<p>After defining a custom ping, before it can be used for sending data, its metadata must be <a href="../../reference/general/register-custom-pings.html">loaded into your application or library</a>.</p>
</blockquote>
<p>For example, to define a new metric to record the default search engine, which is sent in a custom ping called <code>search</code>, put <code>search</code> in the <code>send_in_pings</code> parameter.  Note that it is an error to specify a ping in <code>send_in_pings</code> that does not also have an entry in <code>pings.yaml</code>.</p>
<pre><code class="language-YAML">search.default:
  name:
    type: string
    description: &gt;
      The name of the default search engine.
    send_in_pings:
      - search
</code></pre>
<p>If this metric should also be sent in the default ping for the given metric type, you can add the special value <code>default</code> to <code>send_in_pings</code>:</p>
<pre><code class="language-YAML">    send_in_pings:
      - search
      - default
</code></pre>
<h2 id="the-gleanrestarted-event"><a class="header" href="#the-gleanrestarted-event">The <code>glean.restarted</code> event</a></h2>
<p>For custom pings that contain event metrics, the <code>glean.restarted</code> event is injected by Glean
on every application restart that may happen during the pings measurement window.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h3 id="only-applies-to-the-glean-javascript-sdk"><a class="header" href="#only-applies-to-the-glean-javascript-sdk">Only applies to the Glean JavaScript SDK</a></h3>
<blockquote>
<p>The behavior described in this section only applies to custom pings sent by
the Glean JavaScript SDK. Follow the implementation of this feature on the other
SDKs through <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1716725">Bug 1716725</a>.</p>
</blockquote>
<h3 id="event-timestamps-throughout-application-restarts"><a class="header" href="#event-timestamps-throughout-application-restarts">Event timestamps throughout application restarts</a></h3>
<p>Event timestamps are always calculated relative to the first event in a ping. The first event
will always have timestamp <code>0</code> and subsequent events will have timestamps corresponding to the
elapsed amount of milliseconds since that first event.</p>
<p>That is also the case for events recorded throughout restarts.</p>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<p>In the below example payload, there were two events recorded on the first application run.
The first event is timestamp <code>0</code> and the second event happens one second after the first one,
so it has timestamp <code>1000</code>.</p>
<p>The application is restarted one hour after the first event and a <code>glean.restarted</code> event is
recorded, timestamp <code>3600000</code>. Finally, an event is recorded during the second application run
two seconds after restart, timestamp <code>3602000</code>.</p>
<pre><code class="language-json">{
  ...
  &quot;events&quot;: [
    {
      &quot;timestamp&quot;: 0,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;,
    },
    {
      &quot;timestamp&quot;: 1000,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
    {
      &quot;timestamp&quot;: 3600000,
      &quot;category&quot;: &quot;glean&quot;,
      &quot;name&quot;: &quot;restarted&quot;
    },
    {
      &quot;timestamp&quot;: 3602000,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
  ]
}
</code></pre>
<h4 id="caveat-handling-decreasing-time-offsets"><a class="header" href="#caveat-handling-decreasing-time-offsets">Caveat: Handling decreasing time offsets</a></h4>
<p>For events recorded in a single application run, Glean relies on a monotonically increasing timer
to calculate event timestamps, while for calculating the time elapsed between application runs Glean
has to rely on the computer clock, which is not necessarily monotonically increasing.</p>
<p>In the case that timestamps in between application runs are not monotonically increasing, Glean
will take the value of the previous timestamp and add one millisecond, thus guaranteeing that
timestamps are always increasing.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="checking-for-decreasing-time-offsets-between-restarts"><a class="header" href="#checking-for-decreasing-time-offsets-between-restarts">Checking for decreasing time offsets between restarts</a></h5>
<blockquote>
<p>When this edge case is hit, Glean records an <a href="../error-reporting.html"><code>InvalidValue</code> error</a>
for the <code>glean.restarted</code> metric. This metric may be consulted at analysis time.
It is sent in the same ping where the error happened.</p>
</blockquote>
<p>In the below example payload, the first and second application runs go exactly like in the
<a href="#example">example above</a>.</p>
<p>The only difference is that when the restart happens, the offset between the absolute time
of the first event and the absolute time of the restart is not enough to keep the timestamps increasing.
That may happen for many reasons, such as a change in timezones or simply a manual change in the clock
by the user.</p>
<p>In this case, Glean will ignore the incorrect timestamp and add one millisecond to the last timestamp
of the previous run, in order to keep the monotonically increasing nature of the timestamps.</p>
<pre><code class="language-json">{
  ...
  &quot;events&quot;: [
    {
      &quot;timestamp&quot;: 0,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;,
    },
    {
      &quot;timestamp&quot;: 1000,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
    {
      &quot;timestamp&quot;: 1001,
      &quot;category&quot;: &quot;glean&quot;,
      &quot;name&quot;: &quot;restarted&quot;
    },
    {
      &quot;timestamp&quot;: 3001,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
  ]
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/custom.md">Edit this file on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../../user/pings/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../../user/pings/testing-custom-pings.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../../user/pings/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../../user/pings/testing-custom-pings.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
                <script type="text/javascript" src="../../../shared/tabs.js"></script>
                <script type="text/javascript" src="../../../shared/mermaid.min.js"></script>
                <script type="text/javascript" src="../../../shared/mermaid-init.js"></script>
                <script type="text/javascript" src="../../chart.min.js"></script>
                <script type="text/javascript" src="../../chart-distributions.js"></script>
                <script type="text/javascript" src="../../chart-distributions-ui.js"></script>
        
        
    </body>
</html>
