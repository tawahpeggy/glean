<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Glean SDKs - Cross-platform Telemetry Libraries</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
                <link rel="stylesheet" href="../shared/glean.css">
                <link rel="stylesheet" href="../shared/mermaid.css">
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="index.html">Glean</a></li><li class="chapter-item affix "><li class="part-title">User Guides</li><li class="chapter-item "><a href="user/adding-glean-to-your-project/index.html"><strong aria-hidden="true">1.</strong> Adding Glean to your project</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="user/adding-glean-to-your-project/kotlin.html"><strong aria-hidden="true">1.1.</strong> Kotlin</a></li><li class="chapter-item "><a href="user/adding-glean-to-your-project/swift.html"><strong aria-hidden="true">1.2.</strong> Swift</a></li><li class="chapter-item "><a href="user/adding-glean-to-your-project/python.html"><strong aria-hidden="true">1.3.</strong> Python</a></li><li class="chapter-item "><a href="user/adding-glean-to-your-project/javascript.html"><strong aria-hidden="true">1.4.</strong> JavaScript</a></li><li class="chapter-item "><a href="user/adding-glean-to-your-project/qt.html"><strong aria-hidden="true">1.5.</strong> Qt/QML</a></li></ol></li><li class="chapter-item "><a href="user/integrating-glean-for-product-managers.html"><strong aria-hidden="true">2.</strong> Integrating Glean for project managers</a></li><li class="chapter-item "><a href="user/metrics/adding-new-metrics.html"><strong aria-hidden="true">3.</strong> Metrics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="user/metrics/adding-new-metrics.html"><strong aria-hidden="true">3.1.</strong> Adding new metrics</a></li><li class="chapter-item "><a href="user/metrics/testing-metrics.html"><strong aria-hidden="true">3.2.</strong> Testing metrics</a></li><li class="chapter-item "><a href="user/metrics/error-reporting.html"><strong aria-hidden="true">3.3.</strong> Error reporting</a></li><li class="chapter-item "><a href="user/collected-metrics/metrics.html"><strong aria-hidden="true">3.4.</strong> Metrics collected by the Glean SDKs</a></li></ol></li><li class="chapter-item "><a href="user/pings/index.html"><strong aria-hidden="true">4.</strong> Pings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="user/pings/custom.html"><strong aria-hidden="true">4.1.</strong> Adding new custom pings</a></li><li class="chapter-item "><a href="user/pings/testing-custom-pings.html"><strong aria-hidden="true">4.2.</strong> Testing custom pings</a></li><li class="chapter-item "><a href="user/pings/sent-by-glean.html"><strong aria-hidden="true">4.3.</strong> Pings sent by Glean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="user/pings/baseline.html"><strong aria-hidden="true">4.3.1.</strong> Baseline Ping</a></li><li class="chapter-item "><a href="user/pings/deletion_request.html"><strong aria-hidden="true">4.3.2.</strong> Deletion Request Ping</a></li><li class="chapter-item "><a href="user/pings/events.html"><strong aria-hidden="true">4.3.3.</strong> Events Ping</a></li><li class="chapter-item "><a href="user/pings/metrics.html"><strong aria-hidden="true">4.3.4.</strong> Metrics Ping</a></li><li class="chapter-item "><a href="user/pings/ping-schedules-and-timings.html"><strong aria-hidden="true">4.3.5.</strong> Schedules and timings overview</a></li></ol></li></ol></li><li class="chapter-item "><a href="user/debugging/index.html"><strong aria-hidden="true">5.</strong> Debugging products using Glean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="user/debugging/android.html"><strong aria-hidden="true">5.1.</strong> Android</a></li><li class="chapter-item "><a href="user/debugging/ios.html"><strong aria-hidden="true">5.2.</strong> iOS</a></li><li class="chapter-item "><a href="user/debugging/python.html"><strong aria-hidden="true">5.3.</strong> Python</a></li><li class="chapter-item "><a href="user/debugging/javascript.html"><strong aria-hidden="true">5.4.</strong> JavaScript</a></li></ol></li><li class="chapter-item "><li class="part-title">API Reference</li><li class="chapter-item "><a href="reference/yaml/index.html"><strong aria-hidden="true">6.</strong> YAML Registry Format</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="reference/yaml/metrics.html"><strong aria-hidden="true">6.1.</strong> Metrics</a></li><li class="chapter-item "><a href="reference/yaml/pings.html"><strong aria-hidden="true">6.2.</strong> Pings</a></li><li class="chapter-item "><a href="reference/yaml/tags.html"><strong aria-hidden="true">6.3.</strong> Tags</a></li></ol></li><li class="chapter-item "><a href="reference/general/index.html"><strong aria-hidden="true">7.</strong> General API</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="reference/general/initializing.html"><strong aria-hidden="true">7.1.</strong> Initializing</a></li><li class="chapter-item "><a href="reference/general/toggling-upload-status.html"><strong aria-hidden="true">7.2.</strong> Toggling upload status</a></li><li class="chapter-item "><a href="reference/general/experiments-api.html"><strong aria-hidden="true">7.3.</strong> Annotating experiments</a></li><li class="chapter-item "><a href="reference/general/register-custom-pings.html"><strong aria-hidden="true">7.4.</strong> Registering custom pings</a></li><li class="chapter-item "><a href="reference/general/shutdown.html"><strong aria-hidden="true">7.5.</strong> Shut down</a></li></ol></li><li class="chapter-item "><a href="reference/debug/index.html"><strong aria-hidden="true">8.</strong> Debugging</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="reference/debug/logPings.html"><strong aria-hidden="true">8.1.</strong> Log pings</a></li><li class="chapter-item "><a href="reference/debug/debugViewTag.html"><strong aria-hidden="true">8.2.</strong> Debug View Tag</a></li><li class="chapter-item "><a href="reference/debug/sourceTags.html"><strong aria-hidden="true">8.3.</strong> Source Tags</a></li></ol></li><li class="chapter-item "><a href="reference/metrics/index.html"><strong aria-hidden="true">9.</strong> Metric types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="reference/metrics/boolean.html"><strong aria-hidden="true">9.1.</strong> Boolean</a></li><li class="chapter-item "><a href="reference/metrics/labeled_booleans.html"><strong aria-hidden="true">9.2.</strong> Labeled Booleans</a></li><li class="chapter-item "><a href="reference/metrics/counter.html"><strong aria-hidden="true">9.3.</strong> Counter</a></li><li class="chapter-item "><a href="reference/metrics/labeled_counters.html"><strong aria-hidden="true">9.4.</strong> Labeled Counters</a></li><li class="chapter-item "><a href="reference/metrics/string.html"><strong aria-hidden="true">9.5.</strong> String</a></li><li class="chapter-item "><a href="reference/metrics/labeled_strings.html"><strong aria-hidden="true">9.6.</strong> Labeled Strings</a></li><li class="chapter-item "><a href="reference/metrics/string_list.html"><strong aria-hidden="true">9.7.</strong> String List</a></li><li class="chapter-item "><a href="reference/metrics/timespan.html"><strong aria-hidden="true">9.8.</strong> Timespan</a></li><li class="chapter-item "><a href="reference/metrics/timing_distribution.html"><strong aria-hidden="true">9.9.</strong> Timing Distribution</a></li><li class="chapter-item "><a href="reference/metrics/memory_distribution.html"><strong aria-hidden="true">9.10.</strong> Memory Distribution</a></li><li class="chapter-item "><a href="reference/metrics/uuid.html"><strong aria-hidden="true">9.11.</strong> UUID</a></li><li class="chapter-item "><a href="reference/metrics/url.html"><strong aria-hidden="true">9.12.</strong> URL</a></li><li class="chapter-item "><a href="reference/metrics/datetime.html"><strong aria-hidden="true">9.13.</strong> Datetime</a></li><li class="chapter-item "><a href="reference/metrics/event.html"><strong aria-hidden="true">9.14.</strong> Event</a></li><li class="chapter-item "><a href="reference/metrics/custom_distribution.html"><strong aria-hidden="true">9.15.</strong> Custom Distribution</a></li><li class="chapter-item "><a href="reference/metrics/quantity.html"><strong aria-hidden="true">9.16.</strong> Quantity</a></li><li class="chapter-item "><a href="reference/metrics/rate.html"><strong aria-hidden="true">9.17.</strong> Rate</a></li><li class="chapter-item "><a href="reference/metrics/text.html"><strong aria-hidden="true">9.18.</strong> Text</a></li></ol></li><li class="chapter-item "><a href="reference/pings/index.html"><strong aria-hidden="true">10.</strong> Pings</a></li><li class="chapter-item affix "><li class="part-title">SDK Specific Information</li><li class="chapter-item "><a href="language-bindings/index.html"><strong aria-hidden="true">11.</strong> Overview</a></li><li class="chapter-item "><a href="language-bindings/android/index.html"><strong aria-hidden="true">12.</strong> Android</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="language-bindings/android/android-build-configuration-options.html"><strong aria-hidden="true">12.1.</strong> Android build configuration options</a></li><li class="chapter-item "><a href="language-bindings/android/android-offline-builds.html"><strong aria-hidden="true">12.2.</strong> Android offline builds</a></li><li class="chapter-item "><a href="language-bindings/android/instrument-android-crashes-example.html"><strong aria-hidden="true">12.3.</strong> Instrumenting Android crashes with Glean</a></li></ol></li><li class="chapter-item "><a href="language-bindings/javascript/index.html"><strong aria-hidden="true">13.</strong> JavaScript</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="language-bindings/javascript/plugins/index.html"><strong aria-hidden="true">13.1.</strong> Plugins</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="language-bindings/javascript/plugins/encryption.html"><strong aria-hidden="true">13.1.1.</strong> Ping Encryption Plugin</a></li></ol></li></ol></li><li class="chapter-item "><li class="part-title">Appendix</li><li class="chapter-item "><a href="appendix/glossary.html"><strong aria-hidden="true">14.</strong> Glossary</a></li><li class="chapter-item "><a href="appendix/changelog/index.html"><strong aria-hidden="true">15.</strong> Changelog</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="appendix/changelog/sdk.html"><strong aria-hidden="true">15.1.</strong> mozilla/glean</a></li><li class="chapter-item "><a href="appendix/changelog/js.html"><strong aria-hidden="true">15.2.</strong> mozilla/glean.js</a></li></ol></li><li class="chapter-item "><a href="appendix/twig.html"><strong aria-hidden="true">16.</strong> This Week in Glean</a></li><li class="chapter-item "><a href="appendix/contribution-guidelines.html"><strong aria-hidden="true">17.</strong> Contribution Guidelines</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Glean SDKs - Cross-platform Telemetry Libraries</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/mozilla/glean" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>The Glean SDKs are modern cross-platform telemetry client libraries
and are a part of the <a href="https://docs.telemetry.mozilla.org/concepts/glean/glean.html">Glean project</a>.</p>
<p><img src="glean.jpeg" alt="Glean logo" /></p>
<p>The Glean SDKs are available for several programming languages and development environments.
Each SDK aims to contain the same group of features with similar, but idiomatic APIs.</p>
<p>To learn more about each SDK, refer to the <a href="./language-bindings/index.html">SDKs overview</a> page.</p>
<p>To get started adding Glean to your project, choose one of the following guides:</p>
<ul>
<li><strong><a href="./user/adding-glean-to-your-project/kotlin.html">Kotlin</a></strong>
<ul>
<li>Get started adding Glean to an Android application or library.</li>
</ul>
</li>
<li><strong><a href="./user/adding-glean-to-your-project/swift.html">Swift</a></strong>
<ul>
<li>Get started adding Glean to an iOS application or library.</li>
</ul>
</li>
<li><strong><a href="./user/adding-glean-to-your-project/python.html">Python</a></strong>
<ul>
<li>Get started adding Glean to any Python project.</li>
</ul>
</li>
<li><strong><a href="./user/adding-glean-to-your-project/javascript.html">JavaScript</a></strong>
<ul>
<li>Get started adding Glean to a website, web extension or Node.js project.</li>
</ul>
</li>
<li><strong><a href="./user/adding-glean-to-your-project/qt.html">QML</a></strong>
<ul>
<li>Get started adding Glean to a Qt/QML application or library.</li>
</ul>
</li>
</ul>
<!-- - **[Rust](TODO)**
  - Get started adding Glean to any Rust project.
- **[Firefox Desktop](TODO)**
  - Get started adding Glean to a Firefox Desktop component. -->
<h2 id="sections"><a class="header" href="#sections">Sections</a></h2>
<h3 id="a-hrefuseradding-glean-to-your-projectindexhtmluser-guidesa"><a class="header" href="#a-hrefuseradding-glean-to-your-projectindexhtmluser-guidesa"><a href="./user/adding-glean-to-your-project/index.html">User Guides</a></a></h3>
<p>This section of the book contains step-by-step guides and essays detailing how to
achieve specific tasks with each Glean SDK.</p>
<p>It contains guides on the first steps of integrating Glean into your project,
choosing the right metric type for you, debugging products that use Glean and
Glean's built-in error reporting mechanism.</p>
<p>If you want to start using Glean to report data, this is the section you should read.</p>
<h3 id="a-hrefreferenceyamlindexhtmlapi-referencea"><a class="header" href="#a-hrefreferenceyamlindexhtmlapi-referencea"><a href="./reference/yaml/index.html">API Reference</a></a></h3>
<p>This section of the book contains reference pages for Glean’s user facing APIs.</p>
<p>If you are looking for information a specific Glean API, this is the section you should check out.</p>
<h3 id="a-hreflanguage-bindingsandroidindexhtmlsdk-specific-informationa"><a class="header" href="#a-hreflanguage-bindingsandroidindexhtmlsdk-specific-informationa"><a href="./language-bindings/android/index.html">SDK Specific Information</a></a></h3>
<p>This section contains guides and essays regarding specific usage information
and possibilities in each Glean SDK.</p>
<p>Check out this section for more information on the SDK you are using.</p>
<h3 id="appendix"><a class="header" href="#appendix">Appendix</a></h3>
<h4 id="a-hrefappendixglossaryhtmlglossarya"><a class="header" href="#a-hrefappendixglossaryhtmlglossarya"><a href="./appendix/glossary.html">Glossary</a></a></h4>
<p>In this book we use a lot of Glean specific terminology. In the glossary, we go through
many of the terms used throughout this book and describe exactly what we mean when we use them.</p>
<h4 id="a-hrefappendixchangelogindexhtmlchangeloga"><a class="header" href="#a-hrefappendixchangelogindexhtmlchangeloga"><a href="./appendix/changelog/index.html">Changelog</a></a></h4>
<p>This section contains detailed notes about changes in Glean, per release.</p>
<h4 id="a-hrefappendixtwightmlthis-week-in-gleana"><a class="header" href="#a-hrefappendixtwightmlthis-week-in-gleana"><a href="./appendix/twig.html">This Week in Glean</a></a></h4>
<p>“This Week in Glean” is a series of blog posts that the Glean Team at Mozilla is using to try
to communicate better about our work. They could be release notes, documentation, hopes, dreams,
or whatever: so long as it is inspired by Glean.</p>
<h4 id="a-hrefappendixcontribution-guidelineshtmlcontribution-guidelinesa"><a class="header" href="#a-hrefappendixcontribution-guidelineshtmlcontribution-guidelinesa"><a href="./appendix/contribution-guidelines.html">Contribution Guidelines</a></a></h4>
<p>This section contains detailed information on where and how to include new content to this book.</p>
<h2 id="contact"><a class="header" href="#contact">Contact</a></h2>
<p>To contact the Glean team you can:</p>
<ul>
<li>Find us in the <a href="https://chat.mozilla.org/#/room/#glean:mozilla.org">#glean channel on chat.mozilla.org</a>.</li>
<li>Send an email to <em>glean-team@mozilla.com</em>.</li>
<li>The Glean SDKs team is: <em>:janerik</em>, <em>:dexter</em>, <em>:travis</em>, <em>:mdroettboom</em>, <em>:chutten</em>, <em>:brizental</em>.</li>
</ul>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>The Glean SDKs Source Code is subject to the terms of the Mozilla Public License v2.0.
You can obtain a copy of the MPL at <a href="https://mozilla.org/MPL/2.0/">https://mozilla.org/MPL/2.0/</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-glean-to-your-project"><a class="header" href="#adding-glean-to-your-project">Adding Glean to your project</a></h1>
<p>This page describes the steps for adding Glean to a project. This does not include the
steps for adding a new metrics or pings to an existing Glean integration. If that is what
your are looking for, refer to the <a href="user/adding-glean-to-your-project/../metrics/adding-new-metrics.html">Adding new metrics</a> or the <a href="user/adding-glean-to-your-project/../pings/custom.html">Adding new pings</a> guide.</p>
<h2 id="glean-integration-checklist"><a class="header" href="#glean-integration-checklist">Glean integration checklist</a></h2>
<p>The Glean integration checklist can help to ensure your Glean SDK-using product is meeting all of the recommended guidelines.</p>
<p>Products (applications or libraries) using a Glean SDK to collect telemetry <strong>must</strong>:</p>
<ol>
<li>
<p><a href="user/adding-glean-to-your-project/index.html#looking-for-an-integration-guide">Integrate the Glean SDK into the build system</a>. Since the Glean SDK does some code generation for your metrics at build time, this requires a few more steps than just adding a library.</p>
</li>
<li>
<p>Go through <a href="https://wiki.mozilla.org/Firefox/Data_Collection">data review process</a> for all newly collected data.</p>
</li>
<li>
<p>Ensure that telemetry coming from automated testing or continuous integration is either not sent to the telemetry server or <a href="user/adding-glean-to-your-project/../../reference/debug/sourceTags.html">tagged with the <code>automation</code> tag using the <code>sourceTag</code> feature</a>.</p>
</li>
<li>
<p>At least one week before releasing your product, <a href="https://bugzilla.mozilla.org/enter_bug.cgi?assigned_to=nobody@mozilla.org&amp;bug_ignored=0&amp;bug_severity=--&amp;bug_status=NEW&amp;bug_type=task&amp;cf_fx_iteration=---&amp;cf_fx_points=---&amp;comment=%23%20To%20be%20filled%20by%20the%20requester%0A%0A%2A%2AApplication%20ID%5C%2A%2A%2A%3A%20my.app_id%0A%2A%2AApplication%20Canonical%20Name%2A%2A%3A%20My%20Application%0A%2A%2ADescription%2A%2A%3A%20Brief%20description%20of%20your%20application%0A%2A%2AData-review%20response%20link%2A%2A%3A%20The%20link%20to%20the%20data%20response%20to%20the%20data%20collection%20request%20for%20adding%20Glean%20to%20your%20project.%0A%2A%2ARepository%20URL%2A%2A%3A%20https%3A%2F%2Fgithub.com%2Fmozilla%2Fmy_app_name%0A%2A%2ALocations%20of%20%60metrics.yaml%60%20files%20%28can%20be%20many%29%3A%2A%2A%0A%20%20-%20src%2Fmetrics.yaml%0A%0A%2A%2ALocations%20of%20%60pings.yaml%60%20files%20%28can%20be%20many%29%3A%2A%2A%0A%20-%20src%2Fpings.yaml%0A%0A%2A%2ADependencies%5C%2A%5C%2A%2A%2A%3A%0A%20-%20glean-core%0A%0A%2A%2ARetention%20Days%5C%2A%5C%2A%5C%2A%2A%2A%3A%20N%0A%0A%23%23%20_%28Optional%29_%20To%20be%20filled%20by%20the%20requester%0A%2A%2ADoes%20the%20product%20require%20end-to-end%20encryption%20in%20the%20pipeline%3F%2A%2A%20Yes%20%7C%20No%0A%2A%2AIf%20answered%20yes%20to%20the%20above%2C%20who%20should%20be%20granted%20access%20to%20the%20data%3F%2A%2A%0A%0A-%20LDAP%20account%201%0A-%20LDAP%20account%202%0A%0A%23%23%20Notes%20and%20guidelines%0A%0A%5C%2A%20This%20is%20the%20identifier%20used%20to%20initialize%20Glean%20%28or%20the%20id%20used%20on%20the%20store%20on%20Android%20and%20Apple%20devices%29.%0A%0A%5C%2A%5C%2A%20Dependencies%20can%20be%20found%20%5Bin%20the%20Glean%20repositories%5D%28https%3A%2F%2Fprobeinfo.telemetry.mozilla.org%2Fv2%2Fglean%2Flibrary-variants%29.%20Each%20dependency%20must%20be%20listed%20explicitly.%20For%20example%2C%20the%20default%20Glean%20probes%20will%20only%20be%20included%20if%20glean%20itself%20is%20a%20dependency.%0A%0A%5C%2A%5C%2A%5C%2A%20Number%20of%20days%20that%20raw%20data%20will%20be%20retained.%20A%20good%20default%20is%20180.%20We%20can%20change%20this%20later%20to%20accommodate%20longer%20retention%20periods%2C%20though%20we%20cannot%20recover%20data%20that%20is%20past%20the%20retention%20period%20%28for%20example%2C%20we%20cannot%20recover%20data%20that%20is%20200%20days%20old%20if%20your%20retention%20period%20is%20180%20days%29.%0A%0A%23%23%20Need%20additional%20help%3F%0AIf%20you%20need%20new%20dependencies%2C%20please%20file%20new%20bugs%20for%20them%2C%20separately%20from%20this%20one.%20For%20any%20questions%2C%20ask%20in%20the%20%23glean%20channel.%0A%0A%23%20To%20be%20filled%20by%20the%20Glean%20team%0A%5B%2A%2AApplication%20friendly%20name%2A%2A%5D%28https%3A%2F%2Fmozilla.github.io%2Fprobe-scraper%2F%23tag%2Fapplication%29%3A%20my_app_name%0A%0A%23%23%20The%20following%20are%20only%20required%20for%20products%20requiring%20encryption%3A%0A%2A%2ADocument%20namespace%2A%2A%3A%20my-app-name%0A%0A%2A%2APlease%20NI%20Operations%20on%20this%20bug%20to%20request%20the%20creation%20of%20encryption%20keys%20and%20an%20analysis%20project.%2A%2A&amp;component=Glean%20Platform&amp;contenttypemethod=list&amp;contenttypeselection=text%2Fplain&amp;defined_groups=1&amp;filed_via=standard_form&amp;flag_type-4=X&amp;flag_type-607=X&amp;flag_type-800=X&amp;flag_type-803=X&amp;flag_type-936=X&amp;form_name=enter_bug&amp;maketemplate=Remember%20values%20as%20bookmarkable%20template&amp;op_sys=Unspecified&amp;priority=--&amp;product=Data%20Platform%20and%20Tools&amp;rep_platform=Unspecified&amp;short_desc=Enable%20new%20Glean%20App%20%60my.app_id%60&amp;target_milestone=---&amp;version=unspecified">file a data engineering bug</a> to enable your product's application id and have your metrics be indexed by the <a href="https://dictionary.telemetry.mozilla.org">Glean Dictionary</a>.</p>
</li>
</ol>
<blockquote>
<p><strong>Important consideration for libraries:</strong> For libraries that are adding Glean, you will need to indicate which <em>applications</em> use the library as a dependency so that the library metrics get correctly indexed and added to the products that consume the library. If the library is added to a new product later, then it is necessary to file a new <a href="https://bugzilla.mozilla.org/enter_bug.cgi?assigned_to=nobody@mozilla.org&amp;bug_ignored=0&amp;bug_severity=--&amp;bug_status=NEW&amp;bug_type=task&amp;cf_fx_iteration=---&amp;cf_fx_points=---&amp;comment=%23%20To%20be%20filled%20by%20the%20requester%0A%0A%2A%2AApplication%20ID%5C%2A%2A%2A%3A%20my.app_id%0A%2A%2AApplication%20Canonical%20Name%2A%2A%3A%20My%20Application%0A%2A%2ADescription%2A%2A%3A%20Brief%20description%20of%20your%20application%0A%2A%2AData-review%20response%20link%2A%2A%3A%20The%20link%20to%20the%20data%20response%20to%20the%20data%20collection%20request%20for%20adding%20Glean%20to%20your%20project.%0A%2A%2ARepository%20URL%2A%2A%3A%20https%3A%2F%2Fgithub.com%2Fmozilla%2Fmy_app_name%0A%2A%2ALocations%20of%20%60metrics.yaml%60%20files%20%28can%20be%20many%29%3A%2A%2A%0A%20%20-%20src%2Fmetrics.yaml%0A%0A%2A%2ALocations%20of%20%60pings.yaml%60%20files%20%28can%20be%20many%29%3A%2A%2A%0A%20-%20src%2Fpings.yaml%0A%0A%2A%2ADependencies%5C%2A%5C%2A%2A%2A%3A%0A%20-%20glean-core%0A%0A%2A%2ARetention%20Days%5C%2A%5C%2A%5C%2A%2A%2A%3A%20N%0A%0A%23%23%20_%28Optional%29_%20To%20be%20filled%20by%20the%20requester%0A%2A%2ADoes%20the%20product%20require%20end-to-end%20encryption%20in%20the%20pipeline%3F%2A%2A%20Yes%20%7C%20No%0A%2A%2AIf%20answered%20yes%20to%20the%20above%2C%20who%20should%20be%20granted%20access%20to%20the%20data%3F%2A%2A%0A%0A-%20LDAP%20account%201%0A-%20LDAP%20account%202%0A%0A%23%23%20Notes%20and%20guidelines%0A%0A%5C%2A%20This%20is%20the%20identifier%20used%20to%20initialize%20Glean%20%28or%20the%20id%20used%20on%20the%20store%20on%20Android%20and%20Apple%20devices%29.%0A%0A%5C%2A%5C%2A%20Dependencies%20can%20be%20found%20%5Bin%20the%20Glean%20repositories%5D%28https%3A%2F%2Fprobeinfo.telemetry.mozilla.org%2Fv2%2Fglean%2Flibrary-variants%29.%20Each%20dependency%20must%20be%20listed%20explicitly.%20For%20example%2C%20the%20default%20Glean%20probes%20will%20only%20be%20included%20if%20glean%20itself%20is%20a%20dependency.%0A%0A%5C%2A%5C%2A%5C%2A%20Number%20of%20days%20that%20raw%20data%20will%20be%20retained.%20A%20good%20default%20is%20180.%20We%20can%20change%20this%20later%20to%20accommodate%20longer%20retention%20periods%2C%20though%20we%20cannot%20recover%20data%20that%20is%20past%20the%20retention%20period%20%28for%20example%2C%20we%20cannot%20recover%20data%20that%20is%20200%20days%20old%20if%20your%20retention%20period%20is%20180%20days%29.%0A%0A%23%23%20Need%20additional%20help%3F%0AIf%20you%20need%20new%20dependencies%2C%20please%20file%20new%20bugs%20for%20them%2C%20separately%20from%20this%20one.%20For%20any%20questions%2C%20ask%20in%20the%20%23glean%20channel.%0A%0A%23%20To%20be%20filled%20by%20the%20Glean%20team%0A%5B%2A%2AApplication%20friendly%20name%2A%2A%5D%28https%3A%2F%2Fmozilla.github.io%2Fprobe-scraper%2F%23tag%2Fapplication%29%3A%20my_app_name%0A%0A%23%23%20The%20following%20are%20only%20required%20for%20products%20requiring%20encryption%3A%0A%2A%2ADocument%20namespace%2A%2A%3A%20my-app-name%0A%0A%2A%2APlease%20NI%20Operations%20on%20this%20bug%20to%20request%20the%20creation%20of%20encryption%20keys%20and%20an%20analysis%20project.%2A%2A&amp;component=Glean%20Platform&amp;contenttypemethod=list&amp;contenttypeselection=text%2Fplain&amp;defined_groups=1&amp;filed_via=standard_form&amp;flag_type-4=X&amp;flag_type-607=X&amp;flag_type-800=X&amp;flag_type-803=X&amp;flag_type-936=X&amp;form_name=enter_bug&amp;maketemplate=Remember%20values%20as%20bookmarkable%20template&amp;op_sys=Unspecified&amp;priority=--&amp;product=Data%20Platform%20and%20Tools&amp;rep_platform=Unspecified&amp;short_desc=Enable%20new%20Glean%20App%20%60my.app_id%60&amp;target_milestone=---&amp;version=unspecified">bug</a> to add it as a dependency to that product in order for the library metrics to be collected along with the data from the new product.</p>
</blockquote>
<p>Additionally, applications (but not libraries) <strong>must</strong>:</p>
<ol start="5">
<li>
<p>Request a <a href="https://wiki.mozilla.org/Firefox/Data_Collection">data review</a> to add Glean to your application (since it <em>can</em> send data out of the box).</p>
</li>
<li>
<p><a href="user/adding-glean-to-your-project/../../reference/general/initializing.html">Initialize Glean</a> as early as possible at application startup.</p>
</li>
<li>
<p>Provide a way for users to turn data collection off (e.g. providing settings to control <code>Glean.setUploadEnabled()</code>). The exact method used is application-specific.</p>
</li>
</ol>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="looking-for-an-integration-guide"><a class="header" href="#looking-for-an-integration-guide">Looking for an integration guide?</a></h5>
<blockquote>
<p>Step-by-step tutorials for each supported language/platform,
can be found on the specific integration guides:</p>
<ul>
<li><a href="user/adding-glean-to-your-project/./javascript.html">JavaScript</a></li>
<li><a href="user/adding-glean-to-your-project/./kotlin.html">Kotlin</a></li>
<li><a href="user/adding-glean-to-your-project/./python.html">Python</a></li>
<li><a href="user/adding-glean-to-your-project/./swift.html">Swift</a></li>
<li><a href="user/adding-glean-to-your-project/./qt.html">Qt/QML</a></li>
</ul>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/adding-glean-to-your-project/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="adding-glean-to-your-kotlin-project"><a class="header" href="#adding-glean-to-your-kotlin-project">Adding Glean to your Kotlin project</a></h1>
<p>This page provides a step-by-step guide on how to integrate the Glean library into a Kotlin project.</p>
<p>Nevertheless this is just one of the required steps for integrating Glean successfully into a project. Check you the full <a href="user/adding-glean-to-your-project/./index.html">Glean integration checklist</a> for a comprehensive list of all the steps involved in doing so.</p>
<p>Currently, this SDK only supports the Android platform.</p>
<h2 id="setting-up-the-dependency"><a class="header" href="#setting-up-the-dependency">Setting up the dependency</a></h2>
<p>The Glean Kotlin SDK is published on <a href="https://maven.mozilla.org/">maven.mozilla.org</a>.
To use it, you need to add the following to your project's top-level build file,
in the <code>allprojects</code> block (see e.g. <a href="https://github.com/mozilla/glean/blob/main/build.gradle">Glean SDK's own <code>build.gradle</code></a>):</p>
<pre><code class="language-Groovy">repositories {
    maven {
       url &quot;https://maven.mozilla.org/maven2&quot;
    }
}
</code></pre>
<p>Each module that uses the Glean Kotlin SDK needs to specify it in its build file, in the <code>dependencies</code> block.
Add this to your Gradle configuration:</p>
<pre><code class="language-Groovy">implementation &quot;org.mozilla.components:service-glean:{latest-version}&quot;
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="pick-the-correct-version"><a class="header" href="#pick-the-correct-version">Pick the correct version</a></h5>
<blockquote>
<p>The <code>{latest-version}</code> placeholder in the above link should be replaced with the version of Android Components used by the project.</p>
</blockquote>
<p>The Glean Kotlin SDK is released as part of <a href="https://github.com/mozilla-mobile/android-components">android-components</a>. Therefore, it follows android-components' versions.
The <a href="https://github.com/mozilla-mobile/android-components/releases/">android-components release page</a> can be used to determine the latest version.</p>
<p>For example, if version <em>33.0.0</em> is used, then the include directive becomes:</p>
<pre><code class="language-Groovy">implementation &quot;org.mozilla.components:service-glean:33.0.0&quot;
</code></pre>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="size-impact-on-the-application-apk"><a class="header" href="#size-impact-on-the-application-apk">Size impact on the application APK</a></h5>
<blockquote>
<p>The Glean Kotlin SDK APK ships binary libraries for all the supported platforms. Each library file measures about 600KB. If the final APK size of the consuming project is a concern, please enable <a href="https://developer.android.com/studio/build/configure-apk-splits#configure-abi-split">ABI splits</a>.</p>
</blockquote>
<h3 id="dependency-for-local-testing"><a class="header" href="#dependency-for-local-testing">Dependency for local testing</a></h3>
<p>Due to its use of a native library you will need additional setup to allow local testing.</p>
<p>First add a new configuration to your <code>build.gradle</code>, just before your <code>dependencies</code>:</p>
<pre><code class="language-Groovy">configurations {
    jnaForTest
}
</code></pre>
<p>Then add the following lines to your <code>dependencies</code> block:</p>
<pre><code class="language-Groovy">jnaForTest &quot;net.java.dev.jna:jna:5.6.0@jar&quot;
testImplementation files(configurations.jnaForTest.copyRecursive().files)
testImplementation &quot;org.mozilla.telemetry:glean-forUnitTests:${project.ext.glean_version}&quot;
</code></pre>
<p><strong>Note:</strong> Always use <code>org.mozilla.telemetry:glean-forUnitTests</code>.
This package is standalone and its version will be exported from the main Glean package automatically.</p>
<h2 id="setting-up-metrics-and-pings-code-generation"><a class="header" href="#setting-up-metrics-and-pings-code-generation">Setting up metrics and pings code generation</a></h2>
<p>In order for the Glean Kotlin SDK to generate an API for your metrics, two Gradle plugins must be included in your build:</p>
<ul>
<li>The <a href="https://github.com/mozilla/glean/tree/main/gradle-plugin/">Glean Gradle plugin</a></li>
<li>JetBrains' <a href="https://github.com/JetBrains/gradle-python-envs/">Python envs plugin</a></li>
</ul>
<p>The Glean Gradle plugin is distributed through Mozilla's Maven, so we need to tell your build where to look for it by adding the following to the top of your <code>build.gradle</code>:</p>
<pre><code>buildscript {
    repositories {
        // Include the next clause if you are tracking snapshots of android components
        maven {
            url &quot;https://snapshots.maven.mozilla.org/maven2&quot;
        }
        maven {
            url &quot;https://maven.mozilla.org/maven2&quot;
        }

        dependencies {
            classpath &quot;org.mozilla.components:tooling-glean-gradle:{android-components-version}&quot;
        }
    }
}
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="important"><a class="header" href="#important">Important</a></h5>
<blockquote>
<p>As above, the <code>{android-components-version}</code> placeholder in the above link should be replaced with the version number of android components used in your project.</p>
</blockquote>
<p>The JetBrains Python plugin is distributed in the Gradle plugin repository, so it can be included with:</p>
<pre><code class="language-Groovy">plugins {
    id &quot;com.jetbrains.python.envs&quot; version &quot;0.0.26&quot;
}
</code></pre>
<p>Right before the end of the same file, we need to apply the Glean Gradle plugin.
Set any <a href="user/adding-glean-to-your-project/../../language-bindings/android/android-build-configuration-options.html">additional parameters</a> to control the behavior of the Glean Gradle plugin before calling <code>apply plugin</code>.</p>
<pre><code class="language-Groovy">// Optionally, set any parameters to send to the plugin.
ext.gleanGenerateMarkdownDocs = true
apply plugin: &quot;org.mozilla.telemetry.glean-gradle-plugin&quot;
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="earlier-versions"><a class="header" href="#earlier-versions">Earlier versions</a></h5>
<blockquote>
<p><strong>Note:</strong> Earlier versions of Glean used a Gradle script (<code>sdk_generator.gradle</code>) rather than a Gradle plugin. Its use is deprecated and projects should be updated to use the Gradle plugin as described above.</p>
</blockquote>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="offline-builds"><a class="header" href="#offline-builds">Offline builds</a></h5>
<blockquote>
<p>The Glean Gradle plugin has limited support for <a href="user/adding-glean-to-your-project/../../language-bindings/android/android-offline-builds.html">offline builds</a> of applications that use the Glean SDK.</p>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/adding-glean-to-your-project/kotlin.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="adding-glean-to-your-swift-project"><a class="header" href="#adding-glean-to-your-swift-project">Adding Glean to your Swift project</a></h1>
<p>This page provides a step-by-step guide on how to integrate the Glean library into a Swift project.</p>
<p>Nevertheless this is just one of the required steps for integrating Glean successfully into a project. Check you the full <a href="user/adding-glean-to-your-project/./index.html">Glean integration checklist</a> for a comprehensive list of all the steps involved in doing so.</p>
<p>Currently, this SDK only supports the iOS platform.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li>Python &gt;= 3.6.</li>
</ul>
<h2 id="setting-up-the-dependency-1"><a class="header" href="#setting-up-the-dependency-1">Setting up the dependency</a></h2>
<p>The Glean Swift SDK can be consumed through <a href="https://github.com/Carthage/Carthage">Carthage</a>, a dependency manager for macOS and iOS.
For consuming the latest version of the Glean SDK, add the following line to your <code>Cartfile</code>:</p>
<pre><code>github &quot;mozilla/glean&quot; &quot;{latest-version}&quot;
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="pick-the-correct-version-1"><a class="header" href="#pick-the-correct-version-1">Pick the correct version</a></h5>
<blockquote>
<p>The <code>{latest-version}</code> placeholder should be replaced with the version number of the latest Glean Swift SDK release.
You can find the version number on the <a href="https://github.com/mozilla/glean/releases/latest">release page</a>.</p>
</blockquote>
<p>Then check out and build the new dependency:</p>
<pre><code>carthage update --platform iOS
</code></pre>
<h2 id="integrating-with-the-build-system"><a class="header" href="#integrating-with-the-build-system">Integrating with the build system</a></h2>
<p>For integration with the build system you can follow the <a href="https://github.com/Carthage/Carthage#quick-start">Carthage Quick Start steps</a>.</p>
<ol>
<li>
<p>After building the dependency one drag the built <code>.framework</code> binaries from <code>Carthage/Build/iOS</code> into your application's Xcode project.</p>
</li>
<li>
<p>On your application targets' Build Phases settings tab, click the <code>+</code> icon and choose <code>New Run Script Phase</code>.
If you already use Carthage for other dependencies, extend the existing step.
Create a Run Script in which you specify your shell (ex: <code>/bin/sh</code>), add the following contents to the script area below the shell:</p>
<pre><code>/usr/local/bin/carthage copy-frameworks
</code></pre>
</li>
<li>
<p>Add the path to the Glean framework under &quot;Input Files&quot;:</p>
<pre><code>$(SRCROOT)/Carthage/Build/iOS/Glean.framework
</code></pre>
</li>
<li>
<p>Add the paths to the copied framework to the &quot;Output Files&quot;:</p>
<pre><code>$(BUILT_PRODUCTS_DIR)/$(FRAMEWORKS_FOLDER_PATH)/Glean.framework
</code></pre>
</li>
</ol>
<h2 id="combined-usage-with-application-services"><a class="header" href="#combined-usage-with-application-services">Combined usage with application-services</a></h2>
<p>If your application uses both the Glean Swift SDK and <a href="https://github.com/mozilla/application-services">application-services</a>
you can use a combined release to reduce the memory usage and startup time impact.</p>
<p>In your <code>Cartfile</code> require only <code>application-services</code>, e.g.:</p>
<pre><code>github &quot;mozilla/application-services&quot; ~&gt; &quot;{latest-version}&quot;
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="pick-the-correct-version-2"><a class="header" href="#pick-the-correct-version-2">Pick the correct version</a></h5>
<blockquote>
<p>The <code>{latest-version}</code> placeholder should be replaced with the version number of the latest application-services release.
You can find the version number on the <a href="https://github.com/mozilla/application-services/releases/latest">release page</a>.</p>
</blockquote>
<p>Then check out and build the new dependency:</p>
<pre><code>carthage update --platform iOS
</code></pre>
<h2 id="setting-up-metrics-and-pings-code-generation-1"><a class="header" href="#setting-up-metrics-and-pings-code-generation-1">Setting up metrics and pings code generation</a></h2>
<p>The <code>metrics.yaml</code> file is parsed at build time and Swift code is generated.
Add a new <code>metrics.yaml</code> file to your Xcode project.</p>
<p>Follow these steps to automatically run the parser at build time:</p>
<ol>
<li>Download the <code>sdk_generator.sh</code> script from the Glean repository:
<pre><code>https://raw.githubusercontent.com/mozilla/glean/{latest-release}/glean-core/ios/sdk_generator.sh
</code></pre>
</li>
</ol>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="pick-the-correct-version-3"><a class="header" href="#pick-the-correct-version-3">Pick the correct version</a></h5>
<blockquote>
<p>As above, the <code>{latest-version}</code> placeholder should be replaced with the version number of Glean Swift SDK release used in this project.</p>
</blockquote>
<ol start="2">
<li>
<p>Add the <code>sdk_generator.sh</code> file to your Xcode project.</p>
</li>
<li>
<p>On your application targets' Build Phases settings tab, click the <code>+</code> icon and choose <code>New Run Script Phase</code>.
Create a Run Script in which you specify your shell (ex: <code>/bin/sh</code>), add the following contents to the script area below the shell:</p>
<pre><code>bash $PWD/sdk_generator.sh
</code></pre>
</li>
</ol>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="using-with-application-services"><a class="header" href="#using-with-application-services">Using with application-services</a></h5>
<blockquote>
<p>If you are using the combined release of application-services and the Glean Swift SDK you need to set the namespace to <code>MozillaAppServices</code>, e.g.:</p>
<pre><code>bash $PWD/sdk_generator.sh --glean-namespace MozillaAppServices
</code></pre>
</blockquote>
<ol start="3">
<li>
<p>Add the path to your <code>metrics.yaml</code> and (optionally) <code>pings.yaml</code> under &quot;Input files&quot;:</p>
<pre><code>$(SRCROOT)/{project-name}/metrics.yaml
$(SRCROOT)/{project-name}/pings.yaml
</code></pre>
</li>
<li>
<p>Add the path to the generated code file to the &quot;Output Files&quot;:</p>
<pre><code>$(SRCROOT)/{project-name}/Generated/Metrics.swift
</code></pre>
</li>
</ol>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="the-generated-api"><a class="header" href="#the-generated-api">The generated API</a></h5>
<blockquote>
<p>The parser now generates a single file called <code>Metrics.swift</code> (since Glean v31.0.0).</p>
</blockquote>
<ol start="5">
<li>
<p>If you are using Git, add the following lines to your <code>.gitignore</code> file:</p>
<pre><code>.venv/
{project-name}/Generated
</code></pre>
<p>This will ignore files that are generated at build time by the <code>sdk_generator.sh</code> script.
They don't need to be kept in version control, as they can be re-generated from your <code>metrics.yaml</code> and <code>pings.yaml</code> files.</p>
</li>
</ol>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="glean-and-embedded-extensions"><a class="header" href="#glean-and-embedded-extensions">Glean and embedded extensions</a></h5>
<blockquote>
<p>Metric collection is a no-op in <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionOverview.html#//apple_ref/doc/uid/TP40014214-CH2-SW2">application extensions</a> and Glean will not run. Since extensions run in a separate sandbox and process from the application, Glean would run in an extension as if it were a completely separate application with different client ids and storage. This complicates things because Glean doesn’t know or care about other processes. Because of this, Glean is purposefully prevented from running in an application extension and if metrics need to be collected from extensions, it's up to the integrating application to pass the information to the base application to record in Glean.</p>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/adding-glean-to-your-project/swift.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="adding-glean-to-your-python-project"><a class="header" href="#adding-glean-to-your-python-project">Adding Glean to your Python project</a></h1>
<p>This page provides a step-by-step guide on how to integrate the Glean library into a Python project.</p>
<p>Nevertheless this is just one of the required steps for integrating Glean successfully into a project. Check you the full <a href="user/adding-glean-to-your-project/./index.html">Glean integration checklist</a> for a comprehensive list of all the steps involved in doing so.</p>
<h2 id="setting-up-the-dependency-2"><a class="header" href="#setting-up-the-dependency-2">Setting up the dependency</a></h2>
<p>We recommend using a virtual environment for your work to isolate the dependencies for your project. There are many popular abstractions on top of virtual environments in the Python ecosystem which can help manage your project dependencies.</p>
<p>The Glean Python SDK currently has <a href="https://pypi.org/project/glean-sdk/#files">prebuilt wheels on PyPI for Windows (i686 and x86_64), Linux/glibc (x86_64) and macOS (x86_64)</a>.
For other platforms, including BSD or Linux distributions that don't use glibc, such as Alpine Linux, the <code>glean_sdk</code> package will be built from source on your machine.
This requires that Cargo and Rust are already installed.
The easiest way to do this is through <a href="https://rustup.rs/">rustup</a>.</p>
<p>Once you have your virtual environment set up and activated, you can install the Glean Python SDK into it using:</p>
<pre><code class="language-bash">$ python -m pip install glean_sdk
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="important-1"><a class="header" href="#important-1">Important</a></h5>
<blockquote>
<p>Installing Python wheels is still a rapidly evolving feature of the Python package ecosystem.
If the above command fails, try upgrading <code>pip</code>:</p>
<pre><code class="language-bash">python -m pip install --upgrade pip
</code></pre>
</blockquote>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="important-2"><a class="header" href="#important-2">Important</a></h5>
<blockquote>
<p>The Glean Python SDK make extensive use of type annotations to catch type related errors at build time. We highly recommend adding <a href="https://mypy-lang.org">mypy</a> to your continuous integration workflow to catch errors related to type mismatches early.</p>
</blockquote>
<h2 id="consuming-yaml-registry-files"><a class="header" href="#consuming-yaml-registry-files">Consuming YAML registry files</a></h2>
<p>For Python, the <code>metrics.yaml</code> file must be available and loaded at runtime.</p>
<p>If your project is a script (i.e. just Python files in a directory), you can load the <code>metrics.yaml</code> using:</p>
<pre><code class="language-Python">from glean import load_metrics

metrics = load_metrics(&quot;metrics.yaml&quot;)

# Use a metric on the returned object
metrics.your_category.your_metric.set(&quot;value&quot;)
</code></pre>
<p>If your project is a distributable Python package, you need to include the <code>metrics.yaml</code> file using <a href="https://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files">one of the myriad ways to include data in a Python package</a> and then use <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#resource-extraction"><code>pkg_resources.resource_filename()</code></a> to get the filename at runtime.</p>
<pre><code class="language-Python">from glean import load_metrics
from pkg_resources import resource_filename

metrics = load_metrics(resource_filename(__name__, &quot;metrics.yaml&quot;))

# Use a metric on the returned object
metrics.your_category.your_metric.set(&quot;value&quot;)
</code></pre>
<h3 id="automation-steps"><a class="header" href="#automation-steps">Automation steps</a></h3>
<h4 id="documentation"><a class="header" href="#documentation">Documentation</a></h4>
<p>The documentation for your application or library's metrics and pings are written in <code>metrics.yaml</code> and <code>pings.yaml</code>. </p>
<p>For Mozilla projects, this SDK documentation is automatically published on the <a href="https://dictionary.telemetry.mozilla.org">Glean Dictionary</a>. For non-Mozilla products, it is recommended to generate markdown-based documentation of your metrics and pings into the repository. For most languages and platforms, this transformation can be done automatically as part of the build. However, for some SDKs the integration to automatically generate docs is an additional step.</p>
<p>The Glean Python SDK provides a commandline tool for automatically generating markdown documentation from your <code>metrics.yaml</code> and <code>pings.yaml</code> files. To perform that translation, run <code>glean_parser</code>'s <code>translate</code> command:</p>
<pre><code class="language-sh">python3 -m glean_parser translate -f markdown -o docs metrics.yaml pings.yaml
</code></pre>
<p>To get more help about the commandline options:</p>
<pre><code class="language-sh">python3 -m glean_parser translate --help
</code></pre>
<p>We recommend integrating this step into your project's documentation build. The details of that integration is left to you, since it depends on the documentation tool being used and how your project is set up.</p>
<h4 id="metrics-linting"><a class="header" href="#metrics-linting">Metrics linting</a></h4>
<p>Glean includes a &quot;linter&quot; for <code>metrics.yaml</code> and <code>pings.yaml</code> files called the <code>glinter</code> that catches a number of common mistakes in these files.</p>
<p>As part of your continuous integration, you should run the following on your <code>metrics.yaml</code> and <code>pings.yaml</code> files:</p>
<pre><code class="language-sh">python3 -m glean_parser glinter metrics.yaml pings.yaml
</code></pre>
<h3 id="parallelism"><a class="header" href="#parallelism">Parallelism</a></h3>
<p>Most Glean SDKs use a separate worker thread to do most of its work, including any I/O. This thread is fully managed by the SDK as an implementation detail. Therefore, users should feel free to use the Glean SDKs wherever they are most convenient, without worrying about the performance impact of updating metrics and sending pings.</p>
<p>Since the Glean SDKs perform disk and networking I/O, they try to do as much of their work as possible on separate threads and processes.
Since there are complex trade-offs and corner cases to support Python parallelism, it is hard to design a one-size-fits-all approach.</p>
<h4 id="default-behavior"><a class="header" href="#default-behavior">Default behavior</a></h4>
<p>When using the Python SDK, most of the Glean's work is done on a separate thread, managed by the SDK itself.
The SDK releases the Global Interpreter Lock (GIL) for most of its operations, therefore your application's threads should not be in contention with the Glean's worker thread.</p>
<p>The Glean Python SDK installs an <a href="https://docs.python.org/3/library/atexit.html"><code>atexit</code> handler</a> so that its worker thread can cleanly finish when your application exits.
This handler will wait up to 30 seconds for any pending work to complete.</p>
<p>By default, ping uploading is performed in a separate child process. This process will continue to upload any pending pings even after the main process shuts down. This is important for commandline tools where you want to return control to the shell as soon as possible and not be delayed by network connectivity.</p>
<h4 id="cases-where-subprocesses-arent-possible"><a class="header" href="#cases-where-subprocesses-arent-possible">Cases where subprocesses aren't possible</a></h4>
<p>The default approach may not work with applications built using <a href="https://www.pyinstaller.org/"><code>PyInstaller</code></a> or similar tools which bundle an application together with a Python interpreter making it impossible to spawn new subprocesses of that interpreter. For these cases, there is an option to ensure that ping uploading occurs in the main process. To do this, set the <code>allow_multiprocessing</code> parameter on the <code>glean.Configuration</code> object to <code>False</code>.</p>
<h4 id="using-the-multiprocessing-module"><a class="header" href="#using-the-multiprocessing-module">Using the <code>multiprocessing</code> module</a></h4>
<p>Additionally, the default approach does not work if your application uses the <code>multiprocessing</code> module for parallelism.
The Glean Python SDK can not wait to finish its work in a <code>multiprocessing</code> subprocess, since <code>atexit</code> handlers are not supported in that context.<br />
Therefore, if the Glean Python SDK detects that it is running in a <code>multiprocessing</code> subprocess, all of its work that would normally run on a worker thread will run on the main thread.
In practice, this should not be a performance issue: since the work is already in a subprocess, it will not block the main process of your application.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/adding-glean-to-your-project/python.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="adding-glean-to-your-javascript-project"><a class="header" href="#adding-glean-to-your-javascript-project">Adding Glean to your JavaScript project</a></h1>
<p>This page provides a step-by-step guide on how to integrate
the Glean JavaScript SDK into a JavaScript project.</p>
<p>Nevertheless this is just one of the required steps for integrating Glean successfully into a project. Check you the full <a href="user/adding-glean-to-your-project/./index.html">Glean integration checklist</a> for a comprehensive list of all the steps involved in doing so.</p>
<p>The Glean JavaScript SDK allows integration with three distinct JavaScript environments:
<strong>websites, web extension and Node.js.</strong></p>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<ul>
<li>Node.js &gt;= 12.20.0</li>
<li>npm &gt;= 7.0.0</li>
<li>Webpack &gt;= 5.34.0</li>
<li>Python &gt;= 3.6
<ul>
<li>The <code>glean</code> command requires Python to download <a href="https://mozilla.github.io/glean_parser/"><code>glean_parser</code></a> which is a Python library</li>
</ul>
</li>
</ul>
<h3 id="browser-extension-specific-requirements"><a class="header" href="#browser-extension-specific-requirements">Browser extension specific requirements</a></h3>
<ul>
<li><a href="https://github.com/mozilla/webextension-polyfill">webextension-polyfill</a> &gt;= 0.8.0
<ul>
<li>Glean.js assumes a Promise-based <code>browser</code> API: Firefox provides such an API by default.
Other browsers may require using a polyfill library such us <code>webextension-polyfill</code>
when using Glean in browser extensions</li>
</ul>
</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#host_permissions">Host permissions</a> to the telemetry server
<ul>
<li>Only necessary if the defined server endpoint denies
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">cross-origin</a> requests</li>
</ul>
</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api_permissions">&quot;storage&quot;</a> API permissions</li>
</ul>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h4 id="browser-extension-example-configuration"><a class="header" href="#browser-extension-example-configuration">Browser extension example configuration</a></h4>
<blockquote>
<p>The <a href="https://github.com/mozilla/glean.js/blob/main/samples/web-extension/javascript/manifest.json"><code>manifest.json</code></a>
file of the sample browser extension available on the <code>mozilla/glean.js</code> repository provides
an example on how to define the above permissions as well as how and where to load
the <code>webextension-polyfill</code> script.</p>
</blockquote>
<h2 id="setting-up-the-dependency-3"><a class="header" href="#setting-up-the-dependency-3">Setting up the dependency</a></h2>
<p>The Glean JavaScript SDK is distributed as an npm package
<a href="https://www.npmjs.com/package/@mozilla/glean"><code>@mozilla/glean</code></a>.</p>
<p>This package has different entry points to access the different SDKs.</p>
<ul>
<li><code>@mozilla/glean/web</code> gives access to the websites SDK</li>
<li><code>@mozilla/glean/webext</code> gives access to the web extension SDK</li>
<li><code>@mozilla/glean/node</code> gives access to the Node.js SDK<sup class="footnote-reference"><a href="#1">1</a></sup></li>
</ul>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>The Node.js SDK does not have persistent storage yet. This means, Glean does not persist
state throughout application runs. For updates on the implementation of this feature in Node.js,
follow <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1728807">Bug 1728807</a>.</p>
</div>
<p>Install Glean in your JavaScript project, by running:</p>
<pre><code class="language-bash">npm install @mozilla/glean
</code></pre>
<p>Then import Glean into your project:</p>
<pre><code class="language-js">// Importing the Glean JavaScript SDK for use in **web extensions**
//
// esm
import Glean from &quot;@mozilla/glean/webext&quot;;
// cjs
const { default: Glean } = require(&quot;@mozilla/glean/webext&quot;);

// Importing the Glean JavaScript SDK for use in **websites**
//
// esm
import Glean from &quot;@mozilla/glean/web&quot;;
// cjs
const { default: Glean } = require(&quot;@mozilla/glean/web&quot;);

// Importing the Glean JavaScript SDK for use in **Node.js**
//
// esm
import Glean from &quot;@mozilla/glean/node&quot;;
// cjs
const { default: Glean } = require(&quot;@mozilla/glean/node&quot;);
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h3 id="browser-extension-security-considerations"><a class="header" href="#browser-extension-security-considerations">Browser extension security considerations</a></h3>
<blockquote>
<p>In case of privilege-escalation attack into the context of the web extension using Glean,
the malicious scripts would be able to call Glean APIs or use the <code>browser.storage.local</code> APIs directly.
That would be a risk to Glean data, but not caused by Glean. Glean-using extensions should be careful
not to relax the default Content-Security-Policy that generally prevents these attacks.</p>
</blockquote>
<h3 id="common-import-errors"><a class="header" href="#common-import-errors">Common import errors</a></h3>
<h4 id="cannot-find-module-mozillaglean"><a class="header" href="#cannot-find-module-mozillaglean">&quot;Cannot find module '@mozilla/glean'&quot;</a></h4>
<p>Glean.js does not have a <a href="https://nodejs.org/api/packages.html#packages_main_entry_point_export"><code>main</code></a> package entry point.
Instead it relies on a series of entry points depending on the platform you are targeting.</p>
<p>In order to import Glean use:</p>
<pre><code class="language-js">import Glean from '@mozilla/glean/{your-platform}'
</code></pre>
<h4 id="module-not-found-error-cant-resolve-mozillagleanwebext-in-"><a class="header" href="#module-not-found-error-cant-resolve-mozillagleanwebext-in-">&quot;Module not found: Error: Can't resolve '@mozilla/glean/webext' in '...'&quot;</a></h4>
<p>Glean.js relies on Node.js' <a href="https://nodejs.org/api/packages.html#packages_subpath_exports">subpath exports</a>
feature to define multiple package entry points.</p>
<p>Please make sure that you are using a supported Node.js runtime and also make sure the tools you are using support this Node.js feature.</p>
<h2 id="setting-up-metrics-and-pings-code-generation-2"><a class="header" href="#setting-up-metrics-and-pings-code-generation-2">Setting up metrics and pings code generation</a></h2>
<p>In JavaScript, the metrics and pings definitions must be parsed at build time.
The <code>@mozilla/glean</code> package exposes <a href="https://github.com/mozilla/glean_parser">glean_parser</a> through the <code>glean</code> script.</p>
<p>To parse your YAML registry files using this script, define a new script in your <code>package.json</code> file:</p>
<pre><code class="language-json">{
  // ...
  &quot;scripts&quot;: {
    // ...
    &quot;build:glean&quot;: &quot;glean translate path/to/metrics.yaml path/to/pings.yaml -f javascript -o path/to/generated&quot;,
    // Or, if you are building for a Typescript project
    &quot;build:glean&quot;: &quot;glean translate path/to/metrics.yaml path/to/pings.yaml -f typescript -o path/to/generated&quot;
  }
}
</code></pre>
<p>Then run this script by calling:</p>
<pre><code class="language-bash">npm run build:glean
</code></pre>
<h2 id="automation-steps-1"><a class="header" href="#automation-steps-1">Automation steps</a></h2>
<h3 id="documentation-1"><a class="header" href="#documentation-1">Documentation</a></h3>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h4 id="prefer-using-the-glean-dictionary"><a class="header" href="#prefer-using-the-glean-dictionary">Prefer using the Glean Dictionary</a></h4>
<blockquote>
<p>While it is still possible to generate Markdown documentation,
if working on a public Mozilla project rely on the <a href="https://dictionary.telemetry.mozilla.org">Glean Dictionary</a> for documentation.
Your product will be automatically indexed by the Glean Dictionary after it gets enabled in the pipeline.</p>
</blockquote>
<p>One of the commands provided by <code>glean_parser</code> allows users to generate Markdown documentation based on the contents of their YAML registry files.
To perform that translation, use the <code>translate</code> command with a different output format, as shown below.</p>
<p>In your <code>package.json</code>, define the following script:</p>
<pre><code class="language-json">{
  // ...
  &quot;scripts&quot;: {
    // ...
    &quot;docs:glean&quot;: &quot;glean translate path/to/metrics.yaml path/to/pings.yaml -f markdown -o path/to/docs&quot;,
  }
}
</code></pre>
<p>Then run this script by calling:</p>
<pre><code class="language-bash">npm run docs:glean
</code></pre>
<h3 id="yaml-registry-files-linting"><a class="header" href="#yaml-registry-files-linting">YAML registry files linting</a></h3>
<p>Glean includes a &quot;linter&quot; for the YAML registry files called the <code>glinter</code> that catches a number of common mistakes in these files.
To run the linter use the <code>glinter</code> command.</p>
<p>In your <code>package.json</code>, define the following script:</p>
<pre><code class="language-json">{
  // ...
  &quot;scripts&quot;: {
    // ...
    &quot;lint:glean&quot;: &quot;glean glinter path/to/metrics.yaml path/to/pings.yaml&quot;,
  }
}
</code></pre>
<p>Then run this script by calling:</p>
<pre><code class="language-bash">npm run lint:glean
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/adding-glean-to-your-project/javascript.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="adding-glean-to-your-qtqml-project"><a class="header" href="#adding-glean-to-your-qtqml-project">Adding Glean to your Qt/QML project</a></h1>
<p>This page provides a step-by-step guide on how to integrate the <a href="https://github.com/mozilla/glean.js/">Glean.js</a> library into a Qt/QML project.</p>
<p>Nevertheless this is just one of the required steps for integrating Glean successfully into a project. Check you the full <a href="user/adding-glean-to-your-project/./index.html">Glean integration checklist</a> for a comprehensive list of all the steps involved in doing so.</p>
<h2 id="requirements-2"><a class="header" href="#requirements-2">Requirements</a></h2>
<ul>
<li>Python &gt;= 3.6</li>
<li>Qt &gt;= 5.15.2</li>
</ul>
<h2 id="setting-up-the-dependency-4"><a class="header" href="#setting-up-the-dependency-4">Setting up the dependency</a></h2>
<p>Glean.js' Qt/QML build is distributed as an asset with every Glean.js release. In order to download
the latest version visit <a href="https://github.com/mozilla/glean.js/releases/latest">https://github.com/mozilla/glean.js/releases/latest</a>.</p>
<p>Glean.js is a <a href="https://doc.qt.io/qt-5/qtqml-modules-topic.html">QML module</a>,
so extract the contents of the downloaded file wherever you keep your other modules.
Make sure that whichever directory that module is placed in, is part of the
<a href="https://doc.qt.io/qt-5/qtqml-syntax-imports.html#qml-import-path">QML Import Path</a>.</p>
<p>After doing that, import Glean like so:</p>
<pre><code class="language-qml">import org.mozilla.Glean &lt;version&gt;
</code></pre>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h3 id="picking-the-correct-version"><a class="header" href="#picking-the-correct-version">Picking the correct version</a></h3>
<blockquote>
<p>The <code>&lt;version&gt;</code> number is the version of the release you downloaded minus its patch version.
For example, if you downloaded Glean.js version <code>0.15.0</code> your import statement will be:</p>
<pre><code class="language-qml">import org.mozilla.Glean 0.15
</code></pre>
</blockquote>
<h2 id="consuming-yaml-registry-files-1"><a class="header" href="#consuming-yaml-registry-files-1">Consuming YAML registry files</a></h2>
<p>Qt/QML projects need to setup metrics and pings code generation manually.</p>
<p>First install the <a href="https://mozilla.github.io/glean_parser/"><code>glean_parser</code></a> CLI tool.</p>
<pre><code class="language-bash">pip install glean_parser
</code></pre>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h3 id="make-sure-you-have-the-correct-glean_parser-version"><a class="header" href="#make-sure-you-have-the-correct-glean_parser-version">Make sure you have the correct <code>glean_parser</code> version!</a></h3>
<blockquote>
<p>Qt/QML support was added to <code>glean_parser</code> in version <strong>3.5.0</strong>.</p>
</blockquote>
<p>Then call <code>glean_parser</code> from the command line:</p>
<pre><code class="language-bash">glean_parser translate path/to/metrics.yaml path/to/pings.yaml \
  -f javascript \
  -o path/to/generated/files \
  --option platform=qt \
  --option version=0.15
</code></pre>
<p>The <code>translate</code> command will takes a list of YAML registry file paths and an output path and parse
the given YAML registry files into QML JavaScript files.</p>
<p>The generated folder will be a QML module. Make sure wherever the generated module is placed is also
part of the <a href="https://doc.qt.io/qt-5/qtqml-syntax-imports.html#qml-import-path">QML Import Path</a>.</p>
<p>Notice that when building for Qt/QML it is mandatory to give the <code>translate</code> command two extra options.</p>
<h4 id="--option-platformqt"><a class="header" href="#--option-platformqt"><code>--option platform=qt</code></a></h4>
<p>This option is what changes the output file from standard JavaScript to QML JavaScript.</p>
<h4 id="--option-versionversion"><a class="header" href="#--option-versionversion"><code>--option version=&lt;version&gt;</code></a></h4>
<p>The version passed to this option will be the version of the generated QML module.</p>
<h2 id="automation-steps-2"><a class="header" href="#automation-steps-2">Automation steps</a></h2>
<h3 id="documentation-2"><a class="header" href="#documentation-2">Documentation</a></h3>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h4 id="prefer-using-the-glean-dictionary-1"><a class="header" href="#prefer-using-the-glean-dictionary-1">Prefer using the Glean Dictionary</a></h4>
<blockquote>
<p>While it is still possible to generate Markdown documentation, if working on a public Mozilla project rely on the <a href="https://dictionary.telemetry.mozilla.org">Glean Dictionary</a> for documentation.
Your product will be automatically indexed by the Glean Dictionary after it gets enabled in the pipeline.</p>
</blockquote>
<p>One of the commands provided by <code>glean_parser</code> allows users to generate Markdown documentation based
on the contents of their YAML registry files. To perform that translation, use the <code>translate</code> command
with a different output format, as shown below.</p>
<pre><code class="language-bash">glean_parser translate path/to/metrics.yaml path/to/pings.yaml \
  -f markdown \
  -o path/to/docs
</code></pre>
<h3 id="yaml-registry-files-linting-1"><a class="header" href="#yaml-registry-files-linting-1">YAML registry files linting</a></h3>
<p><code>glean_parser</code> includes a &quot;linter&quot; for the YAML registry files called the <code>glinter</code> that catches a
number of common mistakes in these files. To run the linter use the <code>glinter</code> command.</p>
<pre><code class="language-bash">glean_parser glinter path/to/metrics.yaml path/to/pings.yaml
</code></pre>
<h2 id="debugging"><a class="header" href="#debugging">Debugging</a></h2>
<p>By default, the Glean.js QML module uses a minified version of the Glean.js library.
It may be useful to use the unminified version of the library in order to get proper
line numbers and function names when debugging crashes.</p>
<p>The bundle provided contains the unminified version of the library.
In order to use it, open the <code>glean.js</code> file inside the included module and change the line:</p>
<pre><code>.import &quot;glean.lib.js&quot; as Glean
</code></pre>
<p>to</p>
<pre><code>.import &quot;glean.dev.js&quot; as Glean
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="submitping-may-cause-crashes-when-debugging-ios-devices"><a class="header" href="#submitping-may-cause-crashes-when-debugging-ios-devices"><code>submitPing</code> may cause crashes when debugging iOS devices</a></h3>
<p>The <a href="user/adding-glean-to-your-project/../../reference/pings/index.html"><code>submitPing</code></a> function hits a
<a href="https://bugreports.qt.io/browse/QTBUG-96788">known bug</a> in the Qt JavaScript interpreter.</p>
<p>This bug is only reproduced in iOS devices, it does not happen in emulators. It also
<strong>only happens when using the Qt debug library for iOS</strong>.</p>
<p>There is no way around this bug other than avoiding the Qt debug library for iOS altogether until
it is fixed. Refer to the <a href="https://doc.qt.io/qt-5/debug.html#debugging-in-macos-and-xcode">the Qt debugging documentation</a> on how to do that.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/adding-glean-to-your-project/qt.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="integrating-glean-for-product-managers"><a class="header" href="#integrating-glean-for-product-managers">Integrating Glean for product managers</a></h1>
<p>This chapter provides guidance for planning the work involved in integrating Glean into your product, for internal Mozilla customers.
For a technical coding perspective, see <a href="user/adding-glean-to-your-project/index.html">adding Glean to your project</a>.</p>
<p>Glean is the standard telemetry platform required for all new Mozilla products.
While there are some upfront costs to integrating Glean in your product, this pays off in easier long-term maintenance and a rich set of self-serve analysis tools.
The Glean team is happy to support your telemetry integration and make it successful.
Find us in <a href="https://chat.mozilla.org/#/room/#glean:mozilla.org">#glean</a> or email <a href="mailto:glean-team@mozilla.com">glean-team@mozilla.com</a>.</p>
<h2 id="building-a-telemetry-plan"><a class="header" href="#building-a-telemetry-plan">Building a telemetry plan</a></h2>
<p>The Glean SDKs provide support for answering basic product questions out-of-the-box, such as daily active users, product version and platform information.<br />
However, it is also a good idea to have a sense of any additional product-specific questions you are trying to answer with telemetry, and, when possible, in collaboration with a data scientist.<br />
This of course helps for your own planning, but is also invaluable for the Glean team to support you, since we will understand the ultimate goals of your product's telemetry and ensure the design will meet those goals and we can identify any new features that may be required.
It is best to frame this document in the form of questions and use cases rather than as specific data points and schemas.</p>
<h2 id="integrating-glean-into-your-product"><a class="header" href="#integrating-glean-into-your-product">Integrating Glean into your product</a></h2>
<p>The <a href="user/adding-glean-to-your-project/index.html">technical steps for integrating Glean in your product are documented in its own chapter</a> for supported platforms.
We recommend having a member of the Glean team review this integration to catch any potential pitfalls.</p>
<h2 id="optional-adapting-glean-to-your-platform"><a class="header" href="#optional-adapting-glean-to-your-platform">(Optional) Adapting Glean to your platform</a></h2>
<p>The Glean SDKs are a collection of cross platform libraries and tools that facilitate collection of Glean conforming telemetry from applications.<br />
Consult the list of the currently supported <a href="user/../index.html">platforms and languages</a>.
If your product's tech stack isn't currently supported, please reach out to the Glean team: significant work will be required to create a new integration.<br />
In previous efforts, this has ranged from 1 to 3 months FTE of work, so it is important to plan for this work well in advance.
While the first phase of this work generally requires the specialized expertise of the Glean team, the second half can benefit from outside developers to move faster.</p>
<h2 id="optional-designing-ping-submission"><a class="header" href="#optional-designing-ping-submission">(Optional) Designing ping submission</a></h2>
<p>The Glean SDKs periodically send telemetry to our servers in a bundle known as a &quot;<a href="user/../appendix/glossary.html#ping">ping</a>&quot;.<br />
For mobile applications with common interaction models, such as web browsers, the Glean SDKs provide <a href="user/pings/index.html">basic pings out-of-the-box</a>.
For other kinds of products, it may be necessary to carefully design what triggers the submission of a ping.
It is important to have a solid telemetry plan (see above) so we can make sure the ping submission will be able to answer the telemetry questions required of the product.</p>
<h2 id="optional-new-metric-types"><a class="header" href="#optional-new-metric-types">(Optional) New metric types</a></h2>
<p>The Glean SDKs have a number of <a href="https://mozilla.github.io/glean/book/user/metrics/index.html">different metric types</a> that it can collect.<br />
Metric types provide &quot;guardrails&quot; to make sure that telemetry is being collected correctly, and to present the data at analysis time more automatically.
Occasionally, products need to collect data that doesn't fit neatly into one of the available metric types.
Glean <a href="https://wiki.mozilla.org/Glean/Adding_or_changing_Glean_metric_types">has a process</a> to request and introduce more metric types and we will work with you to design something appropriate.
This design and implementation work is at least 4 weeks, though we are working on the foundation to accelerate that.
Having a telemetry plan (see above) will help to identify this work early.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/integrating-glean-for-product-managers.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="adding-new-metrics"><a class="header" href="#adding-new-metrics">Adding new metrics</a></h1>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#process-overview">Process overview</a></li>
<li><a href="user/metrics/adding-new-metrics.html#choosing-a-metric-type">Choosing a metric type</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#is-it-a-single-measurement">Is it a single measurement?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-measuring-user-behavior">Are you measuring user behavior?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-counting-things">Are you counting things?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-measuring-time">Are you measuring time?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#for-how-long-do-you-need-to-collect-this-data">For how long do you need to collect this data?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">When should the Glean SDK automatically clear the measurement?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#a-lifetime-example">A lifetime example</a></li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-lifetimes-are-appropriate">What if none of these lifetimes are appropriate?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-should-this-new-metric-be-called">What should this new metric be called?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#reuse-names-from-other-applications">Reuse names from other applications</a></li>
<li><a href="user/metrics/adding-new-metrics.html#make-names-unique-within-an-application">Make names unique within an application</a></li>
<li><a href="user/metrics/adding-new-metrics.html#be-as-specific-as-possible">Be as specific as possible</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-metric-types-is-the-right-fit">What if none of these metric types is the right fit?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#how-do-i-make-sure-my-metric-is-working">How do I make sure my metric is working?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file">Adding the metric to the <code>metrics.yaml</code> file</a></li>
<li><a href="user/metrics/adding-new-metrics.html#using-the-metric-from-your-code">Using the metric from your code</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#capitalization">Capitalization</a></li>
</ul>
</li>
</ul>
<h2 id="process-overview"><a class="header" href="#process-overview">Process overview</a></h2>
<p>When adding a new metric, the process is:</p>
<ul>
<li>Consider the question you are trying to answer with this data, and choose the <a href="user/metrics/../../reference/metrics/index.html">metric type</a> and parameters to use.</li>
<li>Add a new entry to <a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file"><code>metrics.yaml</code></a>.</li>
<li>Add code to your project to record into the metric by calling the Glean SDK.</li>
</ul>
<blockquote>
<p><strong>Important</strong>: Any new data collection requires documentation and <a href="https://wiki.mozilla.org/Firefox/Data_Collection">data-review</a>. This is also required for any new metric automatically collected by the Glean SDK.</p>
</blockquote>
<h2 id="choosing-a-metric-type"><a class="header" href="#choosing-a-metric-type">Choosing a metric type</a></h2>
<p>The following is a set of questions to ask about the data being collected to help better determine which metric type to use.</p>
<h3 id="is-it-a-single-measurement"><a class="header" href="#is-it-a-single-measurement">Is it a single measurement?</a></h3>
<p>If the value is true or false, use a <a href="user/metrics/../../reference/metrics/boolean.html">boolean metric</a>.</p>
<p>If the value is a string, use a <a href="user/metrics/../../reference/metrics/string.html">string metric</a>. For example, to record the name of the default search engine.</p>
<blockquote>
<p><strong>Beware:</strong> string metrics are exceedingly general, and you are probably best served by selecting the most specific metric for the job, since you'll get better error checking and richer analysis tools for free. For example, avoid storing a number in a string metric --- you probably want a <a href="user/metrics/../../reference/metrics/counter.html">counter metric</a> instead.</p>
</blockquote>
<p>If you need to store multiple string values in a metric, use a <a href="user/metrics/../../reference/metrics/string_list.html">string list metric</a>. For example, you may want to record the list of other Mozilla products installed on the device.</p>
<!-- TODO: If you do know the list of values you might store and you just want to record their presence, consider using a [labeled boolean](../../reference/metrics/labeled_boolean.html) instead. -->
<!-- If you have a related set of metrics that you want to record strings for, and you don't know the things the strings relate to at build time, use a [labeled string metric](../../reference/metrics/labeled_strings.html). -->
<p>For all of the metric types in this section that measure single values, it is especially important to consider how the lifetime of the value relates to the ping it is being sent in. Since these metrics don't perform any aggregation on the client side, when a ping containing the metric is submitted, it will contain only the &quot;last known&quot; value for the metric, potentially resulting in <strong>data loss</strong>.  There is further discussion of <a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">metric lifetimes</a> below.</p>
<h3 id="are-you-measuring-user-behavior"><a class="header" href="#are-you-measuring-user-behavior">Are you measuring user behavior?</a></h3>
<p>For tracking user behavior, it is usually meaningful to know the over of events that lead to the use of a feature.  Therefore, for user behavior, an <a href="user/metrics/../../reference/metrics/event.html">event metric</a> is usually the best choice.</p>
<p>Be aware, however, that events can be particularly expensive to transmit, store and analyze, so should not be used for higher-frequency measurements.</p>
<h3 id="are-you-counting-things"><a class="header" href="#are-you-counting-things">Are you counting things?</a></h3>
<p>If you want to know how many times something happened, use a <a href="user/metrics/../../reference/metrics/counter.html">counter metric</a>.  If you are counting a group of related things, or you don't know what all of the things to count are at build time, use a <a href="user/metrics/../../reference/metrics/labeled_counters.html">labeled counter metric</a>.</p>
<p>If you need to know how many times something happened relative to the number of times something else happened,
use a <a href="user/metrics/../../reference/metrics/rate.html">rate metric</a>.</p>
<p>If you need to know when the things being counted happened relative to other things, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h3 id="are-you-measuring-time"><a class="header" href="#are-you-measuring-time">Are you measuring time?</a></h3>
<p>If you need to record an absolute time, use a <a href="user/metrics/../../reference/metrics/datetime.html">datetime metric</a>. Datetimes are recorded in the user's local time, according to their device's real time clock, along with a timezone offset from UTC. Datetime metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.</p>
<p>If you need to record how long something takes you have a few options.</p>
<p>If you need to measure the total time spent doing a particular task, look to the <a href="user/metrics/../../reference/metrics/timespan.html">timespan metric</a>. Timespan metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.
Note that this metric should only be used to measure time on a single thread. If multiple overlapping timespans are measured for the same metric, an invalid state error is recorded.</p>
<p>If you need to measure the relative occurrences of many timings, use a <a href="user/metrics/../../reference/metrics/timing_distribution.html">timing distribution</a>. It builds a histogram of timing measurements, and is safe to record multiple concurrent timespans on different threads.</p>
<p>If you need to know the time between multiple distinct actions that aren't a simple &quot;begin&quot; and &quot;end&quot; pair, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h2 id="for-how-long-do-you-need-to-collect-this-data"><a class="header" href="#for-how-long-do-you-need-to-collect-this-data">For how long do you need to collect this data?</a></h2>
<p>Think carefully about how long the metric will be needed, and set the <code>expires</code> parameter to disable the metric at the earliest possible time.
This is an important component of Mozilla's <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean data practices</a>.</p>
<p>When the metric passes its expiration date (determined at build time), it will automatically stop collecting data.</p>
<p>When a metric's expiration is within in 14 days, emails will be sent from <code>telemetry-alerts@mozilla.com</code> to the <code>notification_emails</code> addresses associated with the metric.
At that time, the metric should be removed, which involves removing it from the <code>metrics.yaml</code> file and removing uses of it in the source code.
Removing a metric does not affect the availability of data already collected by the pipeline.</p>
<p>If the metric is still needed after its expiration date, it should go back for <a href="https://wiki.mozilla.org/Firefox/Data_Collection">another round of data review</a> to have its expiration date extended.</p>
<blockquote>
<p><strong>Important:</strong> Ensure that telemetry alerts are received and are reviewed in a timely manner. Expired metrics don't record any data, extending or removing a metric should be done in time. Consider adding both a group email address and an individual who is responsible for this metric to the <code>notification_emails</code> list.</p>
</blockquote>
<h2 id="when-should-the-glean-sdk-automatically-clear-the-measurement"><a class="header" href="#when-should-the-glean-sdk-automatically-clear-the-measurement">When should the Glean SDK automatically clear the measurement?</a></h2>
<p>The <code>lifetime</code> parameter of a metric defines when its value will be cleared. There are three lifetime options available:</p>
<h5 id="ping-default"><a class="header" href="#ping-default"><code>ping</code> <em>(default)</em></a></h5>
<p>The metric is cleared each time it is submitted in the ping. This is the most common case,
and should be used for metrics that are highly dynamic, such as things computed
in response to the user's interaction with the application.</p>
<h5 id="application"><a class="header" href="#application"><code>application</code></a></h5>
<p>The metric is related to an application run, and is cleared after the application restarts
and any Glean-owned ping, due at startup, is submitted. This should be used for things
that are constant during the run of an application, such as the operating system version.
In practice, these metrics are generally set during application startup.  A common mistake---
using the ping lifetime for these type of metrics---means that they will only be included
in the first ping sent during a particular run of the application.</p>
<h5 id="user"><a class="header" href="#user"><code>user</code></a></h5>
<p><strong>Reach out to the Glean team before using this.</strong></p>
<p>The metric is part of the user's profile and will live as long as the profile lives.
This is often not the best choice unless the metric records a value that <em>really</em> needs
to be persisted for the full lifetime of the user profile, e.g. an identifier like the <code>client_id</code>,
the day the product was first executed. It is rare to use this lifetime outside of some metrics
that are built in to the Glean SDK.</p>
<p>While lifetimes are important to understand for all metric types, they are particularly important for the metric types that record single values and don't aggregate on the client (<code>boolean</code>, <code>string</code>, <code>labeled_string</code>, <code>string_list</code>, <code>datetime</code> and <code>uuid</code>), since these metrics will send the &quot;last known&quot; value and missing the earlier values could be a form of unintended data loss.</p>
<h3 id="a-lifetime-example"><a class="header" href="#a-lifetime-example">A lifetime example</a></h3>
<p>Let's work through an example to see how these lifetimes play out in practice. Let's suppose we have a user preference, &quot;turbo mode&quot;, which defaults to <code>false</code>, but the user can turn it to <code>true</code> at any time.  We want to know when this flag is <code>true</code> so we can measure its affect on other metrics in the same ping.  In the following diagram, we look at a time period that sends 4 pings across two separate runs of the application. We assume here, that like the Glean SDK's built-in <a href="user/metrics/../pings/metrics.html">metrics ping</a>, the developer writing the metric isn't in control of when the ping is submitted.</p>
<p>In this diagram, the ping measurement windows are represented as rectangles, but the moment the ping is &quot;submitted&quot; is represented by its right edge. The user changes the &quot;turbo mode&quot; setting from <code>false</code> to <code>true</code> in the first run, and then toggles it again twice in the second run.</p>
<p><img src="user/metrics/../metric-lifetime-timeline.svg" alt="Metric lifetime timeline" /></p>
<ul>
<li>
<p><strong>A. Ping lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet.  It is included in the first ping after being recorded (Ping 2), which causes it to be cleared.</p>
</li>
<li>
<p><strong>B. Ping lifetime, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Ping 2, which causes it to be cleared.  It therefore misses Ping 3, but when the application is started, it is recorded again and it is included in Ping 4.  However, this causes it to be cleared again and it is not in Ping 5.</p>
</li>
<li>
<p><strong>C. Application lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet. After the value is changed, it is included in Pings 2 and 3, but then due to application restart it is cleared, so it is not included until the value is manually toggled again.</p>
</li>
<li>
<p><strong>D. Application, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Pings 2 and 3. Even though the application startup causes it to be cleared, it is set again, and all subsequent pings also have the value.</p>
</li>
<li>
<p><strong>E. User, set on change</strong>: The default value is missing from Ping 1, but since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset (e.g. on Android, when the product is uninstalled), it is included in all subsequent pings.</p>
</li>
<li>
<p><strong>F. User, set on init and change</strong>: Since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset, it is included in all subsequent pings.  This would be true even if the &quot;turbo mode&quot; preference were never changed again.</p>
</li>
</ul>
<p>Note that for all of the metric configurations, the toggle of the preference off and on during Ping 4 is completely missed.  If you need to create a ping containing one, and only one, value for this metric, consider using a <a href="user/metrics/../pings/custom.html">custom ping</a> to create a ping whose lifetime matches the lifetime of the value.</p>
<h3 id="what-if-none-of-these-lifetimes-are-appropriate"><a class="header" href="#what-if-none-of-these-lifetimes-are-appropriate">What if none of these lifetimes are appropriate?</a></h3>
<p>If the timing at which the metric is sent in the ping needs to closely match the timing of the metrics value, the best option is to use a <a href="user/metrics/../pings/custom.html">custom ping</a> to manually control when pings are sent.</p>
<p>This is especially useful when metrics need to be tightly related to one another, for example when you need to measure the distribution of frame paint times when a particular rendering backend is in use.  If these metrics were in different pings, with different measurement windows, it is much harder to do that kind of reasoning with much certainty.</p>
<h2 id="what-should-this-new-metric-be-called"><a class="header" href="#what-should-this-new-metric-be-called">What should this new metric be called?</a></h2>
<p>Metric names have a maximum length of 30 characters.</p>
<h3 id="reuse-names-from-other-applications"><a class="header" href="#reuse-names-from-other-applications">Reuse names from other applications</a></h3>
<p>There's a lot of value using the same name for analogous metrics collected across different products. For example, BigQuery makes it simple to join columns with the same name across multiple tables. Therefore, we encourage you to investigate if a similar metric is already being collected by another product. If it is, there may be an opportunity for code reuse across these products, and if all the projects are using the Glean SDK, it's easy for libraries to send their own metrics. If sharing the code doesn't make sense, at a minimum we recommend using the same metric name for similar actions and concepts whenever possible.</p>
<h3 id="make-names-unique-within-an-application"><a class="header" href="#make-names-unique-within-an-application">Make names unique within an application</a></h3>
<p>Metric identifiers (the combination of a metric's category and name) must be unique across all metrics that are sent by a single application.
This includes not only the metrics defined in the app's <code>metrics.yaml</code>, but the <code>metrics.yaml</code> of any Glean SDK-using library that the application uses, including the Glean SDK itself.
Therefore, care should be taken to name things specifically enough so as to avoid namespace collisions.
In practice, this generally involves thinking carefully about the <code>category</code> of the metric, more than the <code>name</code>.</p>
<blockquote>
<p><strong>Note:</strong> Duplicate metric identifiers are not currently detected at build time. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1578383">bug 1578383</a> for progress on that.
However, the <a href="https://github.com/mozilla/probe-scraper">probe_scraper</a> process, which runs nightly, will detect duplicate metrics and e-mail the <code>notification_emails</code> associated with the given metrics.</p>
</blockquote>
<h3 id="be-as-specific-as-possible"><a class="header" href="#be-as-specific-as-possible">Be as specific as possible</a></h3>
<p>More broadly, you should choose the names of metrics to be as specific as possible.
It is not necessary to put the type of the metric in the category or name, since this information is retained in other ways through the entire end-to-end system.</p>
<p>For example, if defining a set of events related to search, put them in a category called <code>search</code>, rather than just <code>events</code> or <code>search_events</code>. The <code>events</code> word here would be redundant.</p>
<h2 id="what-if-none-of-these-metric-types-is-the-right-fit"><a class="header" href="#what-if-none-of-these-metric-types-is-the-right-fit">What if none of these metric types is the right fit?</a></h2>
<p>The current set of metrics the Glean SDKs support is based on known common use cases, but new use cases are discovered all the time.</p>
<p>Please reach out to us on <a href="https://chat.mozilla.org/#/room/#glean:mozilla.org">#glean:mozilla.org</a>. If you think you need a new metric type, we <a href="user/metrics/../../reference/metrics/index.html#adding-or-changing-metric-types">have a process for that</a>.</p>
<h2 id="how-do-i-make-sure-my-metric-is-working"><a class="header" href="#how-do-i-make-sure-my-metric-is-working">How do I make sure my metric is working?</a></h2>
<p>The Glean SDK has rich support for writing unit tests involving metrics. Writing a good unit test is a large topic, but in general, you should write unit tests for all new telemetry that does the following:</p>
<ul>
<li>
<p>Performs the operation being measured.</p>
</li>
<li>
<p>Asserts that metrics contain the expected data, using the <code>testGetValue</code> API on the metric.</p>
</li>
<li>
<p>Where applicable, asserts that no errors are recorded, such as when values are out of range, using the <code>testGetNumRecordedErrors</code> API.</p>
</li>
</ul>
<p>In addition to unit tests, it is good practice to validate the incoming data for the new metric on a pre-release channel to make sure things are working as expected.</p>
<!--
TODO: This will be a good place to talk about the product telemetry health
dashboard when that's ready
-->
<h2 id="adding-the-metric-to-the-metricsyaml-file"><a class="header" href="#adding-the-metric-to-the-metricsyaml-file">Adding the metric to the <code>metrics.yaml</code> file</a></h2>
<p>The <a href="user/metrics/../../reference/yaml/metrics.html"><code>metrics.yaml</code> file</a> defines the metrics your application or library will send.
They are organized into categories.
The overall organization is:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

toolbar:
  click:
    type: event
    description: |
      Event to record toolbar clicks.
    metadata:
      tags:
        - Interaction
    notification_emails:
      - CHANGE-ME@example.com
    bugs:
      - https://bugzilla.mozilla.org/123456789/
    data_reviews:
      - http://example.com/path/to/data-review
    expires: 2019-06-01  # &lt;-- Update to a date in the future

  double_click:
    ...
</code></pre>
<p>Refer to the <a href="user/metrics/../../reference/yaml/metrics.html">metrics YAML registry format</a> for a full reference
on the <code>metrics.yaml</code> file structure.</p>
<h2 id="using-the-metric-from-your-code"><a class="header" href="#using-the-metric-from-your-code">Using the metric from your code</a></h2>
<p>The <a href="user/metrics/../../reference/metrics/index.html">reference documentation for each metric type</a> goes into detail about using each metric type from your code.</p>
<p>Note that all Glean metrics are write-only. Outside of unit tests, it is impossible to retrieve a value from the Glean SDK's database.
While this may seem limiting, this is required to:</p>
<ul>
<li>enforce the semantics of certain metric types (e.g. that Counters can only be incremented).</li>
<li>ensure the lifetime of the metric (when it is cleared or reset) is correctly handled.</li>
</ul>
<h3 id="capitalization"><a class="header" href="#capitalization">Capitalization</a></h3>
<p>One thing to note is that we try to adhere to the coding conventions of each language wherever possible, so the metric name and category in the <code>metrics.yaml</code> (which is in <code>snake_case</code>) may be changed to some other case convention, such as <code>camelCase</code>, when used from code.</p>
<p>Event extras and labels are never capitalized, no matter the target language.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Kotlin coding standards defined by <a href="https://github.com/pinterest/ktlint">ktlint</a>,
these identifiers must be <code>camelCase</code> in Kotlin.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views
GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Swift coding standards defined by <a href="https://github.com/realm/SwiftLint">swiftlint</a>,
these identifiers must be <code>camelCase</code> in Swift.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Swift">GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>, which matches the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> standard, so no translation is needed for Python.</p>
</div>
<div data-lang="Rust" class="tab">
<p>Given the Rust coding standards defined by
<a href="https://github.com/rust-lang/rust-clippy">clippy</a>,
identifiers should all be <code>snake_case</code>.
This includes category names which in the <code>metrics.yaml</code> are <code>dotted.snake_case</code>:</p>
<pre><code class="language-YAML">compound.category:
  metric_name:
    ...
</code></pre>
<p>In Rust this becomes:</p>
<pre><code class="language-Rust">use fog::metrics;

metrics::compound_category::metric_name...
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<p>JavaScript identifiers are customarily <code>camelCase</code>.
This requires transforming a metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">compound.category:
  metric_name:
    ...
</code></pre>
<p>to a form useful in JS as:</p>
<pre><code class="language-js">import * as compoundCategory from &quot;./path/to/generated/files/compoundCategory.js&quot;;

compoundCategory.metricName...
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p>Firefox Desktop has
<a href="https://firefox-source-docs.mozilla.org/code-quality/coding-style/index.html">Coding Style Guidelines</a>
for both C++ and JS.
This results in, for a metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">compound.category:
  metric_name:
    ...
</code></pre>
<p>an identifier that looks like:</p>
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::compound_category::metric_name...
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.compoundCategory.metricName...
</code></pre>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/adding-new-metrics.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="adding-new-metrics-1"><a class="header" href="#adding-new-metrics-1">Adding new metrics</a></h1>
<h2 id="table-of-contents-1"><a class="header" href="#table-of-contents-1">Table of Contents</a></h2>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#process-overview">Process overview</a></li>
<li><a href="user/metrics/adding-new-metrics.html#choosing-a-metric-type">Choosing a metric type</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#is-it-a-single-measurement">Is it a single measurement?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-measuring-user-behavior">Are you measuring user behavior?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-counting-things">Are you counting things?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#are-you-measuring-time">Are you measuring time?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#for-how-long-do-you-need-to-collect-this-data">For how long do you need to collect this data?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">When should the Glean SDK automatically clear the measurement?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#a-lifetime-example">A lifetime example</a></li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-lifetimes-are-appropriate">What if none of these lifetimes are appropriate?</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-should-this-new-metric-be-called">What should this new metric be called?</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#reuse-names-from-other-applications">Reuse names from other applications</a></li>
<li><a href="user/metrics/adding-new-metrics.html#make-names-unique-within-an-application">Make names unique within an application</a></li>
<li><a href="user/metrics/adding-new-metrics.html#be-as-specific-as-possible">Be as specific as possible</a></li>
</ul>
</li>
<li><a href="user/metrics/adding-new-metrics.html#what-if-none-of-these-metric-types-is-the-right-fit">What if none of these metric types is the right fit?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#how-do-i-make-sure-my-metric-is-working">How do I make sure my metric is working?</a></li>
<li><a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file">Adding the metric to the <code>metrics.yaml</code> file</a></li>
<li><a href="user/metrics/adding-new-metrics.html#using-the-metric-from-your-code">Using the metric from your code</a>
<ul>
<li><a href="user/metrics/adding-new-metrics.html#capitalization">Capitalization</a></li>
</ul>
</li>
</ul>
<h2 id="process-overview-1"><a class="header" href="#process-overview-1">Process overview</a></h2>
<p>When adding a new metric, the process is:</p>
<ul>
<li>Consider the question you are trying to answer with this data, and choose the <a href="user/metrics/../../reference/metrics/index.html">metric type</a> and parameters to use.</li>
<li>Add a new entry to <a href="user/metrics/adding-new-metrics.html#adding-the-metric-to-the-metricsyaml-file"><code>metrics.yaml</code></a>.</li>
<li>Add code to your project to record into the metric by calling the Glean SDK.</li>
</ul>
<blockquote>
<p><strong>Important</strong>: Any new data collection requires documentation and <a href="https://wiki.mozilla.org/Firefox/Data_Collection">data-review</a>. This is also required for any new metric automatically collected by the Glean SDK.</p>
</blockquote>
<h2 id="choosing-a-metric-type-1"><a class="header" href="#choosing-a-metric-type-1">Choosing a metric type</a></h2>
<p>The following is a set of questions to ask about the data being collected to help better determine which metric type to use.</p>
<h3 id="is-it-a-single-measurement-1"><a class="header" href="#is-it-a-single-measurement-1">Is it a single measurement?</a></h3>
<p>If the value is true or false, use a <a href="user/metrics/../../reference/metrics/boolean.html">boolean metric</a>.</p>
<p>If the value is a string, use a <a href="user/metrics/../../reference/metrics/string.html">string metric</a>. For example, to record the name of the default search engine.</p>
<blockquote>
<p><strong>Beware:</strong> string metrics are exceedingly general, and you are probably best served by selecting the most specific metric for the job, since you'll get better error checking and richer analysis tools for free. For example, avoid storing a number in a string metric --- you probably want a <a href="user/metrics/../../reference/metrics/counter.html">counter metric</a> instead.</p>
</blockquote>
<p>If you need to store multiple string values in a metric, use a <a href="user/metrics/../../reference/metrics/string_list.html">string list metric</a>. For example, you may want to record the list of other Mozilla products installed on the device.</p>
<!-- TODO: If you do know the list of values you might store and you just want to record their presence, consider using a [labeled boolean](../../reference/metrics/labeled_boolean.html) instead. -->
<!-- If you have a related set of metrics that you want to record strings for, and you don't know the things the strings relate to at build time, use a [labeled string metric](../../reference/metrics/labeled_strings.html). -->
<p>For all of the metric types in this section that measure single values, it is especially important to consider how the lifetime of the value relates to the ping it is being sent in. Since these metrics don't perform any aggregation on the client side, when a ping containing the metric is submitted, it will contain only the &quot;last known&quot; value for the metric, potentially resulting in <strong>data loss</strong>.  There is further discussion of <a href="user/metrics/adding-new-metrics.html#when-should-the-glean-sdk-automatically-clear-the-measurement">metric lifetimes</a> below.</p>
<h3 id="are-you-measuring-user-behavior-1"><a class="header" href="#are-you-measuring-user-behavior-1">Are you measuring user behavior?</a></h3>
<p>For tracking user behavior, it is usually meaningful to know the over of events that lead to the use of a feature.  Therefore, for user behavior, an <a href="user/metrics/../../reference/metrics/event.html">event metric</a> is usually the best choice.</p>
<p>Be aware, however, that events can be particularly expensive to transmit, store and analyze, so should not be used for higher-frequency measurements.</p>
<h3 id="are-you-counting-things-1"><a class="header" href="#are-you-counting-things-1">Are you counting things?</a></h3>
<p>If you want to know how many times something happened, use a <a href="user/metrics/../../reference/metrics/counter.html">counter metric</a>.  If you are counting a group of related things, or you don't know what all of the things to count are at build time, use a <a href="user/metrics/../../reference/metrics/labeled_counters.html">labeled counter metric</a>.</p>
<p>If you need to know how many times something happened relative to the number of times something else happened,
use a <a href="user/metrics/../../reference/metrics/rate.html">rate metric</a>.</p>
<p>If you need to know when the things being counted happened relative to other things, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h3 id="are-you-measuring-time-1"><a class="header" href="#are-you-measuring-time-1">Are you measuring time?</a></h3>
<p>If you need to record an absolute time, use a <a href="user/metrics/../../reference/metrics/datetime.html">datetime metric</a>. Datetimes are recorded in the user's local time, according to their device's real time clock, along with a timezone offset from UTC. Datetime metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.</p>
<p>If you need to record how long something takes you have a few options.</p>
<p>If you need to measure the total time spent doing a particular task, look to the <a href="user/metrics/../../reference/metrics/timespan.html">timespan metric</a>. Timespan metrics allow specifying the resolution they are collected at, and to stay <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean</a>, they should only be collected at the minimum resolution required to answer your question.
Note that this metric should only be used to measure time on a single thread. If multiple overlapping timespans are measured for the same metric, an invalid state error is recorded.</p>
<p>If you need to measure the relative occurrences of many timings, use a <a href="user/metrics/../../reference/metrics/timing_distribution.html">timing distribution</a>. It builds a histogram of timing measurements, and is safe to record multiple concurrent timespans on different threads.</p>
<p>If you need to know the time between multiple distinct actions that aren't a simple &quot;begin&quot; and &quot;end&quot; pair, consider using an <a href="user/metrics/../../reference/metrics/event.html">event</a>.</p>
<h2 id="for-how-long-do-you-need-to-collect-this-data-1"><a class="header" href="#for-how-long-do-you-need-to-collect-this-data-1">For how long do you need to collect this data?</a></h2>
<p>Think carefully about how long the metric will be needed, and set the <code>expires</code> parameter to disable the metric at the earliest possible time.
This is an important component of Mozilla's <a href="https://www.mozilla.org/en-US/about/policy/lean-data/stay-lean/">lean data practices</a>.</p>
<p>When the metric passes its expiration date (determined at build time), it will automatically stop collecting data.</p>
<p>When a metric's expiration is within in 14 days, emails will be sent from <code>telemetry-alerts@mozilla.com</code> to the <code>notification_emails</code> addresses associated with the metric.
At that time, the metric should be removed, which involves removing it from the <code>metrics.yaml</code> file and removing uses of it in the source code.
Removing a metric does not affect the availability of data already collected by the pipeline.</p>
<p>If the metric is still needed after its expiration date, it should go back for <a href="https://wiki.mozilla.org/Firefox/Data_Collection">another round of data review</a> to have its expiration date extended.</p>
<blockquote>
<p><strong>Important:</strong> Ensure that telemetry alerts are received and are reviewed in a timely manner. Expired metrics don't record any data, extending or removing a metric should be done in time. Consider adding both a group email address and an individual who is responsible for this metric to the <code>notification_emails</code> list.</p>
</blockquote>
<h2 id="when-should-the-glean-sdk-automatically-clear-the-measurement-1"><a class="header" href="#when-should-the-glean-sdk-automatically-clear-the-measurement-1">When should the Glean SDK automatically clear the measurement?</a></h2>
<p>The <code>lifetime</code> parameter of a metric defines when its value will be cleared. There are three lifetime options available:</p>
<h5 id="ping-default-1"><a class="header" href="#ping-default-1"><code>ping</code> <em>(default)</em></a></h5>
<p>The metric is cleared each time it is submitted in the ping. This is the most common case,
and should be used for metrics that are highly dynamic, such as things computed
in response to the user's interaction with the application.</p>
<h5 id="application-1"><a class="header" href="#application-1"><code>application</code></a></h5>
<p>The metric is related to an application run, and is cleared after the application restarts
and any Glean-owned ping, due at startup, is submitted. This should be used for things
that are constant during the run of an application, such as the operating system version.
In practice, these metrics are generally set during application startup.  A common mistake---
using the ping lifetime for these type of metrics---means that they will only be included
in the first ping sent during a particular run of the application.</p>
<h5 id="user-1"><a class="header" href="#user-1"><code>user</code></a></h5>
<p><strong>Reach out to the Glean team before using this.</strong></p>
<p>The metric is part of the user's profile and will live as long as the profile lives.
This is often not the best choice unless the metric records a value that <em>really</em> needs
to be persisted for the full lifetime of the user profile, e.g. an identifier like the <code>client_id</code>,
the day the product was first executed. It is rare to use this lifetime outside of some metrics
that are built in to the Glean SDK.</p>
<p>While lifetimes are important to understand for all metric types, they are particularly important for the metric types that record single values and don't aggregate on the client (<code>boolean</code>, <code>string</code>, <code>labeled_string</code>, <code>string_list</code>, <code>datetime</code> and <code>uuid</code>), since these metrics will send the &quot;last known&quot; value and missing the earlier values could be a form of unintended data loss.</p>
<h3 id="a-lifetime-example-1"><a class="header" href="#a-lifetime-example-1">A lifetime example</a></h3>
<p>Let's work through an example to see how these lifetimes play out in practice. Let's suppose we have a user preference, &quot;turbo mode&quot;, which defaults to <code>false</code>, but the user can turn it to <code>true</code> at any time.  We want to know when this flag is <code>true</code> so we can measure its affect on other metrics in the same ping.  In the following diagram, we look at a time period that sends 4 pings across two separate runs of the application. We assume here, that like the Glean SDK's built-in <a href="user/metrics/../pings/metrics.html">metrics ping</a>, the developer writing the metric isn't in control of when the ping is submitted.</p>
<p>In this diagram, the ping measurement windows are represented as rectangles, but the moment the ping is &quot;submitted&quot; is represented by its right edge. The user changes the &quot;turbo mode&quot; setting from <code>false</code> to <code>true</code> in the first run, and then toggles it again twice in the second run.</p>
<p><img src="user/metrics/../metric-lifetime-timeline.svg" alt="Metric lifetime timeline" /></p>
<ul>
<li>
<p><strong>A. Ping lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet.  It is included in the first ping after being recorded (Ping 2), which causes it to be cleared.</p>
</li>
<li>
<p><strong>B. Ping lifetime, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Ping 2, which causes it to be cleared.  It therefore misses Ping 3, but when the application is started, it is recorded again and it is included in Ping 4.  However, this causes it to be cleared again and it is not in Ping 5.</p>
</li>
<li>
<p><strong>C. Application lifetime, set on change</strong>: The value isn't included in Ping 1, because Glean doesn't know about it yet. After the value is changed, it is included in Pings 2 and 3, but then due to application restart it is cleared, so it is not included until the value is manually toggled again.</p>
</li>
<li>
<p><strong>D. Application, set on init and change</strong>: The default value is included in Ping 1, and the changed value is included in Pings 2 and 3. Even though the application startup causes it to be cleared, it is set again, and all subsequent pings also have the value.</p>
</li>
<li>
<p><strong>E. User, set on change</strong>: The default value is missing from Ping 1, but since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset (e.g. on Android, when the product is uninstalled), it is included in all subsequent pings.</p>
</li>
<li>
<p><strong>F. User, set on init and change</strong>: Since <code>user</code> lifetime metrics aren't cleared unless the user profile is reset, it is included in all subsequent pings.  This would be true even if the &quot;turbo mode&quot; preference were never changed again.</p>
</li>
</ul>
<p>Note that for all of the metric configurations, the toggle of the preference off and on during Ping 4 is completely missed.  If you need to create a ping containing one, and only one, value for this metric, consider using a <a href="user/metrics/../pings/custom.html">custom ping</a> to create a ping whose lifetime matches the lifetime of the value.</p>
<h3 id="what-if-none-of-these-lifetimes-are-appropriate-1"><a class="header" href="#what-if-none-of-these-lifetimes-are-appropriate-1">What if none of these lifetimes are appropriate?</a></h3>
<p>If the timing at which the metric is sent in the ping needs to closely match the timing of the metrics value, the best option is to use a <a href="user/metrics/../pings/custom.html">custom ping</a> to manually control when pings are sent.</p>
<p>This is especially useful when metrics need to be tightly related to one another, for example when you need to measure the distribution of frame paint times when a particular rendering backend is in use.  If these metrics were in different pings, with different measurement windows, it is much harder to do that kind of reasoning with much certainty.</p>
<h2 id="what-should-this-new-metric-be-called-1"><a class="header" href="#what-should-this-new-metric-be-called-1">What should this new metric be called?</a></h2>
<p>Metric names have a maximum length of 30 characters.</p>
<h3 id="reuse-names-from-other-applications-1"><a class="header" href="#reuse-names-from-other-applications-1">Reuse names from other applications</a></h3>
<p>There's a lot of value using the same name for analogous metrics collected across different products. For example, BigQuery makes it simple to join columns with the same name across multiple tables. Therefore, we encourage you to investigate if a similar metric is already being collected by another product. If it is, there may be an opportunity for code reuse across these products, and if all the projects are using the Glean SDK, it's easy for libraries to send their own metrics. If sharing the code doesn't make sense, at a minimum we recommend using the same metric name for similar actions and concepts whenever possible.</p>
<h3 id="make-names-unique-within-an-application-1"><a class="header" href="#make-names-unique-within-an-application-1">Make names unique within an application</a></h3>
<p>Metric identifiers (the combination of a metric's category and name) must be unique across all metrics that are sent by a single application.
This includes not only the metrics defined in the app's <code>metrics.yaml</code>, but the <code>metrics.yaml</code> of any Glean SDK-using library that the application uses, including the Glean SDK itself.
Therefore, care should be taken to name things specifically enough so as to avoid namespace collisions.
In practice, this generally involves thinking carefully about the <code>category</code> of the metric, more than the <code>name</code>.</p>
<blockquote>
<p><strong>Note:</strong> Duplicate metric identifiers are not currently detected at build time. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1578383">bug 1578383</a> for progress on that.
However, the <a href="https://github.com/mozilla/probe-scraper">probe_scraper</a> process, which runs nightly, will detect duplicate metrics and e-mail the <code>notification_emails</code> associated with the given metrics.</p>
</blockquote>
<h3 id="be-as-specific-as-possible-1"><a class="header" href="#be-as-specific-as-possible-1">Be as specific as possible</a></h3>
<p>More broadly, you should choose the names of metrics to be as specific as possible.
It is not necessary to put the type of the metric in the category or name, since this information is retained in other ways through the entire end-to-end system.</p>
<p>For example, if defining a set of events related to search, put them in a category called <code>search</code>, rather than just <code>events</code> or <code>search_events</code>. The <code>events</code> word here would be redundant.</p>
<h2 id="what-if-none-of-these-metric-types-is-the-right-fit-1"><a class="header" href="#what-if-none-of-these-metric-types-is-the-right-fit-1">What if none of these metric types is the right fit?</a></h2>
<p>The current set of metrics the Glean SDKs support is based on known common use cases, but new use cases are discovered all the time.</p>
<p>Please reach out to us on <a href="https://chat.mozilla.org/#/room/#glean:mozilla.org">#glean:mozilla.org</a>. If you think you need a new metric type, we <a href="user/metrics/../../reference/metrics/index.html#adding-or-changing-metric-types">have a process for that</a>.</p>
<h2 id="how-do-i-make-sure-my-metric-is-working-1"><a class="header" href="#how-do-i-make-sure-my-metric-is-working-1">How do I make sure my metric is working?</a></h2>
<p>The Glean SDK has rich support for writing unit tests involving metrics. Writing a good unit test is a large topic, but in general, you should write unit tests for all new telemetry that does the following:</p>
<ul>
<li>
<p>Performs the operation being measured.</p>
</li>
<li>
<p>Asserts that metrics contain the expected data, using the <code>testGetValue</code> API on the metric.</p>
</li>
<li>
<p>Where applicable, asserts that no errors are recorded, such as when values are out of range, using the <code>testGetNumRecordedErrors</code> API.</p>
</li>
</ul>
<p>In addition to unit tests, it is good practice to validate the incoming data for the new metric on a pre-release channel to make sure things are working as expected.</p>
<!--
TODO: This will be a good place to talk about the product telemetry health
dashboard when that's ready
-->
<h2 id="adding-the-metric-to-the-metricsyaml-file-1"><a class="header" href="#adding-the-metric-to-the-metricsyaml-file-1">Adding the metric to the <code>metrics.yaml</code> file</a></h2>
<p>The <a href="user/metrics/../../reference/yaml/metrics.html"><code>metrics.yaml</code> file</a> defines the metrics your application or library will send.
They are organized into categories.
The overall organization is:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

toolbar:
  click:
    type: event
    description: |
      Event to record toolbar clicks.
    metadata:
      tags:
        - Interaction
    notification_emails:
      - CHANGE-ME@example.com
    bugs:
      - https://bugzilla.mozilla.org/123456789/
    data_reviews:
      - http://example.com/path/to/data-review
    expires: 2019-06-01  # &lt;-- Update to a date in the future

  double_click:
    ...
</code></pre>
<p>Refer to the <a href="user/metrics/../../reference/yaml/metrics.html">metrics YAML registry format</a> for a full reference
on the <code>metrics.yaml</code> file structure.</p>
<h2 id="using-the-metric-from-your-code-1"><a class="header" href="#using-the-metric-from-your-code-1">Using the metric from your code</a></h2>
<p>The <a href="user/metrics/../../reference/metrics/index.html">reference documentation for each metric type</a> goes into detail about using each metric type from your code.</p>
<p>Note that all Glean metrics are write-only. Outside of unit tests, it is impossible to retrieve a value from the Glean SDK's database.
While this may seem limiting, this is required to:</p>
<ul>
<li>enforce the semantics of certain metric types (e.g. that Counters can only be incremented).</li>
<li>ensure the lifetime of the metric (when it is cleared or reset) is correctly handled.</li>
</ul>
<h3 id="capitalization-1"><a class="header" href="#capitalization-1">Capitalization</a></h3>
<p>One thing to note is that we try to adhere to the coding conventions of each language wherever possible, so the metric name and category in the <code>metrics.yaml</code> (which is in <code>snake_case</code>) may be changed to some other case convention, such as <code>camelCase</code>, when used from code.</p>
<p>Event extras and labels are never capitalized, no matter the target language.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Kotlin coding standards defined by <a href="https://github.com/pinterest/ktlint">ktlint</a>,
these identifiers must be <code>camelCase</code> in Kotlin.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views
GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Swift coding standards defined by <a href="https://github.com/realm/SwiftLint">swiftlint</a>,
these identifiers must be <code>camelCase</code> in Swift.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Swift">GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>, which matches the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> standard, so no translation is needed for Python.</p>
</div>
<div data-lang="Rust" class="tab">
<p>Given the Rust coding standards defined by
<a href="https://github.com/rust-lang/rust-clippy">clippy</a>,
identifiers should all be <code>snake_case</code>.
This includes category names which in the <code>metrics.yaml</code> are <code>dotted.snake_case</code>:</p>
<pre><code class="language-YAML">compound.category:
  metric_name:
    ...
</code></pre>
<p>In Rust this becomes:</p>
<pre><code class="language-Rust">use fog::metrics;

metrics::compound_category::metric_name...
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<p>JavaScript identifiers are customarily <code>camelCase</code>.
This requires transforming a metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">compound.category:
  metric_name:
    ...
</code></pre>
<p>to a form useful in JS as:</p>
<pre><code class="language-js">import * as compoundCategory from &quot;./path/to/generated/files/compoundCategory.js&quot;;

compoundCategory.metricName...
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p>Firefox Desktop has
<a href="https://firefox-source-docs.mozilla.org/code-quality/coding-style/index.html">Coding Style Guidelines</a>
for both C++ and JS.
This results in, for a metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">compound.category:
  metric_name:
    ...
</code></pre>
<p>an identifier that looks like:</p>
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::compound_category::metric_name...
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.compoundCategory.metricName...
</code></pre>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/adding-new-metrics.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="unit-testing-glean-metrics"><a class="header" href="#unit-testing-glean-metrics">Unit testing Glean metrics</a></h1>
<p>In order to support unit testing inside of client applications using the Glean SDK, a set of testing API functions have been included.
The intent is to make the Glean SDKs easier to test 'out of the box' in any client application it may be used in.
These functions expose a way to inspect and validate recorded metric values within the client application but are restricted to test code only through visibility annotations
(<code>@VisibleForTesting(otherwise = VisibleForTesting.NONE)</code> for Kotlin, <code>internal</code> methods for Swift).
(Outside of a testing context, Glean APIs are otherwise write-only so that it can enforce semantics and constraints about data).</p>
<p>To encourage using the testing API, it is also possible to <a href="user/metrics/testing-metrics.html#generating-testing-coverage-reports">generate testing coverage reports</a> to show which metrics in your project are tested.</p>
<h2 id="general-test-api-method-semantics"><a class="header" href="#general-test-api-method-semantics">General test API method semantics</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Using the Glean Kotlin SDK's unit testing API requires adding <a href="http://robolectric.org/">Robolectric 4.0 or later</a> as a testing dependency. In Gradle, this can be done by declaring a <code>testImplementation</code> dependency:</p>
<pre><code class="language-groovy">dependencies {
    testImplementation &quot;org.robolectric:robolectric:4.3.1&quot;
}
</code></pre>
<p>In order to prevent issues with async calls when unit testing the Glean SDK,
it is important to put the Glean Kotlin SDK into testing mode by applying the JUnit <code>GleanTestRule</code> to your test class.
When the Glean Kotlin SDK is in testing mode, it enables uploading and clears the recorded metrics at the beginning of each test run.
The rule can be used as shown below:</p>
<pre><code class="language-kotlin">@RunWith(AndroidJUnit4::class)
class ActivityCollectingDataTest {
    // Apply the GleanTestRule to set up a disposable Glean instance.
    // Please note that this clears the Glean data across tests.
    @get:Rule
    val gleanRule = GleanTestRule(ApplicationProvider.getApplicationContext())

    @Test
    fun checkCollectedData() {
      // The Glean Kotlin SDK testing API can be called here.
    }
}
</code></pre>
<p>This will ensure that metrics are done recording when the other test functions are used.</p>
<p>To check if a value exists (i.e. it has been recorded), there is a <code>testHasValue()</code> function on each of the metric instances:</p>
<pre><code class="language-kotlin">assertTrue(GleanMetrics.Search.defaultSearchEngineUrl.testHasValue())
</code></pre>
<p>To check the actual values, there is a <code>testGetValue()</code> function on each of the metric instances.
It is important to check that the values are recorded as expected, since many of the metric types may truncate or error-correct the value.
This function will return a datatype appropriate to the specific type of the metric it is being used with:</p>
<pre><code class="language-kotlin">assertEquals(&quot;https://example.com/search?&quot;, GleanMetrics.Search.defaultSearchEngineUrl.testGetValue())
</code></pre>
<p>Note that each of these functions has its visibility limited to the scope of unit tests by making use of the <code>@VisibleForTesting</code> annotation,
so the IDE should complain if you attempt to use them inside of client code.</p>
</div>
<div data-lang="Swift" class="tab">
<blockquote>
<p><strong>NOTE</strong>: There's no automatic test rule for Glean tests implemented.</p>
</blockquote>
<p>In order to prevent issues with async calls when unit testing the Glean SDK, it is important to put the Glean Swift SDK into testing mode.
When the Glean Swift SDK is in testing mode, it enables uploading and clears the recorded metrics at the beginning of each test run.</p>
<p>Activate it by resetting Glean in your test's setup:</p>
<pre><code class="language-swift">@testable import Glean
import XCTest

class GleanUsageTests: XCTestCase {
    override func setUp() {
        Glean.shared.resetGlean(clearStores: true)
    }

    // ...
}
</code></pre>
<p>This will ensure that metrics are done recording when the other test functions are used.</p>
<p>To check if a value exists (i.e. it has been recorded), there is a <code>testHasValue()</code> function on each of the metric instances:</p>
<pre><code class="language-Swift">XCTAssertTrue(GleanMetrics.Search.defaultSearchEngineUrl.testHasValue())
</code></pre>
<p>To check the actual values, there is a <code>testGetValue()</code> function on each of the metric instances.
It is important to check that the values are recorded as expected, since many of the metric types may truncate or error-correct the value.
This function will return a datatype appropriate to the specific type of the metric it is being used with:</p>
<pre><code class="language-Swift">XCTAssertEqual(&quot;https://example.com/search?&quot;, try GleanMetrics.Search.defaultSearchEngineUrl.testGetValue())
</code></pre>
<p>Note that each of these functions is marked as <code>internal</code>, you need to import <code>Glean</code> explicitly in test mode:</p>
<pre><code class="language-Swift">@testable import Glean
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>It is generally a good practice to &quot;reset&quot; the Glean Python SDK prior to every unit test that uses the Glean Python SDK, to prevent side effects of one unit test impacting others.
The Glean Python SDK contains a helper function <code>glean.testing.reset_glean()</code> for this purpose.
It has two required arguments: the application ID, and the application version.
Each reset of the Glean Python SDK will create a new temporary directory for Glean to store its data in.
This temporary directory is automatically cleaned up the next time the Glean Python SDK is reset or when the testing framework finishes.</p>
<p>The instructions below assume you are using <a href="https://pypi.org/project/pytest/">pytest</a> as the test runner.
Other test-running libraries have similar features, but are different in the details.</p>
<p>Create a file <code>conftest.py</code> at the root of your test directory, and add the following to reset Glean at the start of every test in your suite:</p>
<pre><code class="language-python">import pytest
from glean import testing

@pytest.fixture(name=&quot;reset_glean&quot;, scope=&quot;function&quot;, autouse=True)
def fixture_reset_glean():
    testing.reset_glean(application_id=&quot;my-app-id&quot;, application_version=&quot;0.1.0&quot;)
</code></pre>
<p>To check if a value exists (i.e. it has been recorded), there is a <code>test_has_value()</code> function on each of the metric instances:</p>
<pre><code class="language-python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# ...

assert metrics.search.search_engine_url.test_has_value()
</code></pre>
<p>To check the actual values, there is a <code>test_get_value()</code> function on each of the metric instances.
It is important to check that the values are recorded as expected, since many of the metric types may truncate or error-correct the value.
This function will return a datatype appropriate to the specific type of the metric it is being used with:</p>
<pre><code class="language-python">assert (
    &quot;https://example.com/search?&quot; ==
    metrics.search.default_search_engine_url.test_get_value()
)
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648448">bug 1648448</a>.</p>
</div>
</div>
</div>
<h2 id="testing-metrics-for-custom-pings"><a class="header" href="#testing-metrics-for-custom-pings">Testing metrics for custom pings</a></h2>
<p>In order to test metrics where the metric is included in more than one ping, the test functions take an optional <code>pingName</code> argument (<code>ping_name</code> in Python).
This is the name of the ping that the metric is being sent in, such as <code>&quot;events&quot;</code> for the <a href="user/metrics/../pings/events.html"><code>events</code> ping</a>,
or <code>&quot;metrics&quot;</code> for the <a href="user/metrics/../pings/metrics.html"><code>metrics</code> ping</a>.
This could also be a custom ping name that the metric is being sent in.
In most cases you should not have to supply the ping name to the test function and can just use the default which is the &quot;default&quot; ping that this metric is sent in.
You should only need to provide a <code>pingName</code> if the metric is being sent in more than one ping in order to identify the correct metric store.</p>
<p>You can call the <code>testHasValue()</code> and <code>testGetValue()</code> functions with <code>pingName</code> like this:</p>
<pre><code class="language-kotlin">GleanMetrics.Foo.uriCount.testHasValue(&quot;customPing&quot;)
GleanMetrics.Foo.uriCount.testGetValue(&quot;customPing&quot;)
</code></pre>
<h2 id="example-of-using-the-test-api"><a class="header" href="#example-of-using-the-test-api">Example of using the test API</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Here is a longer example to better illustrate the intended use of the test API:</p>
<pre><code class="language-kotlin">// Record a metric value with extra to validate against
GleanMetrics.BrowserEngagement.click.record(
    mapOf(
        BrowserEngagement.clickKeys.font to &quot;Courier&quot;
    )
)

// Record more events without extras attached
BrowserEngagement.click.record()
BrowserEngagement.click.record()

// Check if we collected any events into the 'click' metric
assertTrue(BrowserEngagement.click.testHasValue())

// Retrieve a snapshot of the recorded events
val events = BrowserEngagement.click.testGetValue()

// Check if we collected all 3 events in the snapshot
assertEquals(3, events.size)

// Check extra key/value for first event in the list
assertEquals(&quot;Courier&quot;, events.elementAt(0).extra[&quot;font&quot;])
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Here is a longer example to better illustrate the intended use of the test API:</p>
<pre><code class="language-Swift">// Record a metric value with extra to validate against
GleanMetrics.BrowserEngagement.click.record([.font: &quot;Courier&quot;])

// Record more events without extras attached
BrowserEngagement.click.record()
BrowserEngagement.click.record()

// Check if we collected any events into the 'click' metric
XCTAssertTrue(BrowserEngagement.click.testHasValue())

// Retrieve a snapshot of the recorded events
let events = try! BrowserEngagement.click.testGetValue()

// Check if we collected all 3 events in the snapshot
XCTAssertEqual(3, events.count)

// Check extra key/value for first event in the list
XCTAssertEqual(&quot;Courier&quot;, events[0].extra?[&quot;font&quot;])
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Here is a longer example to better illustrate the intended use of the test API:</p>
<pre><code class="language-python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Record a metric value with extra to validate against
metrics.url.visit.add(1)

# Check if we collected any events into the 'click' metric
assert metrics.url.visit.test_has_value()

# Retrieve a snapshot of the recorded events
assert 1 == metrics.url.visit.test_get_value()
</code></pre>
</div>
<div data-lang="C#" class="tab">
<p>TODO. To be implemented in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648448">bug 1648448</a>.</p>
</div>
</div>
</div>
<h2 id="generating-testing-coverage-reports"><a class="header" href="#generating-testing-coverage-reports">Generating testing coverage reports</a></h2>
<p>Glean can generate coverage reports to track which metrics are tested in your unit test suite.</p>
<p>There are three steps to integrate it into your continuous integration workflow: recording coverage, post-processing the results, and uploading the results.</p>
<h3 id="recording-coverage"><a class="header" href="#recording-coverage">Recording coverage</a></h3>
<p>Glean testing coverage is enabled by setting the <code>GLEAN_TEST_COVERAGE</code> environment variable to the name of a file to store results.
It is good practice to set it to the absolute path to a file, since some testing harnesses (such as <code>cargo test</code>) may change the current working directory.</p>
<pre><code class="language-bash">GLEAN_TEST_COVERAGE=$(realpath glean_coverage.txt) make test
</code></pre>
<h3 id="post-processing-the-results"><a class="header" href="#post-processing-the-results">Post-processing the results</a></h3>
<p>A post-processing step is required to convert the raw output in the file specified by <code>GLEAN_TEST_COVERAGE</code> into usable output for coverage reporting tools. Currently, the only coverage reporting tool supported is <a href="https://codecov.io">codecov.io</a>.</p>
<p>This post-processor is available in the <code>coverage</code> subcommand in the <a href="https://github.com/mozilla/glean_parser"><code>glean_parser</code></a> tool.</p>
<p>For some build systems, <code>glean_parser</code> is already installed for you by the build system integration at the following locations:</p>
<ul>
<li>On Android/Gradle, <code>$GRADLE_HOME/glean/bootstrap-4.5.11/Miniconda3/bin/glean_parser</code></li>
<li>On iOS/Carthage, <code>$PROJECT_ROOT/.venv/bin/glean_parser</code></li>
<li>For other systems, install <code>glean_parser</code> using <code>pip install glean_parser</code></li>
</ul>
<p>The <code>glean_parser coverage</code> command requires the following parameters:</p>
<ul>
<li><code>-f</code>: The output format to produce, for example <code>codecovio</code> to produce <a href="https://codecov.io">codecov.io</a>'s custom format.</li>
<li><code>-o</code>: The path to the output file, for example <code>codecov.json</code>.</li>
<li><code>-c</code>: The input raw coverage file. <code>glean_coverage.txt</code> in the example above.</li>
<li>A list of the <code>metrics.yaml</code> files in your repository.</li>
</ul>
<p>For example, to produce output for <a href="https://codecov.io">codecov.io</a>:</p>
<pre><code class="language-bash">glean_parser coverage -f codecovio -o glean_coverage.json -c glean_coverage.txt app/metrics.yaml
</code></pre>
<p>In this example, the <code>glean_coverage.json</code> file is now ready for uploading to codecov.io.</p>
<h3 id="uploading-coverage"><a class="header" href="#uploading-coverage">Uploading coverage</a></h3>
<p>If using <code>codecov.io</code>, the uploader doesn't send coverage results for YAML files by default. Pass the <code>-X yaml</code> option to the uploader to make sure they are included:</p>
<pre><code class="language-bash">bash &lt;(curl -s https://codecov.io/bash) -X yaml
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/testing-metrics.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="error-reporting"><a class="header" href="#error-reporting">Error reporting</a></h1>
<p>The Glean SDKs record the number of errors that occur when metrics are passed invalid data or are otherwise used incorrectly.
This information is reported back in special labeled counter metrics in the <code>glean.error</code> category.
Error metrics are included in the same pings as the metric that caused the error.
Additionally, error metrics are always sent in the <a href="user/metrics/../pings/metrics.html"><code>metrics</code> ping</a> ping.</p>
<p>The following categories of errors are recorded:</p>
<ul>
<li><code>invalid_value</code>: The metric value was invalid.</li>
<li><code>invalid_label</code>: The label on a labeled metric was invalid.</li>
<li><code>invalid_state</code>: The metric caught an invalid state while recording.</li>
<li><code>invalid_overflow</code>: The metric value to be recorded overflows the metric-specific upper range.</li>
</ul>
<p>For example, if you had a string metric and passed it a string that was too long:</p>
<pre><code class="language-Kotlin">MyMetrics.stringMetric.set(&quot;this_string_is_longer_than_the_limit_for_string_metrics&quot;)
</code></pre>
<p>The following error metric counter would be incremented:</p>
<pre><code class="language-Kotlin">Glean.error.invalidOverflow[&quot;my_metrics.string_metric&quot;].add(1)
</code></pre>
<p>Resulting in the following keys in the ping:</p>
<pre><code class="language-json">{
  &quot;metrics&quot;: {
    &quot;labeled_counter&quot;: {
      &quot;glean.error.invalid_overflow&quot;: {
        &quot;my_metrics.string_metric&quot;: 1
      }
    }
  }
}
</code></pre>
<p>If you have a debug build of the Glean SDK, details about the errors being recorded are included in the logs. This detailed information is not included in Glean pings.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/metrics/error-reporting.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><div class="special-quote special-quote-info fa fa-info-circle"></div>
<h1 id="the-glean-javascript-sdk-provides-a-slightly-different-set-of-metrics-and-pings"><a class="header" href="#the-glean-javascript-sdk-provides-a-slightly-different-set-of-metrics-and-pings">The Glean JavaScript SDK provides a slightly different set of metrics and pings</a></h1>
<blockquote>
<p>If you are looking for the metrics collected by Glean.js,
refer to the documentation over on the <a href="https://github.com/mozilla/glean.js/blob/main/docs/reference/metrics.md"><code>@mozilla/glean.js</code></a> repository.</p>
</blockquote>
<!-- AUTOGENERATED BY glean_parser. DO NOT EDIT. -->
<h1 id="metrics"><a class="header" href="#metrics">Metrics</a></h1>
<p>This document enumerates the metrics collected by this project using the <a href="https://mozilla.github.io/glean/book/index.html">Glean SDK</a>.
This project may depend on other projects which also collect metrics.
This means you might have to go searching through the dependency tree to get a full picture of everything collected by this project.</p>
<h1 id="pings"><a class="header" href="#pings">Pings</a></h1>
<ul>
<li><a href="user/collected-metrics/metrics.html#all-pings">all-pings</a></li>
<li><a href="user/collected-metrics/metrics.html#baseline">baseline</a></li>
<li><a href="user/collected-metrics/metrics.html#deletion-request">deletion-request</a></li>
<li><a href="user/collected-metrics/metrics.html#metrics">metrics</a></li>
</ul>
<h2 id="all-pings"><a class="header" href="#all-pings">all-pings</a></h2>
<p>These metrics are sent in every ping.</p>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>In addition to those built-in metrics, the following metrics are added to the ping:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Data reviews</th><th>Extras</th><th>Expiration</th><th><a href="https://wiki.mozilla.org/Firefox/Data_Collection">Data Sensitivity</a></th></tr></thead><tbody>
<tr><td>glean.error.invalid_label</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a metric was set with an invalid label. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499761#c5">Bug 1499761</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.invalid_overflow</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a metric was set a value that overflowed. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1591912#c3">Bug 1591912</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.invalid_state</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a timing metric was used incorrectly. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499761#c5">Bug 1499761</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.invalid_value</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of times a metric was set to an invalid value. The labels are the <code>category.name</code> identifier of the metric.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1499761#c5">Bug 1499761</a></td><td></td><td>never</td><td>1</td></tr>
</tbody></table>
<h2 id="baseline"><a class="header" href="#baseline">baseline</a></h2>
<p>This is a built-in ping that is assembled out of the box by the Glean SDK.</p>
<p>See the Glean SDK documentation for the <a href="https://mozilla.github.io/glean/book/user/pings/baseline.html"><code>baseline</code> ping</a>.</p>
<p>This ping is sent if empty.</p>
<p>This ping includes the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section">client id</a>.</p>
<p><strong>Data reviews for this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3">https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1599877#c25">https://bugzilla.mozilla.org/show_bug.cgi?id=1599877#c25</a></li>
</ul>
<p><strong>Bugs related to this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/1512938">https://bugzilla.mozilla.org/1512938</a></li>
<li><a href="https://bugzilla.mozilla.org/1599877">https://bugzilla.mozilla.org/1599877</a></li>
</ul>
<p><strong>Reasons this ping may be sent:</strong></p>
<ul>
<li>
<p><code>active</code>: The ping was submitted when the application became active again, which
includes when the application starts. In earlier versions, this was called
<code>foreground</code>.</p>
<pre><code>*Note*: this ping will not contain the `glean.baseline.duration` metric.
</code></pre>
</li>
<li>
<p><code>dirty_startup</code>: The ping was submitted at startup, because the application process was
killed before the Glean SDK had the chance to generate this ping, before
becoming inactive, in the last session.</p>
<pre><code>*Note*: this ping will not contain the `glean.baseline.duration` metric.
</code></pre>
</li>
<li>
<p><code>inactive</code>: The ping was submitted when becoming inactive. In earlier versions, this
was called <code>background</code>.</p>
</li>
</ul>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>In addition to those built-in metrics, the following metrics are added to the ping:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Data reviews</th><th>Extras</th><th>Expiration</th><th><a href="https://wiki.mozilla.org/Firefox/Data_Collection">Data Sensitivity</a></th></tr></thead><tbody>
<tr><td>glean.baseline.duration</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/timespan.html">timespan</a></td><td>The duration of the last foreground session.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3">Bug 1512938</a></td><td></td><td>never</td><td>1, 2</td></tr>
<tr><td>glean.validation.first_run_hour</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/datetime.html">datetime</a></td><td>The hour of the first run of the application.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1680783#c5">Bug 1680783</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.validation.pings_submitted</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>A count of the pings submitted, by ping type.  This metric appears in both the metrics and baseline pings.  - On the metrics ping, the counts include the number of pings sent since   the last metrics ping (including the last metrics ping) - On the baseline ping, the counts include the number of pings send since   the last baseline ping (including the last baseline ping)</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1586764#c3">Bug 1586764</a></td><td></td><td>never</td><td>1</td></tr>
</tbody></table>
<h2 id="deletion-request"><a class="header" href="#deletion-request">deletion-request</a></h2>
<p>This is a built-in ping that is assembled out of the box by the Glean SDK.</p>
<p>See the Glean SDK documentation for the <a href="https://mozilla.github.io/glean/book/user/pings/deletion-request.html"><code>deletion-request</code> ping</a>.</p>
<p>This ping is sent if empty.</p>
<p>This ping includes the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section">client id</a>.</p>
<p><strong>Data reviews for this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1587095#c6">https://bugzilla.mozilla.org/show_bug.cgi?id=1587095#c6</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1702622#c2">https://bugzilla.mozilla.org/show_bug.cgi?id=1702622#c2</a></li>
</ul>
<p><strong>Bugs related to this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/1587095">https://bugzilla.mozilla.org/1587095</a></li>
<li><a href="https://bugzilla.mozilla.org/1702622">https://bugzilla.mozilla.org/1702622</a></li>
</ul>
<p><strong>Reasons this ping may be sent:</strong></p>
<ul>
<li>
<p><code>at_init</code>: The ping was submitted at startup.
Glean discovered that between the last time it was run and this time,
upload of data has been disabled.</p>
</li>
<li>
<p><code>set_upload_enabled</code>: The ping was submitted between Glean init and Glean shutdown.
Glean was told after init but before shutdown that upload has changed
from enabled to disabled.</p>
</li>
</ul>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>This ping contains no metrics.</p>
<h2 id="metrics-1"><a class="header" href="#metrics-1">metrics</a></h2>
<p>This is a built-in ping that is assembled out of the box by the Glean SDK.</p>
<p>See the Glean SDK documentation for the <a href="https://mozilla.github.io/glean/book/user/pings/metrics.html"><code>metrics</code> ping</a>.</p>
<p>This ping includes the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section">client id</a>.</p>
<p><strong>Data reviews for this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3">https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1557048#c13">https://bugzilla.mozilla.org/show_bug.cgi?id=1557048#c13</a></li>
</ul>
<p><strong>Bugs related to this ping:</strong></p>
<ul>
<li><a href="https://bugzilla.mozilla.org/1512938">https://bugzilla.mozilla.org/1512938</a></li>
</ul>
<p><strong>Reasons this ping may be sent:</strong></p>
<ul>
<li>
<p><code>overdue</code>: The last ping wasn't submitted on the current calendar day, but it's after
4am, so this ping submitted immediately</p>
</li>
<li>
<p><code>reschedule</code>: A ping was just submitted. This ping was rescheduled for the next calendar
day at 4am.</p>
</li>
<li>
<p><code>today</code>: The last ping wasn't submitted on the current calendar day, but it is
still before 4am, so schedule to send this ping on the current calendar
day at 4am.</p>
</li>
<li>
<p><code>tomorrow</code>: The last ping was already submitted on the current calendar day, so
schedule this ping for the next calendar day at 4am.</p>
</li>
<li>
<p><code>upgrade</code>: This ping was submitted at startup because the application was just
upgraded.</p>
</li>
</ul>
<p>All Glean pings contain built-in metrics in the <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="https://mozilla.github.io/glean/book/user/pings/index.html#the-client_info-section"><code>client_info</code></a> sections.</p>
<p>In addition to those built-in metrics, the following metrics are added to the ping:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Data reviews</th><th>Extras</th><th>Expiration</th><th><a href="https://wiki.mozilla.org/Firefox/Data_Collection">Data Sensitivity</a></th></tr></thead><tbody>
<tr><td>glean.database.size</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/memory_distribution.html">memory_distribution</a></td><td>The size of the database file at startup.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1656589#c7">Bug 1656589</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.io</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The number of times we encountered an IO error when writing a pending ping to disk.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1686233#c2">Bug 1686233</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.error.preinit_tasks_overflow</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The number of tasks queued in the pre-initialization buffer. Only sent if the buffer overflows.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609482#c3">Bug 1609482</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.deleted_pings_after_quota_hit</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The number of pings deleted after the quota for the size of the pending pings directory or number of files is hit. Since quota is only calculated for the pending pings directory, and deletion request ping live in a different directory, deletion request pings are never deleted.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1601550#c3">Bug 1601550</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.discarded_exceeding_pings_size</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/memory_distribution.html">memory_distribution</a></td><td>The size of pings that exceeded the maximum ping size allowed for upload.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1597761#c10">Bug 1597761</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.pending_pings</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>The total number of pending pings at startup. This does not include deletion-request pings.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1665041#c23">Bug 1665041</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.pending_pings_directory_size</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/memory_distribution.html">memory_distribution</a></td><td>The size of the pending pings directory upon initialization of Glean. This does not include the size of the deletion request pings directory.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1601550#c3">Bug 1601550</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.upload.ping_upload_failure</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>Counts the number of ping upload failures, by type of failure. This includes failures for all ping types, though the counts appear in the next successfully sent <code>metrics</code> ping.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1589124#c1">Bug 1589124</a></td><td><ul><li>status_code_4xx</li><li>status_code_5xx</li><li>status_code_unknown</li><li>unrecoverable</li><li>recoverable</li></ul></td><td></td><td></td></tr>
<tr><td>never</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>glean.validation.first_run_hour</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/datetime.html">datetime</a></td><td>The hour of the first run of the application.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1680783#c5">Bug 1680783</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.validation.foreground_count</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/counter.html">counter</a></td><td>On mobile, the number of times the application went to foreground.</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1683707#c2">Bug 1683707</a></td><td></td><td>never</td><td>1</td></tr>
<tr><td>glean.validation.pings_submitted</td><td><a href="https://mozilla.github.io/glean/book/user/metrics/labeled_counters.html">labeled_counter</a></td><td>A count of the pings submitted, by ping type.  This metric appears in both the metrics and baseline pings.  - On the metrics ping, the counts include the number of pings sent since   the last metrics ping (including the last metrics ping) - On the baseline ping, the counts include the number of pings send since   the last baseline ping (including the last baseline ping)</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1586764#c3">Bug 1586764</a></td><td></td><td>never</td><td>1</td></tr>
</tbody></table>
<p>Data categories are <a href="https://wiki.mozilla.org/Firefox/Data_Collection">defined here</a>.</p>
<!-- AUTOGENERATED BY glean_parser. DO NOT EDIT. -->
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/collected-metrics/metrics.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="pings-1"><a class="header" href="#pings-1">Pings</a></h1>
<p>A ping is a bundle of related metrics, gathered in a payload to be transmitted.
The ping payload is encoded in JSON format and contains one or more of the
<a href="user/pings/index.html#payload-structure">common sections</a> with shared information data.</p>
<p>If data collection is enabled, the chosen Glean SDK may provide a set of <a href="user/pings/./sent-by-glean.html">built-in pings</a>
that are assembled out of the box without any developer intervention.</p>
<h2 id="table-of-contents-2"><a class="header" href="#table-of-contents-2">Table of contents</a></h2>
<ul>
<li><a href="user/pings/index.html#payload-structure">Payload structure</a>
<ul>
<li><a href="user/pings/index.html#the-ping_info-section">The <code>ping_info</code> section</a>
<ul>
<li><a href="user/pings/index.html#seq"><code>seq</code></a></li>
<li><a href="user/pings/index.html#start_time"><code>start_time</code></a></li>
<li><a href="user/pings/index.html#end_time"><code>end_time</code></a></li>
<li><a href="user/pings/index.html#reason-optional"><code>reason</code> (optional)</a></li>
<li><a href="user/pings/index.html#experiments-optional"><code>experiments</code> (optional)</a></li>
</ul>
</li>
<li><a href="user/pings/index.html#the-client_info-section">The <code>client_info</code> section</a>
<ul>
<li><a href="user/pings/index.html#app_build"><code>app_build</code></a></li>
<li><a href="user/pings/index.html#app_channel-optional"><code>app_channel</code> (optional)</a></li>
<li><a href="user/pings/index.html#app_display_version"><code>app_display_version</code></a></li>
<li><a href="user/pings/index.html#architecture"><code>architecture</code></a></li>
<li><a href="user/pings/index.html#client_id-optional"><code>client_id</code> (optional)</a></li>
<li><a href="user/pings/index.html#device_manufacturer-optional"><code>device_manufacturer</code> (optional)</a></li>
<li><a href="user/pings/index.html#device_model-optional"><code>device_model</code> (optional)</a></li>
<li><a href="user/pings/index.html#first_run_date"><code>first_run_date</code></a></li>
<li><a href="user/pings/index.html#os"><code>os</code></a></li>
<li><a href="user/pings/index.html#os_version"><code>os_version</code></a></li>
<li><a href="user/pings/index.html#android_sdk_version-optional"><code>android_sdk_version</code> (optional)</a></li>
<li><a href="user/pings/index.html#telemetry_sdk_build"><code>telemetry_sdk_build</code></a></li>
<li><a href="user/pings/index.html#locale-optional"><code>locale</code> (optional)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="user/pings/index.html#ping-submission">Ping submission</a>
<ul>
<li><a href="user/pings/index.html#url">URL</a></li>
<li><a href="user/pings/index.html#limitations">Limitations</a>
<ul>
<li><a href="user/pings/index.html#rate-limiting">Rate limiting</a></li>
<li><a href="user/pings/index.html#request-body-size-limiting">Request body size limiting</a></li>
<li><a href="user/pings/index.html#storage-quota">Storage quota</a></li>
</ul>
</li>
<li><a href="user/pings/index.html#submitted-headers">Submitted headers</a>
<ul>
<li><a href="user/pings/index.html#content-type"><code>Content-Type</code></a></li>
<li><a href="user/pings/index.html#date"><code>Date</code></a></li>
<li><a href="user/pings/index.html#user-agent"><code>User-Agent</code></a></li>
<li><a href="user/pings/index.html#x-telemetry-agent"><code>X-Telemetry-Agent</code></a></li>
<li><a href="user/pings/index.html#x-client-type-deprecated"><code>X-Client-Type</code> (deprecated)</a></li>
<li><a href="user/pings/index.html#x-client-version-deprecated"><code>X-Client-Version</code> (deprecated)</a></li>
<li><a href="user/pings/index.html#x-debug-id-optional"><code>X-Debug-Id</code> (optional)</a></li>
<li><a href="user/pings/index.html#x-source-tags-optional"><code>X-Source-Tags</code> (optional)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="payload-structure"><a class="header" href="#payload-structure">Payload structure</a></h2>
<p>Every ping payload has the following keys at the top-level:</p>
<ul>
<li>
<p>The <a href="user/pings/index.html#the-ping_info-section"><code>ping_info</code> section</a> contains core metadata
that is included in <strong>every</strong> ping.</p>
</li>
<li>
<p>The <a href="user/pings/index.html#the-client_info-section"><code>client_info</code> section</a> contains information that identifies the client.
It is included in most pings (including all built-in pings), but may be excluded from pings
where we don't want to connect client information with the other metrics in the ping.</p>
</li>
</ul>
<p>The following keys are only present if any metrics or events were recorded for the given ping:</p>
<ul>
<li>
<p>The <code>metrics</code> section contains the submitted values for all metric types
except for <a href="user/pings/../metrics/event.html">events</a>. It has keys for each of the metric types,
under which is data for each metric.</p>
</li>
<li>
<p>The <code>events</code> section contains the events recorded in the ping.</p>
</li>
</ul>
<p>See the <a href="user/pings/../../../dev/core/internal/payload.html">payload documentation</a>
for more details for each metric type in the <code>metrics</code> and <code>events</code> section.</p>
<h3 id="the-ping_info-section"><a class="header" href="#the-ping_info-section">The <code>ping_info</code> section</a></h3>
<p>The following fields are included in the <code>ping_info</code> section, for every ping.
Optional fields are marked accordingly.</p>
<h4 id="seq"><a class="header" href="#seq"><code>seq</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">Counter</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#user">User</a></em></p>
<p>A running counter of the number of times pings of this type have been sent.</p>
<h4 id="start_time"><a class="header" href="#start_time"><code>start_time</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/datetime.html">Datetime</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#user">User</a></em></p>
<p>The time of the start of collection of the data in the ping, in local time
and with minute precision, including timezone information.</p>
<h4 id="end_time"><a class="header" href="#end_time"><code>end_time</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/datetime.html">Datetime</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#ping-default">Ping</a></em></p>
<p>The time of the end of collection of the data in the ping, in local time and with minute precision,
including timezone information. This is also the time this ping was generated
and is likely well before ping transmission time.</p>
<h4 id="reason-optional"><a class="header" href="#reason-optional"><code>reason</code> <em>(optional)</em></a></h4>
<p>The reason the ping was submitted. The specific set of values
and their meanings are defined for each metric type in the <a href="user/pings/../../reference/yaml/pings.html#reasons"><code>reasons</code></a>
field in the <code>pings.yaml</code> file.</p>
<h4 id="experiments-optional"><a class="header" href="#experiments-optional"><code>experiments</code> <em>(optional)</em></a></h4>
<p>A dictionary of active experiments.</p>
<p>This object contains experiment annotations keyed by the experiment <code>id</code>.
Each annotation contains the experiment <code>branch</code> the client is enrolled in
and may contain a string to string map with additional data in the <code>extra</code> key.</p>
<p>Both the <code>id</code> and <code>branch</code> are truncated to 30 characters.
See <a href="user/pings/../../reference/general/experiments-api.html">Using the Experiments API</a>
on how to record experiments data.</p>
<pre><code class="language-json">{
  &quot;&lt;id&gt;&quot;: {
    &quot;branch&quot;: &quot;branch-id&quot;,
    &quot;extra&quot;: {
      &quot;some-key&quot;: &quot;a-value&quot;
    }
  }
}
</code></pre>
<h3 id="the-client_info-section"><a class="header" href="#the-client_info-section">The <code>client_info</code> section</a></h3>
<p>The following fields are included in the <code>client_info</code> section.
Optional fields are marked accordingly.</p>
<h4 id="app_build"><a class="header" href="#app_build"><code>app_build</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#ping-default">Ping</a></em></p>
<p>The build identifier generated by the CI system (e.g. &quot;1234/A&quot;).
If the value was not provided through configuration, this metric gets set to <code>Unknown</code>.</p>
<h4 id="app_channel-optional"><a class="header" href="#app_channel-optional"><code>app_channel</code> <em>(optional)</em></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#ping-default">Ping</a></em></p>
<p>The product-provided release channel (e.g. &quot;beta&quot;).</p>
<h4 id="app_display_version"><a class="header" href="#app_display_version"><code>app_display_version</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#ping-default">Ping</a></em></p>
<p>The user-visible version string (e.g. &quot;1.0.3&quot;).
The meaning of the string (e.g. whether semver or a git hash) is application-specific.
If the value was not provided through configuration, this metric gets set to <code>Unknown</code>.</p>
<h4 id="architecture"><a class="header" href="#architecture"><code>architecture</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#ping-default">Ping</a></em></p>
<p>The architecture of the device (e.g. &quot;arm&quot;, &quot;x86&quot;).</p>
<h4 id="client_id-optional"><a class="header" href="#client_id-optional"><code>client_id</code> <em>(optional)</em></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#user">User</a></em></p>
<p>A UUID identifying a profile and allowing user-oriented correlation of data.</p>
<h4 id="device_manufacturer-optional"><a class="header" href="#device_manufacturer-optional"><code>device_manufacturer</code> <em>(optional)</em></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#application">Application</a></em></p>
<p>The manufacturer of the device the application is running on.
Not set if the device manufacturer can't be determined (e.g. on Desktop).</p>
<h4 id="device_model-optional"><a class="header" href="#device_model-optional"><code>device_model</code> <em>(optional)</em></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#application">Application</a></em></p>
<p>The model of the device the application is running on.
On Android, this is <code>Build.MODEL</code>, the user-visible marketing name, like &quot;Pixel 2 XL&quot;.
Not set if the device model can't be determined (e.g. on Desktop).</p>
<h4 id="first_run_date"><a class="header" href="#first_run_date"><code>first_run_date</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/datetime.html">Datetime</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#user">User</a></em></p>
<p>The date of the first run of the application, in local time and with day precision,
including timezone information.</p>
<h4 id="os"><a class="header" href="#os"><code>os</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#application">Application</a></em></p>
<p>The name of the operating system (e.g. &quot;Linux&quot;, &quot;Android&quot;, &quot;iOS&quot;).</p>
<h4 id="os_version"><a class="header" href="#os_version"><code>os_version</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#application">Application</a></em></p>
<p>The user-visible version of the operating system (e.g. &quot;1.2.3&quot;).
If the version detection fails, this metric gets set to <code>Unknown</code>.</p>
<h4 id="android_sdk_version-optional"><a class="header" href="#android_sdk_version-optional"><code>android_sdk_version</code> <em>(optional)</em></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#application">Application</a></em></p>
<p>The Android specific SDK version of the software running on this hardware device (e.g. &quot;23&quot;).</p>
<h4 id="telemetry_sdk_build"><a class="header" href="#telemetry_sdk_build"><code>telemetry_sdk_build</code></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#application">Application</a></em></p>
<p>The version of the Glean SDK.</p>
<h4 id="locale-optional"><a class="header" href="#locale-optional"><code>locale</code> <em>(optional)</em></a></h4>
<p><em>Type: <a href="user/pings/../../reference/metrics/counter.html">String</a>,
Lifetime: <a href="user/pings/../../reference/yaml/metrics.html#application">Application</a></em></p>
<p>The locale of the application during initialization (e.g. &quot;es-ES&quot;).
If the locale can't be determined on the system, the value is &quot;und&quot;, to indicate &quot;undetermined&quot;.</p>
<h2 id="ping-submission"><a class="header" href="#ping-submission">Ping submission</a></h2>
<p>The pings that the Glean SDKs generate are submitted to the Mozilla servers at specific paths,
in order to provide additional metadata without the need to unpack the ping payload.</p>
<h3 id="url"><a class="header" href="#url">URL</a></h3>
<p>A typical submission URL looks like</p>
<pre><code>&quot;&lt;server-address&gt;/submit/&lt;application-id&gt;/&lt;doc-type&gt;/&lt;glean-schema-version&gt;/&lt;document-id&gt;&quot;
</code></pre>
<p>where:</p>
<ul>
<li><code>&lt;server-address&gt;</code>: the address of the server that receives the pings;</li>
<li><code>&lt;application-id&gt;</code>: a unique application id, automatically detected by the Glean SDK; this is the value returned by <a href="http://developer.android.com/reference/android/content/Context.html#getPackageName()"><code>Context.getPackageName()</code></a>;</li>
<li><code>&lt;doc-type&gt;</code>: the name of the ping; this can be one of the pings available out of the box with the Glean SDK, or a custom ping;</li>
<li><code>&lt;glean-schema-version&gt;</code>: the version of the Glean ping schema;</li>
<li><code>&lt;document-id&gt;</code>: a unique identifier for this ping.</li>
</ul>
<h3 id="limitations"><a class="header" href="#limitations">Limitations</a></h3>
<p>To keep resource usage in check, the Glean SDK enforces some limitations on ping uploading and ping storage.</p>
<h4 id="rate-limiting"><a class="header" href="#rate-limiting">Rate limiting</a></h4>
<p>Only up to 15 ping submissions every 60 seconds are allowed.</p>
<p>For the JavaScript SDK that limit is higher
and up to 40 ping submissions every 60 seconds are allowed.</p>
<h4 id="request-body-size-limiting"><a class="header" href="#request-body-size-limiting">Request body size limiting</a></h4>
<p>The body of a ping request may have up to 1MB (after compression). Pings that exceed this size are discarded
and don't get uploaded. Size and number of discarded pings are recorded on the internal
Glean metric <a href="user/pings/../collected-metrics/metrics.html#metrics-1"><code>glean.upload.discarded_exceeding_pings_size</code></a>.</p>
<h4 id="storage-quota"><a class="header" href="#storage-quota">Storage quota</a></h4>
<p>Pending pings are stored on disk. Storage is scanned every time Glean is initialized and upon scanning
Glean checks its size. If it exceeds a size of 10MB or 250 pending pings, pings are deleted to get the
storage back to an accepted size. Pings are deleted oldest first, until the storage size is below the quota.</p>
<p>The number of deleted pings due to exceeding storage quota is recorded on the metric
<a href="user/pings/../collected-metrics/metrics.html#metrics-1"><code>glean.upload.deleted_pings_after_quota_hit</code></a>
and the size of the pending pings directory is recorded (regardless on whether quota has been reached)
on the metric <a href="user/pings/../collected-metrics/metrics.html#metrics-1"><code>glean.upload.pending_pings_directory_size</code></a>.</p>
<p>Deletion request pings are not subject to this limitation and never get deleted.</p>
<h3 id="submitted-headers"><a class="header" href="#submitted-headers">Submitted headers</a></h3>
<p>A pre-defined set of headers is additionally sent along with the submitted ping.</p>
<h4 id="content-type"><a class="header" href="#content-type"><code>Content-Type</code></a></h4>
<p>Describes the data sent to the server. Value is always <code>application/json; charset=utf-8</code>.</p>
<h4 id="date"><a class="header" href="#date"><code>Date</code></a></h4>
<p>Submission date/time in GMT/UTC+0 offset, e.g. <code>Mon, 23 Jan 2019 10:10:10 GMT+00:00</code>.</p>
<h4 id="user-agent"><a class="header" href="#user-agent"><code>User-Agent</code></a></h4>
<p>The Glean SDKs do not set this header<sup class="footnote-reference"><a href="#1">1</a></sup>, so it will contain whatever value was set
by the underlying uploading mechanism. For example, when sending pings from browsers
it will contain the characteristic <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent#syntax">browser UA string</a>.</p>
<p>This header is parsed by the Glean pipeline and can be queried at analysis time through
the <a href="https://docs.telemetry.mozilla.org/datasets/pings.html?highlight=metadata#ping-metadata"><code>metadata.user_agent.*</code></a>
fields in the ping tables.</p>
<h4 id="x-telemetry-agent"><a class="header" href="#x-telemetry-agent"><code>X-Telemetry-Agent</code></a></h4>
<p>The Glean SDK version and platform this ping is sent from.
Useful for debugging purposes when pings are sent to <a href="https://docs.telemetry.mozilla.org/concepts/pipeline/filtering.html?highlight=error%20stream#querying-the-error-stream">the error stream</a>.
as it describes the application and the Glean SDK used for sending the ping.</p>
<p>It's looks like <code>Glean/40.0.0 (Kotlin on Android)</code>, where <code>40.0.0</code> is the Glean Kotlin SDK version number
and <code>Kotlin on Android</code> is the name of the language used by the SDK that sent the request
plus the name of the platform it is running on.</p>
<p><em>This header is currently only sent by the Glean JavaScript SDK. See <a href="user/pings/index.html#1">note</a>.</em></p>
<h4 id="x-client-type-deprecated"><a class="header" href="#x-client-type-deprecated"><code>X-Client-Type</code> (deprecated)</a></h4>
<p>Custom header to support handling of Glean pings in the legacy pipeline. Values is always <code>Glean</code>.</p>
<p>This header is deprecated and will soon be removed from all Glean SDKs.</p>
<h4 id="x-client-version-deprecated"><a class="header" href="#x-client-version-deprecated"><code>X-Client-Version</code> (deprecated)</a></h4>
<p>The Glean SDK version e.g. <code>0.40.0</code>, sent as a custom header to support handling of Glean pings in the legacy pipeline.</p>
<p>This header is deprecated and will soon be removed from all Glean SDKs.</p>
<h4 id="x-debug-id-optional"><a class="header" href="#x-debug-id-optional"><code>X-Debug-Id</code> <em>(optional)</em></a></h4>
<p>Debug header attached to Glean pings by using the <a href="user/pings/../../reference/debug/debugViewTag.html">debug APIs</a>,
e.g. <code>test-tag</code>.</p>
<p>When this header is present, the ping is redirected to the
<a href="user/pings/../debugging/index.html#glean-debug-view">Glean Debug View</a>.</p>
<h4 id="x-source-tags-optional"><a class="header" href="#x-source-tags-optional"><code>X-Source-Tags</code> <em>(optional)</em></a></h4>
<p>A list of tags to associate with the ping, useful for clustering pings at analysis time,
for example to tell data generated from CI from other data e.g. <code>automation, perf</code>.</p>
<p>This header is attached to Glean pings by using the <a href="user/pings/../../reference/debug/sourceTags.html">debug APIs</a>.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>This is only true for the Glean JavaScript SDK at the moment. For the other SDKs this
header is overwritten with the value that is described on the <code>X-Telemetry-Agent</code> header section.
However, this feature will be implemented soon on all SDKs.
Follow <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1711928">Bug 1711928</a> for updates.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/index.md">Edit this file on GitHub.</a></footer></div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-pings"><a class="header" href="#custom-pings">Custom pings</a></h1>
<p>Applications can define metrics that are sent in custom pings. Unlike the built-in pings, custom pings are sent explicitly by the application.</p>
<p>This is useful when the scheduling of the built-in pings (<a href="user/pings/metrics.html">metrics</a>, <a href="user/pings/baseline.html">baseline</a> and <a href="user/pings/events.html">events</a>) are not appropriate for your data.  Since the timing of the submission of custom pings is handled by the application, the measurement window is under the application's control.</p>
<p>This is especially useful when metrics need to be tightly related to one another, for example when you need to measure the distribution of frame paint times when a particular rendering backend is in use.  If these metrics were in different pings, with different measurement windows, it is much harder to do that kind of reasoning with much certainty.</p>
<h2 id="defining-a-custom-ping"><a class="header" href="#defining-a-custom-ping">Defining a custom ping</a></h2>
<p>Custom pings must be defined in a <a href="user/pings/../../reference/yaml/pings.html"><code>pings.yaml</code> file</a>, placed in the same directory alongside your app's <code>metrics.yaml</code> file.</p>
<p>For example, to define a custom ping called <code>search</code> specifically for search information:</p>
<pre><code class="language-YAML">$schema: moz://mozilla.org/schemas/glean/pings/2-0-0

search:
  description: &gt;
    A ping to record search data.
  metadata:
    tags:
      - Search
  include_client_id: false
  notification_emails:
    - CHANGE-ME@example.com
  bugs:
    - http://bugzilla.mozilla.org/123456789/
  data_reviews:
    - http://example.com/path/to/data-review
</code></pre>
<p>Tags are an optional feature you can use to provide an additional layer of categorization to pings.
Any tags specified in the <code>metadata</code> section of a ping <em>must</em> have a corresponding entry in a <a href="user/pings/../../reference/yaml/tags.html">tags YAML registry</a> for your project.</p>
<p>Refer to the <a href="user/pings/../../reference/yaml/pings.html">pings YAML registry format</a> for a full reference
on the <code>pings.yaml</code> file structure.</p>
<h2 id="sending-metrics-in-a-custom-ping"><a class="header" href="#sending-metrics-in-a-custom-ping">Sending metrics in a custom ping</a></h2>
<p>To send a metric on a custom ping, you add the custom ping's name to the <code>send_in_pings</code> parameter in the <code>metrics.yaml</code> file.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h3 id="ping-metadata-must-be-loaded-before-sending"><a class="header" href="#ping-metadata-must-be-loaded-before-sending">Ping metadata must be loaded before sending!</a></h3>
<blockquote>
<p>After defining a custom ping, before it can be used for sending data, its metadata must be <a href="user/pings/../../reference/general/register-custom-pings.html">loaded into your application or library</a>.</p>
</blockquote>
<p>For example, to define a new metric to record the default search engine, which is sent in a custom ping called <code>search</code>, put <code>search</code> in the <code>send_in_pings</code> parameter.  Note that it is an error to specify a ping in <code>send_in_pings</code> that does not also have an entry in <code>pings.yaml</code>.</p>
<pre><code class="language-YAML">search.default:
  name:
    type: string
    description: &gt;
      The name of the default search engine.
    send_in_pings:
      - search
</code></pre>
<p>If this metric should also be sent in the default ping for the given metric type, you can add the special value <code>default</code> to <code>send_in_pings</code>:</p>
<pre><code class="language-YAML">    send_in_pings:
      - search
      - default
</code></pre>
<h2 id="the-gleanrestarted-event"><a class="header" href="#the-gleanrestarted-event">The <code>glean.restarted</code> event</a></h2>
<p>For custom pings that contain event metrics, the <code>glean.restarted</code> event is injected by Glean
on every application restart that may happen during the pings measurement window.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h3 id="only-applies-to-the-glean-javascript-sdk"><a class="header" href="#only-applies-to-the-glean-javascript-sdk">Only applies to the Glean JavaScript SDK</a></h3>
<blockquote>
<p>The behavior described in this section only applies to custom pings sent by
the Glean JavaScript SDK. Follow the implementation of this feature on the other
SDKs through <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1716725">Bug 1716725</a>.</p>
</blockquote>
<h3 id="event-timestamps-throughout-application-restarts"><a class="header" href="#event-timestamps-throughout-application-restarts">Event timestamps throughout application restarts</a></h3>
<p>Event timestamps are always calculated relative to the first event in a ping. The first event
will always have timestamp <code>0</code> and subsequent events will have timestamps corresponding to the
elapsed amount of milliseconds since that first event.</p>
<p>That is also the case for events recorded throughout restarts.</p>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<p>In the below example payload, there were two events recorded on the first application run.
The first event is timestamp <code>0</code> and the second event happens one second after the first one,
so it has timestamp <code>1000</code>.</p>
<p>The application is restarted one hour after the first event and a <code>glean.restarted</code> event is
recorded, timestamp <code>3600000</code>. Finally, an event is recorded during the second application run
two seconds after restart, timestamp <code>3602000</code>.</p>
<pre><code class="language-json">{
  ...
  &quot;events&quot;: [
    {
      &quot;timestamp&quot;: 0,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;,
    },
    {
      &quot;timestamp&quot;: 1000,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
    {
      &quot;timestamp&quot;: 3600000,
      &quot;category&quot;: &quot;glean&quot;,
      &quot;name&quot;: &quot;restarted&quot;
    },
    {
      &quot;timestamp&quot;: 3602000,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
  ]
}
</code></pre>
<h4 id="caveat-handling-decreasing-time-offsets"><a class="header" href="#caveat-handling-decreasing-time-offsets">Caveat: Handling decreasing time offsets</a></h4>
<p>For events recorded in a single application run, Glean relies on a monotonically increasing timer
to calculate event timestamps, while for calculating the time elapsed between application runs Glean
has to rely on the computer clock, which is not necessarily monotonically increasing.</p>
<p>In the case that timestamps in between application runs are not monotonically increasing, Glean
will take the value of the previous timestamp and add one millisecond, thus guaranteeing that
timestamps are always increasing.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="checking-for-decreasing-time-offsets-between-restarts"><a class="header" href="#checking-for-decreasing-time-offsets-between-restarts">Checking for decreasing time offsets between restarts</a></h5>
<blockquote>
<p>When this edge case is hit, Glean records an <a href="user/pings/../error-reporting.html"><code>InvalidValue</code> error</a>
for the <code>glean.restarted</code> metric. This metric may be consulted at analysis time.
It is sent in the same ping where the error happened.</p>
</blockquote>
<p>In the below example payload, the first and second application runs go exactly like in the
<a href="user/pings/custom.html#example">example above</a>.</p>
<p>The only difference is that when the restart happens, the offset between the absolute time
of the first event and the absolute time of the restart is not enough to keep the timestamps increasing.
That may happen for many reasons, such as a change in timezones or simply a manual change in the clock
by the user.</p>
<p>In this case, Glean will ignore the incorrect timestamp and add one millisecond to the last timestamp
of the previous run, in order to keep the monotonically increasing nature of the timestamps.</p>
<pre><code class="language-json">{
  ...
  &quot;events&quot;: [
    {
      &quot;timestamp&quot;: 0,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;,
    },
    {
      &quot;timestamp&quot;: 1000,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
    {
      &quot;timestamp&quot;: 1001,
      &quot;category&quot;: &quot;glean&quot;,
      &quot;name&quot;: &quot;restarted&quot;
    },
    {
      &quot;timestamp&quot;: 3001,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    },
  ]
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/custom.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="testing-custom-pings"><a class="header" href="#testing-custom-pings">Testing custom pings</a></h1>
<p>Applications defining <a href="user/pings/custom.html">custom pings</a> can use use the <a href="user/pings/../../reference/pings/index.html#testing-api">ping testing API</a> to test these pings in unit tests.</p>
<h2 id="general-testing-strategy"><a class="header" href="#general-testing-strategy">General testing strategy</a></h2>
<p>The schedule of custom pings depends on the specific application implementation, since it is up to the SDK user to define the ping semantics. This makes the testing strategy a bit more complex, but usually boiling down to:</p>
<ol>
<li>Triggering the code path that accumulates/records the data.</li>
<li>Defining a callback validation function using the <a href="user/pings/../../reference/pings/index.html#testbeforenextsubmit">ping testing API</a>.</li>
<li>Finally triggering the code path that submits the custom ping or submitting the ping using the <a href="user/pings/../../reference/pings/index.html#submit"><code>submit</code> API</a>.</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/testing-custom-pings.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="pings-sent-by-glean"><a class="header" href="#pings-sent-by-glean">Pings sent by Glean</a></h1>
<p>If data collection is enabled, the Glean SDKs provide a set of built-in pings that are assembled out of the box without any developer intervention.  The following is a list of these built-in pings:</p>
<ul>
<li><a href="user/pings/baseline.html"><code>baseline</code> ping</a>: A small ping sent every time the application goes to foreground and background. Going to foreground also includes when the application starts.</li>
<li><a href="user/pings/deletion_request.html"><code>deletion-request</code> ping</a>: Sent when the user disables telemetry in order to request a deletion of their data.</li>
<li><a href="user/pings/events.html"><code>events</code> ping</a>: The default ping for events. Sent every time the application goes to background or a certain number of events is reached.</li>
<li><a href="user/pings/metrics.html"><code>metrics</code> ping</a>: The default ping for metrics. Sent approximately daily.</li>
</ul>
<p>Applications can also define and send their own <a href="user/pings/custom.html">custom pings</a> when the schedules of these pings is not suitable.</p>
<p>There is also a <a href="user/pings/ping-schedules-and-timings.html">high-level overview</a> of how the <code>metrics</code> and <code>baseline</code> pings relate and the timings they record.</p>
<h3 id="available-pings-per-platform"><a class="header" href="#available-pings-per-platform">Available pings per platform</a></h3>
<table><thead><tr><th align="right">SDK</th><th align="center"><a href="user/pings/baseline.html"><code>baseline</code></a></th><th align="center"><a href="user/pings/deletion_request.html"><code>deletion-request</code></a></th><th align="center"><a href="user/pings/events.html"><code>events</code></a></th><th align="center"><a href="user/pings/metrics.html"><code>metrics</code></a></th></tr></thead><tbody>
<tr><td align="right">Kotlin</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr>
<tr><td align="right">Swift</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr>
<tr><td align="right">Python</td><td align="center"></td><td align="center">✅</td><td align="center"></td><td align="center"></td></tr>
<tr><td align="right">Rust</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr>
<tr><td align="right">JavaScript</td><td align="center"></td><td align="center">✅</td><td align="center"></td><td align="center"></td></tr>
<tr><td align="right">Firefox Desktop</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr>
</tbody></table>
<h2 id="defining-foreground-and-background-state"><a class="header" href="#defining-foreground-and-background-state">Defining foreground and background state</a></h2>
<p>These docs refer to application 'foreground' and 'background' state in several places.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<h3 id="foreground"><a class="header" href="#foreground">Foreground</a></h3>
<p>For Android, this specifically means the activity becomes visible to the user, it has entered the <code>Started</code> state, and the system invokes the <a href="https://developer.android.com/reference/android/app/Activity.html#onStart()"><code>onStart()</code></a> callback.</p>
<h3 id="background"><a class="header" href="#background">Background</a></h3>
<p>This specifically means when the activity is no longer visible to the user, it has entered the <code>Stopped</code> state, and the system invokes the <a href="https://developer.android.com/reference/android/app/Activity.html#onStop()"><code>onStop()</code></a> callback.</p>
<p>This may occur, if the user uses <code>Overview</code> button to change to another app, the user presses the <code>Back</code> button and
navigates to a previous application or the home screen, or if the user presses the <code>Home</code> button to return to the
home screen.  This can also occur if the user navigates away from the application through some notification or
other means.</p>
<p>The system may also call <code>onStop()</code> when the activity has finished running, and is about to be terminated.</p>
</div>
<div data-lang="Swift" class="tab">
<h3 id="foreground-1"><a class="header" href="#foreground-1">Foreground</a></h3>
<p>For iOS, the Glean Swift SDK attaches to the <a href="https://developer.apple.com/documentation/uikit/uiapplication/1622944-willenterforegroundnotification"><code>willEnterForegroundNotification</code></a>.
This notification is posted by the OS shortly before an app leaves the background state on its way to becoming the active app.</p>
<h3 id="background-1"><a class="header" href="#background-1">Background</a></h3>
<p>For iOS, this specifically means when the app is no longer visible to the user, or when the <code>UIApplicationDelegate</code>
receives the <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622997-applicationdidenterbackground"><code>applicationDidEnterBackground</code></a> event.</p>
<p>This may occur if the user opens the task switcher to change to another app, or if the user presses the <code>Home</code> button
to show the home screen.  This can also occur if the user navigates away from the app through a notification or other
means.</p>
<blockquote>
<p><strong>Note:</strong> Glean does not currently support <a href="https://developer.apple.com/documentation/uikit/app_and_environment/managing_your_app_s_life_cycle">Scene based lifecycle events</a> that were introduced in iOS 13.</p>
</blockquote>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/sent-by-glean.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="the-baseline-ping"><a class="header" href="#the-baseline-ping">The <code>baseline</code> ping</a></h1>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p>This ping is intended to provide metrics that are managed by the Glean SDKs themselves, and not explicitly set by the application or included in the application's <code>metrics.yaml</code> file.</p>
<h3 id="platform-availability"><a class="header" href="#platform-availability">Platform availability</a></h3>
<table><thead><tr><th align="right">SDK</th><th align="center">Kotlin</th><th align="center">Swift</th><th align="center">Python</th><th align="center">Rust</th><th align="center">JavaScript</th><th align="center">Firefox Desktop</th></tr></thead><tbody>
<tr><td align="right"><a href="user/pings/baseline.html"><code>baseline</code> ping</a></td><td align="center">✅</td><td align="center">✅</td><td align="center"></td><td align="center">✅</td><td align="center"></td><td align="center">✅</td></tr>
</tbody></table>
<h2 id="scheduling"><a class="header" href="#scheduling">Scheduling</a></h2>
<p>The <code>baseline</code> ping is automatically submitted with a <code>reason: active</code> when the application becomes active (on mobile it means getting to <a href="user/pings/sent-by-glean.html#defining-foreground-and-background-state">foreground</a>).  These baseline pings do not contain <code>duration</code>.</p>
<p>The <code>baseline</code> ping is automatically submitted with a <code>reason: inactive</code> when the application becomes inactive (on mobile it means getting to <a href="user/pings/sent-by-glean.html#defining-foreground-and-background-state">background</a>).
If no <code>baseline</code> ping is triggered when becoming inactive (e.g. the process is abruptly killed) a <code>baseline</code> ping with reason <code>dirty_startup</code> will be submitted on the next application startup. This only happens from the second application start onward.</p>
<p>See also the <a href="user/pings/ping-schedules-and-timings.html">ping schedules and timing overview</a>.</p>
<h2 id="contents"><a class="header" href="#contents">Contents</a></h2>
<p>The <code>baseline</code> ping also includes the common <a href="user/pings/index.html#payload-structure">ping sections</a> found in all pings.</p>
<p>It also includes a number of <a href="user/pings/../collected-metrics/metrics.html#baseline">metrics defined in the Glean SDKs themselves</a>.</p>
<h3 id="querying-ping-contents"><a class="header" href="#querying-ping-contents">Querying ping contents</a></h3>
<p>A quick note about querying ping contents (i.e. for <a href="https://sql.telemetry.mozilla.org">sql.telemetry.mozilla.org</a>):  Each metric in the baseline ping is organized by its metric type, and uses a namespace of <code>glean.baseline</code>. For instance, in order to select <code>duration</code> you would use <code>metrics.timespan['glean.baseline.duration']</code>. If you were trying to select a String based metric such as <code>os</code>, then you would use <code>metrics.string['glean.baseline.os']</code></p>
<h2 id="example-baseline-ping"><a class="header" href="#example-baseline-ping">Example baseline ping</a></h2>
<pre><code class="language-json">{
  &quot;ping_info&quot;: {
    &quot;experiments&quot;: {
      &quot;third_party_library&quot;: {
        &quot;branch&quot;: &quot;enabled&quot;
      }
    },
    &quot;seq&quot;: 0,
    &quot;start_time&quot;: &quot;2019-03-29T09:50-04:00&quot;,
    &quot;end_time&quot;: &quot;2019-03-29T09:53-04:00&quot;,
    &quot;reason&quot;: &quot;foreground&quot;
  },
  &quot;client_info&quot;: {
    &quot;telemetry_sdk_build&quot;: &quot;0.49.0&quot;,
    &quot;first_run_date&quot;: &quot;2019-03-29-04:00&quot;,
    &quot;os&quot;: &quot;Android&quot;,
    &quot;android_sdk_version&quot;: &quot;27&quot;,
    &quot;os_version&quot;: &quot;8.1.0&quot;,
    &quot;device_manufacturer&quot;: &quot;Google&quot;,
    &quot;device_model&quot;: &quot;Android SDK built for x86&quot;,
    &quot;architecture&quot;: &quot;x86&quot;,
    &quot;app_build&quot;: &quot;1&quot;,
    &quot;app_display_version&quot;: &quot;1.0&quot;,
    &quot;client_id&quot;: &quot;35dab852-74db-43f4-8aa0-88884211e545&quot;
  },
  &quot;metrics&quot;: {
    &quot;timespan&quot;: {
      &quot;glean.baseline.duration&quot;: {
        &quot;value&quot;: 52,
        &quot;time_unit&quot;: &quot;second&quot;
      }
    }
  }
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/baseline.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="the-deletion-request-ping"><a class="header" href="#the-deletion-request-ping">The <code>deletion-request</code> ping</a></h1>
<h2 id="description-1"><a class="header" href="#description-1">Description</a></h2>
<p>This ping is submitted when a user opts out of sending technical and interaction data.</p>
<p>This ping contains the client id.</p>
<p>This ping is intended to communicate to the Data Pipeline that the user wishes to have their reported Telemetry data deleted.
As such it attempts to send itself at the moment the user opts out of data collection, and continues to try and send itself.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="adding-secondary-ids"><a class="header" href="#adding-secondary-ids">Adding secondary ids</a></h5>
<blockquote>
<p>It is possible to send secondary ids in the deletion request ping.  For instance, if the application is migrating
from legacy telemetry to Glean, the legacy client ids can be added to the deletion request ping by creating a <code>metrics.yaml</code>
entry for the id to be added with a <code>send_in_pings</code> value of <code>deletion_request</code>.</p>
<p>An example <code>metrics.yaml</code> entry might look like this:</p>
<pre><code>legacy_client_id:
   type: uuid
   description:
     A UUID uniquely identifying the legacy client.
   send_in_pings:
     - deletion_request
   ...
</code></pre>
</blockquote>
<h3 id="platform-availability-1"><a class="header" href="#platform-availability-1">Platform availability</a></h3>
<table><thead><tr><th align="right">SDK</th><th align="center">Kotlin</th><th align="center">Swift</th><th align="center">Python</th><th align="center">Rust</th><th align="center">JavaScript</th><th align="center">Firefox Desktop</th></tr></thead><tbody>
<tr><td align="right"><a href="user/pings/deletion_request.html"><code>deletion-request</code> ping</a></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr>
</tbody></table>
<h2 id="scheduling-1"><a class="header" href="#scheduling-1">Scheduling</a></h2>
<p>The <code>deletion-request</code> ping is automatically submitted when upload is disabled in Glean.
If upload fails, it is retried after Glean is initialized.</p>
<h2 id="contents-1"><a class="header" href="#contents-1">Contents</a></h2>
<p>The <code>deletion-request</code> does not contain additional metrics aside from secondary ids that have been added.</p>
<h2 id="example-deletion-request-ping"><a class="header" href="#example-deletion-request-ping">Example <code>deletion-request</code> ping</a></h2>
<pre><code class="language-json">{
  &quot;ping_info&quot;: {
    &quot;seq&quot;: 0,
    &quot;start_time&quot;: &quot;2019-12-06T09:50-04:00&quot;,
    &quot;end_time&quot;: &quot;2019-12-06T09:53-04:00&quot;
  },
  &quot;client_info&quot;: {
    &quot;telemetry_sdk_build&quot;: &quot;22.0.0&quot;,
    &quot;first_run_date&quot;: &quot;2019-03-29-04:00&quot;,
    &quot;os&quot;: &quot;Android&quot;,
    &quot;android_sdk_version&quot;: &quot;28&quot;,
    &quot;os_version&quot;: &quot;9&quot;,
    &quot;device_manufacturer&quot;: &quot;Google&quot;,
    &quot;device_model&quot;: &quot;Android SDK built for x86&quot;,
    &quot;architecture&quot;: &quot;x86&quot;,
    &quot;app_build&quot;: &quot;1&quot;,
    &quot;app_display_version&quot;: &quot;1.0&quot;,
    &quot;client_id&quot;: &quot;35dab852-74db-43f4-8aa0-88884211e545&quot;
  },
  &quot;metrics&quot;: {
    &quot;uuid&quot;: {
      &quot;legacy_client_id&quot;: &quot;5faffa6d-6147-4d22-a93e-c1dbd6e06171&quot;
    }
  }
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/deletion_request.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="the-events-ping"><a class="header" href="#the-events-ping">The <code>events</code> ping</a></h1>
<h2 id="description-2"><a class="header" href="#description-2">Description</a></h2>
<p>The events ping's purpose is to transport all of the event metric information.
If the application crashes, an <code>events</code> ping is generated next time the application starts with events that were not sent before the crash.</p>
<h3 id="platform-availability-2"><a class="header" href="#platform-availability-2">Platform availability</a></h3>
<table><thead><tr><th align="right">SDK</th><th align="center">Kotlin</th><th align="center">Swift</th><th align="center">Python</th><th align="center">Rust</th><th align="center">JavaScript</th><th align="center">Firefox Desktop</th></tr></thead><tbody>
<tr><td align="right"><a href="user/pings/events.html"><code>events</code> ping</a></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center"></td><td align="center">✅</td></tr>
</tbody></table>
<h2 id="scheduling-2"><a class="header" href="#scheduling-2">Scheduling</a></h2>
<p>The <code>events</code> ping is collected under the following circumstances:</p>
<ol>
<li>
<p>Normally, it is collected when the application becomes inactive (on mobile, this means going to <a href="user/pings/sent-by-glean.html#defining-foreground-and-background-state">background</a>), if there are any recorded events to send.</p>
</li>
<li>
<p>When the queue of events exceeds <code>Glean.configuration.maxEvents</code> (default 500).</p>
</li>
<li>
<p>If there are any unsent events found on disk when starting the application. <em>(This results in this ping never containing the <a href="user/pings/./custom.html#the-gleanrestarted-event"><code>glean.restarted</code></a> event.)</em></p>
</li>
</ol>
<p>All of these cases are handled automatically, with no intervention or configuration required by the application.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="python-and-javascript-caveats"><a class="header" href="#python-and-javascript-caveats">Python and JavaScript caveats</a></h5>
<blockquote>
<p>Since the Glean Python and JavaScript SDKs don't have a concept of &quot;going to background&quot;,
case (1) above does not apply.</p>
</blockquote>
<h2 id="contents-2"><a class="header" href="#contents-2">Contents</a></h2>
<p>At the top-level, this ping contains the following keys:</p>
<ul>
<li>
<p><code>ping_info</code>: The information <a href="user/pings/index.html#the-ping_info-section">common to all pings</a>.</p>
</li>
<li>
<p><code>events</code>: An array of all of the events that have occurred since the last time the <code>events</code> ping was sent.</p>
</li>
</ul>
<p>Each entry in the <code>events</code> array is an object with the following properties:</p>
<ul>
<li>
<p><code>&quot;timestamp&quot;</code>: The milliseconds relative to the first event in the ping.</p>
</li>
<li>
<p><code>&quot;category&quot;</code>: The category of the event, as defined by its location in the <code>metrics.yaml</code> file.</p>
</li>
<li>
<p><code>&quot;name&quot;</code>: The name of the event, as defined in the <code>metrics.yaml</code> file.</p>
</li>
<li>
<p><code>&quot;extra&quot;</code> (optional): A mapping of strings to strings providing additional data about the event. The keys are restricted to 40 characters and values in this map will never exceed 100 characters.</p>
</li>
</ul>
<h3 id="example-event-json"><a class="header" href="#example-event-json">Example event JSON</a></h3>
<pre><code class="language-json">{
  &quot;ping_info&quot;: {
    &quot;experiments&quot;: {
      &quot;third_party_library&quot;: {
        &quot;branch&quot;: &quot;enabled&quot;
      }
    },
    &quot;seq&quot;: 0,
    &quot;start_time&quot;: &quot;2019-03-29T09:50-04:00&quot;,
    &quot;end_time&quot;: &quot;2019-03-29T10:02-04:00&quot;
  },
  &quot;client_info&quot;: {
    &quot;telemetry_sdk_build&quot;: &quot;0.49.0&quot;,
    &quot;first_run_date&quot;: &quot;2019-03-29-04:00&quot;,
    &quot;os&quot;: &quot;Android&quot;,
    &quot;android_sdk_version&quot;: &quot;27&quot;,
    &quot;os_version&quot;: &quot;8.1.0&quot;,
    &quot;device_manufacturer&quot;: &quot;Google&quot;,
    &quot;device_model&quot;: &quot;Android SDK built for x86&quot;,
    &quot;architecture&quot;: &quot;x86&quot;,
    &quot;app_build&quot;: &quot;1&quot;,
    &quot;app_display_version&quot;: &quot;1.0&quot;,
    &quot;client_id&quot;: &quot;35dab852-74db-43f4-8aa0-88884211e545&quot;
  },
  &quot;events&quot;: [
    {
      &quot;timestamp&quot;: 0,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;,
      &quot;extra&quot;: {
        &quot;metadata1&quot;: &quot;extra&quot;,
        &quot;metadata2&quot;: &quot;more_extra&quot;
      }
    },
    {
      &quot;timestamp&quot;: 1000,
      &quot;category&quot;: &quot;examples&quot;,
      &quot;name&quot;: &quot;event_example&quot;
    }
  ]
}
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/events.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="the-metrics-ping"><a class="header" href="#the-metrics-ping">The <code>metrics</code> ping</a></h1>
<h2 id="description-3"><a class="header" href="#description-3">Description</a></h2>
<p>The <code>metrics</code> ping is intended for all of the metrics that are explicitly set by the application or are included in the application's <code>metrics.yaml</code> file (except events). 
The reported data is tied to the ping's <em>measurement window</em>, which is the time between the collection of two <code>metrics</code> pings. 
Ideally, this window is expected to be about 24 hours, given that the collection is scheduled daily at 04:00. 
However, the metrics ping is only submitted while the application is actually running, so in practice, it may not meet the 04:00 target very frequently.
Data in the <a href="user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> section of the ping can be used to infer the length of this window and the reason that triggered the ping to be submitted.
If the application crashes, unsent recorded metrics are sent along with the next <code>metrics</code> ping.</p>
<p>Additionally, it is undesirable to mix metric recording from different versions of the application. Therefore, if a version upgrade is detected, the <code>metrics</code> ping is collected immediately before further metrics from the new version are recorded.</p>
<h3 id="platform-availability-3"><a class="header" href="#platform-availability-3">Platform availability</a></h3>
<table><thead><tr><th align="right">SDK</th><th align="center">Kotlin</th><th align="center">Swift</th><th align="center">Python</th><th align="center">Rust</th><th align="center">JavaScript</th><th align="center">Firefox Desktop</th></tr></thead><tbody>
<tr><td align="right"><a href="user/pings/metrics.html"><code>metrics</code> ping</a></td><td align="center">✅</td><td align="center">✅</td><td align="center"></td><td align="center">✅</td><td align="center"></td><td align="center">✅</td></tr>
</tbody></table>
<h2 id="scheduling-3"><a class="header" href="#scheduling-3">Scheduling</a></h2>
<p>The desired behavior is to collect the ping at the first available opportunity after 04:00 local time on a new calendar day, but given constraints of the platform, it can only be submitted while the application is running. 
This breaks down into three scenarios:</p>
<ol>
<li>the application was just installed;</li>
<li>the application was just upgraded (the version of the app is different from the last time the app was run);</li>
<li>the application was just started (after a crash or a long inactivity period);</li>
<li>the application was running at 04:00.</li>
</ol>
<p>In the first case, since the application was just installed, if the due time for the current calendar day has passed, a <code>metrics</code> ping is immediately generated and scheduled for sending (reason code <code>overdue</code>). Otherwise, if the due time for the current calendar day has not passed, a ping collection is scheduled for that time (reason code <code>today</code>). </p>
<p>In the second case, if a version change is detected at startup, the metrics ping is immediately submitted so that metrics from one version are not aggregated with metrics from another version (reason code <code>upgrade</code>).</p>
<p>In the third case, if the <code>metrics</code> ping was not already collected on the current calendar day, and it is before 04:00, a collection is scheduled for 04:00 on the current calendar day (reason code <code>today</code>).
If it is after 04:00, a new collection is scheduled immediately (reason code <code>overdue</code>).
Lastly, if a ping was already collected on the current calendar day, the next one is scheduled for collecting at 04:00 on the next calendar day (reason code <code>tomorrow</code>).</p>
<p>In the fourth and last case, the application is running during a scheduled ping collection time.
The next ping is scheduled for 04:00 the next calendar day (reason code <code>reschedule</code>).</p>
<p>More <a href="user/pings/metrics.html#scheduling-examples">scheduling examples</a> are included below.</p>
<p>See also the <a href="user/pings/ping-schedules-and-timings.html">ping schedules and timing overview</a>.</p>
<h2 id="contents-3"><a class="header" href="#contents-3">Contents</a></h2>
<p>The <code>metrics</code> ping contains all of the metrics defined in <code>metrics.yaml</code> (except events) that don't specify a ping or where <code>default</code> is specified in their <a href="user/pings/../../reference/yaml/metrics.html#send_in_pings"><code>send in pings</code></a> property.</p>
<p>Additionally, error metrics in the <code>glean.error</code> category are included in the <code>metrics</code> ping.</p>
<p>The <code>metrics</code> ping shall also include the common <a href="user/pings/index.html#the-ping_info-section"><code>ping_info</code></a> and <a href="user/pings/index.html#the-client_info-section">'client_info'</a> sections.  It also includes a number of <a href="user/pings/../collected-metrics/metrics.html#metrics-1">metrics defined in the Glean SDKs themselves</a>.</p>
<h3 id="querying-ping-contents-1"><a class="header" href="#querying-ping-contents-1">Querying ping contents</a></h3>
<p>Information about query ping contents is available in <a href="https://docs.telemetry.mozilla.org/concepts/glean/accessing_glean_data.html">Accessing Glean data</a> in the Firefox data docs.</p>
<h2 id="scheduling-examples"><a class="header" href="#scheduling-examples">Scheduling Examples</a></h2>
<h3 id="crossing-due-time-with-the-application-closed"><a class="header" href="#crossing-due-time-with-the-application-closed">Crossing due time with the application closed</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 8 on 17:00.</p>
</li>
</ol>
<ul>
<li>
<p>Glean notes that we passed local 04:00 since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00</code>;</li>
<li><code>end_time=Feb8/17:00</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2, which has a start_time of Feb8/17:00.</p>
</li>
</ul>
<h3 id="crossing-due-time-and-changing-timezones"><a class="header" href="#crossing-due-time-and-changing-timezones">Crossing due time and changing timezones</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00 in timezone UTC, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 8 on 17:00 in timezone UTC+1.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC+1 since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC</code>;</li>
<li><code>end_time=Feb8/17:00/UTC+1</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
</ol>
<h3 id="the-application-doesnt-run-in-a-week"><a class="header" href="#the-application-doesnt-run-in-a-week">The application doesn’t run in a week</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00 in timezone UTC, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 16 on 17:00 in timezone UTC.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC</code>;</li>
<li><code>end_time=Feb16/17:00/UTC</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
</ol>
<h3 id="the-application-doesnt-run-for-a-week-and-when-its-finally-re-opened-the-timezone-has-changed"><a class="header" href="#the-application-doesnt-run-for-a-week-and-when-its-finally-re-opened-the-timezone-has-changed">The application doesn’t run for a week, and when it’s finally re-opened the timezone has changed</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 on 15:00 in timezone UTC, closed on 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 16 on 17:00 in timezone UTC+1.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC+1 since MW1.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC</code></li>
<li><code>end_time=Feb16/17:00/UTC+1</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
</ol>
<h3 id="the-user-changes-timezone-in-an-extreme-enough-fashion-that-they-cross-0400-twice-on-the-same-date"><a class="header" href="#the-user-changes-timezone-in-an-extreme-enough-fashion-that-they-cross-0400-twice-on-the-same-date">The user changes timezone in an extreme enough fashion that they cross 04:00 twice on the same date</a></h3>
<ol>
<li>
<p>The application is opened on Feb 7 at 15:00 in timezone UTC+11, closed at 15:05.</p>
<ul>
<li>Glean records one metric A (say startup time in ms) during this measurement window MW1.</li>
</ul>
</li>
<li>
<p>The application is opened again on Feb 8 at 04:30 in timezone UTC+11.</p>
<ul>
<li>
<p>Glean notes that we passed local 04:00 UTC+11.</p>
</li>
<li>
<p>Glean closes MW1, with:</p>
<ul>
<li><code>start_time=Feb7/15:00/UTC+11</code>;</li>
<li><code>end_time=Feb8/04:30/UTC+11</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW2.</p>
</li>
</ul>
</li>
<li>
<p>The user changes to timezone UTC-10 and opens the application at Feb 7 at 22:00 in timezone UTC-10</p>
<ul>
<li>Glean records metric A again, into MW2 (not MW1, which was already sent).</li>
</ul>
</li>
<li>
<p>The user opens the application at Feb 8 05:00 in timezone UTC-10</p>
<ul>
<li>Glean notes that we have not yet passed local 04:00 on Feb 9</li>
<li>Measurement window MW2 remains the current measurement window</li>
</ul>
</li>
<li>
<p>The user opens the application at Feb 9 07:00 in timezone UTC-10</p>
<ul>
<li>
<p>Glean notes that we have passed local 04:00 on Feb 9</p>
</li>
<li>
<p>Glean closes MW2 with:</p>
<ul>
<li><code>start_time=Feb8/04:30/UTC+11</code>;</li>
<li><code>end_time=Feb9/19:00/UTC-10</code>.</li>
</ul>
</li>
<li>
<p>Glean records metric A again, into MW3.</p>
</li>
</ul>
</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/metrics.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="ping-schedules-and-timings-overview"><a class="header" href="#ping-schedules-and-timings-overview">Ping schedules and timings overview</a></h1>
<p>Full reference details about the <a href="user/pings/metrics.html"><code>metrics</code></a> and <a href="user/pings/baseline.html"><code>baseline</code></a> ping schedules are detailed elsewhere.</p>
<p>The following diagram shows a typical timeline of a mobile application, when pings are sent and what timing-related information is included.</p>
<p><img src="user/pings/ping_timing.svg" alt="ping timeline diagram" /></p>
<p>There are two distinct runs of the application, where the OS shutdown the application at the end of Run 1, and the user started it up again at the beginning of Run 2.</p>
<p>There are three distinct foreground sessions, where the application was visible on the screen and the user was able to interact with it.</p>
<p>The rectangles for the <code>baseline</code> and <code>metrics</code> pings represent the measurement windows of those pings, which always start exactly at the end of the preceding ping.  The <code>ping_info.start_time</code> and <code>ping_info.end_time</code> metrics included in these pings correspond to these beginning and the end of their measurement windows.</p>
<p>The <code>baseline.duration</code> metric (included only in <code>baseline</code> pings) corresponds to amount of time the application spent on the foreground, which, since measurement window always extend to the next ping, is not always the same thing as the <code>baseline</code> ping's measurement window.</p>
<p>The <code>submission_timestamp</code> is the time the ping was received at the telemetry endpoint, added by the ingestion pipeline.  It is not exactly the same as <code>ping_info.end_time</code>, since there may be various networking and system latencies both on the client and in the ingestion pipeline (represented by the dotted horizontal line, not to scale).  Also of note is that <code>start_time</code>/<code>end_time</code> are measured using the client's real-time clock in its local timezone, which is not a fully reliable source of time.</p>
<p>The &quot;Baseline 4&quot; ping illustrates an important corner case. When &quot;Session 2&quot; ended, the OS also shut down the entire process, and the Glean SDK did not have an opportunity to send a <code>baseline</code> ping immediately.  In this case, it is sent at the next available opportunity when the application starts up again in &quot;Run 2&quot;.  This <code>baseline</code> ping is annotated with the reason code <code>dirty_startup</code>.</p>
<p>The &quot;Metrics 2&quot; ping likewise illustrates another important corner case. &quot;Metrics 1&quot; was able to be sent at the target time of 04:00 (local device time) because the application was currently running.  However, the next time 04:00 came around, the application was not active, so the Glean SDK was unable to send a <code>metrics</code> ping.  It is sent at the next available opportunity, when the application starts up again in &quot;Run 2&quot;.  This <code>metrics</code> ping is annotated with the reason code <code>overdue</code>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/pings/ping-schedules-and-timings.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-products-using-the-glean-sdk"><a class="header" href="#debugging-products-using-the-glean-sdk">Debugging products using the Glean SDK</a></h1>
<p>Glean provides a few debugging features to assist with debugging a product using Glean.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<h3 id="log-pings"><a class="header" href="#log-pings">Log Pings</a></h3>
<p>Print the ping payload upon sending a ping.</p>
<h3 id="debug-view-tag"><a class="header" href="#debug-view-tag">Debug View Tag</a></h3>
<p>Tags all outgoing pings as debug pings to make them available for real-time validation, on the Glean Debug View.</p>
<h4 id="glean-debug-view"><a class="header" href="#glean-debug-view">Glean Debug View</a></h4>
<p>The <a href="https://debug-ping-preview.firebaseapp.com/">Glean Debug View</a> enables you to easily see in real-time what data your application is sending.</p>
<p>This data is what actually arrives in our data pipeline, shown in a web
interface that is automatically updated when new data arrives. Any data sent from a Glean-instrumented application usually shows up within 10 seconds,
updating the pages automatically. Pings are retained for 3 weeks.</p>
<h4 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h4>
<p>If nothing is showing up on the dashboard after you set a <code>debugViewTag</code> and you see
<code>Glean must be enabled before sending pings.</code> in the logs, Glean is disabled. Check with
the application author on how to re-enable it.</p>
<h3 id="source-tags"><a class="header" href="#source-tags">Source Tags</a></h3>
<p>Tags outgoing pings with a maximum of 5 comma-separated tags.</p>
<h3 id="send-ping"><a class="header" href="#send-ping">Send Ping</a></h3>
<p>Sends a ping on demand.</p>
<h2 id="debugging-methods"><a class="header" href="#debugging-methods">Debugging methods</a></h2>
<p>Each Glean SDK may expose one or more of the following methods to
interact with and enable these debugging functionalities.</p>
<ol>
<li>Enable debugging features through APIs exposed through the Glean singleton;</li>
<li>Enable debugging features through environment variables set at runtime;</li>
<li>Enable debugging features through platform specific tooling.</li>
</ol>
<p>For methods 1. and 2., refer to the API reference section <a href="user/debugging/../../reference/debug/index.html">&quot;Debugging&quot;</a>
for detailed information on how to use them.</p>
<p>For method 3. please refer to the platform specific pages on how to debug products using Glean.</p>
<h3 id="platform-specific-information"><a class="header" href="#platform-specific-information">Platform Specific Information</a></h3>
<ol>
<li><a href="user/debugging/./android.html">Debugging Android applications using the Glean SDK</a></li>
<li><a href="user/debugging/./ios.html">Debugging iOS applications using the Glean SDK</a></li>
<li><a href="user/debugging/./python.html">Debugging Python applications using the Glean SDK</a></li>
<li><a href="user/debugging/./javascript.html">Debugging JavaScript applications using Glean.js</a></li>
</ol>
<h3 id="available-debugging-methods-per-platform"><a class="header" href="#available-debugging-methods-per-platform">Available debugging methods per platform</a></h3>
<table><thead><tr><th align="right"></th><th align="center">Glean API</th><th align="center">Environment Variables</th><th align="center">Platform Specific Tooling</th></tr></thead><tbody>
<tr><td align="right">Kotlin</td><td align="center"></td><td align="center"></td><td align="center">✅ <sup class="footnote-reference"><a href="#1">1</a></sup></td></tr>
<tr><td align="right">Swift</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅ <sup class="footnote-reference"><a href="#2">2</a></sup></td></tr>
<tr><td align="right">Python</td><td align="center"></td><td align="center">✅</td><td align="center"></td></tr>
<tr><td align="right">Rust</td><td align="center">✅</td><td align="center">✅</td><td align="center"></td></tr>
<tr><td align="right">JavaScript</td><td align="center">✅</td><td align="center"></td><td align="center"></td></tr>
<tr><td align="right">Firefox Desktop</td><td align="center"></td><td align="center">✅</td><td align="center">✅ <sup class="footnote-reference"><a href="#3">3</a></sup></td></tr>
</tbody></table>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>The Glean Kotlin SDK exposes the <a href="user/debugging/./android.html"><code>GleanDebugActivity</code></a> for interacting with debug features. Although it is technically possible to also use environment variables in Android, the Glean team is not aware of a proper way to set environment variables in Android devices or emulators.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>The Glean Swift SDK exposes a <a href="user/debugging/./ios.html">custom URL format</a> for interacting with debug features.</p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">3</sup>
<p>In Firefox Desktop, developers may use the interface exposed through <code>about:glean</code> to log, tag or send pings.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/index.md">Edit this file on GitHub.</a></footer></div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-android-applications-using-the-glean-sdk"><a class="header" href="#debugging-android-applications-using-the-glean-sdk">Debugging Android applications using the Glean SDK</a></h1>
<p>The Glean Kotlin SDK exports the <code>GleanDebugActivity</code> that can be used to toggle debugging features on or off.
Users can invoke this special activity, at run-time, using the following <a href="https://developer.android.com/studio/command-line/adb"><code>adb</code></a> command:</p>
<pre><code class="language-bash">adb shell am start -n [applicationId]/mozilla.telemetry.glean.debug.GleanDebugActivity [extra keys]
</code></pre>
<p>In the above:</p>
<ul>
<li>
<p><code>[applicationId]</code> is the product's application id as defined in the manifest file and/or build script. For the Glean sample application, this is <code>org.mozilla.samples.gleancore</code> for a release build and <code>org.mozilla.samples.gleancore.debug</code> for a debug build.</p>
</li>
<li>
<p><code>[extra keys]</code> is a list of extra keys to be passed to the debug activity. See the <a href="https://developer.android.com/studio/command-line/adb#IntentSpec">documentation</a> for the command line switches used to pass the extra keys. These are the currently supported keys:</p>
</li>
</ul>
<table><thead><tr><th>key</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>logPings</code></td><td>boolean (<code>--ez</code>)</td><td>If set to <code>true</code>, pings are dumped to logcat; defaults to <code>false</code></td></tr>
<tr><td><code>debugViewTag</code></td><td>string (<code>--es</code>)</td><td>Tags all outgoing pings as debug pings to make them available for real-time validation, on the <a href="user/debugging/./index.html#glean-debug-view">Glean Debug View</a>. The value must match the pattern <code>[a-zA-Z0-9-]{1,20}</code>. <strong>Important</strong>: in older versions of the Glean SDK, this was named <code>tagPings</code></td></tr>
<tr><td><code>sourceTags</code></td><td>string array (<code>--esa</code>)</td><td>Tags outgoing pings with a maximum of 5 comma-separated tags. The tags must match the pattern <code>[a-zA-Z0-9-]{1,20}</code>. The <code>automation</code> tag is meant for tagging pings generated on automation: such pings will be specially handled on the pipeline (i.e. discarded from <a href="https://docs.telemetry.mozilla.org/cookbooks/bigquery/querying.html#table-layout-and-naming">non-live views</a>). Tags starting with <code>glean</code> are reserved for future use. Subsequent calls of this overwrite any previously stored tag</td></tr>
<tr><td><code>sendPing</code></td><td>string (<code>--es</code>)</td><td>Sends the ping with the given name immediately</td></tr>
<tr><td><code>startNext</code></td><td>string (<code>--es</code>)</td><td>The name of an exported Android <code>Activity</code>, as defined in the product manifest file, to start right after the <code>GleanDebugActivity</code> completes. All the options provided are propagated to this next activity as well. When omitted, the default launcher activity for the product is started instead.</td></tr>
</tbody></table>
<p>All <a href="https://developer.android.com/studio/command-line/adb#am">the options</a> provided to start the activity are passed over to the main activity for the application to process.
This is useful if SDK users wants to debug telemetry while providing additional options to the product to enable specific behaviors.</p>
<blockquote>
<p><strong>Note:</strong> Due to limitations on Android logcat message size, pings larger than 4KB are broken into multiple log messages when using <code>logPings</code>.</p>
</blockquote>
<p>For example, to direct a release build of the Glean sample application to (1) dump pings to logcat, (2) tag the ping with the <code>test-metrics-ping</code> tag, and (3) send the &quot;metrics&quot; ping immediately, the following command can be used:</p>
<pre><code class="language-shell">adb shell am start -n org.mozilla.samples.gleancore/mozilla.telemetry.glean.debug.GleanDebugActivity \
  --ez logPings true \
  --es sendPing metrics \
  --es debugViewTag test-metrics-ping
</code></pre>
<p>The <code>logPings</code> command doesn't trigger ping submission and you won't see any output until a ping has been sent. You can use the <code>sendPing</code> command to force a ping to be sent, but it could be more desirable to trigger the pings submission on their normal schedule. For instance, the <code>baseline</code> and <code>events</code> pings can be triggered by moving the app out of the foreground and the <code>metrics</code> ping can be triggered normally if it is overdue for the current calendar day.</p>
<blockquote>
<p><strong>Note:</strong> The device or emulator must be connected to the internet for this to work. Otherwise the job that sends the pings won't be triggered.</p>
</blockquote>
<p>If no metrics have been collected, no pings will be sent <em>unless</em> <a href="user/debugging/../pings/custom.html#defining-a-custom-ping"><code>send_if_empty</code> is set on your ping</a>. See the <a href="user/debugging/../pings/index.html">ping documentation</a> for more information on ping scheduling to learn when pings are sent.</p>
<p>Options that are set using the <code>adb</code> flags are not immediately reset and will
persist until the application is closed or manually reset.</p>
<h2 id="glean-kotlin-sdk-log-messages"><a class="header" href="#glean-kotlin-sdk-log-messages">Glean Kotlin SDK Log messages</a></h2>
<p>When running a Glean SDK-powered app in the Android emulator or on a device connected to your computer via cable, there are several ways to read the log output.</p>
<h3 id="android-studio"><a class="header" href="#android-studio">Android Studio</a></h3>
<p>Android Studio can show the logs of a connected emulator or device.
To display the log messages for an app:</p>
<ol>
<li>Run an app on your device.</li>
<li>Click <strong>View &gt; Tool Windows &gt; Logcat</strong> (or click <strong>Logcat</strong> in the tool window bar).</li>
</ol>
<p>The Logcat window will show all log messages and allows to filter those by the application ID.
Select the application ID of the product you're debugging.
You can also filter by <code>Glean</code> only.</p>
<p>More information can be found in the <a href="https://developer.android.com/studio/debug/am-logcat">View Logs with Logcat</a> help article.</p>
<h3 id="command-line"><a class="header" href="#command-line">Command line</a></h3>
<p>On the command line you can show all of the log output using:</p>
<pre><code class="language-shell">adb logcat
</code></pre>
<p>This is the unfiltered output of all log messages.
You can match for <code>glean</code> using grep:</p>
<pre><code class="language-shell">adb logcat | grep -i glean
</code></pre>
<p>A simple way to filter for only the application that is being debugged is by using <a href="https://github.com/JakeWharton/pidcat">pidcat</a>, a wrapper around <code>adb</code>, which adds colors and proper filtering by application ID and log level.
Run it like this to filter for an application:</p>
<pre><code class="language-shell">pidcat [applicationId]
</code></pre>
<p>In the above <code>[applicationId]</code> is the product's application id as defined in the manifest file and/or build script. For the Glean sample application, this is <code>org.mozilla.samples.gleancore</code> for a release build and <code>org.mozilla.samples.gleancore.debug</code> for a debug build.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/android.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-ios-applications-using-the-glean-sdk"><a class="header" href="#debugging-ios-applications-using-the-glean-sdk">Debugging iOS applications using the Glean SDK</a></h1>
<h2 id="enabling-debugging-features-in-ios-through-environment-variables"><a class="header" href="#enabling-debugging-features-in-ios-through-environment-variables">Enabling debugging features in iOS through environment variables</a></h2>
<p>Debugging features in iOS can be enabled using environment variables.
For more information on the available features accessible through this method
and how to enable them, see <a href="user/debugging/../../reference/debug/index.html">Debugging API reference</a>.</p>
<p>These environment variables must be set on the device that is running the application.</p>
<h2 id="enabling-debugging-features-in-ios-through-a-custom-url-scheme"><a class="header" href="#enabling-debugging-features-in-ios-through-a-custom-url-scheme">Enabling debugging features in iOS through a custom URL scheme</a></h2>
<p>For debugging and validation purposes on iOS, the Glean Swift SDK makes use of a custom URL scheme which is implemented <em>within the application</em>. The Glean Swift SDK provides some convenience functions to facilitate this, but it's up to the consuming application to enable this functionality.  Applications that enable this feature will be able to launch the application from a URL with the Glean debug commands embedded in the URL itself.</p>
<h3 id="available-commands-and-query-format"><a class="header" href="#available-commands-and-query-format">Available commands and query format</a></h3>
<p>All 4 Glean debugging features are available through the custom URL scheme tool.</p>
<ul>
<li><a href="user/debugging/../../reference/debug/logPings.html"><code>logPings</code></a>: This is either true or false and will cause pings that are submitted to also be echoed to the device's log.</li>
<li><a href="user/debugging/../../reference/debug/debugViewTag.html"><code>debugViewTag</code></a>: This command will tag outgoing pings with the provided value, in order to identify them in the Glean Debug View.</li>
<li><a href="user/debugging/../../reference/debug/sourceTags.html"><code>sourceTags</code></a>: This command tags outgoing pings with a maximum of 5 comma-separated tags.</li>
<li><code>sendPing</code>: This command expects a string name of a ping to force immediate collection and submission of.</li>
</ul>
<p>The structure of the custom URL uses the following format:</p>
<p><code>&lt;protocol&gt;://glean?&lt;command 1&gt;=&lt;paramter 1&gt;&amp;&lt;command 2&gt;=&lt;parameter 2&gt; ...</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;protocol&gt;</code> is the &quot;URL Scheme&quot; that has been added for your app (see Instrumenting the application below), such as <code>glean-sample-app</code>.</li>
<li>This is followed by <code>://</code> and then <code>glean</code> which is required for the Glean Swift SDK to recognize the command is meant for it to process.</li>
<li>Following standard URL query format, the next character after <code>glean</code> is the <code>?</code> indicating the beginning of the query.</li>
<li>This is followed by one or more queries in the form of <code>&lt;command&gt;=&lt;parameter&gt;</code>, where the command is one of the commands listed above, followed by an <code>=</code> and then the value or parameter to be used with the command.</li>
</ul>
<p>There are a few things to consider when creating the custom URL:</p>
<ul>
<li>Invalid commands will log an error and cause the entire URL to be ignored.</li>
<li>Not all commands are required to be encoded in the URL, you can mix and match the commands that you need.</li>
<li>Multiple instances of commands are not allowed in the same URL and, if present, will cause the entire URL to be ignored.</li>
<li>The <code>logPings</code> command doesn't trigger ping submission and you won't see any output until a ping has been submitted. You can use the <code>sendPing</code> command to force a ping to be sent, but it could be more desirable to trigger the pings submission on their normal schedule. For instance, the <code>baseline</code> and <code>events</code> pings can be triggered by moving the app out of the foreground and the <code>metrics</code> ping can be triggered normally if it is overdue for the current calendar day. See the <a href="user/debugging/../pings/index.html">ping documentation</a> for more information on ping scheduling to learn when pings are sent.</li>
<li>Enabling debugging features through custom URLs overrides any debugging features set through environment variables.</li>
</ul>
<h3 id="instrumenting-the-application-for-glean-swift-sdk-debug-functionality"><a class="header" href="#instrumenting-the-application-for-glean-swift-sdk-debug-functionality">Instrumenting the application for Glean Swift SDK debug functionality</a></h3>
<p>In order to enable the debugging features in an iOS application, it is necessary to add some information to the application's <code>Info.plist</code>, and add a line and possibly an override for a function in the <code>AppDelegate.swift</code>.</p>
<h4 id="register-custom-url-scheme-in-infoplist"><a class="header" href="#register-custom-url-scheme-in-infoplist">Register custom URL scheme in <code>Info.plist</code></a></h4>
<blockquote>
<p><strong>Note:</strong> If your application already has a custom URL scheme implemented, there is no need to implement a second scheme, you can simply use that and skip to the next section about adding the convenience method.  If the app doesn't have a custom URL scheme implemented, then you will need to perform the following instructions to register your app to receive custom URLs.</p>
</blockquote>
<p>Find and open the application's <code>Info.plist</code> and right click any blank area and select <code>Add Row</code> to create a new key.</p>
<p>You will be prompted to select a key from a drop-down menu, scroll down to and select <code>URL types</code>.  This creates an array item, which can be expanded by clicking the triangle disclosure icon.</p>
<p>Select <code>Item 0</code>, click on it and click the disclosure icon to expand it and show the <code>URL identifier</code> line.  Double-click the value field and fill in your identifier, typically the same as the bundle ID.</p>
<p>Right-click on <code>Item 0</code> and select <code>Add Row</code> from the context menu.  In the dropdown menu, select <code>URL Schemes</code> to add the item.</p>
<p>Click on the disclosure icon of <code>URL Schemes</code> to expand the item, double-click the value field of <code>Item 0</code> and key in the value for your application's custom scheme.  For instance, the Glean sample app uses <code>glean-sample-app</code>, which allows for custom URLs to be crafted using that as a protocol, for example: <code>glean-sample-app://glean?logPings=true</code></p>
<h4 id="add-the-gleanhandlecustomurl-convenience-function-and-necessary-overrides"><a class="header" href="#add-the-gleanhandlecustomurl-convenience-function-and-necessary-overrides">Add the <code>Glean.handleCustomUrl()</code> convenience function and necessary overrides</a></h4>
<p>In order to handle the incoming debug commands, it is necessary to implement the override in the application's <code>AppDelegate.swift</code> file.  Within that function, you can make use of the convenience function provided in Glean <code>handleCustomUrl(url: URL)</code>.</p>
<p>An example of a simple implementation of this would look like this:</p>
<pre><code class="language-Swift">func application(_: UIApplication,
                 open url: URL,
                 options _: [UIApplication.OpenURLOptionsKey: Any] = [:]) -&gt; Bool {
    // ...

    // This does nothing if the url isn't meant for Glean.
    Glean.shared.handleCustomUrl(url: url)

    // ...

    return true
}
</code></pre>
<p>If you need additional help setting up a custom URL scheme in your application, please refer to <a href="https://developer.apple.com/documentation/uikit/inter-process_communication/allowing_apps_and_websites_to_link_to_your_content/defining_a_custom_url_scheme_for_your_app">Apple's documentation</a>.</p>
<h3 id="invoking-the-glean-ios-debug-commands"><a class="header" href="#invoking-the-glean-ios-debug-commands">Invoking the Glean-iOS debug commands</a></h3>
<p>Now that the app has the debug functionality enabled, there are a few ways in which we can invoke the debug commands.</p>
<h4 id="using-a-web-browser"><a class="header" href="#using-a-web-browser">Using a web browser</a></h4>
<p>Perhaps the simplest way to invoke the debug functionality is to open a web browser and type/paste the custom URL into the address bar.  This is especially useful on an actual device because there isn't a good way to launch from the command line and process the URL for an actual device.</p>
<p>Using the glean-sample-app as an example: to activate ping logging, tag the pings to go to the Glean Debug View, and force the <code>events</code> ping to be sent, enter the following URL in a web browser on the iOS device:</p>
<pre><code class="language-shell">glean-sample-app://glean?logPings=true&amp;debugViewTag=My-ping-tag&amp;sendPing=events
</code></pre>
<p>This should cause iOS to prompt you with a dialog asking if you want to open the URL in the Glean Sample App, and if you select &quot;Okay&quot; then it will launch (or resume if it's already running) the application with the indicated commands and parameters and immediately force the collection and submission of the events ping.</p>
<blockquote>
<p><strong>Note:</strong> This method does not work if the browser you are using to input the command is the same application you are attempting to pass the Glean debug commands to.  So, you couldn't use Firefox for iOS to trigger commands within Firefox for iOS.</p>
</blockquote>
<p>It is also possible to encode the URL into a 2D barcode or QR code and launch the app via the camera app.  After scanning the encoded URL, the dialog prompting to launch the app should appear as if the URL were entered into the browser address bar.</p>
<h4 id="using-the-command-line"><a class="header" href="#using-the-command-line">Using the command line</a></h4>
<p>This method is useful for testing via the Simulator, which typically requires a Mac with Xcode installed, including the Xcode command line tools.  In order to perform the same command as above with using the browser to input the URL, you can use the following command in the command line terminal of the Mac:</p>
<pre><code class="language-shell">xcrun simctl openurl booted &quot;glean-sample-app://glean?logPings=true&amp;debugViewTag=My-ping-tag&amp;sendPing=events&quot;
</code></pre>
<p>This will launch the simulator and again prompt the user with a dialog box asking if you want to open the URL in the Glean Sample App (or whichever app you are instrumenting and testing).</p>
<h3 id="glean-log-messages"><a class="header" href="#glean-log-messages">Glean log messages</a></h3>
<p>The Glean Swift SDK integrates with the <a href="https://developer.apple.com/documentation/os/logging/">unified logging system</a> available on iOS.
There are various ways to retrieve log information, see the <a href="https://developer.apple.com/documentation/os/logging/viewing_log_messages">official documentation</a>.</p>
<p>If debugging in the simulator, the logging messages can be seen in the console window within Xcode.</p>
<p>When running a Glean-powered app in the iOS Simulator or on a device connected to your computer via cable you can use <code>Console.app</code> to view the system log.
You can filter the logs with <code>category:glean</code> to only see logs from the Glean SDK.</p>
<p>You can also use the command line utility <code>log</code> to stream the log output.
Run the following in a shell:</p>
<pre><code>log stream --predicate 'category contains &quot;glean&quot;'
</code></pre>
<p>See <a href="https://developer.apple.com/library/archive/qa/qa1747/_index.html">Diagnosing Issues Using Crash Reports and Device Logs</a> for more information about debugging deployed iOS apps.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/ios.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-python-applications-using-the-glean-sdk"><a class="header" href="#debugging-python-applications-using-the-glean-sdk">Debugging Python applications using the Glean SDK</a></h1>
<p>Debugging features in Python can be enabled using environment variables.
For more information on the available features and how to enable them,
see the <a href="user/debugging/../../reference/debug/index.html">Debugging API reference</a>.</p>
<h2 id="sending-pings"><a class="header" href="#sending-pings">Sending pings</a></h2>
<p>Unlike other platforms, Python doesn't expose convenience methods to send pings on demand.</p>
<p>In case that is necessary, calling the <code>submit</code> function for a given ping,
such as <code>pings.custom_ping.submit()</code>, will send it.</p>
<h2 id="logging-pings"><a class="header" href="#logging-pings">Logging pings</a></h2>
<p>Glean offers two options for logging from Python:</p>
<ul>
<li><strong>Simple logging API:</strong> A simple API that only allows for setting the logging level, but includes all Glean log messages, including those from its networking subprocess. This is also the only mode in which <a href="user/debugging/../../reference/debug/logPings.html"><code>GLEAN_LOG_PINGS</code></a> can be used to display ping contents in the log.</li>
<li><strong>Flexible logging API:</strong> Full use of the Python <code>logging</code> module, including its features for redirecting to files and custom handling of messages, but does not include messages from the networking subprocess about HTTP requests.</li>
</ul>
<h3 id="simple-logging-api"><a class="header" href="#simple-logging-api">Simple logging API</a></h3>
<p>You can set the logging level for Glean log messages by passing <code>logging.DEBUG</code> to <code>Glean.initialize</code> as follows:</p>
<pre><code class="language-python">import logging
from glean import Glean

Glean.initialize(..., log_level=logging.DEBUG)
</code></pre>
<p>If you want to see ping contents as well, set the <code>GLEAN_LOG_PINGS</code> environment variable to <code>true</code>.</p>
<h3 id="flexible-logging-api"><a class="header" href="#flexible-logging-api">Flexible logging API</a></h3>
<p>You can set the logging level for the Python logging to <code>DEBUG</code> as follows:</p>
<pre><code class="language-python">import logging

logging.basicConfig(level=logging.DEBUG)
</code></pre>
<p>All log messages from the Glean Python SDK are on the <code>glean</code> logger, so if you need to control it independently, you can set a level for just the Glean Python SDK (but note that the global Python logging level also needs to be set as above):</p>
<pre><code class="language-python">logging.getLogger(&quot;glean&quot;).setLevel(logging.DEBUG)
</code></pre>
<p>The flexible logging API is unable to display networking-related log messages or ping contents with <code>GLEAN_LOG_PINGS</code> set to true.</p>
<p>See the <a href="https://docs.python.org/3.8/library/logging.html">Python logging documentation</a> for more information.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/python.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-javascript-applications-using-gleanjs"><a class="header" href="#debugging-javascript-applications-using-gleanjs">Debugging JavaScript applications using Glean.js</a></h1>
<p>Debugging features in JavaScript can be enabled through APIs exposed on the Glean object.
For more information on the available features and how to enable them,
see the <a href="user/debugging/../../reference/debug/index.html">Debugging API reference</a>.</p>
<h2 id="sending-pings-1"><a class="header" href="#sending-pings-1">Sending pings</a></h2>
<p>Unlike other platforms, JavaScript doesn't expose convenience methods to send pings on demand.</p>
<p>In case that is necessary, calling the <code>submit</code> function for a given ping,
such as <code>pings.customPing.submit()</code>, will send it.</p>
<p>Note that this method is only effective for custom pings.
Glean internal pings are not exposed to users.</p>
<h2 id="logging-pings-1"><a class="header" href="#logging-pings-1">Logging pings</a></h2>
<p>By calling <code>Glean.logPings(true)</code> all subsequent pings sent will be logged to the console.</p>
<p>To access the logs for web extensions on</p>
<h3 id="firefox"><a class="header" href="#firefox">Firefox</a></h3>
<ol>
<li>Go to <code>about:debugging#/runtime/this-firefox</code>;</li>
<li>Find the extension you want to see the logs for;</li>
<li>Click on <code>Inspect</code>.</li>
</ol>
<h3 id="chromium-based-browsers"><a class="header" href="#chromium-based-browsers">Chromium-based browsers</a></h3>
<ol>
<li>Go to <code>chrome://extensions</code>;</li>
<li>Find the extension you want to see the logs for;</li>
<li>Click on <code>background page</code>.</li>
</ol>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/user/debugging/javascript.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="yaml-registry-format"><a class="header" href="#yaml-registry-format">YAML Registry Format</a></h1>
<p>User defined Glean pings and metrics are declared in YAML files, which must be parsed by
<a href="https://pypi.org/project/glean-parser/"><code>glean_parser</code></a> to generate public APIs
for said metrics and pings.</p>
<p>These files also serve the purpose of documenting metrics and pings. They are consumed by the
<a href="https://github.com/mozilla/probe-scraper"><code>probe-scraper</code></a> tool, which generates a REST API to
access metrics and pings information consumed by most other tools in the Glean ecosystem, such as
<a href="https://glam.telemetry.mozilla.org/">GLAM</a> and <a href="https://dictionary.telemetry.mozilla.org/">the Glean Dictionary</a>.</p>
<p>Moreover, for products that do not wish to use the Glean Dictionary as their metrics and pings documentation source, <code>glean_parser</code> provides an option to generate Markdown documentation for metrics and pings based on these files. For more information of that, refer to the help output
of the <code>translate</code> command, by running in your terminal:</p>
<pre><code class="language-bash">$ glean_parser translate --help
</code></pre>
<h2 id="metricsyaml-file"><a class="header" href="#metricsyaml-file"><code>metrics.yaml</code> file</a></h2>
<p>For a full reference on the <code>metrics.yaml</code> format, refer to the
<a href="reference/yaml/metrics.html">Metrics YAML Registry Format</a> page.</p>
<h2 id="pingsyaml-file"><a class="header" href="#pingsyaml-file"><code>pings.yaml</code> file</a></h2>
<p>For a full reference on the <code>pings.yaml</code> format, refer to the
<a href="reference/yaml/pings.html">Pings YAML Registry Format</a> page.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/yaml/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="metrics-yaml-registry-format"><a class="header" href="#metrics-yaml-registry-format">Metrics YAML Registry Format</a></h1>
<p>Metrics sent by an application or library are defined in YAML files which follow
the <a href="https://mozilla.github.io/glean_parser/metrics-yaml.html"><code>metrics.yaml</code> JSON schema</a>.</p>
<p>This files must be parsed by <a href="https://pypi.org/project/glean-parser/"><code>glean_parser</code></a> at build time
in order to generate code in the target language (e.g. Kotlin, Swift, ...). The generated code is
what becomes the public API to access the project's metrics.</p>
<p>For more information on how to introduce the <code>glean_parser</code> build step for a specific language /
environment, refer to the <a href="reference/yaml/../../user/adding-glean-to-your-project/index.html">&quot;Adding Glean to your project&quot;</a>
section of this book.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="note-on-the-naming-of-these-files"><a class="header" href="#note-on-the-naming-of-these-files">Note on the naming of these files</a></h2>
<blockquote>
<p>Although we refer to metrics definitions YAML files as <code>metrics.yaml</code> throughout Glean documentation
this files may be named whatever makes the most sense for each project and may even be broken down
into multiple files, if necessary.</p>
</blockquote>
<h2 id="file-structure"><a class="header" href="#file-structure">File structure</a></h2>
<pre><code class="language-yaml">---
# Schema
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

$tags:
  - frontend

# Category
toolbar:
  # Name
  click:
    # Metric Parameters
    type: event
    description: |
      Event to record toolbar clicks.
    metadata:
      tags:
        - Interaction
    notification_emails:
      - CHANGE-ME@example.com
    bugs:
      - https://bugzilla.mozilla.org/123456789/
    data_reviews:
      - http://example.com/path/to/data-review
    expires: 2019-06-01

  double_click:
    ...
</code></pre>
<h2 id="schema"><a class="header" href="#schema">Schema</a></h2>
<p>Declaring the schema at the top of a metrics definitions file is required,
as it is what indicates that the current file is a metrics definitions file.</p>
<h1 id="tags"><a class="header" href="#tags"><code>$tags</code></a></h1>
<p>You may optionally declare <a href="reference/yaml/tags.html">tags</a> at the file level that apply to all metrics in that file.</p>
<h2 id="category"><a class="header" href="#category">Category</a></h2>
<p>Categories are the top-level keys on metrics definition files. One single definition file
may contain multiple categories grouping multiple metrics. They serve the purpose of grouping related
metrics in a project.</p>
<p>Categories can contain alphanumeric lower case characters as well as the <code>.</code> and <code>_</code> characters
which can be used to provide extra structure, for example <code>category.subcategory</code> is a valid category.
Category lengths may not exceed 40 characters.</p>
<p>Categories may not start with the string <code>glean</code>. That prefix is reserved for Glean internal metrics.</p>
<p>See the <a href="reference/yaml/../../user/metrics/adding-new-metrics.html#capitalization">&quot;Capitalization&quot;</a>
note to understand how the category is formatted in generated code.</p>
<h2 id="name"><a class="header" href="#name">Name</a></h2>
<p>Metric names are the second-level keys on metrics definition files.</p>
<p>Names may contain alphanumeric lower case characters as well as the <code>_</code> character. Metric name
lengths may not exceed 30 characters.</p>
<p><a href="reference/yaml/../../user/metrics/adding-new-metrics.html#capitalization">&quot;Capitalization&quot;</a> rules also apply to
metric names on generated code.</p>
<h2 id="metric-parameters"><a class="header" href="#metric-parameters">Metric parameters</a></h2>
<p>Specific metric types may have special required parameters in their definition,
these parameters are documented in each <a href="reference/yaml/../metrics/index.html">&quot;Metric Type&quot;</a> reference page.</p>
<p>Following are the parameters common to all metric types.</p>
<h3 id="required-parameters"><a class="header" href="#required-parameters">Required parameters</a></h3>
<h4 id="type"><a class="header" href="#type"><code>type</code></a></h4>
<p>Specifies the type of a metric, like &quot;counter&quot; or &quot;event&quot;.
This defines which operations are valid for the metric,
how it is stored and how data analysis tooling displays it.
See the list of <a href="reference/yaml/../metrics/index.html">supported metric types</a>.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="types-must-not-be-changed-after-release"><a class="header" href="#types-must-not-be-changed-after-release">Types must not be changed after release</a></h5>
<blockquote>
<p>Once a metric is defined in a product, its <code>type</code> must not be changed.
The ingestion pipeline will not be able to handle such a change.
If a type change is required a new metric must be added with a new name and the new type.
This will require an additional data review, in which you can also reference the old data review.</p>
</blockquote>
<h4 id="description-4"><a class="header" href="#description-4"><code>description</code></a></h4>
<p>A textual description of the metric for humans.
It should describe what the metric does, what it means for analysts,
and its edge cases or any other helpful information.</p>
<p>The description field may contain <a href="https://www.markdownguide.org/basic-syntax/">markdown syntax</a>.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="imposed-limits-on-line-length"><a class="header" href="#imposed-limits-on-line-length">Imposed limits on line length</a></h5>
<blockquote>
<p>The Glean linter uses a line length limit of 80 characters.
If your description is longer, e.g. because it includes longer links,
you can disable <code>yamllint</code> using the following annotations
(and make sure to enable <code>yamllint</code> again as well):</p>
<pre><code class="language-yaml"># yamllint disable
description: |
  Your extra long description, that's longer than 80 characters by far.
# yamllint enable
</code></pre>
</blockquote>
<h4 id="notification_emails"><a class="header" href="#notification_emails"><code>notification_emails</code></a></h4>
<p>A list of email addresses to notify for important events with the metric
or when people with context or ownership for the metric need to be contacted.</p>
<p>For example when a metric's expiration is within in 14 days, emails will be sent
from <code>telemetry-alerts@mozilla.com</code> to the <code>notification_emails</code> addresses associated with the metric.</p>
<p>Consider adding both a group email address and an individual who is responsible for this metric.</p>
<h4 id="bugs"><a class="header" href="#bugs"><code>bugs</code></a></h4>
<p>A list of bugs (e.g. Bugzilla or GitHub) that are relevant to this metric.
For example, bugs that track its original implementation or later changes to it.</p>
<p>Each entry should be the full URL to the bug in an issue tracker.
The use of numbers alone is deprecated and will be an error in the future.</p>
<h4 id="data_reviews"><a class="header" href="#data_reviews"><code>data_reviews</code></a></h4>
<p>A list of URIs to any data collection review <em>responses</em> relevant to the metric.</p>
<h4 id="expires"><a class="header" href="#expires"><code>expires</code></a></h4>
<p>When the metric is set to expire.</p>
<p>After a metric expires, an application will no longer collect or send data related to it.
May be one of the following values:</p>
<ul>
<li><code>&lt;build date&gt;</code>: An ISO date <code>yyyy-mm-dd</code> in UTC on which the metric expires.
For example, <code>2019-03-13</code>. This date is checked at build time. Except in special cases,
this form should be used so that the metric automatically &quot;sunsets&quot; after a period of time.
Emails will be sent to the <code>notification_emails</code> addresses when the metric is about to expire.
Generally, when a metric is no longer needed, it should simply be removed.
This does not affect the availability of data already collected by the pipeline.</li>
<li><code>never</code>: This metric never expires.</li>
<li><code>expired</code>: This metric is manually expired.</li>
</ul>
<h3 id="optional-parameters"><a class="header" href="#optional-parameters">Optional parameters</a></h3>
<h4 id="tags-1"><a class="header" href="#tags-1"><code>tags</code></a></h4>
<p><em>default: <code>[]</code></em></p>
<p>A list of tag names associated with this metric.
Must correspond to an entry specified in a <a href="reference/yaml/./tags.html">tags file</a>.</p>
<h4 id="lifetime"><a class="header" href="#lifetime"><code>lifetime</code></a></h4>
<p><em>default: <code>ping</code></em></p>
<p>Defines the lifetime of the metric. Different lifetimes affect when the metrics value is reset.</p>
<h5 id="ping-default-2"><a class="header" href="#ping-default-2"><code>ping</code> <em>(default)</em></a></h5>
<p>The metric is cleared each time it is submitted in the ping. This is the most common case,
and should be used for metrics that are highly dynamic, such as things computed
in response to the user's interaction with the application.</p>
<h5 id="application-2"><a class="header" href="#application-2"><code>application</code></a></h5>
<p>The metric is related to an application run, and is cleared after the application restarts
and any Glean-owned ping, due at startup, is submitted. This should be used for things
that are constant during the run of an application, such as the operating system version.
In practice, these metrics are generally set during application startup.  A common mistake---
using the ping lifetime for these type of metrics---means that they will only be included
in the first ping sent during a particular run of the application.</p>
<h5 id="user-2"><a class="header" href="#user-2"><code>user</code></a></h5>
<p><strong>Reach out to the Glean team before using this.</strong></p>
<p>The metric is part of the user's profile and will live as long as the profile lives.
This is often not the best choice unless the metric records a value that <em>really</em> needs
to be persisted for the full lifetime of the user profile, e.g. an identifier like the <code>client_id</code>,
the day the product was first executed. It is rare to use this lifetime outside of some metrics
that are built in to the Glean SDK.</p>
<h4 id="send_in_pings"><a class="header" href="#send_in_pings"><code>send_in_pings</code></a></h4>
<p><em>default: <code>events</code>|<code>metrics</code></em></p>
<p>Defines which pings the metric should be sent on.
If not specified, the metric is sent on the default ping,
which is the <code>events</code> ping for events and the <code>metrics</code> ping for everything else.</p>
<p>Most metrics don't need to specify this unless they are sent on <a href="reference/yaml/../../user/pings/custom.html">custom pings</a>.</p>
<p>The special value <code>default</code> may be used, in case it's required for a metric to be sent
on the default ping as well as in a custom ping.</p>
<pre><code class="language-yaml">send_in_pings:
  - my-custom-ping
  - default
</code></pre>
<h4 id="disabled"><a class="header" href="#disabled"><code>disabled</code></a></h4>
<p><em>default: <code>false</code></em></p>
<p>Data collection for this metric is disabled.</p>
<p>This is useful when you want to temporarily disable the collection for a specific metric
without removing references to it in your source code.</p>
<p>Generally, when a metric is no longer needed, it should simply be removed.
This does not affect the availability of data already collected by the pipeline.</p>
<h4 id="version"><a class="header" href="#version"><code>version</code></a></h4>
<p><em>default: <code>0</code></em></p>
<p>The version of the metric. A monotonically increasing integer value.
This should be bumped if the metric changes in a backward-incompatible way.</p>
<h4 id="data_sensitivity"><a class="header" href="#data_sensitivity"><code>data_sensitivity</code></a></h4>
<p><em>default: <code>[]</code></em></p>
<p>A list of data sensitivity categories that the metric falls under.
There are four data collection categories related to data sensitivity
<a href="https://wiki.mozilla.org/Firefox/Data_Collection">defined in Mozilla's data collection review process</a>:</p>
<h5 id="category-1-technical-data-technical"><a class="header" href="#category-1-technical-data-technical">Category 1: Technical Data (<code>technical</code>)</a></h5>
<p>Information about the machine or Firefox itself. Examples include OS, available memory,
crashes and errors, outcome of automated processes like updates, safe browsing, activation,
versions, and build id. This also includes compatibility information about features and APIs
used by websites, add-ons, and other 3rd-party software that interact with Firefox during usage.</p>
<h5 id="category-2-interaction-data-interaction"><a class="header" href="#category-2-interaction-data-interaction">Category 2: Interaction Data (<code>interaction</code>)</a></h5>
<p>Information about the user’s direct engagement with Firefox. Examples include how many tabs,
add-ons, or windows a user has open; uses of specific Firefox features; session length,
scrolls and clicks; and the status of discrete user preferences.</p>
<h5 id="category-3-web-activity-data-web_activity"><a class="header" href="#category-3-web-activity-data-web_activity">Category 3: Web activity data (<code>web_activity</code>)</a></h5>
<p>Information about user web browsing that could be considered sensitive.
Examples include users’ specific web browsing history; general information
about their web browsing history (such as TLDs or categories of webpages visited over time);
and potentially certain types of interaction data about specific webpages visited.</p>
<h5 id="category-4-highly-sensitive-data-highly_sensitive"><a class="header" href="#category-4-highly-sensitive-data-highly_sensitive">Category 4: Highly sensitive data (<code>highly_sensitive</code>)</a></h5>
<p>Information that directly identifies a person, or if combined with other data could identify a person.
Examples include e-mail, usernames, identifiers such as google ad id, apple id, Firefox account,
city or country (unless small ones are explicitly filtered out), or certain cookies.
It may be embedded within specific website content, such as memory contents, dumps,
captures of screen data, or DOM data.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/yaml/metrics.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="pings-yaml-registry-format"><a class="header" href="#pings-yaml-registry-format">Pings YAML Registry Format</a></h1>
<p>Custom pings sent by an application or library are defined in YAML files which follow
the <a href="https://mozilla.github.io/glean_parser/pings-yaml.html"><code>pings.yaml</code> JSON schema</a>.</p>
<p>This files must be parsed by <a href="https://pypi.org/project/glean-parser/"><code>glean_parser</code></a> at build time
in order to generate code in the target language (e.g. Kotlin, Swift, ...). The generated code is
what becomes the public API to access the project's custom pings.</p>
<p>For more information on how to introduce the <code>glean_parser</code> build step for a specific language /
environment, refer to the <a href="reference/yaml/../../user/adding-glean-to-your-project/index.html">&quot;Adding Glean to your project&quot;</a>
section of this book.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="note-on-the-naming-of-these-files-1"><a class="header" href="#note-on-the-naming-of-these-files-1">Note on the naming of these files</a></h2>
<blockquote>
<p>Although we refer to pings definitions YAML files as <code>pings.yaml</code> throughout Glean documentation
this files may be named whatever makes the most sense for each project and may even be broken down
into multiple files, if necessary.</p>
</blockquote>
<h2 id="file-structure-1"><a class="header" href="#file-structure-1">File structure</a></h2>
<pre><code class="language-yaml">---
# Schema
$schema: moz://mozilla.org/schemas/glean/pings/2-0-0

# Name
search:
  # Ping parameters
  description: &gt;
    A ping to record search data.
  include_client_id: false
  notification_emails:
    - CHANGE-ME@example.com
  bugs:
    - http://bugzilla.mozilla.org/123456789/
  data_reviews:
    - http://example.com/path/to/data-review
</code></pre>
<h2 id="schema-1"><a class="header" href="#schema-1">Schema</a></h2>
<p>Declaring the schema at the top of a pings definitions file is required,
as it is what indicates that the current file is a pings definitions file.</p>
<h2 id="name-1"><a class="header" href="#name-1">Name</a></h2>
<p>Ping names are the top-level keys on pings definitions files.
One single definition file may contain multiple ping declarations.</p>
<p>Ping names are limited to lowercase letters from the <a href="https://en.wikipedia.org/wiki/ISO_basic_Latin_alphabet">ISO basic Latin alphabet</a>
and hyphens and a maximum of 30 characters.</p>
<p>Pings may not contain the words <code>custom</code> or <code>ping</code> in their names. These are considered redundant
words and will trigger a <code>REDUNDANT_PING</code> lint failure on <code>glean_parser</code>.</p>
<p><a href="reference/yaml/../../user/metrics/adding-new-metrics.html#capitalization">&quot;Capitalization&quot;</a> rules apply to
ping names on generated code.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h3 id="reserved-ping-names"><a class="header" href="#reserved-ping-names">Reserved ping names</a></h3>
<blockquote>
<p>The names <code>baseline</code>, <code>metrics</code>, <code>events</code>, <code>deletion-request</code>, <code>default</code> and <code>all-pings</code> are reserved
and may not be used as the name of a custom ping.</p>
</blockquote>
<h2 id="ping-parameters"><a class="header" href="#ping-parameters">Ping parameters</a></h2>
<h3 id="required-parameters-1"><a class="header" href="#required-parameters-1">Required parameters</a></h3>
<h4 id="description-5"><a class="header" href="#description-5"><code>description</code></a></h4>
<p>A textual description of the purpose of the ping.
It may contain <a href="https://www.markdownguide.org/basic-syntax/">markdown syntax</a>.</p>
<h4 id="metadata"><a class="header" href="#metadata"><code>metadata</code></a></h4>
<p><em>default: <code>{}</code></em></p>
<p>A dictionary of extra metadata associated with this ping.
Currently the only allowed key is <code>tags</code> (see below).</p>
<h5 id="tags-2"><a class="header" href="#tags-2"><code>tags</code></a></h5>
<p><em>default: <code>[]</code></em></p>
<p>A list of tag names associated with this ping.
Must correspond to an entry specified in a <a href="reference/yaml/./tags.html">tags file</a>.</p>
<h4 id="include_client_id"><a class="header" href="#include_client_id"><code>include_client_id</code></a></h4>
<p>A boolean indicating whether to include the client_id in
<a href="reference/yaml/../../user/pings/index.html#the-client_info-section">the client_info section</a> of the ping.</p>
<h4 id="notification_emails-1"><a class="header" href="#notification_emails-1"><code>notification_emails</code></a></h4>
<p>A list of email addresses to notify for important events with the ping
or when people with context or ownership for the ping need to be contacted.</p>
<p>Consider adding both a group email address and an individual who is responsible for this ping.</p>
<h4 id="bugs-1"><a class="header" href="#bugs-1"><code>bugs</code></a></h4>
<p>A list of bugs (e.g. Bugzilla or GitHub) that are relevant to this ping.
For example, bugs that track its original implementation or later changes to it.</p>
<p>Each entry should be the full URL to the bug in an issue tracker.
The use of numbers alone is deprecated and will be an error in the future.</p>
<h4 id="data_reviews-1"><a class="header" href="#data_reviews-1"><code>data_reviews</code></a></h4>
<p>A list of URIs to any data collection review <em>responses</em> relevant to the metric.</p>
<h3 id="optional-parameters-1"><a class="header" href="#optional-parameters-1">Optional parameters</a></h3>
<h4 id="send_if_empty"><a class="header" href="#send_if_empty"><code>send_if_empty</code></a></h4>
<p><em>default: <code>false</code></em></p>
<p>A boolean indicating if the ping is sent if it contains no metric data.</p>
<h4 id="reasons"><a class="header" href="#reasons"><code>reasons</code></a></h4>
<p><em>default: <code>{}</code></em></p>
<p>The reasons that this ping may be sent. The keys are the reason codes,
and the values are a textual description of each reason.
The ping payload will (optionally) contain one of these reasons in the <code>ping_info.reason</code> field.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/yaml/pings.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="tags-yaml-registry-format"><a class="header" href="#tags-yaml-registry-format">Tags YAML Registry Format</a></h1>
<p>Any number of custom &quot;tags&quot; can be added to any metric or ping.
This can be useful in data discovery tools like the <a href="https://dictionary.telemetry.mozilla.org">Glean Dictionary</a>.
The tags for an application are defined in YAML files which follow
the <a href="https://mozilla.github.io/glean_parser/tags-yaml.html"><code>tags.yaml</code> JSON schema</a>.</p>
<p>These files must be parsed by <a href="https://pypi.org/project/glean-parser/"><code>glean_parser</code></a> at build time in order to generate the metadata.</p>
<p>For more information on how to introduce the <code>glean_parser</code> build step for a specific language /
environment, refer to the <a href="reference/yaml/../../user/adding-glean-to-your-project/index.html">&quot;Adding Glean to your project&quot;</a>
section of this book.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="note-on-the-naming-of-these-files-2"><a class="header" href="#note-on-the-naming-of-these-files-2">Note on the naming of these files</a></h2>
<blockquote>
<p>Although we refer to tag definitions YAML files as <code>tags.yaml</code> throughout Glean documentation
this files may be named whatever makes the most sense for each project and may even be broken down
into multiple files, if necessary.</p>
</blockquote>
<h2 id="file-structure-2"><a class="header" href="#file-structure-2">File structure</a></h2>
<pre><code class="language-yaml">---
# Schema
$schema: moz://mozilla.org/schemas/glean/tags/1-0-0

Search:
  description: Metrics or pings in the &quot;search&quot; domain
</code></pre>
<h2 id="schema-2"><a class="header" href="#schema-2">Schema</a></h2>
<p>Declaring the schema at the top of a tags definitions file is required, as it is what indicates that the current file is a tag definitions file.</p>
<h2 id="name-2"><a class="header" href="#name-2">Name</a></h2>
<p>Tag names are the top-level keys on tag definitions files.
One single definition file may contain multiple tag declarations.</p>
<p>There is no restriction on the name of a tag, aside from the fact that they have a maximum of 80 characters.</p>
<h2 id="tag-parameters"><a class="header" href="#tag-parameters">Tag parameters</a></h2>
<h3 id="required-parameters-2"><a class="header" href="#required-parameters-2">Required parameters</a></h3>
<h4 id="description-6"><a class="header" href="#description-6"><code>description</code></a></h4>
<p>A textual description of the tag.
It may contain <a href="https://www.markdownguide.org/basic-syntax/">markdown syntax</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/yaml/tags.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="the-general-api"><a class="header" href="#the-general-api">The General API</a></h1>
<p>The Glean SDKs have a minimal API available on their top-level <code>Glean</code> object called the General API.
This API allows, among other things, to enable and disable upload, register <a href="reference/general/../../user/pings/custom.html">custom pings</a> and set <a href="reference/general/./experiments-api.html">experiment data</a>.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="only-initialize-in-the-main-application"><a class="header" href="#only-initialize-in-the-main-application">Only initialize in the main application!</a></h5>
<blockquote>
<p>Glean should only be initialized from the main application, not individual libraries.
If you are adding Glean support to a library, you can safely skip this section.</p>
</blockquote>
<h2 id="the-api"><a class="header" href="#the-api">The API</a></h2>
<p>The Glean SDKs provide a general API that supports the following operations. See API reference pages for SDK-specific details.</p>
<table><thead><tr><th>Operation</th><th>Description</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>initialize</code></td><td>Configure and initialize the Glean SDK.</td><td><a href="reference/general/./initializing.html">Initializing the Glean SDK</a></td></tr>
<tr><td><code>setUploadEnabled</code></td><td>Enable or disable Glean collection and upload.</td><td><a href="reference/general/./toggling-upload-status.html">Toggling upload status</a></td></tr>
<tr><td><code>registerPings</code></td><td>Register custom pings generated from <code>pings.yaml</code>.</td><td><a href="reference/general/../../user/pings/custom.html">Custom pings</a></td></tr>
<tr><td><code>setExperimentActive</code></td><td>Indicate that an experiment is running.</td><td><a href="reference/general/./experiments-api.html">Using the Experiments API</a></td></tr>
<tr><td><code>setExperimentInactive</code></td><td>Indicate that an experiment is no longer running..</td><td><a href="reference/general/./experiments-api.html">Using the Experiments API</a></td></tr>
</tbody></table>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="initializing"><a class="header" href="#initializing">Initializing</a></h1>
<p>The following steps are required for applications using the Glean SDK, but not libraries.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="note"><a class="header" href="#note">Note</a></h5>
<blockquote>
<p>The <code>initialize</code> function <em>must</em> be called, even if telemetry upload is disabled.
Glean needs to perform maintenance tasks even when telemetry is disabled, and because Glean
does this as part of its initialization, it is <em>required</em> to always call the <code>initialize</code>
function. Otherwise, Glean won't be able to clean up collected data, disable queuing of pre-init
tasks, or perform other required operations.</p>
<p>This does not apply to special builds where telemetry is disabled at build time. In that case, it is acceptable to not call <code>initialize</code> at all.</p>
</blockquote>
<div class="special-quote special-quote-stop fa fa-ban"></div>
<h5 id="initialize-glean-with-the-correct-value-for-uploadenabled"><a class="header" href="#initialize-glean-with-the-correct-value-for-uploadenabled">Initialize Glean with the correct value for <code>uploadEnabled</code>!</a></h5>
<blockquote>
<p><code>Glean.initialize</code> must <strong>always</strong> be called with real values.
Always pass the user preference, e.g. <code>Glean.initialize(upload=userSettings.telemetry_enabled)</code> or the equivalent for your application.
Never call <code>Glean.initialize(upload=true)</code> if <code>true</code> is a placeholder value that later gets reset by <code>Glean.setUploadEnabled(false)</code>.
Depending on the provided placeholder value, this might trigger the generation of new client ids or the submission of bogus <a href="reference/general/../../user/pings/deletion_request.html"><code>deletion-request</code> pings</a>.</p>
</blockquote>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="multiple-processes-support"><a class="header" href="#multiple-processes-support">Multiple processes support</a></h5>
<blockquote>
<p>The Glean Kotlin SDK does not support use across multiple processes, and must only be initialized on the application's main process. Initializing in other processes is a no-op.
Additionally, Glean must be initialized on the main (UI) thread of the applications main process. Failure to do so will throw an <code>IllegalThreadStateException</code>.</p>
</blockquote>
<p>An excellent place to initialize Glean is within the <code>onCreate</code> method of the class that extends Android's <code>Application</code> class.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.GleanBuildInfo
import org.mozilla.yourApplication.GleanMetrics.Pings

class SampleApplication : Application() {

    override fun onCreate() {
        super.onCreate()

        // If you have custom pings in your application, you must register them
        // using the following command. This command should be omitted for
        // applications not using custom pings.
        Glean.registerPings(Pings)

        // Initialize the Glean library.
        Glean.initialize(
            applicationContext,
            // Here, `settings()` is a method to get user preferences, specific to
            // your application and not part of the Glean API.
            uploadEnabled = settings().isTelemetryEnabled,
            buildInfo = GleanBuildInfo.buildInfo
        )
    }
}
</code></pre>
<p>The Glean Kotlin SDK should be initialized as soon as possible, and importantly, before any other libraries in the application start using Glean.
Library code should never call <code>Glean.initialize</code>, since it should be called exactly once per application.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="uploads-when-using-android-components"><a class="header" href="#uploads-when-using-android-components">Uploads when using Android Components</a></h5>
<blockquote>
<p>When the Glean Kotlin SDK is consumed through Android Components, it is required to configure an HTTP client to be used for upload.
For example:</p>
<pre><code class="language-Kotlin">// Requires `org.mozilla.components:concept-fetch`
import mozilla.components.concept.fetch.Client
// Requires `org.mozilla.components:lib-fetch-httpurlconnection`.
// This can be replaced by other implementations, e.g. `lib-fetch-okhttp`
// or an implementation from `browser-engine-gecko`.
import mozilla.components.lib.fetch.httpurlconnection.HttpURLConnectionClient

import mozilla.components.service.glean.config.Configuration
import mozilla.components.service.glean.net.ConceptFetchHttpUploader

val httpClient = ConceptFetchHttpUploader(lazy { HttpURLConnectionClient() as Client })
val config = Configuration(httpClient = httpClient)
Glean.initialize(
   context,
   uploadEnabled = true,
   configuration = config,
   buildInfo = GleanBuildInfo.buildInfo
)
</code></pre>
</blockquote>
</div>
<div data-lang="Swift" class="tab">
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="multiple-processes-support-1"><a class="header" href="#multiple-processes-support-1">Multiple processes support</a></h5>
<blockquote>
<p>The Glean Swift SDK does not support use across multiple processes, and must only be initialized on the application's main process.</p>
</blockquote>
<p>An excellent place to initialize Glean is within the <code>application(_:)</code> method of the class that extends the <code>UIApplicationDelegate</code> class.</p>
<pre><code class="language-Swift">import Glean
import UIKit

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_: UIApplication, didFinishLaunchingWithOptions _: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
        // If you have custom pings in your application, you must register them
        // using the following command. This command should be omitted for
        // applications not using custom pings.
        Glean.shared.registerPings(GleanMetrics.Pings)

        // Initialize the Glean library.
        Glean.shared.initialize(
            // Here, `Settings` is a method to get user preferences specific to
            // your application, and not part of the Glean API.
            uploadEnabled = Settings.isTelemetryEnabled
        )
    }
}
</code></pre>
<p>The Glean Swift SDK should be initialized as soon as possible, and importantly, before any other libraries in the application start using Glean.
Library code should never call <code>Glean.shared.initialize</code>, since it should be called exactly once per application.</p>
</div>
<div data-lang="Python" class="tab">
<p>The main control for the Glean Python SDK is on the <code>glean.Glean</code> singleton.</p>
<p>The Glean Python SDK should be initialized as soon as possible, and importantly, before any other libraries in the application start using Glean.
Library code should never call <code>Glean.initialize</code>, since it should be called exactly once per application.</p>
<pre><code class="language-python">from glean import Glean

Glean.initialize(
    application_id=&quot;my-app-id&quot;,
    application_version=&quot;0.1.0&quot;,
    upload_enabled=True,
)
</code></pre>
<p>Additional configuration is available on the <code>glean.Configuration</code> object, which can be passed into <code>Glean.initialize()</code>.</p>
<p>Unlike Android and Swift, the Python SDK does not automatically send any pings.
See the <a href="reference/general/../../user/pings/custom.html">custom pings documentation</a> about adding custom pings and sending them.</p>
</div>
<div data-lang="Rust" class="tab">
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="multiple-processes-support-2"><a class="header" href="#multiple-processes-support-2">Multiple processes support</a></h5>
<blockquote>
<p>The Glean Rust SDK does not support use across multiple processes, and must only be initialized on the application's main process.</p>
</blockquote>
<p>The Glean Rust SDK should be initialized as soon as possible,
and importantly, before any other libraries in the application start using Glean.
Library code should never call Glean.initialize,
since it should be called exactly once per application.</p>
<pre><code class="language-Rust">use glean::{ClientInfoMetrics, Configuration};
let cfg = Configuration {
    data_path,
    application_id: &quot;my-app-id&quot;.into(),
    upload_enabled: true,
    max_events: None,
    delay_ping_lifetime_io: false,
    channel: None,
    server_endpoint: Some(&quot;https://incoming.telemetry.mozilla.org&quot;.into()),
    uploader: None,
    use_core_mps: true,
};

let client_info = ClientInfoMetrics {
    app_build: env!(&quot;CARGO_PKG_VERSION&quot;).to_string(),
    app_display_version: env!(&quot;CARGO_PKG_VERSION&quot;).to_string(),
};

glean::initialize(cfg, client_info);
</code></pre>
<p>Unlike in other implementations, the Rust SDK does not provide a default uploader.
See <a href="reference/general/../../../docs/glean/net/trait.PingUploader.html"><code>PingUploader</code></a> for details.</p>
</div>
<div data-lang="JavaScript" class="tab">
<p>The main control for Glean is on the <code>Glean</code> singleton.</p>
<p>The Glean JavaScript SDK should be initialized as soon as possible when the product using it is started.</p>
<pre><code class="language-js">// Glean.js for webextensions: the following code
// runs in the background script.
import Glean from &quot;@mozilla/glean/webext&quot;;

Glean.initialize(
    &quot;my-app-id&quot;,
    true, // uploadEnabled
    {
      appDisplayVersion: &quot;0.1.0&quot;
    }
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="On Firefox Desktop Glean initialization is handled internally."></div>
</div>
</div>
<h2 id="what-happens-after-glean-is-initialized"><a class="header" href="#what-happens-after-glean-is-initialized">What happens after Glean is initialized?</a></h2>
<p>Once initialized, if upload is enabled, Glean will automatically start collecting <a href="reference/general/../../user/pings/metrics.html">baseline metrics</a>.
If upload is disabled, any persisted metrics, events and pings (other than <code>first_run_date</code> and <code>first_run_hour</code>) are cleared, and subsequent calls to record metrics will be no-ops.</p>
<h2 id="release-channels"><a class="header" href="#release-channels">Release channels</a></h2>
<p>If the application has the concept of release channels and knows which channel it is on at run-time,
then it can provide the Glean SDKs with this information by setting it as part of the <code>Configuration</code> object parameter of the <code>initialize</code> method.</p>
<h2 id="behavior-when-uninitialized"><a class="header" href="#behavior-when-uninitialized">Behavior when uninitialized</a></h2>
<p>Metric recording that happens before Glean is initialized is queued and applied at initialization.
To avoid unbounded memory growth the queue is bounded (currently to a maximum of 100 tasks), and further recordings are dropped.
The number of recordings dropped, if any, is recorded in the <code>glean.error.preinit_tasks_overflow</code> metric.</p>
<p>Custom ping submission will not fail before initialization.
Collection and upload of the custom ping is delayed until Glean is initialized.
Built-in pings are only available after initialization.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/initializing.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="toggling-upload-status"><a class="header" href="#toggling-upload-status">Toggling upload status</a></h1>
<p>The Glean SDKs provide an API for toggling Glean's upload status after initialization.</p>
<p>Applications instrumented with Glean
<a href="reference/general/../../user/adding-glean-to-your-project/index.html#glean-integration-checklist">are expected to</a>
provide some form of user interface to allow for toggling the upload status.</p>
<h2 id="disabling-upload"><a class="header" href="#disabling-upload">Disabling upload</a></h2>
<p>When upload is disabled, the Glean SDK will perform the following tasks:</p>
<ol>
<li>Submit a <a href="reference/general/../../user/pings/deletion_request.html"><code>deletion-request</code></a> ping.</li>
<li>Cancel scheduled ping uploads.</li>
<li>Clear metrics and pings data from the client, except for the
<a href="reference/general/../../user/pings/index.html#the-client_info-section"><code>first_run_date</code> and <code>first_run_hour</code></a> metrics.</li>
</ol>
<p>While upload is disabled, metrics aren't recorded and no data is uploaded.</p>
<h2 id="enabling-upload"><a class="header" href="#enabling-upload">Enabling upload</a></h2>
<p>When upload is enabled, the Glean SDK will re-initialize its <a href="reference/general/../../user/collected-metrics/metrics.html">core metrics</a>.
The only core metrics that are not re-initialized are the <a href="reference/general/../../user/pings/index.html#the-client_info-section"><code>first_run_date</code> and <code>first_run_hour</code></a> metrics.</p>
<p>While upload is enabled all metrics are recorded as expected
and pings are sent to the telemetry servers.</p>
<h2 id="api"><a class="header" href="#api">API</a></h2>
<h3 id="gleansetuploadenabledboolean"><a class="header" href="#gleansetuploadenabledboolean"><code>Glean.setUploadEnabled(boolean)</code></a></h3>
<p>Enables or disables upload.</p>
<p>If called prior to initialize this function is a no-op.</p>
<p>If the upload state is not actually changed in between calls to this function, it is also a no-op.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import mozilla.telemetry.glean.Glean

open class MainActivity : AppCompatActivity() {
    override fun onCreate() {
        // ...

        uploadSwitch.setOnCheckedChangeListener { _, isChecked -&gt;
            if (isChecked) {
                Glean.setUploadEnabled(true)
            } else {
                Glean.setUploadEnabled(false)
            }
        }
    }
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import mozilla.telemetry.glean.Glean

Glean.INSTANCE.setUploadEnabled(false);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean
import UIKit

class ViewController: UIViewController {
    @IBOutlet var enableSwitch: UISwitch!

    // ...

    @IBAction func enableToggled(_: Any) {
        Glean.shared.setUploadEnabled(enableSwitch.isOn)
    }
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-python">from glean import Glean

Glean.set_upload_enabled(false)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean;

glean::set_upload_enabled(false);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import Glean from &quot;@mozilla/glean/web&quot;;

const uploadSwitch = document.querySelector(&quot;input[type=checkbox].upload-switch&quot;);
uploadSwitch.addEventListener(&quot;change&quot;, event =&gt; {
    if (event.target.checked) {
        Glean.setUploadEnabled(true);
    } else {
        Glean.setUploadEnabled(false);
    }
});
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="On Firefox Desktop data collection is toggled internally."></div>
</div>
</div>
<h2 id="reference"><a class="header" href="#reference">Reference</a></h2>
<ul>
<li><a href="reference/general/../../../swift/Classes/Glean.html#/s:5GleanAAC16setUploadEnabledyySbF">Swift API docs</a></li>
<li><a href="reference/general/../../../python/glean/index.html#glean.Glean.set_upload_enabled">Python API docs</a></li>
<li><a href="reference/general/../../../docs/glean/fn.set_upload_enabled.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_glean.default.html#setUploadEnabled">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/toggling-upload-status.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="using-the-experiments-api"><a class="header" href="#using-the-experiments-api">Using the experiments API</a></h1>
<p>The Glean SDKs support tagging all their pings with experiments annotations. The annotations are useful to report that experiments were active at the time the measurement were collected. The annotations are reported in the optional <code>experiments</code> entry in the <a href="reference/general/../../user/pings/index.html"><code>ping_info</code> section</a> of all pings.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="experiment-annotations-are-not-persisted"><a class="header" href="#experiment-annotations-are-not-persisted">Experiment annotations are not persisted</a></h5>
<blockquote>
<p>The experiment annotations set through this API are not persisted by the Glean SDKs.
The application or consuming library is responsible for setting the relevant experiment annotations at each run.</p>
</blockquote>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="its-not-required-to-define-experiment-ids-and-branches"><a class="header" href="#its-not-required-to-define-experiment-ids-and-branches">It's not required to define experiment IDs and branches</a></h5>
<blockquote>
<p>Experiment IDs and branches don't need to be pre-defined in the Glean SDK registry files.
Please also note that the <code>extra</code> map is a non-nested arbitrary <code>String</code> to <code>String</code> map. It also has limits on the size of the keys and values defined below.</p>
</blockquote>
<h2 id="recording-api"><a class="header" href="#recording-api">Recording API</a></h2>
<h3 id="setexperimentactive"><a class="header" href="#setexperimentactive"><code>setExperimentActive</code></a></h3>
<p>Annotates Glean pings with experiment data.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">// Annotate Glean pings with experiments data.
Glean.setExperimentActive(
  experimentId = &quot;blue-button-effective&quot;,
  branch = &quot;branch-with-blue-button&quot;,
  extra: mapOf(
    &quot;buttonLabel&quot; to &quot;test&quot;
  )
)
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">// Annotate Glean pings with experiments data.
Glean.shared.setExperimentActive(
  experimentId: &quot;blue-button-effective&quot;,
  branch: &quot;branch-with-blue-button&quot;,
  extra: [&quot;buttonLabel&quot;: &quot;test&quot;]
)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import Glean

Glean.set_experiment_active(
  experiment_id=&quot;blue-button-effective&quot;,
  branch=&quot;branch-with-blue-button&quot;,
  extra={
    &quot;buttonLabel&quot;: &quot;test&quot;
  }
)
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1741583"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">let mut extra = HashMap::new();
extra.insert(&quot;buttonLabel&quot;.to_string(), &quot;test&quot;.to_string());
glean::set_experiment_active(
    &quot;blue-button-effective&quot;.to_string(),
    &quot;branch-with-blue-button&quot;.to_string(),
    Some(extra),
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="at-present-there-is-no-dedicated-c-experiments-api-for-firefox-desktop"><a class="header" href="#at-present-there-is-no-dedicated-c-experiments-api-for-firefox-desktop">At present there is no dedicated C++ Experiments API for Firefox Desktop</a></h5>
<blockquote>
<p>If you require one, please <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Toolkit&amp;component=Telemetry">file a bug</a>.</p>
</blockquote>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">let FOG = Cc[&quot;@mozilla.org/toolkit/glean;1&quot;].createInstance(Ci.nsIFOG);
FOG.setExperimentActive(
  &quot;blue-button-effective&quot;,
  &quot;branch-with-blue-button&quot;,
  {&quot;buttonLabel&quot;: &quot;test&quot;}
);
</code></pre>
</div>
</div>
</div>
<h4 id="limits"><a class="header" href="#limits">Limits</a></h4>
<ul>
<li><code>experimentId</code>, <code>branch</code>, and the keys and values of the <code>extra</code>
field are fixed at a maximum length of 100 bytes.
Longer strings are truncated.
(Specifically, length is measured in the number of bytes when the string is encoded in UTF-8.)</li>
<li><code>extra</code> map is limited to 20 entries.
If passed a map which contains more elements than this, it is truncated to 20 elements.
<strong>WARNING</strong> Which items are truncated is nondeterministic due to the unordered nature of maps.
What's left may not necessarily be the first elements added.</li>
</ul>
<h4 id="recorded-errors"><a class="header" href="#recorded-errors">Recorded errors</a></h4>
<ul>
<li><a href="reference/general/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>:
If the values of <code>experimentId</code> or <code>branch</code> are truncated for length,
if the keys or values in the <code>extra</code> map are truncated for length,
or if the <code>extra</code> map is truncated for the number of elements.</li>
</ul>
<h3 id="setexperimentinactive"><a class="header" href="#setexperimentinactive"><code>setExperimentInactive</code></a></h3>
<p>Removes the experiment annotation.
Should be called when the experiment ends.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">Glean.setExperimentInactive(&quot;blue-button-effective&quot;)
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Glean.shared.setExperimentInactive(experimentId: &quot;blue-button-effective&quot;)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import Glean

Glean.set_experiment_inactive(&quot;blue-button-effective&quot;)
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1741583"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">glean::set_experiment_inactive(&quot;blue-button-effective&quot;.to_string());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="at-present-there-is-no-dedicated-c-experiments-api-for-firefox-desktop-1"><a class="header" href="#at-present-there-is-no-dedicated-c-experiments-api-for-firefox-desktop-1">At present there is no dedicated C++ Experiments API for Firefox Desktop</a></h5>
<blockquote>
<p>If you require one, please <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Toolkit&amp;component=Telemetry">file a bug</a>.</p>
</blockquote>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">let FOG = Cc[&quot;@mozilla.org/toolkit/glean;1&quot;].createInstance(Ci.nsIFOG);
FOG.setExperimentInactive(&quot;blue-button-effective&quot;);
</code></pre>
</div>
</div>
</div>
<h2 id="testing-api"><a class="header" href="#testing-api">Testing API</a></h2>
<h3 id="testisexperimentactive"><a class="header" href="#testisexperimentactive"><code>testIsExperimentActive</code></a></h3>
<p>Reveals if the experiment is annotated in Glean pings.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">assertTrue(Glean.testIsExperimentActive(&quot;blue-button-effective&quot;))
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">XCTAssertTrue(Glean.shared.testIsExperimentActive(experimentId: &quot;blue-button-effective&quot;))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import Glean

assert Glean.test_is_experiment_active(&quot;blue-button-effective&quot;)
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1741583"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">assert!(glean::test_is_experiment_active(&quot;blue-button-effective&quot;.to_string());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetexperimentdata"><a class="header" href="#testgetexperimentdata"><code>testGetExperimentData</code></a></h3>
<p>Returns the recorded experiment data including branch and extras.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">assertEquals(
  &quot;branch-with-blue-button&quot;, Glean.testGetExperimentData(&quot;blue-button-effective&quot;)?.branch
)
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">XCTAssertEqual(
  &quot;branch-with-blue-button&quot;,
  Glean.testGetExperimentData(experimentId: &quot;blue-button-effective&quot;)?.branch
)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import Glean

assert (
    &quot;branch-with-blue-button&quot; ==
    Glean.test_get_experiment_data(&quot;blue-button-effective&quot;).branch
)
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1741583"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">assert_eq!(
    &quot;branch-with-blue-button&quot;,
    glean::test_get_experiment_data(&quot;blue-button-effective&quot;.to_string()).branch,
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="at-present-there-is-no-dedicated-c-experiments-api-for-firefox-desktop-2"><a class="header" href="#at-present-there-is-no-dedicated-c-experiments-api-for-firefox-desktop-2">At present there is no dedicated C++ Experiments API for Firefox Desktop</a></h5>
<blockquote>
<p>If you require one, please <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Toolkit&amp;component=Telemetry">file a bug</a>.</p>
</blockquote>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">let FOG = Cc[&quot;@mozilla.org/toolkit/glean;1&quot;].createInstance(Ci.nsIFOG);
Assert.equals(
  &quot;branch-with-blue-button&quot;,
  FOG.testGetExperimentData(&quot;blue-button-effective&quot;).branch
);
</code></pre>
</div>
</div>
</div>
<h2 id="reference-1"><a class="header" href="#reference-1">Reference</a></h2>
<ul>
<li><a href="reference/general/../../../swift/Classes/QuantityMetricType.html">Swift API docs</a></li>
<li><a href="reference/general/../../../python/glean/metrics/quantity.html">Python API docs</a></li>
<li><a href="reference/general/../../../docs/glean/private/quantity/struct.QuantityMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/experiments-api.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="registering-custom-pings"><a class="header" href="#registering-custom-pings">Registering custom pings</a></h1>
<p>After defining <a href="reference/general/../../user/pings/custom.html">custom pings</a> <code>glean_parser</code> is able to generate code from
<code>pings.yaml</code> files in a <code>Pings</code> object, which must be instantiated so Glean can send pings by name.</p>
<h2 id="api-1"><a class="header" href="#api-1">API</a></h2>
<h3 id="registerpings"><a class="header" href="#registerpings"><code>registerPings</code></a></h3>
<p>Loads custom ping metadata into your application or library.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>In Kotlin, this object must be registered from your startup code before calling <code>Glean.initialize</code>
(such as in your application's <code>onCreate</code> method or a function called from that method).</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pings

override fun onCreate() {
    Glean.registerPings(Pings)

    Glean.initialize(applicationContext, uploadEnabled = true)
}
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<p>In Swift, this object must be registered from your startup code before calling <code>Glean.shared.initialize</code>
(such as in your application's <code>UIApplicationDelegate</code> <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622921-application"><code>application(_:didFinishLaunchingWithOptions:)</code></a> method or a function called from that method).</p>
<pre><code class="language-swift">import Glean

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_: UIApplication, didFinishLaunchingWithOptions _: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
        Glean.shared.registerPings(GleanMetrics.Pings)

        Glean.shared.initialize(uploadEnabled = true)
    }
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>For Python, the <code>pings.yaml</code> file must be available and loaded at runtime.</p>
<p>While the Python SDK does provide a <code>Glean.register_ping_type</code> function, if your project is a script (i.e. just Python files in a directory), you can load the <code>pings.yaml</code> before calling <code>Glean.initialize</code> using:</p>
<pre><code class="language-python">from glean import load_pings

pings = load_pings(&quot;pings.yaml&quot;)

Glean.initialize(
    application_id=&quot;my-app-id&quot;,
    application_version=&quot;0.1.0&quot;,
    upload_enabled=True,
)
</code></pre>
<p>If your project is a distributable Python package, you need to include the <code>pings.yaml</code> file using <a href="https://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files">one of the myriad ways to include data in a Python package</a> and then use <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#resource-extraction"><code>pkg_resources.resource_filename()</code></a> to get the filename at runtime.</p>
<pre><code class="language-Python">from glean import load_pings
from pkg_resources import resource_filename

pings = load_pings(resource_filename(__name__, &quot;pings.yaml&quot;))
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<p>In Rust custom pings need to be registered individually.
This should be done before calling <code>glean::initialize</code>.</p>
<pre><code class="language-Rust">use your_glean_metrics::pings;

glean::register_ping_type(&amp;pings::custom_ping);
glean::register_ping_type(&amp;pings::search);
glean::initialize(cfg, client_info);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-info="On JavaScript environments, it is not necessary to register pings."></div>
<div data-lang="Firefox Desktop" class="tab" data-info="On Firefox Desktop all custom pings are registered automatically."></div>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/register-custom-pings.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="shut-down"><a class="header" href="#shut-down">Shut down</a></h1>
<p>Provides a way for users to gracefully shut down Glean,
by blocking until it is finished performing pending tasks
such as recording metrics and uploading pings.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="how-the-glean-sdks-execute-tasks"><a class="header" href="#how-the-glean-sdks-execute-tasks">How the Glean SDKs execute tasks</a></h2>
<blockquote>
<p>Most calls to Glean APIs are dispatched<sup class="footnote-reference"><a href="#1">1</a></sup>. This strategy is adopted because most tasks
performed by the Glean SDKs involve file system read or write operations, HTTP requests and
other time consuming actions.</p>
<p>Each Glean SDK has an internal structure called &quot;Dispatcher&quot; which makes sure API calls
get executed in the order they were called, while not requiring the caller to block on the
completion of each of these tasks.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Here, this term indicates the tasks are run asynchronously in JavaScript or in a different
thread for all other SDKs.</p>
</div>
</blockquote>
<h2 id="api-2"><a class="header" href="#api-2">API</a></h2>
<h3 id="shutdown"><a class="header" href="#shutdown"><code>shutdown</code></a></h3>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab" data-info="No blocking tasks will be performed on application shutdown, pending pings will be sent on startup."></div>
<div data-lang="Java" class="tab" data-info="No blocking tasks will be performed on application shutdown, pending pings will be sent on startup."></div>
<div data-lang="Swift" class="tab" data-info="No blocking tasks will be performed on application shutdown, pending pings will be sent on startup."></div>
<div data-lang="Python" class="tab" data-info="On application shutdown Glean will wait for up to 30 seconds to finish upload tasks."></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">fn main() {
    let cfg = Configuration {
        // ...
    };
    let client_info = /* ... */;
    glean::initialize(cfg, client_info);

    // Ensure the dispatcher thread winds down
    glean::shutdown();
}
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import Glean from &quot;@mozilla/glean/webext&quot;;

async function onUninstall() {
  // Flips Glean upload status to `false`,
  // which triggers sending of a `deletion-request` ping.
  Glean.setUploadEnabled(false);

  // Block on shut down to guarantee all pending pings
  // (including the `deletion-request` sent above)
  // are sent before the extension is uninstalled.
  await Glean.shutdown();

  // Uninstall browser extension without asking for user approval before doing so.
  await browser.management.uninstallSelf({ showConfirmDialog: false });
}
</code></pre>
<p>The <code>shutdown</code> API is available for all JavaScript targets, even though the above example
is explicitly using the <code>webext</code> target.</p>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="On application shutdown Glean will automatically wait for the dispatcher thread to finish."></div>
</div>
</div>
<h2 id="reference-2"><a class="header" href="#reference-2">Reference</a></h2>
<ul>
<li><a href="reference/general/../../../docs/glean/fn.shutdown.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_glean.default.html#shutdown">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/shutdown.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-1"><a class="header" href="#debugging-1">Debugging</a></h1>
<p>Different platforms have different ways to enable each debug functionality. They may be
enabled</p>
<ul>
<li>through APIs exposed on the Glean singleton,</li>
<li>through environment variables set at run time,</li>
<li>or through platform specific debug tools.</li>
</ul>
<h2 id="platform-specific-information-1"><a class="header" href="#platform-specific-information-1">Platform Specific Information</a></h2>
<p>Check out the platform specific guides on how to use Glean's debug functionalities.</p>
<ol>
<li><a href="reference/debug/../../user/debugging/android.html">Debugging applications using the Glean Android SDK</a></li>
<li><a href="reference/debug/../../user/debugging/ios.html">Debugging applications using the Glean iOS SDK</a></li>
<li><a href="reference/debug/../../user/debugging/python.html">Debugging applications using the Glean Python SDK</a></li>
<li><a href="reference/debug/../../user/debugging/javascript.html">Debugging applications using the Glean JavaScript SDK</a></li>
</ol>
<h2 id="features-1"><a class="header" href="#features-1">Features</a></h2>
<p>The Glean SDKs provides four debugging features.</p>
<h3 id="a-hrefreferencedebuglogpingshtmllog-pingsa"><a class="header" href="#a-hrefreferencedebuglogpingshtmllog-pingsa"><a href="reference/debug/./logPings.html">Log Pings</a></a></h3>
<p>This is either true or false and will cause all subsequent pings that are submitted, to also be echoed to the device's log.</p>
<h3 id="a-hrefreferencedebugdebugviewtaghtmldebug-view-taga"><a class="header" href="#a-hrefreferencedebugdebugviewtaghtmldebug-view-taga"><a href="reference/debug/./debugViewTag.html">Debug View Tag</a></a></h3>
<p>This will tag all subsequent outgoing pings with the provided value, in order to identify them in the <a href="reference/debug/../../user/debugging/index.html#glean-debug-view">Glean Debug View</a>.</p>
<h3 id="a-hrefreferencedebuglogpingshtmlsource-tagsa"><a class="header" href="#a-hrefreferencedebuglogpingshtmlsource-tagsa"><a href="reference/debug/./logPings.html">Source Tags</a></a></h3>
<p>This will tag all subsequent outgoing pings with a maximum of 5 comma-separated tags.</p>
<h3 id="send-pings"><a class="header" href="#send-pings">Send Pings</a></h3>
<p><em>This feature is only available for the Kotlin and Swift SDKs.</em></p>
<p>This expects the name of a ping and forces its immediate submission.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/debug/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="log-pings-1"><a class="header" href="#log-pings-1">Log pings</a></h1>
<p>This flag causes all subsequent pings that are submitted to also be echoed to the product's log.</p>
<p>Once enabled, the only way to disable this feature is to restart or manually reset the application.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="on-how-to-access-logs"><a class="header" href="#on-how-to-access-logs">On how to access logs</a></h2>
<blockquote>
<p>The Glean SDKs log warnings and errors through platform-specific logging frameworks.
See the <a href="reference/debug/./index.html#platform-specific-information">platform-specific instructions</a> for information
on how to view the logs on the platform you are on.</p>
</blockquote>
<h2 id="limits-1"><a class="header" href="#limits-1">Limits</a></h2>
<ul>
<li>The accepted values are <code>true</code> or <code>false</code>. Any other value will be ignored.</li>
</ul>
<h2 id="api-3"><a class="header" href="#api-3">API</a></h2>
<h3 id="setlogpings"><a class="header" href="#setlogpings"><code>setLogPings</code></a></h3>
<p>Enables or disables ping logging.</p>
<p>This API can safely be called before <code>Glean.initialize</code>.
The tag will be applied upon initialization in this case.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

Glean.shared.setLogPings(true)
</code></pre>
</div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean;

glean.set_log_pings(true);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import Glean from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

Glean.setLogPings(true);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="environment-variable"><a class="header" href="#environment-variable">Environment variable</a></h2>
<h3 id="glean_log_pings"><a class="header" href="#glean_log_pings"><code>GLEAN_LOG_PINGS</code></a></h3>
<p>It is also possible to enable ping logging through
the <code>GLEAN_LOG_PINGS</code> environment variable.</p>
<p>This variable must be set at runtime, not at compile time.
It will be checked upon Glean initialization.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"
  data-info="Although it is technically possible to use this environment variable in Android, the Glean team is not aware of a proper way to set environment variables in Android devices or emulators. When in this environment, enable debugging features through the <a href='../../user/debugging/android.html'>GleanDebugActivity</a>"></div>
<div data-lang="Java" class="tab"
  data-info="Although it is technically possible to use this environment variable in Android, the Glean team is not aware of a proper way to set environment variables in Android devices or emulators. When in this environment, enable debugging features through the <a href='../../user/debugging/android.html'>GleanDebugActivity</a>"></div>
<div data-lang="Swift" class="tab">
<p><img src="reference/debug/./screenshots/log_pings_screenshot_swift.png" alt="Xcode IDE scheme editor popup screenshot" title="GLEAN_LOG_PINGS" /></p>
<p>To set environment variables to the process running your app in an iOS device or emulator you need to edit the scheme for your app. In the Xcode IDE, use the shortcut <code>Cmd + &lt;</code> to open the scheme editor popup. The environment variables editor is under the <code>Arguments</code> tab on this popup.</p>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-bash">$ GLEAN_LOG_PINGS=true python my_application.py
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-bash">$ GLEAN_LOG_PINGS=true cargo run
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-info="It is not possible to access environment variables from the currently supported JavaScript platforms: Qt and browsers."></div>
<div data-lang="Firefox Desktop" class="tab">
<pre><code class="language-bash">$ GLEAN_LOG_PINGS=true ./mach run
</code></pre>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/debug/logPings.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="debug-view-tag-1"><a class="header" href="#debug-view-tag-1">Debug View Tag</a></h1>
<p>Tag all subsequent outgoing pings with a given value, in order to redirect
them to the <a href="reference/debug/../../user/debugging/index.html#glean-debug-view">Glean Debug View</a>.</p>
<p>&quot;To tag&quot; a ping with the Debug View Tag means that the ping request
will contain the <code>X-Debug-Id</code> header with the given tag.</p>
<p>Once enabled, the only way to disable this feature is to restart or manually reset the application.</p>
<h2 id="limits-2"><a class="header" href="#limits-2">Limits</a></h2>
<ul>
<li>Any valid HTTP header value is a valid debug view tag (e.g. any value that matches the
regex <code>[a-zA-Z0-9-]{1,20}</code>). Invalid values will be ignored.</li>
</ul>
<h2 id="api-4"><a class="header" href="#api-4">API</a></h2>
<h3 id="setdebugviewtag"><a class="header" href="#setdebugviewtag"><code>setDebugViewTag</code></a></h3>
<p>Sets the Debug View Tag to a given value.</p>
<p>This API can safely be called before <code>Glean.initialize</code>.
The tag will be applied upon initialization in this case.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

Glean.shared.setDebugViewTag(&quot;my-tag&quot;)
</code></pre>
</div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean;

glean.set_debug_view_tag(&quot;my-tag&quot;);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import Glean from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

Glean.setDebugViewTag(&quot;my-tag&quot;);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="environment-variable-1"><a class="header" href="#environment-variable-1">Environment variable</a></h2>
<h3 id="glean_debug_view_tag"><a class="header" href="#glean_debug_view_tag"><code>GLEAN_DEBUG_VIEW_TAG</code></a></h3>
<p>It is also  possible to set the debug view tag through
the <code>GLEAN_DEBUG_VIEW_TAG</code> environment variable.</p>
<p>This variable must be set at runtime, not at compile time.
It will be checked upon Glean initialization.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"
  data-info="Although it is technically possible to use this environment variable in Android, the Glean team is not aware of a proper way to set environment variables in Android devices or emulators. When in this environment, enable debugging features through the <a href='../../user/debugging/android.html'>GleanDebugActivity</a>"></div>
<div data-lang="Java" class="tab"
  data-info="Although it is technically possible to use this environment variable in Android, the Glean team is not aware of a proper way to set environment variables in Android devices or emulators. When in this environment, enable debugging features through the <a href='../../user/debugging/android.html'>GleanDebugActivity</a>"></div>
<div data-lang="Swift" class="tab">
<p><img src="reference/debug/./screenshots/debug_view_tag_screenshot_swift.png" alt="Xcode IDE scheme editor popup screenshot" title="GLEAN_DEBUG_VIEW_TAG" /></p>
<p>To set environment variables to the process running your app in an iOS device or emulator you need to edit the scheme for your app. In the Xcode IDE, use the shortcut <code>Cmd + &lt;</code> to open the scheme editor popup. The environment variables editor is under the <code>Arguments</code> tab on this popup.</p>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-bash">$ GLEAN_DEBUG_VIEW_TAG=&quot;my-tag&quot; python my_application.py
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-bash">$ GLEAN_DEBUG_VIEW_TAG=&quot;my-tag&quot; cargo run
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-info="It is not possible to access environment variables from the currently supported JavaScript platforms: Qt and browsers."></div>
<div data-lang="Firefox Desktop" class="tab">
<pre><code class="language-bash">$ GLEAN_DEBUG_VIEW_TAG=&quot;my-tag&quot; ./mach run
</code></pre>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/debug/debugViewTag.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="source-tags-1"><a class="header" href="#source-tags-1">Source Tags</a></h1>
<p>Tag all subsequent outgoing pings with a maximum of 5 comma-separated tags.</p>
<p>&quot;To tag&quot; a ping with Source Tags means that the ping request
will contain the <code>X-Source-Tags</code> header with a comma separated list of the given tags.</p>
<p>Once enabled, the only way to disable this feature is to restart or manually reset the application.</p>
<h2 id="limits-3"><a class="header" href="#limits-3">Limits</a></h2>
<ul>
<li>Any valid HTTP header value is a valid source tag (e.g. any value that matches the
regex <code>[a-zA-Z0-9-]{1,20}</code>) and values starting with the substring <code>glean</code> are reserved for internal
Glean usage and thus are also considered invalid. If any value in the list of source tags is invalid,
the whole list will be ignored.</li>
<li>If the list of tags has more than five members, the whole list will be ignored.</li>
<li>The special value <code>automation</code> is meant for tagging pings generated on automation: such pings will
be specially handled on the pipeline (i.e. discarded from <a href="https://docs.telemetry.mozilla.org/cookbooks/bigquery/querying.html#table-layout-and-naming">non-live views</a>).</li>
</ul>
<h2 id="api-5"><a class="header" href="#api-5">API</a></h2>
<h3 id="setsourcetags"><a class="header" href="#setsourcetags"><code>setSourceTags</code></a></h3>
<p>Sets the Source Tags to a given value.</p>
<p>This API can safely be called before <code>Glean.initialize</code>.
The tag will be applied upon initialization in this case.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

Glean.shared.setSourceTags([&quot;my-tag&quot;, &quot;your-tag&quot;, &quot;our-tag&quot;])
</code></pre>
</div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean;

glean.set_source_tags([&quot;my-tag&quot;, &quot;your-tag&quot;, &quot;our-tag&quot;]);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import Glean from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

Glean.setSourceTags([&quot;my-tag&quot;, &quot;your-tag&quot;, &quot;our-tag&quot;]);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="environment-variable-2"><a class="header" href="#environment-variable-2">Environment variable</a></h2>
<h3 id="glean_source_tags"><a class="header" href="#glean_source_tags"><code>GLEAN_SOURCE_TAGS</code></a></h3>
<p>It is also  possible to set the debug view tag through
the <code>GLEAN_SOURCE_TAGS</code> environment variable.</p>
<p>This variable must be set at runtime, not at compile time.
It will be checked upon Glean initialization.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"
  data-info="Although it is technically possible to use this environment variable in Android, the Glean team is not aware of a proper way to set environment variables in Android devices or emulators. When in this environment, enable debugging features through the <a href='../../user/debugging/android.html'>GleanDebugActivity</a>"></div>
<div data-lang="Java" class="tab"
  data-info="Although it is technically possible to use this environment variable in Android, the Glean team is not aware of a proper way to set environment variables in Android devices or emulators. When in this environment, enable debugging features through the <a href='../../user/debugging/android.html'>GleanDebugActivity</a>"></div>
<div data-lang="Swift" class="tab">
<p><img src="reference/debug/./screenshots/source_tags_screenshot_swift.png" alt="Xcode IDE scheme editor popup screenshot" title="GLEAN_SOURCE_TAGS" /></p>
<p>To set environment variables to the process running your app in an iOS device or emulator you need to edit the scheme for your app. In the Xcode IDE, use the shortcut <code>Cmd + &lt;</code> to open the scheme editor popup. The environment variables editor is under the <code>Arguments</code> tab on this popup.</p>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-bash">$ GLEAN_SOURCE_TAGS=my-tag,your-tag,our-tag python my_application.py
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-bash">$ GLEAN_SOURCE_TAGS=my-tag,your-tag,our-tag cargo run
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-info="It is not possible to access environment variables from the currently supported JavaScript platforms: Qt and browsers."></div>
<div data-lang="Firefox Desktop" class="tab">
<pre><code class="language-bash">$ GLEAN_SOURCE_TAGS=my-tag,your-tag,our-tag ./mach run
</code></pre>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/debug/sourceTags.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="metrics-2"><a class="header" href="#metrics-2">Metrics</a></h1>
<blockquote>
<p><strong>Not sure which metric type to use?</strong> These docs contain a <a href="reference/metrics/../../user/metrics/adding-new-metrics.html#choosing-a-metric-type">series of questions</a> that can help. Reference information about each metric type is linked below.</p>
</blockquote>
<p>The parameters available that apply to any metric type are in the <a href="reference/metrics/../yaml/index.html">metric parameters page</a>.</p>
<p>There are different metrics to choose from, depending on what you want to achieve:</p>
<ul>
<li>
<p><a href="reference/metrics/boolean.html">Boolean</a>: Records a single truth value, for example &quot;is a11y enabled?&quot;</p>
</li>
<li>
<p><a href="reference/metrics/labeled_booleans.html">Labeled boolean</a>: Records truth values for a set of labels, for example &quot;which a11y features are enabled?&quot;</p>
</li>
<li>
<p><a href="reference/metrics/counter.html">Counter</a>: Used to count how often something happens, for example, how often a certain button was pressed.</p>
</li>
<li>
<p><a href="reference/metrics/labeled_counters.html">Labeled counter</a>: Used to count how often something happens, for example which kind of crash occurred (<code>&quot;uncaught_exception&quot;</code> or <code>&quot;native_code_crash&quot;</code>).</p>
</li>
<li>
<p><a href="reference/metrics/string.html">String</a>: Records a single Unicode string value, for example the name of the OS.</p>
</li>
<li>
<p><a href="reference/metrics/labeled_strings.html">Labeled strings</a>: Records multiple Unicode string values, for example to record which kind of error occurred in different stages of a login process.</p>
</li>
<li>
<p><a href="reference/metrics/string_list.html">String List</a>: Records a list of Unicode string values, for example the list of enabled search engines.</p>
</li>
<li>
<p><a href="reference/metrics/timespan.html">Timespan</a>: Used to measure how much time is spent in a single task.</p>
</li>
<li>
<p><a href="reference/metrics/timing_distribution.html">Timing Distribution</a>: Used to record the distribution of multiple time measurements.</p>
</li>
<li>
<p><a href="reference/metrics/memory_distribution.html">Memory Distribution</a>: Used to record the distribution of memory sizes.</p>
</li>
<li>
<p><a href="reference/metrics/uuid.html">UUID</a>: Used to record universally unique identifiers (UUIDs), such as a client ID.</p>
</li>
<li>
<p><a href="reference/metrics/url.html">URL</a>: Used to record URL-like strings.</p>
</li>
<li>
<p><a href="reference/metrics/datetime.html">Datetime</a>: Used to record an absolute date and time, such as the time the user first ran the application.</p>
</li>
<li>
<p><a href="reference/metrics/event.html">Events</a>: Records events e.g. individual occurrences of user actions, say every time a view was open and from where.</p>
</li>
<li>
<p><a href="reference/metrics/custom_distribution.html">Custom Distribution</a>: Used to record the distribution of a value that needs fine-grained control of how the histogram buckets are computed.  <strong>Custom distributions are only available for values that come from Gecko.</strong></p>
</li>
<li>
<p><a href="reference/metrics/quantity.html">Quantity</a>: Used to record a single non-negative integer value. For example, the width of the display in pixels.</p>
</li>
<li>
<p><a href="reference/metrics/rate.html">Rate</a>: Used to record the rate something happens relative to some other thing.
For example, the number of HTTP connections that experienced an error relative to the number of total HTTP connections made.</p>
</li>
<li>
<p><a href="reference/metrics/text.html">Text</a>: Records a single long Unicode text, used when the limits on <code>String</code> are too low.</p>
</li>
</ul>
<h2 id="labeled-metrics"><a class="header" href="#labeled-metrics">Labeled metrics</a></h2>
<p>There are two types of metrics listed above - <em>labeled</em> and <em>unlabeled</em> metrics. If a metric is <em>labeled</em>, it means that for a single metric entry you define in <code>metrics.yaml</code>, you can record into multiple metrics under the same name, each of the same type and identified by a different string label.</p>
<p>This is useful when you need to break down metrics by a label known at build time or run time. For example:</p>
<ul>
<li>
<p>When you want to count a different set of sub-views that users interact with, you could use <code>viewCount[&quot;view1&quot;].add()</code> and <code>viewCount[&quot;view2&quot;].add()</code>.</p>
</li>
<li>
<p>When you want to count errors that might occur for a feature, you could use <code>errorCount[errorName].add()</code>.</p>
</li>
</ul>
<p>Labeled metrics come in two forms:</p>
<ul>
<li>
<p><strong>Static labels</strong>: The labels are specified at build time in the <code>metrics.yaml</code> file, in the <code>labels</code> parameter.
If a label that isn't part of this set is used at run time, it is converted to the special label <code>__other__</code>.
The number of static labels is limited to 100 per metric.</p>
</li>
<li>
<p><strong>Dynamic labels</strong>: The labels aren't known at build time, so are set at run time.
Only the first 16 labels seen by Glean will be tracked. After that, any additional labels are converted to the special label <code>__other__</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong>: Be careful with using arbitrary strings as labels and make sure they can't accidentally contain identifying data (like directory paths or user input).</p>
</blockquote>
<h3 id="label-format"><a class="header" href="#label-format">Label format</a></h3>
<p>To ensure maximum support in database columns, labels must be made up of dot-separated identifiers with lowercase ASCII alphanumerics, containing underscores and dashes.</p>
<p>Specifically, they must conform to this regular expression:</p>
<pre><code>^[a-z_][a-z0-9_-]{0,29}(\\.[a-z_][a-z0-9_-]{0,29})*$
</code></pre>
<h2 id="adding-or-changing-metric-types"><a class="header" href="#adding-or-changing-metric-types">Adding or changing metric types</a></h2>
<p>Glean has a <a href="https://wiki.mozilla.org/Glean/Adding_or_changing_Glean_metric_types">well-defined process</a> for requesting changes to existing metric types or suggesting the implementation of new metric types:</p>
<ol>
<li>Glean consumers need to file a bug in the <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Data%20Platform%20and%20Tools&amp;component=Glean%20Metric%20Types">Data platforms &amp; tools::Glean Metric Types</a> component, filling in the provided form;</li>
<li>The triage owner of the Bugzilla component prioritizes this within 6 business days and kicks off the <a href="https://wiki.mozilla.org/Glean/Adding_or_changing_Glean_metric_types#The_decision_making_process">decision making process</a>.</li>
<li>Once the decision process is completed, the bug is closed with a comment outlining the decision that was made.</li>
</ol>
<h2 id="deprecated-metrics"><a class="header" href="#deprecated-metrics">Deprecated metrics</a></h2>
<ul>
<li><a href="https://docs.google.com/document/d/1nntNIiE6braTGzoKf-lx21OVDd8ssyeIeJu3jnQQfEE/edit?usp=sharing">JWE</a>: Deprecated in <a href="https://github.com/mozilla/glean/blob/main/CHANGELOG.md#v3700-2021-04-30">v37.0.0</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="boolean"><a class="header" href="#boolean">Boolean</a></h1>
<p>Boolean metrics are used for reporting simple flags.</p>
<h2 id="recording-api-1"><a class="header" href="#recording-api-1">Recording API</a></h2>
<h3 id="set"><a class="header" href="#set"><code>set</code></a></h3>
<p>Sets a boolean metric to a specific value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Flags

Flags.a11yEnabled.set(System.isAccesibilityEnabled())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Flags;

Flags.INSTANCE.a11yEnabled.set(System.isAccessibilityEnabled());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Flags.a11yEnabled.set(self.isAccessibilityEnabled)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.flags.a11y_enabled.set(is_accessibility_enabled())
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code>use glean_metrics;

flags::a11y_enabled.set(system.is_accessibility_enabled());
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as flags from &quot;./path/to/generated/files/flags.js&quot;;

flags.a11yEnabled.set(this.isAccessibilityEnabled());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::flags::a11y_enabled.Set(false);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.flags.a11yEnabled.set(false);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-1"><a class="header" href="#recorded-errors-1">Recorded errors</a></h4>
<p>N/A</p>
<h2 id="testing-api-1"><a class="header" href="#testing-api-1">Testing API</a></h2>
<h3 id="testgetvalue"><a class="header" href="#testgetvalue"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given boolean metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Flags

assertTrue(Flags.a11yEnabled.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Flags;

assertTrue(Flags.INSTANCE.a11yEnabled.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertTrue(try Flags.a11yEnabled.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert True is metrics.flags.a11y_enabled.test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code>use glean_metrics;

assert!(flags::a11y_enabled.test_get_value(None).unwrap());
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as flags from &quot;./path/to/generated/files/flags.js&quot;;

assert(await flags.a11yEnabled.testGetValue());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_EQ(false, mozilla::glean::flags::a11y_enabled.TestGetValue().value());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Assert.equal(false, Glean.flags.a11yEnabled.testGetValue());
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue"><a class="header" href="#testhasvalue"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given boolean metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Flags

assertTrue(Flags.a11yEnabled.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Flags;

assertTrue(Flags.INSTANCE.a11yEnabled.testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertTrue(try Flags.a11yEnabled.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert True is metrics.flags.a11y_enabled.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-1"><a class="header" href="#metric-parameters-1">Metric parameters</a></h2>
<p>Example boolean metric definition:</p>
<pre><code class="language-yaml">flags:
  a11y_enabled:
    type: boolean
    description: &gt;
      Records whether a11y is enabled on the device.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters"><a class="header" href="#extra-metric-parameters">Extra metric parameters</a></h3>
<p>N/A</p>
<h2 id="data-questions"><a class="header" href="#data-questions">Data questions</a></h2>
<ul>
<li>Is accessibility enabled?</li>
</ul>
<h2 id="reference-3"><a class="header" href="#reference-3">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/BooleanMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/boolean.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/boolean/struct.BooleanMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_boolean.default.html">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/boolean.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="labeled-booleans"><a class="header" href="#labeled-booleans">Labeled Booleans</a></h1>
<p>Labeled booleans are used to record different related boolean flags.</p>
<h2 id="recording-api-2"><a class="header" href="#recording-api-2">Recording API</a></h2>
<h3 id="set-1"><a class="header" href="#set-1"><code>set</code></a></h3>
<p>Sets one of the labels in a labeled boolean metric to a specific value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Accessibility

Accessibility.features[&quot;screen_reader&quot;].set(isScreenReaderEnabled())
Accessibility.features[&quot;high_contrast&quot;].set(isHighContrastEnabled())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Accessibility;

Acessibility.INSTANCE.features[&quot;screen_reader&quot;].set(isScreenReaderEnabled());
Acessibility.INSTANCE.features[&quot;high_contrast&quot;].set(isHighContrastEnabled());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Accessibility.features[&quot;screen_reader&quot;].set(isScreenReaderEnabled())
Accessibility.features[&quot;high_contrast&quot;].set(isHighContrastEnabled())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.accessibility.features[&quot;screen_reader&quot;].set(is_screen_reader_enabled())
metrics.accessibility.features[&quot;high_contrast&quot;].set(is_high_contrast_enabled())
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

accessibility::features.get(&quot;screen_reader&quot;).set(is_screen_reader_enabled());
accessibility::features.get(&quot;high_contrast&quot;).set(is_high_contrast_enabled());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as acessibility from &quot;./path/to/generated/files/acessibility.js&quot;;

acessibility.features[&quot;screen_reader&quot;].set(this.isScreenReaderEnabled());
acessibility.features[&quot;high_contrast&quot;].set(this.isHighContrastEnabled());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::accessibility::features.Get(&quot;screen_reader&quot;_ns).Set(true);
mozilla::glean::accessibility::features.Get(&quot;high_contrast&quot;_ns).Set(false);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.accessibility.features.screen_reader.set(true);
Glean.accessibility.features[&quot;high_contrast&quot;].set(false);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-2"><a class="header" href="#recorded-errors-2">Recorded Errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_label</code></a>:
<ul>
<li>If the label contains invalid characters. Data is still recorded to the special label <code>__other__</code>.</li>
<li>If the label exceeds the maximum number of allowed characters. Data is still recorded to the special label <code>__other__</code>.</li>
</ul>
</li>
</ul>
<h2 id="testing-api-2"><a class="header" href="#testing-api-2">Testing API</a></h2>
<h3 id="testgetvalue-1"><a class="header" href="#testgetvalue-1"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given label in a labeled boolean metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Accessibility

// Do the booleans have the expected values?
assertEquals(True, Accessibility.features[&quot;screen_reader&quot;].testGetValue())
assertEquals(False, Accessibility.features[&quot;high_contrast&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Accessibility;

// Do the booleans have the expected values?
assertEquals(True, Acessibility.INSTANCE.features[&quot;screen_reader&quot;].testGetValue());
assertEquals(False, Acessibility.INSTANCE.features[&quot;high_contrast&quot;].testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Do the booleans have the expected values?
XCTAssertEqual(true, try Accessibility.features[&quot;screen_reader&quot;].testGetValue())
XCTAssertEqual(false, try Accessibility.features[&quot;high_contrast&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Do the booleans have the expected values?
assert metrics.accessibility.features[&quot;screen_reader&quot;].test_get_value()
assert not metrics.accessibility.features[&quot;high_contrast&quot;].test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Do the booleans have the expected values?
assert!(accessibility::features.get(&quot;screen_reader&quot;).test_get_value(None).unwrap());
assert!(!accessibility::features.get(&quot;high_contrast&quot;).test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as accessibility from &quot;./path/to/generated/files/acessibility.js&quot;;

assert(await accessibility.features[&quot;screen_reader&quot;].testGetValue());
assert(!(await accessibility.features[&quot;high_contrast&quot;].testGetValue()));
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_EQ(
    true,
    mozilla::glean::accessibility::features.Get(&quot;screen_reader&quot;_ns).TestGetValue().unwrap().ref());
ASSERT_EQ(
    false,
    mozilla::glean::accessibility::features.Get(&quot;high_contrast&quot;_ns).TestGetValue().unwrap().ref());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Assert.equal(true, Glean.accessibility.features[&quot;screen_reader&quot;].testGetValue());
Assert.equal(false, Glean.accessibility.features.high_contrast.testGetValue());
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-1"><a class="header" href="#testhasvalue-1"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given label in a labeled boolean metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Accessibility

// Was anything recorded?
assertTrue(Accessibility.features[&quot;screen_reader&quot;].testHasValue())
assertTrue(Accessibility.features[&quot;high_contrast&quot;].testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Accessibility;

// Was anything recorded?
assertEquals(True, Acessibility.INSTANCE.features[&quot;screen_reader&quot;].testHasValue());
assertEquals(True, Acessibility.INSTANCE.features[&quot;high_contrast&quot;].testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Accessibility.features[&quot;screen_reader&quot;].testHasValue())
XCTAssert(Accessibility.features[&quot;high_contrast&quot;].testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was anything recorded?
assert metrics.accessibility.features[&quot;screen_reader&quot;].test_has_value()
assert metrics.accessibility.features[&quot;high_contrast&quot;].test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors"><a class="header" href="#testgetnumrecordederrors"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets the number of errors recorded for a given labeled boolean metric in total.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Accessibility

// Did we record any invalid labels?
assertEquals(0, Accessibility.features.testGetNumRecordedErrors(ErrorType.InvalidLabel))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Accessibility;

// Did we record any invalid labels?
assertEquals(0, Acessibility.INSTANCE.features.testGetNumRecordedErrors());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Were there any invalid labels?
XCTAssertEqual(0, Accessibility.features.testGetNumRecordedErrors(.invalidLabel))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Did we record any invalid labels?
assert 0 == metrics.accessibility.features.test_get_num_recorded_errors(
    ErrorType.INVALID_LABEL
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Did we record any invalid labels?
assert_eq!(
  1,
  accessibility::features.test_get_num_recorded_errors(
    ErrorType::InvalidLabel
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as accessibility from &quot;./path/to/generated/files/acessibility.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

assert(
  1,
  await accessibility.features.testGetNumRecordedErrors(ErrorType.InvalidLabel)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-2"><a class="header" href="#metric-parameters-2">Metric parameters</a></h2>
<p>Example labeled boolean metric definition:</p>
<pre><code class="language-YAML">accessibility:
  features:
    type: labeled_boolean
    description: &gt;
      a11y features enabled on the device.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
    labels:
      - screen_reader
      - high_contrast
      ...
</code></pre>
<h3 id="extra-metric-parameters-1"><a class="header" href="#extra-metric-parameters-1">Extra metric parameters</a></h3>
<h4 id="labels"><a class="header" href="#labels"><code>labels</code></a></h4>
<p>Labeled metrics may have an optional <code>labels</code> parameter, containing a list of known labels.
The labels in this list must match the following requirements:</p>
<ul>
<li>
<p>Conform to the <a href="reference/metrics/index.html#label-format">label formatting regular expression</a>.</p>
</li>
<li>
<p>Each label must have a maximum of 60 bytes, when encoded as UTF-8.</p>
</li>
<li>
<p>This list itself is limited to 100 labels.</p>
</li>
</ul>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="important-3"><a class="header" href="#important-3">Important</a></h5>
<blockquote>
<p>If the labels are specified in the <code>metrics.yaml</code>, using any label not listed in that file
will be replaced with the special value <code>__other__</code>.</p>
<p>If the labels are <strong>not</strong> specified in the <code>metrics.yaml</code>, only 16 different dynamic labels
may be used, after which the special value <code>__other__</code> will be used.</p>
</blockquote>
<p>Removing or changing labels, including their order in the registry file, is permitted. Avoid reusing labels
that were removed in the past. It is best practice to add documentation about removed labels to the
description field so that analysts will know of their existence and meaning in historical data.
Special care must be taken when changing GeckoView metrics sent through the Glean SDK, as the
index of the labels is used to report Gecko data through the Glean SDK.</p>
<h2 id="data-questions-1"><a class="header" href="#data-questions-1">Data questions</a></h2>
<ul>
<li>Which accessibility features are enabled?</li>
</ul>
<h2 id="reference-4"><a class="header" href="#reference-4">Reference</a></h2>
<ul>
<li>Swift API docs: <a href="reference/metrics/../../../swift/Classes/LabeledMetricType.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../swift/Classes/BooleanMetricType.html"><code>BooleanMetricType</code></a></li>
<li>Python API docs: <a href="reference/metrics/../../../python/glean/metrics/labeled.html"><code>LabeledMetricBase</code></a>, <a href="reference/metrics/../../../python/glean/metrics/boolean.html"><code>BooleanMetricType</code></a></li>
<li>Rust API docs: <a href="reference/metrics/../../../docs/glean/private/struct.LabeledMetric.html"><code>LabeledMetric</code></a>, <a href="reference/metrics/../../../docs/glean/private/struct.BooleanMetric.html"><code>BooleanMetricType</code></a></li>
<li>JavaScript API docs: <a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_labeled.default.html"><code>LabeledMetricType</code></a>, <a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_boolean.default.html"><code>BooleanMetricType</code></a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/labeled_booleans.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="counter"><a class="header" href="#counter">Counter</a></h1>
<p>Used to count how often something happens, say how often a certain button was pressed.
A counter always starts from <code>0</code>.
Each time you record to a counter, its value is incremented.
Unless incremented by a positive value, a counter will not be reported in pings,
that means: the value <code>0</code> is never sent in a ping.</p>
<p>If you find that you need to control the actual value sent in the ping, you may be measuring something,
not just counting something, and a <a href="reference/metrics/quantity.html">Quantity metric</a> may be a better choice.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="let-the-glean-metric-do-the-counting"><a class="header" href="#let-the-glean-metric-do-the-counting">Let the Glean metric do the counting</a></h2>
<blockquote>
<p>When using a counter metric, it is important to let the Glean metric do the counting.
Using your own variable for counting and setting the counter yourself could be problematic because
it will be difficult to reset the value at the exact moment that the value is sent in a ping.
Instead, just use <code>counter.add</code> to increment the value and let Glean handle resetting the counter.</p>
</blockquote>
<h2 id="recording-api-3"><a class="header" href="#recording-api-3">Recording API</a></h2>
<h3 id="add"><a class="header" href="#add"><code>add</code></a></h3>
<p>Increases the counter by a certain amount. If no amount is passed it defaults to <code>1</code>.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Controls

Controls.refreshPressed.add() // Adds 1 to the counter.
Controls.refreshPressed.add(5) // Adds 5 to the counter.
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Controls;

Controls.INSTANCE.refreshPressed.add(); // Adds 1 to the counter.
Controls.INSTANCE.refreshPressed.add(5); // Adds 5 to the counter.
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Controls.refreshPressed.add() // Adds 1 to the counter.
Controls.refreshPressed.add(5) // Adds 5 to the counter.
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.controls.refresh_pressed.add()  # Adds 1 to the counter.
metrics.controls.refresh_pressed.add(5) # Adds 5 to the counter.
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics;

controls::refresh_pressed.add(1); // Adds 1 to the counter.
controls::refresh_pressed.add(5); // Adds 5 to the counter.
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as controls from &quot;./path/to/generated/files/controls.js&quot;;

controls.refreshPressed.add(); // Adds 1 to the counter.
controls.refreshPressed.add(5); // Adds 5 to the counter.
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::controls::refresh_pressed.Add(1);
mozilla::glean::controls::refresh_pressed.Add(5);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.controls.refreshPressed.add(1);
Glean.controls.refreshPressed.add(5);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-3"><a class="header" href="#recorded-errors-3">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: If the counter is incremented by <code>0</code> or a negative value.</li>
</ul>
<h4 id="limits-4"><a class="header" href="#limits-4">Limits</a></h4>
<ul>
<li>Only increments;</li>
<li>Saturates at the largest value that can be represented as a 32-bit signed integer (<code>2147483647</code>).</li>
</ul>
<h2 id="testing-api-3"><a class="header" href="#testing-api-3">Testing API</a></h2>
<h3 id="testgetvalue-2"><a class="header" href="#testgetvalue-2"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Controls

assertEquals(6, Controls.refreshPressed.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Controls;

assertEquals(6, Controls.INSTANCE.refreshPressed.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertEqual(6, try Controls.refreshPressed.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert 6 == metrics.controls.refresh_pressed.test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

assert_eq!(6, controls::refresh_pressed.test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as controls from &quot;./path/to/generated/files/controls.js&quot;;

assert.strictEqual(6, await controls.refreshPressed.testGetValue());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_TRUE(mozilla::glean::controls::refresh_pressed.TestGetValue().isOk());
ASSERT_EQ(6, mozilla::glean::controls::refresh_pressed.TestGetValue().unwrap().value());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
Assert.equal(6, Glean.controls.refreshPressed.testGetValue());
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-2"><a class="header" href="#testhasvalue-2"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Controls

assertTrue(Controls.refreshPressed.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Controls;

assertTrue(Controls.INSTANCE.refreshPressed.testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssert(Controls.refreshPressed.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert metrics.controls.refresh_pressed.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-1"><a class="header" href="#testgetnumrecordederrors-1"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Controls

assertEquals(
    1, Controls.refreshPressed.testGetNumRecordedErrors(ErrorType.InvalidValue)
)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Controls;

assertEquals(
    1, Controls.INSTANCE.refreshPressed.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">XCTAssertEqual(1, Controls.refreshPressed.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

from glean.testing import ErrorType

assert 1 == metrics.controls.refresh_pressed.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

assert_eq!(
  1,
  controls::refresh_pressed.test_get_num_recorded_errors(
    ErrorType::InvalidValue
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as controls from &quot;./path/to/generated/files/controls.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

assert.strictEqual(
  1,
  await controls.refreshPressed.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-3"><a class="header" href="#metric-parameters-3">Metric parameters</a></h2>
<p>Example counter metric definition:</p>
<pre><code class="language-yaml">controls:
  refresh_pressed:
    type: counter
    description: &gt;
      Counts how often the refresh button is pressed.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters-2"><a class="header" href="#extra-metric-parameters-2">Extra metric parameters</a></h3>
<p>N/A</p>
<h2 id="data-questions-2"><a class="header" href="#data-questions-2">Data questions</a></h2>
<ul>
<li>How often was a certain button pressed?</li>
</ul>
<h2 id="reference-5"><a class="header" href="#reference-5">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/CounterMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/counter.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/counter/struct.CounterMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_counter.default.html">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/counter.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="labeled-counters"><a class="header" href="#labeled-counters">Labeled Counters</a></h1>
<p>Labeled counters are used to record different related counts that should sum up to a total.
Each counter always starts from <code>0</code>.
Each time you record to a labeled counter, its value is incremented.
Unless incremented by a positive value, a counter will not be reported in pings,
that means: the value <code>0</code> is never sent in a ping.</p>
<h2 id="recording-api-4"><a class="header" href="#recording-api-4">Recording API</a></h2>
<h3 id="add-1"><a class="header" href="#add-1"><code>add</code></a></h3>
<p>Increases one of the labels in a labeled counter metric by a certain amount.
If no amount is passed it defaults to <code>1</code>.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Stability

Stability.crashCount[&quot;uncaught_exception&quot;].add() // Adds 1 to the &quot;uncaught_exception&quot; counter.
Stability.crashCount[&quot;native_code_crash&quot;].add(3) // Adds 3 to the &quot;native_code_crash&quot; counter.
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Stability;

Stability.INSTANCE.crashCount[&quot;uncaught_exception&quot;].add(); // Adds 1 to the &quot;uncaught_exception&quot; counter.
Stability.INSTANCE.crashCount[&quot;native_code_crash&quot;].add(3); // Adds 3 to the &quot;native_code_crash&quot; counter.
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Stability.crashCount[&quot;uncaught_exception&quot;].add() // Adds 1 to the &quot;uncaught_exception&quot; counter.
Stability.crashCount[&quot;native_code_crash&quot;].add(3) // Adds 3 to the &quot;native_code_crash&quot; counter.
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Adds 1 to the &quot;uncaught_exception&quot; counter.
metrics.stability.crash_count[&quot;uncaught_exception&quot;].add()
# Adds 3 to the &quot;native_code_crash&quot; counter.
metrics.stability.crash_count[&quot;native_code_crash&quot;].add(3)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

stability::crash_count.get(&quot;uncaught_exception&quot;).add(1); // Adds 1 to the &quot;uncaught_exception&quot; counter.
stability::crash_count.get(&quot;native_code_crash&quot;).add(3); // Adds 3 to the &quot;native_code_crash&quot; counter.
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as stability from &quot;./path/to/generated/files/stability.js&quot;;

// Adds 1 to the &quot;uncaught_exception&quot; counter.
stability.crashCount[&quot;uncaught_exception&quot;].add();
// Adds 3 to the &quot;native_code_crash&quot; counter.
stability.crashCount[&quot;native_code_crash&quot;].add(3);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::stability::crash_count.Get(&quot;uncaught_exception&quot;_ns).Add(1);
mozilla::glean::stability::crash_count.Get(&quot;native_code_crash&quot;_ns).Add(3);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.stability.crashCount.uncaught_exception.add(1);
Glean.stability.crashCount[&quot;native_code_crash&quot;].add(3);
</code></pre>
</div>
</div>
</div>
<h4 id="errors-recorded"><a class="header" href="#errors-recorded">Errors recorded</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: If the counter is incremented by <code>0</code> or a negative value.</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_label</code></a>:
<ul>
<li>If the label contains invalid characters. Data is still recorded to the special label <code>__other__</code>.</li>
<li>If the label exceeds the maximum number of allowed characters. Data is still recorded to the special label <code>__other__</code>.</li>
</ul>
</li>
</ul>
<h4 id="limits-5"><a class="header" href="#limits-5">Limits</a></h4>
<ul>
<li>Only increments;</li>
<li>Saturates at the largest value that can be represented as a 32-bit signed integer.</li>
</ul>
<h2 id="testing-api-4"><a class="header" href="#testing-api-4">Testing API</a></h2>
<h3 id="testgetvalue-3"><a class="header" href="#testgetvalue-3"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given label in a labeled counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Stability

// Do the counters have the expected values?
assertEquals(1, Stability.crashCount[&quot;uncaught_exception&quot;].testGetValue())
assertEquals(3, Stability.crashCount[&quot;native_code_crash&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Stability;

// Do the counters have the expected values?
assertEquals(1, Stability.INSTANCE.crashCount[&quot;uncaught_exception&quot;].testGetValue());
assertEquals(3, Stability.INSTANCE.crashCount[&quot;native_code_crash&quot;].testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Do the counters have the expected values?
XCTAssertEqual(1, try Stability.crashCount[&quot;uncaught_exception&quot;].testGetValue())
XCTAssertEqual(3, try Stability.crashCount[&quot;native_code_crash&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Do the counters have the expected values?
assert 1 == metrics.stability.crash_count[&quot;uncaught_exception&quot;].test_get_value()
assert 3 == metrics.stability.crash_count[&quot;native_code_crash&quot;].test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Do the counters have the expected values?
assert_eq!(1, stability::crash_count.get(&quot;uncaught_exception&quot;).test_get_value().unwrap());
assert_eq!(3, stability::crash_count.get(&quot;native_code_crash&quot;).test_get_value().unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as stability from &quot;./path/to/generated/files/stability.js&quot;;

// Do the counters have the expected values?
assert.strictEqual(1, await stability.crashCount[&quot;uncaught_exception&quot;].testGetValue());
assert.strictEqual(3, await stability.crashCount[&quot;native_code_crash&quot;].testGetValue());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_EQ(
    1,
    mozilla::glean::stability::crash_count.Get(&quot;uncaught_exception&quot;_ns).TestGetValue().unwrap().ref());
ASSERT_EQ(
    3,
    mozilla::glean::stability::crash_count.Get(&quot;native_code_crash&quot;_ns).TestGetValue().unwrap().ref());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Assert.equal(1, Glean.stability.crashCount[&quot;uncaught_exception&quot;].testGetValue());
Assert.equal(3, Glean.stability.crashCount.native_code_crash.testGetValue());
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-3"><a class="header" href="#testhasvalue-3"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given label in a labeled counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Stability

// Was anything recorded?
assertTrue(Stability.crashCount[&quot;uncaught_exception&quot;].testHasValue())
assertTrue(Stability.crashCount[&quot;native_code_crash&quot;].testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Stability;

// Was anything recorded?
assertTrue(Stability.INSTANCE.crashCount[&quot;uncaught_exception&quot;].testHasValue());
assertTrue(Stability.INSTANCE.crashCount[&quot;native_code_crash&quot;].testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Stability.crashCount[&quot;uncaught_exception&quot;].testHasValue())
XCTAssert(Stability.crashCount[&quot;native_code_crash&quot;].testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was anything recorded?
assert metrics.stability.crash_count[&quot;uncaught_exception&quot;].test_has_value()
assert metrics.stability.crash_count[&quot;native_code_crash&quot;].test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-2"><a class="header" href="#testgetnumrecordederrors-2"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets the number of errors recorded for a given labeled counter metric in total.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Stabilit

// Were there any invalid labels?
assertEquals(0, Stability.crashCount.testGetNumRecordedErrors(ErrorType.InvalidLabel))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Stability;

// Were there any invalid labels?
assertEquals(0, Stability.INSTANCE.crashCount.testGetNumRecordedErrors(ErrorType.InvalidLabel));
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Were there any invalid labels?
XCTAssertEqual(0, Stability.crashCount.testGetNumRecordedErrors(.invalidLabel))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Were there any invalid labels?
assert 0 == metrics.stability.crash_count.test_get_num_recorded_errors(
    ErrorType.INVALID_LABEL
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Were there any invalid labels?
assert_eq!(
  0,
  stability::crash_count.test_get_num_recorded_errors(
    ErrorType::InvalidLabel
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as stability from &quot;./path/to/generated/files/stability.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

// Were there any invalid labels?
assert(
  0,
  await stability.crashCount.testGetNumRecordedErrors(ErrorType.InvalidLabel)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-4"><a class="header" href="#metric-parameters-4">Metric parameters</a></h2>
<p>Example labeled counter metric definition:</p>
<pre><code class="language-YAML">accessibility:
  features:
    type: labeled_counter
    description: &gt;
      Counts the number of crashes that occur in the application.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
    labels:
      - uncaught_exception
      - native_code_crash
      ...
</code></pre>
<h3 id="extra-metric-parameters-3"><a class="header" href="#extra-metric-parameters-3">Extra metric parameters</a></h3>
<h4 id="labels-1"><a class="header" href="#labels-1"><code>labels</code></a></h4>
<p>Labeled metrics may have an optional <code>labels</code> parameter, containing a list of known labels.
The labels in this list must match the following requirements:</p>
<ul>
<li>
<p>Conform to the <a href="reference/metrics/index.html#label-format">label formatting regular expression</a>.</p>
</li>
<li>
<p>Each label must have a maximum of 60 bytes, when encoded as UTF-8.</p>
</li>
<li>
<p>This list itself is limited to 100 labels.</p>
</li>
</ul>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="important-4"><a class="header" href="#important-4">Important</a></h5>
<blockquote>
<p>If the labels are specified in the <code>metrics.yaml</code>, using any label not listed in that file
will be replaced with the special value <code>__other__</code>.</p>
<p>If the labels are <strong>not</strong> specified in the <code>metrics.yaml</code>, only 16 different dynamic labels
may be used, after which the special value <code>__other__</code> will be used.</p>
</blockquote>
<p>Removing or changing labels, including their order in the registry file, is permitted. Avoid reusing labels
that were removed in the past. It is best practice to add documentation about removed labels to the
description field so that analysts will know of their existence and meaning in historical data.
Special care must be taken when changing GeckoView metrics sent through the Glean SDK, as the
index of the labels is used to report Gecko data through the Glean SDK.</p>
<h2 id="data-questions-3"><a class="header" href="#data-questions-3">Data questions</a></h2>
<ul>
<li>How many times did different types of crashes occur?</li>
</ul>
<h2 id="reference-6"><a class="header" href="#reference-6">Reference</a></h2>
<ul>
<li>Swift API docs: <a href="reference/metrics/../../../swift/Classes/LabeledMetricType.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../swift/Classes/CounterMetricType.html"><code>CounterMetricType</code></a></li>
<li>Python API docs: <a href="reference/metrics/../../../python/glean/metrics/labeled.html"><code>LabeledMetricBase</code></a>, <a href="reference/metrics/../../../python/glean/metrics/counter.html"><code>CounterMetricType</code></a></li>
<li>Rust API docs: <a href="reference/metrics/../../../docs/glean/private/struct.LabeledMetric.html"><code>LabeledMetric</code></a>, <a href="reference/metrics/../../../docs/glean/private/struct.CounterMetric.html"><code>CounterMetricType</code></a></li>
<li>JavaScript API docs: <a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_labeled.default.html"><code>LabeledMetricType</code></a>, <a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_counter.default.html"><code>CounterMetricType</code></a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/labeled_counters.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="strings"><a class="header" href="#strings">Strings</a></h1>
<p>String metrics allow recording a Unicode string value with arbitrary content.</p>
<p>This metric type does not support recording JSON blobs</p>
<ul>
<li>please get in contact with the Glean team if you're missing a type.</li>
</ul>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="important-5"><a class="header" href="#important-5">Important</a></h2>
<blockquote>
<p>Be careful using arbitrary strings and make sure they can't accidentally contain identifying data (like directory paths or user input).</p>
</blockquote>
<h2 id="recording-api-5"><a class="header" href="#recording-api-5">Recording API</a></h2>
<h3 id="set-2"><a class="header" href="#set-2"><code>set</code></a></h3>
<p>Set a string metric to a specific value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Record a value into the metric.
SearchDefault.name.set(&quot;duck duck go&quot;)
// If it changed later, you can record the new value:
SearchDefault.name.set(&quot;wikipedia&quot;)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.SearchDefault;

// Record a value into the metric.
SearchDefault.INSTANCE.name.set(&quot;duck duck go&quot;);
// If it changed later, you can record the new value:
SearchDefault.INSTANCE.name.set(&quot;wikipedia&quot;);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">// Record a value into the metric.
SearchDefault.name.set(&quot;duck duck go&quot;)
// If it changed later, you can record the new value:
SearchDefault.name.set(&quot;wikipedia&quot;)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Record a value into the metric.
metrics.search_default.name.set(&quot;duck duck go&quot;)
# If it changed later, you can record the new value:
metrics.search_default.name.set(&quot;wikipedia&quot;)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Record a value into the metric.
search_default::name.set(&quot;duck duck go&quot;);
// If it changed later, you can record the new value:
search_default::name.set(&quot;wikipedia&quot;);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as searchDefault from &quot;./path/to/generated/files/searchDefault.js&quot;;

// Record a value into the metric.
searchDefault.name.set(&quot;duck duck go&quot;);
// If it changed later, you can record the new value:
searchDefault.name.set(&quot;wikipedia&quot;);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::search_default::name.Set(&quot;wikipedia&quot;_ns);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.searchDefault.name.set(&quot;wikipedia&quot;);
</code></pre>
</div>
</div>
</div>
<h4 id="limits-6"><a class="header" href="#limits-6">Limits</a></h4>
<ul>
<li>Fixed maximum string length: 100. Longer strings are truncated. This is measured in the number of bytes when the string is encoded in UTF-8.</li>
</ul>
<h4 id="recorded-errors-4"><a class="header" href="#recorded-errors-4">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_overflow</code></a>: if the string is too long. (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</li>
</ul>
<h2 id="testing-api-5"><a class="header" href="#testing-api-5">Testing API</a></h2>
<h3 id="testgetvalue-4"><a class="header" href="#testgetvalue-4"><code>testGetValue</code></a></h3>
<p>Get the recorded value for a given string metric.</p>
<p>The recorded value may have been truncated. See <a href="reference/metrics/string.html#limits">&quot;Limits&quot;</a> section above.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Does the string metric have the expected value?
assertEquals(&quot;wikipedia&quot;, SearchDefault.name.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Does the string metric have the expected value?
assertEquals(&quot;wikipedia&quot;, SearchDefault.INSTANCE.name.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Does the string metric have the expected value?
XCTAssertEqual(&quot;wikipedia&quot;, try SearchDefault.name.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Does the string metric have the expected value?
assert &quot;wikipedia&quot; == metrics.search_default.name.test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Does the string metric have the expected value?
assert_eq!(6, search_default::name.test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as searchDefault from &quot;./path/to/generated/files/searchDefault.js&quot;;

assert.strictEqual(&quot;wikipedia&quot;, await searchDefault.name.testGetValue());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Is it clear of errors?
ASSERT_TRUE(mozilla::glean::search_default::name.TestGetValue().isOk());
// Does it have the expected value?
ASSERT_STREQ(
  &quot;wikipedia&quot;,
  mozilla::glean::search_default::name.TestGetValue().unwrap().value().get()
);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// Does it have the expected value?
// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
Assert.equal(&quot;wikipedia&quot;, Glean.searchDefault.name.testGetValue());
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-4"><a class="header" href="#testhasvalue-4"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given string metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Was anything recorded?
assertTrue(SearchDefault.name.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Was anything recorded?
assertTrue(SearchDefault.INSTANCE.name.testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(SearchDefault.name.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was anything recorded?
assert metrics.search_default.name.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-3"><a class="header" href="#testgetnumrecordederrors-3"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given string metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Was the string truncated, and an error reported?
assertEquals(1, SearchDefault.name.testGetNumRecordedErrors(ErrorType.InvalidOverflow))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.SearchDefault;

// Was the string truncated, and an error reported?
assertEquals(
    1,
    SearchDefault.INSTANCE.name.testGetNumRecordedErrors(
        ErrorType.InvalidOverflow
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was the string truncated, and an error reported?
XCTAssertEqual(1, SearchDefault.name.testGetNumRecordedErrors(.invalidOverflow))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was the string truncated, and an error reported?
assert 1 == metrics.search_default.name.test_get_num_recorded_errors(
    ErrorType.INVALID_OVERFLOW
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Was the string truncated, and an error reported?
assert_eq!(
  1,
  search_default::name.test_get_num_recorded_errors(
    ErrorType::InvalidOverflow
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as searchDefault from &quot;./path/to/generated/files/searchDefault.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

// Was the string truncated, and an error reported?
assert.strictEqual(
  1,
  await searchDefault.name.testGetNumRecordedErrors(ErrorType.InvalidOverflow)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-5"><a class="header" href="#metric-parameters-5">Metric parameters</a></h2>
<p>Example string metric definition:</p>
<pre><code class="language-yaml">controls:
  refresh_pressed:
    type: string
    description: &gt;
      The name of the default search engine.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters-4"><a class="header" href="#extra-metric-parameters-4">Extra metric parameters</a></h3>
<p>N/A</p>
<h2 id="data-questions-4"><a class="header" href="#data-questions-4">Data questions</a></h2>
<ul>
<li>
<p>Record the operating system name with a value of <code>&quot;android&quot;</code>.</p>
</li>
<li>
<p>Recording the device model with a value of <code>&quot;SAMSUNG-SGH-I997&quot;</code>.</p>
</li>
</ul>
<h2 id="reference-7"><a class="header" href="#reference-7">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/StringMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/string.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.StringMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_string.default.html#set">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/string.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="labeled-strings"><a class="header" href="#labeled-strings">Labeled Strings</a></h1>
<p>Labeled strings record multiple Unicode string values, each under a different label.</p>
<h2 id="recording-api-6"><a class="header" href="#recording-api-6">Recording API</a></h2>
<h3 id="set-3"><a class="header" href="#set-3"><code>set</code></a></h3>
<p>Sets one of the labels in a labeled string metric to a specific value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Login

Login.errorsByStage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Login;

Login.INSTANCE.errorsByStage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Login.errorsByStage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.login.errors_by_stage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

login::errors_by_stage.get(&quot;server_auth&quot;).set(&quot;Invalid password&quot;);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as login from &quot;./path/to/generated/files/login.js&quot;;

login.errorsByStage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::login::errors_by_stage.Get(&quot;server_auth&quot;_ns).Set(&quot;Invalid password&quot;_ns);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.login.errorsByStage[&quot;server_auth&quot;].set(&quot;Invalid password&quot;);
</code></pre>
</div>
</div>
</div>
<h4 id="limits-7"><a class="header" href="#limits-7">Limits</a></h4>
<ul>
<li>Fixed maximum string length: 100. Longer strings are truncated. This is measured in the number of bytes when the string is encoded in UTF-8.</li>
</ul>
<h4 id="recorded-errors-5"><a class="header" href="#recorded-errors-5">Recorded Errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_overflow</code></a>: if the string is too long. (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_label</code></a>:
<ul>
<li>If the label contains invalid characters. Data is still recorded to the special label <code>__other__</code>.</li>
<li>If the label exceeds the maximum number of allowed characters. Data is still recorded to the special label <code>__other__</code>.</li>
</ul>
</li>
</ul>
<h2 id="testing-api-6"><a class="header" href="#testing-api-6">Testing API</a></h2>
<h3 id="testgetvalue-5"><a class="header" href="#testgetvalue-5"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given label in a labeled string metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Login

// Does the metric have the expected value?
assertTrue(Login.errorsByStage[&quot;server_auth&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Login;

// Does the metric have the expected value?
assertTrue(Login.INSTANCE.errorsByStage[&quot;server_auth&quot;].testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Does the metric have the expected value?
XCTAssert(Login.errorsByStage[&quot;server_auth&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Does the metric have the expected value?
assert &quot;Invalid password&quot; == metrics.login.errors_by_stage[&quot;server_auth&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Does the metric have the expected value?
assert!(login::errors_by_stage.get(&quot;server_auth&quot;).test_get_value());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as login from &quot;./path/to/generated/files/login.js&quot;;

// Does the metric have the expected value?
assert.strictEqual(&quot;Invalid password&quot;, await metrics.login.errorsByStage[&quot;server_auth&quot;].testGetValue())
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_STREQ(&quot;Invalid password&quot;,
             mozilla::glean::login::errors_by_stage.Get(&quot;server_auth&quot;_ns)
                .TestGetValue()
                .unwrap()
                .ref()
                .get());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Assert.equal(&quot;Invalid password&quot;, Glean.login.errorsByStage[&quot;server_auth&quot;].testGetValue());
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-5"><a class="header" href="#testhasvalue-5"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given label in a labeled string metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Login

// Was anything recorded?
assertTrue(Login.errorsByStage[&quot;server_auth&quot;].testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Login;

// Was anything recorded?
assertTrue(Login.INSTANCE.errorsByStage[&quot;server_auth&quot;].testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Login.errorsByStage[&quot;server_auth&quot;].testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python"># Was anything recorded?
assert metrics.login.errors_by_stage[&quot;server_auth&quot;].test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-4"><a class="header" href="#testgetnumrecordederrors-4"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets the number of errors recorded for a given labeled string metric in total.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Login

// Were there any invalid labels?
assertEquals(0, Login.errorsByStage.testGetNumRecordedErrors(ErrorType.InvalidLabel))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Login;

// Were there any invalid labels?
assertEquals(0, Login.INSTANCE.errorsByStage.testGetNumRecordedErrors(ErrorType.InvalidLabel));
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Were there any invalid labels?
XCTAssertEqual(0, Login.errorsByStage.testGetNumRecordedErrors(.invalidLabel))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Were there any invalid labels?
assert 0 == metrics.login.errors_by_stage.test_get_num_recorded_errors(
    ErrorType.INVALID_LABEL
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

// Were there any invalid labels?
assert_eq!(
  0,
  login::errors_by_stage.test_get_num_recorded_errors(
    ErrorType::InvalidLabel
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as login from &quot;./path/to/generated/files/login.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

// Were there any invalid labels?
assert(
  0,
  await login.errorsByStage.testGetNumRecordedErrors(ErrorType.InvalidLabel)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" calss="tab"></div>
</div>
</div>
<h2 id="metric-parameters-6"><a class="header" href="#metric-parameters-6">Metric parameters</a></h2>
<p>Example labeled boolean metric definition:</p>
<pre><code class="language-YAML">login:
  errors_by_stage:
    type: labeled_string
    description: Records the error type, if any, that occur in different stages of the login process.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
    labels:
      - server_auth
      - enter_email
      ...
</code></pre>
<h3 id="extra-metric-parameters-5"><a class="header" href="#extra-metric-parameters-5">Extra metric parameters</a></h3>
<h4 id="labels-2"><a class="header" href="#labels-2"><code>labels</code></a></h4>
<p>Labeled metrics may have an optional <code>labels</code> parameter, containing a list of known labels.
The labels in this list must match the following requirements:</p>
<ul>
<li>
<p>Conform to the <a href="reference/metrics/index.html#label-format">label formatting regular expression</a>.</p>
</li>
<li>
<p>Each label must have a maximum of 60 bytes, when encoded as UTF-8.</p>
</li>
<li>
<p>This list itself is limited to 100 labels.</p>
</li>
</ul>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="important-6"><a class="header" href="#important-6">Important</a></h5>
<blockquote>
<p>If the labels are specified in the <code>metrics.yaml</code>, using any label not listed in that file
will be replaced with the special value <code>__other__</code>.</p>
<p>If the labels are <strong>not</strong> specified in the <code>metrics.yaml</code>, only 16 different dynamic labels
may be used, after which the special value <code>__other__</code> will be used.</p>
</blockquote>
<p>Removing or changing labels, including their order in the registry file, is permitted. Avoid reusing labels
that were removed in the past. It is best practice to add documentation about removed labels to the
description field so that analysts will know of their existence and meaning in historical data.
Special care must be taken when changing GeckoView metrics sent through the Glean SDK, as the
index of the labels is used to report Gecko data through the Glean SDK.</p>
<h2 id="data-questions-5"><a class="header" href="#data-questions-5">Data questions</a></h2>
<ul>
<li>What kinds of errors occurred at each step in the login process?</li>
</ul>
<h2 id="reference-8"><a class="header" href="#reference-8">Reference</a></h2>
<ul>
<li>Swift API docs: <a href="reference/metrics/../../../swift/Classes/LabeledMetricType.html"><code>LabeledMetricType</code></a>, <a href="reference/metrics/../../../swift/Classes/StringMetricType.html"><code>StringMetricType</code></a></li>
<li>Python API docs: <a href="reference/metrics/../../../python/glean/metrics/labeled.html"><code>LabeledMetricBase</code></a>, <a href="reference/metrics/../../../python/glean/metrics/string.html"><code>StringMetricType</code></a></li>
<li>Rust API docs: <a href="reference/metrics/../../../docs/glean/private/struct.LabeledMetric.html"><code>LabeledMetric</code></a>, <a href="reference/metrics/../../../docs/glean/private/struct.StringMetric.html"><code>StringMetricType</code></a></li>
<li>JavaScript API docs: <a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_labeled.default.html"><code>LabeledMetricType</code></a>, <a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_string.default.html"><code>StringMetricType</code></a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/labeled_strings.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="string-list"><a class="header" href="#string-list">String List</a></h1>
<p>Strings lists are used for recording a list of Unicode string values, such as the names of the enabled search engines.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="important-7"><a class="header" href="#important-7">Important</a></h5>
<blockquote>
<p>Be careful using arbitrary strings and make sure they can't accidentally contain identifying data (like directory paths or user input).</p>
</blockquote>
<h2 id="recording-api-7"><a class="header" href="#recording-api-7">Recording API</a></h2>
<h3 id="add-2"><a class="header" href="#add-2"><code>add</code></a></h3>
<p>Add a new string to the list.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

Search.engines.add(&quot;wikipedia&quot;)
Search.engines.add(&quot;duck duck go&quot;)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search

Search.INSTANCE.engines().add(&quot;wikipedia&quot;)
Search.INSTANCE.engines().add(&quot;duck duck go&quot;)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Search.engines.add(&quot;wikipedia&quot;)
Search.engines.add(&quot;duck duck go&quot;)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.search.engines.add(&quot;wikipedia&quot;)
metrics.search.engines.add(&quot;duck duck go&quot;)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics::search;

search::engines.add(&quot;wikipedia&quot;.to_string());
search::engines.add(&quot;duck duck go&quot;.to_string());
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">Glean.search.engines.add(&quot;wikipedia&quot;);
Glean.search.engines.add(&quot;duck duck go&quot;);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::search::engines.Add(&quot;wikipedia&quot;_ns);
mozilla::glean::search::engines.Add(&quot;duck duck go&quot;_ns);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.search.engines.add(&quot;wikipedia&quot;);
Glean.search.engines.add(&quot;duck duck go&quot;);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-6"><a class="header" href="#recorded-errors-6">Recorded errors</a></h4>
<ul>
<li><code>invalid_overflow</code>: if the string is too long. (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</li>
<li><code>invalid_value</code>: if the list is too long.</li>
</ul>
<h4 id="limits-8"><a class="header" href="#limits-8">Limits</a></h4>
<ul>
<li>Fixed maximum string length: 50. Longer strings are truncated. This is measured in the number of bytes when the string is encoded in UTF-8.</li>
<li>Fixed maximum list length: 20 items. Additional strings are dropped.</li>
</ul>
<h3 id="set-4"><a class="header" href="#set-4"><code>set</code></a></h3>
<p>Set the metric to a specific list of strings.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

Search.engines.set(listOf(&quot;wikipedia&quot;, &quot;duck duck go&quot;))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search

Search.INSTANCE.engines().set(listOf(&quot;wikipedia&quot;, &quot;duck duck go&quot;))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Search.engines.set([&quot;wikipedia&quot;, &quot;duck duck go&quot;])
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.search.engines.set([&quot;wikipedia&quot;, &quot;duck duck go&quot;])
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics::search;

search::engines.set(vec![&quot;wikipedia&quot;.to_string(), &quot;duck duck go&quot;.to_string()])
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">Glean.search.engines.set([&quot;wikipedia&quot;, &quot;duck duck go&quot;]);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::search::engines.Set({&quot;wikipedia&quot;_ns, &quot;duck duck go&quot;_ns});
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.search.engines.set([&quot;wikipedia&quot;, &quot;duck duck go&quot;]);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-7"><a class="header" href="#recorded-errors-7">Recorded errors</a></h4>
<ul>
<li><code>invalid_overflow</code>: if the string is too long. (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</li>
<li><code>invalid_value</code>: if the list is too long.</li>
</ul>
<h4 id="limits-9"><a class="header" href="#limits-9">Limits</a></h4>
<ul>
<li>Fixed maximum string length: 50. Longer strings are truncated. This is measured in the number of bytes when the string is encoded in UTF-8.</li>
<li>Fixed maximum list length: 20 items. Additional strings are dropped.</li>
</ul>
<h2 id="testing-api-7"><a class="header" href="#testing-api-7">Testing API</a></h2>
<h3 id="testgetvalue-6"><a class="header" href="#testgetvalue-6"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given string list metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

assertEquals(listOf(&quot;Google&quot;, &quot;DuckDuckGo&quot;), Search.engines.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search

assertEquals(
    Arrays.asList(&quot;Google&quot;, &quot;DuckDuckGo&quot;),
    Search.INSTANCE.engines().testGetValue()
)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertEqual([&quot;Google&quot;, &quot;DuckDuckGo&quot;], try Search.engines.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert [&quot;Google&quot;, &quot;DuckDuckGo&quot;] == metrics.search.engines.test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics::search;

assert_eq!(
    vec![&quot;Google&quot;.to_string(), &quot;DuckDuckGo&quot;.to_string()],
    search::engines.test_get_value(None).unwrap()
);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
const engines = Glean.search.engines.testGetValue();
Assert.ok(engines.includes(&quot;wikipedia&quot;));
Assert.ok(engines.includes(&quot;duck duck go&quot;));
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_EQUAL(mozilla::glean::search::engines.TestGetValue().isOk());
nsTArray&lt;nsCString&gt; list = mozilla::glean::search::engines.TestGetValue().unwrap();
ASSERT_TRUE(list.Contains(&quot;wikipedia&quot;_ns));
ASSERT_TRUE(list.Constains(&quot;duck duck go&quot;_ns));
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
const engines = Glean.search.engines.testGetValue();
Assert.ok(engines.includes(&quot;wikipedia&quot;));
Assert.ok(engines.includes(&quot;duck duck go&quot;));
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-6"><a class="header" href="#testhasvalue-6"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given string list metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

assertTrue(Search.engines.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search

assertTrue(Search.INSTANCE.engines().testHasValue())
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssert(Search.engines.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert metrics.search.engines.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-5"><a class="header" href="#testgetnumrecordederrors-5"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given string list metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

assertEquals(1, Search.engines.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search

assertEquals(
    1, Search.INSTANCE.engines().testGetNumRecordedErrors(ErrorType.InvalidValue)
)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Were any of the values too long, and thus an error was recorded?
XCTAssertEqual(1, Search.engines.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert 1 == metrics.search.engines.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::ErrorType;
use glean_metrics::search;

assert_eq!(
    0,
    search::engines.test_get_num_recorded_errors(ErrorType::InvalidValue)
);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab" data-bug="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-7"><a class="header" href="#metric-parameters-7">Metric parameters</a></h2>
<p>Example string list metric definition:</p>
<pre><code class="language-YAML">search:
  engines:
    type: string_list
    description: &gt;
      Records the name of the enabled search engines.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters-6"><a class="header" href="#extra-metric-parameters-6">Extra metric parameters</a></h3>
<p>N/A</p>
<h2 id="data-questions-6"><a class="header" href="#data-questions-6">Data questions</a></h2>
<ul>
<li>Which search engines are enabled?</li>
</ul>
<h2 id="reference-9"><a class="header" href="#reference-9">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/StringListMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/string_list.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.StringListMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/string_list.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="timespan"><a class="header" href="#timespan">Timespan</a></h1>
<p>Timespans are used to make a measurement of how much time is spent in a particular task.</p>
<p>To measure the distribution of multiple timespans,
see <a href="reference/metrics/timing_distribution.html">Timing Distributions</a>.
To record absolute times, see <a href="reference/metrics/datetime.html">Datetimes</a>.</p>
<p>It is not recommended to use timespans in multiple threads,
since calling <code>start</code> or <code>stop</code> out of order will be recorded as an <code>invalid_state</code> error.</p>
<h2 id="recording-api-8"><a class="header" href="#recording-api-8">Recording API</a></h2>
<h3 id="start"><a class="header" href="#start"><code>start</code></a></h3>
<p>Starts tracking time. Uses an internal monotonic timer.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

fun onShowLogin() {
    Auth.loginTime.start()
    // ...
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

void onShowLogin() {
    Auth.INSTANCE.loginTime.start();
    // ...
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">func onShowLogin() {
    Auth.loginTime.start()
    // ...
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

def on_show_login():
    metrics.auth.login_time.start()
    # ...
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fog::metrics;

fn show_login() {
    metrics::auth::login_time.start();
    // ...
}
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as auth from &quot;./path/to/generated/files/auth.js&quot;;

function onShowLogin() {
    auth.loginTime.start();
    // ...
}
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;
void OnShowLogin() {
  mozilla::glean::auth::login_time.Start();
  // ...
}
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">function onShowLogin() {
  Glean.auth.loginTime.start();
  // ...
}
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-8"><a class="header" href="#recorded-errors-8">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_state</code></a>:
If the metric is already tracking time (<code>start</code> has already been called and not <code>cancel</code>ed).</li>
</ul>
<h4 id="limits-10"><a class="header" href="#limits-10">Limits</a></h4>
<ul>
<li>The maximum resolution of the elapsed duration is limited by the clock used on each platform.</li>
<li>This also determines the behavior of a timespan over sleep:
<ul>
<li>On Android, the
<a href="https://developer.android.com/reference/android/os/SystemClock.html#elapsedRealtimeNanos()"><code>SystemClock.elapsedRealtimeNanos()</code></a>
function is used, so it is limited by the accuracy and performance of that timer.
The time measurement includes time spent in sleep.</li>
<li>On iOS, the
<a href="https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/KernelProgramming/services/services.html"><code>mach_absolute_time</code></a>
function is used, so it is limited by the accuracy and performance of that timer.
The time measurement does not include time spent in sleep.</li>
<li>On Python 3.7 and later,
<a href="https://docs.python.org/3/library/time.html#time.monotonic_ns"><code>time.monotonic_ns()</code></a> is used.
On earlier versions of Python,
<a href="https://docs.python.org/3/library/time.html#time.monotonic"><code>time.monotonics()</code></a> is used,
which is not guaranteed to have nanosecond resolution.</li>
<li>On other platforms
<a href="https://docs.rs/time/0.1.40/time/fn.precise_time_ns.html"><code>time::precise_time_ns</code></a> is used,
which uses a high-resolution performance counter in nanoseconds provided by the underlying platform.</li>
</ul>
</li>
</ul>
<h3 id="stop"><a class="header" href="#stop"><code>stop</code></a></h3>
<p>Stops tracking time.
The metric value is set to the elapsed time.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

fun onLogin() {
    Auth.loginTime.stop()
    // ...
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

void onLogin() {
    Auth.INSTANCE.loginTime.stop();
    // ...
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">func onLogin() {
    Auth.loginTime.stop()
    // ...
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

def on_login():
    metrics.auth.login_time.stop()
    # ...
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fog::metrics;

fn login() {
    metrics::auth::login_time.stop();
    // ...
}
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as auth from &quot;./path/to/generated/files/auth.js&quot;;

function onLogin() {
    auth.login_time.stop();
    // ...
}
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;
void OnLogin() {
  mozilla::glean::auth::login_time.Stop();
  // ...
}
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">function onLogin() {
  Glean.auth.loginTime.stop();
  // ...
}
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-9"><a class="header" href="#recorded-errors-9">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_state</code></a>:
Calling <code>stop</code> without calling <code>start</code> first.</li>
</ul>
<h3 id="cancel"><a class="header" href="#cancel"><code>cancel</code></a></h3>
<p>Cancels a previous <code>start</code>.
No error is recorded if there was no previous <code>start</code>.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

fun onLoginCancel() {
    Auth.loginTime.cancel()
    // ...
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

void onLoginCancel() {
    Auth.INSTANCE.loginTime.cancel();
    // ...
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">func onLoginCancel() {
    Auth.loginTime.cancel()
    // ...
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

def on_login_cancel():
    metrics.auth.login_time.cancel()
    # ...
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fog::metrics;

fn login_cancel() {
    metrics::auth::login_time.cancel();
    // ...
}
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as auth from &quot;./path/to/generated/files/auth.js&quot;;

function onLoginCancel() {
    auth.login_time.cancel();
    // ...
}
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;
void OnLoginCancel() {
  mozilla::glean::auth::login_time.Cancel();
  // ...
}
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">function onLoginCancel() {
  Glean.auth.loginTime.cancel();
  // ...
}
</code></pre>
</div>
</div>
</div>
<h3 id="measure"><a class="header" href="#measure"><code>measure</code></a></h3>
<p>Some languages support convenient auto timing of blocks of code.
<code>measure</code> is treated as a <code>start</code> and <code>stop</code> pair for the purposes of error recording.
Exceptions (if present in the language) are treated as a <code>cancel</code>.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

Auth.loginTime.measure {
    // Process login flow
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth

Auth.INSTANCE.loginTime.measure() -&gt; {
    // Process login flow
    return null;
});
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Auth.loginTime.measure {
    // Process login flow
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

with metrics.auth.login_time.measure():
    # ... Do the login ...
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="setrawnanos"><a class="header" href="#setrawnanos"><code>setRawNanos</code></a></h3>
<p>Explicitly sets the timespan's value.</p>
<p>Regardless of the time unit chosen for the metric, this API expects the raw value to be in <strong>nanoseconds</strong>.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="only-use-this-if-you-have-to"><a class="header" href="#only-use-this-if-you-have-to">Only use this if you have to</a></h2>
<blockquote>
<p>This API should only be used if the code being instrumented cannot make use of
<code>start</code>, <code>stop</code>, and <code>cancel</code> or <code>measure</code>.
Time is hard, and this API can't help you with it.</p>
</blockquote>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

fun afterLogin(loginElapsedNs: Long) {
    Auth.loginTime.setRawNanos(loginElapsedNs)
    // ...
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

void afterLogin(long loginElapsedNs) {
    Auth.INSTANCE.loginTime.setRawNanos(loginElapsedNs);
    // ...
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">func afterLogin(_ loginElapsedNs: UInt64) {
    Auth.loginTime.setRawNanos(loginElapsedNs)
    // ...
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

def after_login(login_elapsed_ns):
    metrics.auth.login_time.set_raw_nanos(login_elapsed_ns)
    # ...
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fog::metrics;
use std::time::duration;

fn after_login(login_elapsed: Duration) {
    metrics::auth::login_time.set_raw(login_elapsed);
    // ...
}
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as auth from &quot;./path/to/generated/files/auth.js&quot;;

function onAfterLogin(loginElapsedNs) {
    auth.loginTime.setRawNanos(loginElapsedNs);
    // ...
}
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="these-are-different"><a class="header" href="#these-are-different">These are different</a></h2>
<blockquote>
<p>Firefox Desktop's <code>setRaw</code> uses the units specified in the metric definition.
e.g. if the Timespan's <code>time_unit</code> is <code>millisecond</code>,
then the duration parameter is a count of milliseconds.</p>
</blockquote>
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

void AfterLogin(uint32_t aDuration) {
  mozilla::glean::auth::login_time.SetRaw(aDuration);
  // ...
}
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">function afterLogin(aDuration) {
  Glean.auth.loginTime.setRaw(aDuration);
  // ...
}
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-10"><a class="header" href="#recorded-errors-10">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>:
If you attempt to record a negative elapsed duration.</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_state</code></a>:
If you call this API after calling <code>start</code> or call this API multiple times.</li>
</ul>
<h2 id="testing-api-8"><a class="header" href="#testing-api-8">Testing API</a></h2>
<h3 id="testgetvalue-7"><a class="header" href="#testgetvalue-7"><code>testGetValue</code></a></h3>
<p>Get the currently-stored value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

assertTrue(Auth.loginTime.testGetValue() &gt; 0)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

assertTrue(Auth.INSTANCE.loginTime.testGetValue() &gt; 0);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssert(try Auth.loginTime.testGetValue() &gt; 0)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert metrics.auth.login_time.test_get_value() &gt; 0
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fog::metrics;

assert!(metrics::login_time.test_get_value().unwrap() &gt; 0);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as auth from &quot;./path/to/generated/files/auth.js&quot;;

assert(await auth.loginTime.testGetValue() &gt; 0);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_TRUE(mozilla::glean::auth::login_time.TestGetValue().isOk());
ASSERT_GE(mozilla::glean::auth::login_time.TestGetValue().unwrap().value(), 0);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
Assert.ok(Glean.auth.loginTime.testGetValue() &gt; 0);
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-7"><a class="header" href="#testhasvalue-7"><code>testHasValue</code></a></h3>
<p>Test if the metric currently stores any value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

assertTrue(Auth.loginTime.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

assertTrue(Auth.INSTANCE.loginTime.testHasValue() &gt; 0);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssert(try Auth.loginTime.testHasValue() &gt; 0)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert metrics.auth.login_time.test_has_value() &gt; 0
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fog::metrics;

assert!(metrics::login_time.test_has_value().unwrap() &gt; 0);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-6"><a class="header" href="#testgetnumrecordederrors-6"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets the number of errors recorded during operations on this metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Auth

assertEquals(1, Auth.loginTime.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Auth;

assertEquals(
    1,
    Auth.INSTANCE.loginTime.testGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertEqual(1, Auth.loginTime.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert 1 == metrics.auth.local_time.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fog::metrics;

assert_eq!(1, login_time.test_get_num_recorded_errors(ErrorType::InvalidValue));
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as auth from &quot;./path/to/generated/files/auth.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;;

assert.strictEqual(
  1,
  await auth.loginTime.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-8"><a class="header" href="#metric-parameters-8">Metric parameters</a></h2>
<p>Example timespan metric definition:</p>
<pre><code class="language-YAML">auth:
  login_time:
    type: timespan
    description: &gt;
      Measures the time spent logging in.
    time_unit: millisecond
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-01-01
    data_sensitivity:
      - interaction
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters-7"><a class="header" href="#extra-metric-parameters-7">Extra metric parameters</a></h3>
<h4 id="time_unit"><a class="header" href="#time_unit"><code>time_unit</code></a></h4>
<p>Timespans have a required
<code>time_unit</code> parameter to specify the smallest unit of resolution that the timespan will record.
The allowed values for <code>time_unit</code> are:</p>
<ul>
<li><code>nanosecond</code></li>
<li><code>microsecond</code></li>
<li><code>millisecond</code></li>
<li><code>second</code></li>
<li><code>minute</code></li>
<li><code>hour</code></li>
<li><code>day</code></li>
</ul>
<p>Consider the resolution that is required by your metric,
and use the largest possible value that will provide useful information so as to not leak too much fine-grained information from the client.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="values-are-truncated"><a class="header" href="#values-are-truncated">Values are truncated</a></h2>
<blockquote>
<p>It is important to note that the value sent in the ping is truncated down to the nearest unit.
Therefore, a measurement of 500 nanoseconds will be truncated to 0 microseconds.</p>
</blockquote>
<h2 id="data-questions-7"><a class="header" href="#data-questions-7">Data questions</a></h2>
<ul>
<li>How long did it take for the user to log in?</li>
</ul>
<h2 id="reference-10"><a class="header" href="#reference-10">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/TimespanMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/timespan.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.TimespanMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_timespan.default.html">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/timespan.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="timing-distribution"><a class="header" href="#timing-distribution">Timing Distribution</a></h1>
<p>Timing distributions are used to accumulate and store time measurement, for analyzing distributions of the timing data.</p>
<p>To measure the distribution of single timespans, see <a href="reference/metrics/timespan.html">Timespans</a>.
To record absolute times, see <a href="reference/metrics/datetime.html">Datetimes</a>.</p>
<p>Timing distributions are recorded in a histogram where the buckets have an exponential distribution, specifically with 8 buckets for every power of 2.
That is, the function from a value \( x \) to a bucket index is:</p>
<p>\[ \lfloor 8 \log_2(x) \rfloor \]</p>
<p>This makes them suitable for measuring timings on a number of time scales without any configuration.</p>
<blockquote>
<p><strong>Note</strong> Check out how this bucketing algorithm would behave on the <a href="reference/metrics/timing_distribution.html#simulator">Simulator</a>.</p>
</blockquote>
<p>Timings always span the full length between <code>start</code> and <code>stopAndAccumulate</code>.
If the Glean upload is disabled when calling <code>start</code>, the timer is still started.
If the Glean upload is disabled at the time <code>stopAndAccumulate</code> is called, nothing is recorded.</p>
<p>Multiple concurrent timings in different threads may be measured at the same time.</p>
<p>Timings are always stored and sent in the payload as nanoseconds. However, the <code>time_unit</code> parameter
controls the minimum and maximum values that will recorded:</p>
<ul>
<li><code>nanosecond</code>: 1ns &lt;= x &lt;= 10 minutes</li>
<li><code>microsecond</code>: 1μs &lt;= x &lt;= ~6.94 days</li>
<li><code>millisecond</code>: 1ms &lt;= x &lt;= ~19 years</li>
</ul>
<p>Overflowing this range is considered an error and is reported through the error reporting mechanism.
Underflowing this range is not an error and the value is silently truncated to the minimum value.</p>
<p>Additionally, when a metric comes from GeckoView (the <code>geckoview_datapoint</code> parameter is present),
the <code>time_unit</code> parameter specifies the unit that the samples are in when passed to Glean.
Glean will convert all of the incoming samples to nanoseconds internally.</p>
<h2 id="recording-api-9"><a class="header" href="#recording-api-9">Recording API</a></h2>
<h3 id="start-1"><a class="header" href="#start-1"><code>start</code></a></h3>
<p>Start tracking time for the provided metric.
Multiple timers can run simultaneously.
Returns a unique <code>TimerId</code> for the new timer.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import mozilla.components.service.glean.GleanTimerId
import org.mozilla.yourApplication.GleanMetrics.Pages

val timerId : GleanTimerId

fun onPageStart(e: Event) {
    timerId = Pages.pageLoad.start()
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import mozilla.components.service.glean.GleanTimerId;
import org.mozilla.yourApplication.GleanMetrics.Pages;

GleanTimerId timerId;

void onPageStart(Event e) {
    timerId = Pages.INSTANCE.pageLoad().start();
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

var timerId : GleanTimerId

func onPageStart() {
    timerId = Pages.pageLoad.start()
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

class PageHandler:
    def __init__(self):
        self.timer_id = None

    def on_page_start(self, event):
        self.timer_id = metrics.pages.page_load.start()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics::pages;

fn on_page_start() {
    self.timer_id = pages::page_load.start();
}
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1716954"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

auto timerId = mozilla::glean::pages::page_load.Start();
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">let timerId = Glean.pages.pageLoad.start();
</code></pre>
</div>
</div>
</div>
<h3 id="stopandaccumulate"><a class="header" href="#stopandaccumulate"><code>stopAndAccumulate</code></a></h3>
<p>Stops tracking time for the provided metric and associated timer id.</p>
<p>Adds a count to the corresponding bucket in the timing distribution.
This will record an error if <code>start</code> was not called.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

fun onPageLoaded(e: Event) {
    Pages.pageLoad.stopAndAccumulate(timerId)
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Pages;

void onPageLoaded(Event e) {
    Pages.INSTANCE.pageLoad().stopAndAccumulate(timerId);
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

func onPageLoaded() {
    Pages.pageLoad.stopAndAccumulate(timerId)
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

class PageHandler:
    def on_page_loaded(self, event):
        metrics.pages.page_load.stop_and_accumulate(self.timer_id)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics::pages;

fn on_page_loaded() {
    pages::page_load.stop_and_accumulate(self.timer_id);
}
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1716954"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::pages::page_load.StopAndAccumulate(std::move(timerId));
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.pages.pageLoad.stopAndAccumulate(timerId);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-11"><a class="header" href="#recorded-errors-11">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: If recording a negative timespan.</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_state</code></a>: If a non-existing/stopped timer is stopped again.</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_overflow</code></a>: If recording a time longer than the maximum for the given unit.</li>
</ul>
<h3 id="measure-1"><a class="header" href="#measure-1"><code>measure</code></a></h3>
<p>For convenience one can measure the time of a function or block of code.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

Pages.pageLoad.measure {
    // Load a page
}
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

Pages.pageLoad.measure {
    // Load a page
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

with metrics.pages.page_load.measure():
    # Load a page
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab" data-bug="1716954"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="cancel-1"><a class="header" href="#cancel-1"><code>cancel</code></a></h3>
<p>Aborts a previous <code>start</code> call.
No error is recorded if <code>start</code> was not called.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

fun onPageError(e: Event) {
    Pages.pageLoad.cancel(timerId)
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Pages;

fun onPageError(e: Event) {
    Pages.INSTANCE.pageLoad().cancel(timerId);
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

func onPageError() {
    Pages.pageLoad.cancel(timerId)
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

class PageHandler:
    def on_page_error(self, event):
        metrics.pages.page_load.cancel(self.timer_id)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics::pages;

fn on_page_error() {
    pages::page_load.cancel(self.timer_id);
}
</code></pre>
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::pages::page_load.Cancel(std::move(timerId));
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.pages.pageLoad.cancel(timerId);
</code></pre>
</div>
</div>
</div>
<h2 id="testing-api-9"><a class="header" href="#testing-api-9">Testing API</a></h2>
<h3 id="testgetvalue-8"><a class="header" href="#testgetvalue-8"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given timing distribution metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

// Get snapshot.
val snapshot = Pages.pageLoad.testGetValue()

// Usually you don't know the exact timing values,
// but how many should have been recorded.
assertEquals(1L, snapshot.count)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Pages;

// Get snapshot.
DistributionData snapshot = pages.INSTANCE.pageLoad().testGetValue();

// Usually you don't know the exact timing values,
// but how many should have been recorded.
assertEquals(1L, snapshot.getCount());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Get snapshot.
let snapshot = try! pages.pageLoad.testGetValue()

// Usually you don't know the exact timing values,
// but how many should have been recorded.
XCTAssertEqual(1, snapshot.count)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Get snapshot.
snapshot = metrics.pages.page_load.test_get_value()

# Usually you don't know the exact timing values,
# but how many should have been recorded.
assert 1 == snapshot.count
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;
use glean_metrics::pages;

// Get snapshot
let snapshot = pages::page_load.test_get_value(None).unwrap();

// Usually you don't know the exact timing values,
// but how many should have been recorded.
assert_eq!(1, snapshot.values.len());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1716954"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have an expected values?
const data = mozilla::glean::pages::page_load.TestGetValue().value().unwrap();
ASSERT_TRUE(data.sum &gt; 0);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Assert.ok(Glean.pages.pageLoad.testGetValue().sum &gt; 0);
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-8"><a class="header" href="#testhasvalue-8"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given timing distribution metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

// Was anything recorded?
assertTrue(Pages.pageLoad.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Pages;

// Was anything recorded?
assertTrue(Pages.INSTANCE.pageLoad().testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(pages.pageLoad.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was anything recorded?
assert metrics.pages.page_load.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-7"><a class="header" href="#testgetnumrecordederrors-7"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given timing distribution metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

// Assert that no errors were recorded.
assertEquals(0, Pages.pageLoad.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Pages;

// Assert that no errors were recorded.
assertEquals(
    0,
    Pages.INSTANCE.pageLoad().testGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Assert that no errors were recorded.
XCTAssertEqual(0, pages.pageLoad.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Assert that no errors were recorded.
assert 0 == metrics.pages.page_load.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::ErrorType;
use glean_metrics::pages;

assert_eq!(
    0,
    pages::page_load.test_get_num_recorded_errors(ErrorType::InvalidValue)
);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1716954"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-9"><a class="header" href="#metric-parameters-9">Metric parameters</a></h2>
<p>Example timing distribution metric definition:</p>
<pre><code class="language-YAML">pages:
  page_load:
    type: timing_distribution
    time_unit: millisecond
    description: &gt;
      Counts how long each page takes to load
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<h3 id="extra-metric-parameters-8"><a class="header" href="#extra-metric-parameters-8">Extra metric parameters</a></h3>
<h4 id="time_unit-1"><a class="header" href="#time_unit-1"><code>time_unit</code></a></h4>
<p>Timing distributions have a required <code>time_unit</code> parameter to specify the smallest unit of resolution that the timespan will record.
The allowed values for <code>time_unit</code> are:</p>
<ul>
<li><code>nanosecond</code></li>
<li><code>microsecond</code></li>
<li><code>millisecond</code></li>
<li><code>second</code></li>
<li><code>minute</code></li>
<li><code>hour</code></li>
<li><code>day</code></li>
</ul>
<h2 id="limits-11"><a class="header" href="#limits-11">Limits</a></h2>
<ul>
<li>
<p>Timings are recorded in nanoseconds.</p>
<ul>
<li>
<p>On Android, the <a href="https://developer.android.com/reference/android/os/SystemClock.html#elapsedRealtimeNanos()"><code>SystemClock.elapsedRealtimeNanos()</code></a> function is used,
so it is limited by the accuracy and performance of that timer. The time measurement includes time spent in sleep.</p>
</li>
<li>
<p>On iOS, the <a href="https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/KernelProgramming/services/services.html"><code>mach_absolute_time</code></a> function is used,
so it is limited by the accuracy and performance of that timer.
The time measurement does not include time spent in sleep.</p>
</li>
<li>
<p>On Python 3.7 and later, <a href="https://docs.python.org/3/library/time.html#time.monotonic_ns"><code>time.monotonic_ns()</code></a> is used.
On earlier versions of Python, <a href="https://docs.python.org/3/library/time.html#time.monotonic"><code>time.monotonics()</code></a> is used,
which is not guaranteed to have nanosecond resolution.</p>
</li>
<li>
<p>In Rust, <a href="https://docs.rs/time/0.1.42/time/fn.precise_time_ns.html"><code>time::precise_time_ns()</code></a> is used.</p>
</li>
</ul>
</li>
<li>
<p>The maximum timing value that will be recorded depends on the <code>time_unit</code> parameter:</p>
<ul>
<li><code>nanosecond</code>: 1ns &lt;= x &lt;= 10 minutes</li>
<li><code>microsecond</code>: 1μs &lt;= x &lt;= ~6.94 days</li>
<li><code>millisecond</code>: 1ms &lt;= x &lt;= ~19 years
Longer times will be truncated to the maximum value and an error will be recorded.</li>
</ul>
</li>
</ul>
<h2 id="data-questions-8"><a class="header" href="#data-questions-8">Data questions</a></h2>
<ul>
<li>How long does it take a page to load?</li>
</ul>
<h2 id="reference-11"><a class="header" href="#reference-11">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/TimingDistributionMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/timing_distribution.html">Python API docs</a></li>
</ul>
<h2 id="simulator"><a class="header" href="#simulator">Simulator</a></h2>
<div id="custom-data-modal-overlay">
    <div id="custom-data-modal">
        <p>Please, insert your custom data below as a JSON array.</p>
        <textarea rows="30"></textarea>
    </div>
</div>
<div id="simulator-container">
    <div id="histogram-chart-container">
        <div id="histogram-chart"></div>
        <p id="histogram-chart-legend"><p>
    </div>
    <div id="data-options">
        <h3 id="data-options"><a class="header" href="#data-options">Data options</a></h3>
        <div class="input-group">
            <label for="normally-distributed">Generate normally distributed data</label>
            <input name="data-options" value="normally-distributed" id="normally-distributed" type="radio" />
        </div>
        <div class="input-group">
            <label for="log-normally-distributed">Generate log-normally distributed data</label>
            <input name="data-options" value="log-normally-distributed" id="log-normally-distributed" type="radio" checked />
        </div>
        <div class="input-group">
            <label for="uniformly-distributed">Generate uniformly distributed data</label>
            <input name="data-options" value="uniformly-distributed" id="uniformly-distributed" type="radio" />
        </div>
        <div class="input-group" id="custom-data-input-group">
            <label for="custom">Use custom data</label>
            <input name="data-options" value="custom" id="custom" type="radio" />
        </div>
    </div>
    <div id="histogram-props">
        <h3 id="properties"><a class="header" href="#properties">Properties</a></h3>
        <div class="input-group hide">
            <label for="kind">Histogram type</label>
            <select id="kind" name="kind" disabled>
                <option value="functional" selected>Functional</option>
            </select>
        </div>
        <div class="input-group hide">
            <label for="log-base">Log base</label>
            <input id="log-base" name="log-base" type="number" value="2" disabled />
        </div>
        <div class="input-group hide">
            <label for="buckets-per-magnitude">Buckets per magnitude</label>
            <input id="buckets-per-magnitude" name="buckets-per-magnitude" type="number" value="8" disabled />
        </div>
        <div class="input-group hide">
            <label for="maximum-value">Maximum value</label>
            <input id="maximum-value" name="maximum-value" type="number" value="600000000000" disabled />
        </div>
        <div class="input-group">
            <label for="time-unit">Time unit (<code>time_unit</code>)</label>
            <select id="time-unit" name="time-unit">
                <option value="nanoseconds" selected>Nanoseconds</option>
                <option value="microseconds">Microseconds</option>
                <option value="milliseconds">Milliseconds</option>
            </select>
        </div>
    </div>
</div>
<blockquote>
<p><strong>Note</strong> The data <em>provided</em>, is assumed to be in the configured time unit. The data <em>recorded</em>, on the other hand, is always in <strong>nanoseconds</strong>.
This means that, if the configured time unit is not <code>nanoseconds</code>, the data will be transformed before being recorded. Notice this, by using the select field above to change the time unit and see the mean of the data recorded changing.</p>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/timing_distribution.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="memory-distribution"><a class="header" href="#memory-distribution">Memory Distribution</a></h1>
<p>Memory distributions are used to accumulate and store memory sizes.</p>
<p>Memory distributions are recorded in a histogram where the buckets have an exponential distribution, specifically with 16 buckets for every power of 2.
That is, the function from a value \( x \) to a bucket index is:</p>
<p>\[ \lfloor 16 \log_2(x) \rfloor \]</p>
<p>This makes them suitable for measuring memory sizes on a number of different scales without any configuration.</p>
<blockquote>
<p><strong>Note</strong> Check out how this bucketing algorithm would behave on the <a href="reference/metrics/memory_distribution.html#simulator">Simulator</a>.</p>
</blockquote>
<h2 id="recording-api-10"><a class="header" href="#recording-api-10">Recording API</a></h2>
<h3 id="accumulate"><a class="header" href="#accumulate"><code>accumulate</code></a></h3>
<p>Accumulates the provided sample in the metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Memory

fun allocateMemory(nbytes: Int) {
    // ...
    Memory.heapAllocated.accumulate(nbytes / 1024)
}
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Memory;

fun allocateMemory(nbytes: Int) {
    // ...
    Memory.INSTANCE.heapAllocated().accumulate(nbytes / 1024);
}
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">import Glean

func allocateMemory(nbytes: UInt64) {
    // ...
    Memory.heapAllocated.accumulate(nbytes / 1024)
}
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

def allocate_memory(nbytes):
    # ...
    metrics.memory.heap_allocated.accumulate(nbytes / 1024)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics::memory;

fn allocate_memory(bytes: u64) {
    // ...
    memory::heap_allocated.accumulate(bytes / 1024);
}
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab" data-bug="1716952"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::memory::heap_allocated.Accumulate(bytes / 1024);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.memory.heapAllocated.accumulate(bytes / 1024);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-12"><a class="header" href="#recorded-errors-12">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: If recording a negative memory size.</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: If recording a size larger than 1 TB.</li>
</ul>
<h2 id="testing-api-10"><a class="header" href="#testing-api-10">Testing API</a></h2>
<h3 id="testgetvalue-9"><a class="header" href="#testgetvalue-9"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given memory distribution metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Memory

// Get snapshot
val snapshot = Memory.heapAllocated.testGetValue()

// Does the sum have the expected value?
assertEquals(11, snapshot.sum)

// Usually you don't know the exact memory values,
// but how many should have been recorded.
assertEquals(2L, snapshot.count)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Memory;

// Get snapshot
val snapshot = Memory.INSTANCE.heapAllocated().testGetValue();

// Does the sum have the expected value?
assertEquals(11, snapshot.sum);

// Usually you don't know the exact memory values,
// but how many should have been recorded.
assertEquals(2L, snapshot.getCount());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Get snapshot
let snapshot = try! Memory.heapAllocated.testGetValue()

// Does the sum have the expected value?
XCTAssertEqual(11, snapshot.sum)

// Usually you don't know the exact memory values,
// but how many should have been recorded.
XCTAssertEqual(2, snapshot.count)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Get snapshot.
snapshot = metrics.memory.heap_allocated.test_get_value()

# Does the sum have the expected value?
assert 11 == snapshot.sum

# Usually you don't know the exact memory values,
# but how many should have been recorded.
assert 2 == snapshot.count
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;
use glean_metrics::memory;

// Get snapshot
let snapshot = memory::heap_allocated.test_get_value(None).unwrap();

// Does the sum have the expected value?
assert_eq!(11, snapshot.sum);

// Usually you don't know the exact timing values,
// but how many should have been recorded.
assert_eq!(2, snapshot.values.len());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab"  data-bug="1716952"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Does it have an expected values?
const data = mozilla::glean::memory::heap_allocated.TestGetValue().value().unwrap()
ASSERT_EQ(11 * 1024, data.sum);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">const data = Glean.memory.heapAllocated.testGetValue();
Assert.equal(11 * 1024, data.sum);
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-9"><a class="header" href="#testhasvalue-9"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given memory distribution metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Pages

// Get snapshot
assertTrue(Memory.heapAllocated.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Pages;

// Was anything recorded?
assertTrue(Memory.INSTANCE.heapAllocated().testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Memory.heapAllocated.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was anything recorded?
assert metrics.memory.head_allocated.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-8"><a class="header" href="#testgetnumrecordederrors-8"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given memory distribution metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Memory

// Did this record a negative value?
assertEquals(
    0,
    Memory.heapAllocated.testGetNumRecordedErrors(ErrorType.InvalidValue)
)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Memory;

// Assert that no errors were recorded.
assertEquals(
    0,
    Memory.INSTANCE.heapAllocated().testGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Did this record a negative value?
XCTAssertEqual(0, Memory.heapAllocated.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Did this record a negative value?
assert 0 == metrics.memory.heap_allocated.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::ErrorType;
use glean_metrics::pages;

assert_eq!(
    0,
    pages::page_load.test_get_num_recorded_errors(ErrorType::InvalidValue)
);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab"  data-bug="1716952"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-10"><a class="header" href="#metric-parameters-10">Metric parameters</a></h2>
<p>Example memory distribution metric definition:</p>
<pre><code class="language-YAML">memory:
  heap_allocated:
    type: memory_distribution
    memory_unit: kilobyte
    description: &gt;
      The heap memory allocated
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<h3 id="extra-metric-parameters-9"><a class="header" href="#extra-metric-parameters-9">Extra metric parameters</a></h3>
<h4 id="memory_unit"><a class="header" href="#memory_unit"><code>memory_unit</code></a></h4>
<p>Memory distributions have a required <code>memory_unit</code> parameter,
which specifies the unit the incoming memory size values are recorded in.
The allowed values for <code>time_unit</code> are:</p>
<ul>
<li><code>byte</code></li>
<li><code>kilobyte</code> (<code>= 2^10 = 1,024 bytes</code>)</li>
<li><code>megabyte</code> (<code>= 2^20 = 1,048,576 bytes</code>)</li>
<li><code>gigabyte</code> (<code>= 2^30 = 1,073,741,824 bytes</code>)</li>
</ul>
<h2 id="limits-12"><a class="header" href="#limits-12">Limits</a></h2>
<ul>
<li>The maximum memory size that can be recorded is 1 Terabyte (2<sup>40</sup> bytes).
Larger sizes will be truncated to 1 Terabyte.</li>
</ul>
<h2 id="data-questions-9"><a class="header" href="#data-questions-9">Data questions</a></h2>
<ul>
<li>What is the distribution of the size of heap allocations?</li>
</ul>
<h2 id="reference-12"><a class="header" href="#reference-12">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/MemoryDistributionMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/timing_distribution.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.MemoryDistributionMetric.html">Rust API docs</a></li>
</ul>
<h2 id="simulator-1"><a class="header" href="#simulator-1">Simulator</a></h2>
<div id="custom-data-modal-overlay">
    <div id="custom-data-modal">
        <p>Please, insert your custom data below as a JSON array.</p>
        <textarea rows="30"></textarea>
    </div>
</div>
<div id="simulator-container">
    <div id="histogram-chart-container">
        <div id="histogram-chart"></div>
        <p id="histogram-chart-legend"><p>
    </div>
    <div id="data-options">
        <h3 id="data-options-1"><a class="header" href="#data-options-1">Data options</a></h3>
        <div class="input-group">
            <label for="normally-distributed">Generate normally distributed data</label>
            <input name="data-options" value="normally-distributed" id="normally-distributed" type="radio" />
        </div>
        <div class="input-group">
            <label for="log-normally-distributed">Generate log-normally distributed data</label>
            <input name="data-options" value="log-normally-distributed" id="log-normally-distributed" type="radio" checked />
        </div>
        <div class="input-group">
            <label for="uniformly-distributed">Generate uniformly distributed data</label>
            <input name="data-options" value="uniformly-distributed" id="uniformly-distributed" type="radio" />
        </div>
        <div class="input-group" id="custom-data-input-group">
            <label for="custom">Use custom data</label>
            <input name="data-options" value="custom" id="custom" type="radio" />
        </div>
    </div>
    <div id="histogram-props">
        <h3 id="properties-1"><a class="header" href="#properties-1">Properties</a></h3>
        <div class="input-group hide">
            <label for="kind">Histogram type</label>
            <select id="kind" name="kind" disabled>
                <option value="functional" selected>Functional</option>
            </select>
        </div>
        <div class="input-group hide">
            <label for="log-base">Log base</label>
            <input id="log-base" name="log-base" type="number" value="2" disabled />
        </div>
        <div class="input-group hide">
            <label for="buckets-per-magnitude">Buckets per magnitude</label>
            <input id="buckets-per-magnitude" name="buckets-per-magnitude" type="number" value="16" disabled />
        </div>
        <div class="input-group hide">
            <label for="maximum-value">Maximum value</label>
            <input id="maximum-value" name="maximum-value" type="number" value="1099511627776" disabled />
        </div>
        <div class="input-group">
            <label for="memory-unit">Memory unit (<code>memory_unit</code>)</label>
            <select id="memory-unit" name="memory-unit">
                <option value="byte" selected>Byte</option>
                <option value="kilobyte">Kilobyte</option>
                <option value="megabyte">Megabyte</option>
                <option value="gigabyte">Gigabyte</option>
            </select>
        </div>
    </div>
</div>
<blockquote>
<p><strong>Note</strong> The data <em>provided</em>, is assumed to be in the configured memory unit. The data <em>recorded</em>, on the other hand, is always in <strong>bytes</strong>.
This means that, if the configured memory unit is not <code>byte</code>, the data will be transformed before being recorded. Notice this, by using the select field above to change the memory unit and see the mean of the data recorded changing.</p>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/memory_distribution.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="uuid"><a class="header" href="#uuid">UUID</a></h1>
<p>UUIDs metrics are used to record values that uniquely identify some entity, such as a client id.</p>
<h2 id="recording-api-11"><a class="header" href="#recording-api-11">Recording API</a></h2>
<h3 id="generateandset"><a class="header" href="#generateandset"><code>generateAndSet</code></a></h3>
<p>Sets a UUID metric to a randomly generated <a href="https://datatracker.ietf.org/doc/html/rfc4122">UUID</a> value (UUID v4) .</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.User

// Generate a new UUID and record it
User.clientId.generateAndSet()
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.User;

// Generate a new UUID and record it
User.INSTANCE.clientId.generateAndSet();
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">// Generate a new UUID and record it
User.clientId.generateAndSet()
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Generate a new UUID and record it
metrics.user.client_id.generate_and_set()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;
use uuid::Uuid;

// Generate a new UUID and record it
user::client_id.generate_and_set();
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as user from &quot;./path/to/generated/files/user.js&quot;;

user.clientId.generateAndSet();
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Generate a new UUID and record it.
mozilla::glean::user::client_id.GenerateAndSet();
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// Generate a new UUID and record it.
Glean.user.clientId.generateAndSet();
</code></pre>
</div>
</div>
</div>
<h3 id="set-5"><a class="header" href="#set-5"><code>set</code></a></h3>
<p>Sets a UUID metric to a specific value.
Accepts any UUID version.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.User

// Set a UUID explicitly
User.clientId.set(UUID.randomUUID())  // Set a UUID explicitly
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.User;

// Set a UUID explicitly
User.INSTANCE.clientId.set(UUID.randomUUID());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">User.clientId.set(UUID())  // Set a UUID explicitly
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">import uuid

from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Set a UUID explicitly
metrics.user.client_id.set(uuid.uuid4())
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;
use uuid::Uuid;

// Set a UUID explicitly
user::client_id.set(Uuid::new_v4());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as user from &quot;./path/to/generated/files/user.js&quot;;

const uuid = &quot;decafdec-afde-cafd-ecaf-decafdecafde&quot;;
user.clientId.set(uuid);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Set a specific value.
nsCString kUuid(&quot;decafdec-afde-cafd-ecaf-decafdecafde&quot;);
mozilla::glean::user::client_id.Set(kUuid);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// Set a specific value.
const uuid = &quot;decafdec-afde-cafd-ecaf-decafdecafde&quot;;
Glean.user.clientId.set(uuid);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-13"><a class="header" href="#recorded-errors-13">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: if the value is set to a string that is not a UUID (only applies for dynamically-typed languages, such as Python).</li>
</ul>
<h2 id="testing-api-11"><a class="header" href="#testing-api-11">Testing API</a></h2>
<h3 id="testgetvalue-10"><a class="header" href="#testgetvalue-10"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given UUID metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.User

// Was it the expected value?
assertEquals(uuid, User.clientId.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.User;

// Was it the expected value?
assertEquals(uuid, User.INSTANCE.clientId.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was it the expected value?
XCTAssertEqual(uuid, try User.clientId.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was it the expected value?
assert uuid == metrics.user.client_id.test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;
use uuid::Uuid;

let u = Uuid::new_v4();
// Does it have the expected value?
assert_eq!(u, user::client_id.test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as user from &quot;./path/to/generated/files/user.js&quot;;

const uuid = &quot;decafdec-afde-cafd-ecaf-decafdecafde&quot;;
assert(uuid, await user.clientId.testGetValue());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

// Is it clear of errors?
ASSERT_TRUE(mozilla::glean::user::client_id.TestGetValue().isOk());
// Does it have an expected values?
ASSERT_STREQ(kUuid.get(), mozilla::glean::user::client_id.TestGetValue().unwrap().value().get());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">const uuid = &quot;decafdec-afde-cafd-ecaf-decafdecafde&quot;;
// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
Assert.equal(Glean.user.clientId.testGetValue(), uuid);
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-10"><a class="header" href="#testhasvalue-10"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given UUID metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.User

// Was anything recorded?
assertTrue(User.clientId.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.User;

// Was anything recorded?
assertTrue(User.INSTANCE.clientId.testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(User.clientId.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was anything recorded?
assert metrics.user.client_id.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-9"><a class="header" href="#testgetnumrecordederrors-9"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given UUID metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.User

assertEquals(
    1, User.clientId.testGetNumRecordedErrors(ErrorType.InvalidValue)
)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.User;

assertEquals(
    1, User.INSTANCE.clientId.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">XCTAssertEqual(1, User.clientId.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

from glean.testing import ErrorType

assert 1 == metrics.user.client_id.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

assert_eq!(
  1,
  user::client_id.test_get_num_recorded_errors(
    ErrorType::InvalidValue
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as user from &quot;./path/to/generated/files/user.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

// Was the string truncated, and an error reported?
assert.strictEqual(
  1,
  await user.clientId.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-11"><a class="header" href="#metric-parameters-11">Metric Parameters</a></h2>
<p>You first need to add an entry for it to the <code>metrics.yaml</code> file:</p>
<pre><code class="language-YAML">user:
  client_id:
    type: uuid
    description: &gt;
      A unique identifier for the client's profile
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters-10"><a class="header" href="#extra-metric-parameters-10">Extra metric parameters</a></h3>
<p>N/A</p>
<h2 id="data-questions-10"><a class="header" href="#data-questions-10">Data questions</a></h2>
<ul>
<li>A unique identifier for the client.</li>
</ul>
<h2 id="reference-13"><a class="header" href="#reference-13">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/UuidMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/uuid.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/uuid/struct.UuidMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_uuid.default.html#set">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/uuid.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="url-1"><a class="header" href="#url-1">URL</a></h1>
<p>URL metrics allow recording URL-like<sup class="footnote-reference"><a href="#1">1</a></sup> strings.</p>
<p>This metric type does not support recording <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">data URLs</a> - please get in contact with the Glean team if you're missing a type.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="important-8"><a class="header" href="#important-8">Important</a></h2>
<blockquote>
<p>Be careful using arbitrary URLs and make sure they can't accidentally contain identifying data
(like directory paths, user input or credentials).</p>
</blockquote>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>The Glean SDKs specifically do not validate if a URL is fully spec compliant,
all the validations performed are the ones listed in the
<a href="reference/metrics/url.html#recorded-errors">&quot;Recorded errors&quot;</a> section of this page.</p>
</div>
<h2 id="recording-api-12"><a class="header" href="#recording-api-12">Recording API</a></h2>
<h3 id="set-6"><a class="header" href="#set-6"><code>set</code></a></h3>
<p>Set a URL metric to a specific string value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

Search.template.set(&quot;https://mysearchengine.com/&quot;)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search;

Search.INSTANCE.template.set(&quot;https://mysearchengine.com/&quot;);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Search.template.set(&quot;https://mysearchengine.com&quot;)

// Swift's URL type is supported
let url = URL(string: &quot;https://mysearchengine.com&quot;)!
Search.template.set(url: url)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.search.template.set(&quot;https://mysearchengine.com/&quot;)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

search::template.set(&quot;https://mysearchengine.com/&quot;);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as search from &quot;./path/to/generated/files/search.js&quot;;

search.template.set(&quot;https://mysearchengine.com/&quot;);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="seturl"><a class="header" href="#seturl"><code>setUrl</code></a></h3>
<p>Set a URL metric to a specific URL value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as search from &quot;./path/to/generated/files/search.js&quot;;

search.template.setUrl(new URL(&quot;https://mysearchengine.com/&quot;));
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h4 id="recorded-errors-14"><a class="header" href="#recorded-errors-14">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>:
<ul>
<li>If the URL passed does not start with a <a href="https://url.spec.whatwg.org/#url-representation">scheme</a> followed by a <code>:</code> character.</li>
<li>If the URL passed uses the <code>data:</code> protocol.</li>
</ul>
</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_overflow</code></a>: If the URL passed is longer than 2048 characters (before encoding).</li>
</ul>
<h4 id="limits-13"><a class="header" href="#limits-13">Limits</a></h4>
<ul>
<li>Fixed maximum URL length: 2048. Longer URLs are dropped.</li>
</ul>
<h2 id="testing-api-12"><a class="header" href="#testing-api-12">Testing API</a></h2>
<h3 id="testgetvalue-11"><a class="header" href="#testgetvalue-11"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given URL metric as a (unencoded) string.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

assertEquals(&quot;https://mysearchengine.com/&quot;, Search.template.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search

assertEquals(&quot;https://mysearchengine.com/&quot;, Search.INSTANCE.template.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertEqual(&quot;https://mysearchengine.com/&quot;, try Search.template.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert &quot;https://mysearchengine.com/&quot; == metrics.search.template.test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

assert_eq!(&quot;https://mysearchengine.com/&quot;, search::template.test_get_value(None).unwrap());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as search from &quot;./path/to/generated/files/search.js&quot;;

assert.strictEqual(&quot;https://mysearchengine.com/&quot;, await search.template.testGetValue());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testhasvalue-11"><a class="header" href="#testhasvalue-11"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given UUID metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

assertTrue(Search.template.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search

assertTrue(Search.INSTANCE.template.testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssert(try Search.template.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert metrics.search.template.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-10"><a class="header" href="#testgetnumrecordederrors-10"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Search

assertEquals(0, Search.template.testGetNumRecordedErrors(ErrorType.InvalidValue))

assertEquals(0, Search.template.testGetNumRecordedErrors(ErrorType.InvalidOverflow))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Search;

assertEquals(
    0,
    Search.INSTANCE.template.testGetNumRecordedErrors(
        ErrorType.InvalidValue
    )
);

assertEquals(
    0,
    Search.INSTANCE.template.testGetNumRecordedErrors(
        ErrorType.InvalidOverflow
    )
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertEqual(0, Search.template.testGetNumRecordedErrors(.invalidValue))
XCTAssertEqual(0, Search.template.testGetNumRecordedErrors(.invalidOverflow))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert 0 == metrics.search.template.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)

assert 0 == metrics.search.template.test_get_num_recorded_errors(
    ErrorType.INVALID_OVERFLOW
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

assert_eq!(
  0,
  search::template.test_get_num_recorded_errors(
    ErrorType::InvalidValue
  )
);

assert_eq!(
  0,
  search::template.test_get_num_recorded_errors(
    ErrorType::InvalidOverflow
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as search from &quot;./path/to/generated/files/search.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

assert.strictEqual(
  0,
  await search.template.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
assert.strictEqual(
  0,
  await search.template.testGetNumRecordedErrors(ErrorType.InvalidOverflow)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-12"><a class="header" href="#metric-parameters-12">Metric parameters</a></h2>
<p>Example URL metric definition:</p>
<pre><code class="language-yaml">search:
  template:
    type: url
    description: &gt;
      The base URL used to build the search query for the search engine.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
    data_sensitivity:
      - web_activity
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the metrics <a href="reference/metrics/../yaml/index.html">YAML format</a> reference page.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="note-on-data_sensitivity-of-url-metrics"><a class="header" href="#note-on-data_sensitivity-of-url-metrics">Note on <code>data_sensitivity</code> of URL metrics</a></h2>
<blockquote>
<p>URL metrics can only either be on categories 3 or 4, namely
<a href="reference/metrics/../yaml/metrics.html#category-3-web-activity-data-web_activity">&quot;Web activity data&quot;</a> or
<a href="reference/metrics/../yaml/metrics.html#category-4-highly-sensitive-data-highly_sensitive">&quot;Highly sensitive data&quot;</a>.</p>
</blockquote>
<h3 id="extra-metric-parameters-11"><a class="header" href="#extra-metric-parameters-11">Extra metric parameters</a></h3>
<p>N/A</p>
<h2 id="data-questions-11"><a class="header" href="#data-questions-11">Data questions</a></h2>
<ul>
<li>What is the base URL used to build the search query for the search engine?</li>
</ul>
<h2 id="reference-14"><a class="header" href="#reference-14">Reference</a></h2>
<ul>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_url.default.html">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/url.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="datetime"><a class="header" href="#datetime">Datetime</a></h1>
<p>Datetimes are used to record an absolute date and time,
for example the date and time that the application was first run.</p>
<p>The device's offset from UTC is recorded and sent with the Datetime value in the ping.</p>
<p>To record a single elapsed time, see <a href="reference/metrics/timespan.html">Timespan</a>.
To measure the distribution of multiple timespans, see <a href="reference/metrics/timing_distribution.html">Timing Distributions</a>.</p>
<h2 id="recording-api-13"><a class="header" href="#recording-api-13">Recording API</a></h2>
<h3 id="set-7"><a class="header" href="#set-7"><code>set</code></a></h3>
<p>Sets a datetime metric to a specific date value. Defaults to now.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Install

Install.firstRun.set() // Records &quot;now&quot;
Install.firstRun.set(Calendar(2019, 3, 25)) // Records a custom datetime
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Install;

Install.INSTANCE.firstRun.set(); // Records &quot;now&quot;
Install.INSTANCE.firstRun.set(Calendar(2019, 3, 25)); // Records a custom datetime
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Install.firstRun.set() // Records &quot;now&quot;
let dateComponents = DateComponents(
                        calendar: Calendar.current,
                        year: 2004, month: 12, day: 9, hour: 8, minute: 3, second: 29
                     )
Install.firstRun.set(dateComponents.date!) // Records a custom datetime
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">import datetime

from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.install.first_run.set() # Records &quot;now&quot;
metrics.install.first_run.set(datetime.datetime(2019, 3, 25)) # Records a custom datetime
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics;

use chrono::{FixedOffset, TimeZone};

install::first_run.set(None); // Records &quot;now&quot;
let custom_date = FixedOffset::east(0).ymd(2019, 3, 25).and_hms(0, 0, 0);
install::first_run.set(Some(custom_date)); // Records a custom datetime
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as install from &quot;./path/to/generated/files/install.js&quot;;

install.firstRun.set(); // Records &quot;now&quot;
install.firstRun.set(new Date(&quot;March 25, 2019 00:00:00&quot;)); // Records a custom datetime
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

PRExplodedTime date = {0, 35, 10, 12, 6, 10, 2020, 0, 0, {5 * 60 * 60, 0}};
mozilla::glean::install::first_run.Set(&amp;date);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">const value = new Date(&quot;2020-06-11T12:00:00&quot;);
Glean.install.firstRun.set(value.getTime() * 1000);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-15"><a class="header" href="#recorded-errors-15">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: Setting the date time to an invalid value.</li>
</ul>
<h2 id="testing-api-13"><a class="header" href="#testing-api-13">Testing API</a></h2>
<h3 id="testgetvalue-12"><a class="header" href="#testgetvalue-12"><code>testGetValue</code></a></h3>
<p>Get the recorded value for a given datetime metric as a language-specific Date object.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Install

assertEquals(Install.firstRun.testGetValue(), Date(2019, 3, 25))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Install;

assertEquals(Install.INSTANCE.firstRun.testGetValue(), Date(2019, 3, 25));
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

let expectedDate = DateComponents(
                      calendar: Calendar.current,
                      year: 2004, month: 12, day: 9, hour: 8, minute: 3, second: 29
                   )
XCTAssertEqual(expectedDate.date!, try Install.firstRun.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">import datetime

from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

value = datetime.datetime(1993, 2, 23, 5, 43, tzinfo=datetime.timezone.utc)
assert value == metrics.install.first_run.test_get_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics;

use chrono::{FixedOffset, TimeZone};

let expected_date = FixedOffset::east(0).ymd(2019, 3, 25).and_hms(0, 0, 0);
assert_eq!(expected_date, metrics.install.first_run.test_get_value(None));
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as install from &quot;./path/to/generated/files/install.js&quot;;

const expectedDate = new Date(&quot;March 25, 2019 00:00:00&quot;);
assert.deepStrictEqual(expectedDate, await install.firstRun.testGetValue());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

PRExplodedTime date{0, 35, 10, 12, 6, 10, 2020, 0, 0, {5 * 60 * 60, 0}};
ASSERT_TRUE(mozilla::glean::install::first_run.TestGetValue().isOk());
ASSERT_EQ(
    0,
    std::memcmp(
        &amp;date,
        mozilla::glean::install::first_run.TestGetValue().unwrap().ptr(),
        sizeof(date)));
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">const value = new Date(&quot;2020-06-11T12:00:00&quot;);
// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
Assert.equal(Glean.install.firstRun.testGetValue().getTime(), value.getTime());
</code></pre>
</div>
</div>
</div>
<h3 id="testgetvalueasstring"><a class="header" href="#testgetvalueasstring"><code>testGetValueAsString</code></a></h3>
<p>Get the recorded value for a given datetime metric as an <a href="https://en.wikipedia.org/wiki/ISO_8601#Dates">ISO Date String</a>.</p>
<p>The returned string will be truncated to the metric's <a href="reference/metrics/datetime.html#time_unit">time unit</a>
and will include the timezone offset from UTC, e.g. <code>2019-03-25-05:00</code>
(in this example, <code>time_unit</code> is <code>day</code>).</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Install

assertEquals(&quot;2019-03-25-05:00&quot;, Install.firstRun.testGetValueAsString())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Install;

assertEquals(&quot;2019-03-25-05:00&quot;, Install.INSTANCE.firstRun.testGetValueAsString());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

assertEquals(&quot;2019-03-25-05:00&quot;, try Install.firstRun.testGetValueAsString())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert &quot;2019-03-25-05:00&quot; == metrics.install.first_run.test_get_value_as_str()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as install from &quot;./path/to/generated/files/install.js&quot;;

assert.strictEqual(&quot;2019-03-25-05:00&quot;, await install.firstRun.testGetValueAsString());
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testhasvalue-12"><a class="header" href="#testhasvalue-12"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given datetime metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Install

assertTrue(Install.firstRun.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Install;

assertTrue(Install.INSTANCE.firstRun.testHasValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssert(Install.firstRun.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert metrics.install.first_run.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-11"><a class="header" href="#testgetnumrecordederrors-11"><code>testGetNumRecordedErrors</code></a></h3>
<p>Get number of errors recorded for a given datetime metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import mozilla.telemetry.glean.testing.ErrorType
import org.mozilla.yourApplication.GleanMetrics.Install

assertEquals(0, Install.firstRun.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import mozilla.telemetry.glean.testing.ErrorType
import org.mozilla.yourApplication.GleanMetrics.Install;

assertEquals(0, Install.INSTANCE.firstRun.testGetNumRecordedErrors(ErrorType.InvalidValue));
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

XCTAssertEqual(0, Install.firstRun.getNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert 0 == metrics.install.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;
use glean_metrics;

assert_eq!(0, install::first_run.test_get_num_recorded_errors(
    ErrorType::InvalidValue
));
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as install from &quot;./path/to/generated/files/install.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

assert.strictEqual(
  1,
  await install.firstRun.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-13"><a class="header" href="#metric-parameters-13">Metric parameters</a></h2>
<p>Example datetime metric definition:</p>
<pre><code class="language-yaml">install:
  first_run:
    type: datetime
    time_unit: day
    description: &gt;
      Records the date when the application was first run
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters-12"><a class="header" href="#extra-metric-parameters-12">Extra metric parameters</a></h3>
<h4 id="time_unit-2"><a class="header" href="#time_unit-2"><code>time_unit</code></a></h4>
<p>Datetimes have a required <code>time_unit</code> parameter to specify the smallest unit of resolution that the metric will record. The allowed values for <code>time_unit</code> are:</p>
<ul>
<li><code>nanosecond</code></li>
<li><code>microsecond</code></li>
<li><code>millisecond</code></li>
<li><code>second</code></li>
<li><code>minute</code></li>
<li><code>hour</code></li>
<li><code>day</code></li>
</ul>
<p>Carefully consider the required resolution for recording your metric, and choose the coarsest resolution possible.</p>
<h2 id="data-questions-12"><a class="header" href="#data-questions-12">Data questions</a></h2>
<ul>
<li>When did the user first run the application?</li>
</ul>
<h2 id="reference-15"><a class="header" href="#reference-15">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/DatetimeMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/datetime.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/struct.DatetimeMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_datetime.default.html">Datetime API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/datetime.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="events"><a class="header" href="#events">Events</a></h1>
<p>Events allow recording of e.g. individual occurrences of user actions,
say every time a view was open and from where.</p>
<p>Each event contains the following data:</p>
<ul>
<li>A timestamp, in milliseconds. The first event in any ping always has a value of <code>0</code>, and subsequent event timestamps are relative to it.
<ul>
<li>If sending events in custom pings, see <a href="reference/metrics/../../user/pings/custom.html#the-gleanrestarted-event">note</a> on event timestamp calculation throughout restarts.</li>
</ul>
</li>
<li>The name of the event.</li>
<li>A set of key-value pairs, where the keys are predefined in the <code>extra_keys</code> metric parameter, and the values are strings.</li>
</ul>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="are-you-sure-you-need-an-event-metric"><a class="header" href="#are-you-sure-you-need-an-event-metric">Are you sure you need an event metric?</a></h2>
<blockquote>
<p>Events are best-suited to measuring user behavior, where the frequency of events is relatively low and the order of the events matters. Therefore, events should be the default choice for most user-behavior telemetry.</p>
<p>For other types of telemetry (e.g. performance or stability), events may be too expensive metric type to record, transmit, store and, most importantly, analyze. In those cases, consider lighter metrics, such as <a href="reference/metrics/counter.html">counters</a>.</p>
<p>When in doubt, refer to the
<a href="reference/metrics/../../user/metrics/adding-new-metrics.html">metric type choosing guide</a>.</p>
</blockquote>
<h2 id="recording-api-14"><a class="header" href="#recording-api-14">Recording API</a></h2>
<h3 id="recordobject"><a class="header" href="#recordobject"><code>record(object)</code></a></h3>
<p><em>Added in: <a href="reference/metrics/../../appendix/changelog/sdk.html#v3800-2021-05-12">v38.0.0</a></em></p>
<p>Record a new event, with optional typed extra values.
This requires <code>type</code> annotations in the definition.
See <a href="reference/metrics/event.html#extra-metric-parameters">Extra metrics parameters</a>.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Extra</code> added.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views

Views.loginOpened.record(Views.loginOpenedExtra(sourceOfLogin = &quot;toolbar&quot;))
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Extra</code> added.</p>
<pre><code class="language-Swift">Views.loginOpened.record(LoginOpenedExtra(sourceOfLogin: &quot;toolbar&quot;))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>_extra</code> added.</p>
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.views.login_opened.record(LoginOpenedExtra(sourceOfLogin=&quot;toolbar&quot;))
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Keys</code> added.</p>
<pre><code class="language-Rust">use metrics::views::{self, LoginOpenedExtra};

let extra = LoginOpenedExtra { source_of_login: Some(&quot;toolbar&quot;.to_string()) };
views::login_opened.record(extra);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as views from &quot;./path/to/generated/files/views.js&quot;;

views.loginOpened.record({ sourceOfLogin: &quot;toolbar&quot; });
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

using mozilla::glean::views::LoginOpenedExtra;
LoginOpenedExtra extra = { .source_of_login = Some(&quot;value&quot;_ns) };
mozilla::glean::views::login_opened.Record(std::move(extra))
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">const extra = { sourceOfLogin: &quot;toolbar&quot; };
Glean.views.loginOpened.record(extra);
</code></pre>
</div>
</div>
</div>
<h3 id="recordmap-deprecated"><a class="header" href="#recordmap-deprecated"><code>record(map)</code> (<em>deprecated</em>)</a></h3>
<p><em>Deprecated in: <a href="reference/metrics/../../appendix/changelog/sdk.html#v3800-2021-05-12">v38.0.0</a></em></p>
<!-- FIXME: Update anchor when v38.0.0 is actually released -->
<p>Record a new event, with optional extra values.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="deprecation-notice"><a class="header" href="#deprecation-notice">Deprecation notice</a></h5>
<blockquote>
<p>This API is used in v38.0.0 if an event has no <code>type</code> annotations in the definition.
See <a href="reference/metrics/event.html#extra-metric-parameters">Extra metrics parameters</a>.</p>
<p>In future versions extra values will default to a <code>string</code> type and this API will be removed.<br />
In Rust and Firefox Desktop this API is not supported.</p>
</blockquote>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Keys</code> added.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views

Views.loginOpened.record(mapOf(Views.loginOpenedKeys.sourceOfLogin to &quot;toolbar&quot;))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Views;

Views.INSTANCE.loginOpened.record();
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>Keys</code> added.</p>
<pre><code class="language-Swift">Views.loginOpened.record(extra: [.sourceOfLogin: &quot;toolbar&quot;])
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Note that an <code>enum</code> has been generated for handling the <code>extra_keys</code>: it has the same name as the event metric, with <code>_keys</code> added.</p>
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.views.login_opened.record(
    {
        metrics.views.login_opened_keys.SOURCE_OF_LOGIN: &quot;toolbar&quot;
    }
)
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as views from &quot;./path/to/generated/files/views.js&quot;;

views.loginOpened.record({ sourceOfLogin: &quot;toolbar&quot; });
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h4 id="recorded-errors-16"><a class="header" href="#recorded-errors-16">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_overflow</code></a>: if any of the values in the <code>extras</code> object are greater than 50 bytes in length.  (Prior to Glean 31.5.0, this recorded an <code>invalid_value</code>).</li>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: if there is an attempt to record to an extra key which is not allowed i.e. an extra key that has not been listed in the YAML registry file.</li>
</ul>
<h2 id="testing-api-14"><a class="header" href="#testing-api-14">Testing API</a></h2>
<h3 id="testgetvalue-13"><a class="header" href="#testgetvalue-13"><code>testGetValue</code></a></h3>
<p>Get the list of recorded events.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views

val snapshot = Views.loginOpened.testGetValue()
assertEquals(2, snapshot.size)
val first = snapshot.single()
assertEquals(&quot;login_opened&quot;, first.name)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Views

assertEquals(Views.INSTANCE.loginOpened.testGetValue().size)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-swift">@testable import Glean

val snapshot = try! Views.loginOpened.testGetValue()
XCTAssertEqual(2, snapshot.size)
val first = snapshot[0]
XCTAssertEqual(&quot;login_opened&quot;, first.name)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

snapshot = metrics.views.login_opened.test_get_value()
assert 2 == len(snapshot)
first = snapshot[0]
assert &quot;login_opened&quot; == first.name
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use metrics::views;

var snapshot = views::login_opened.test_get_value(None).unwrap();
assert_eq!(2, snapshot.len());
let first = &amp;snapshot[0];
assert_eq!(&quot;login_opened&quot;, first.name);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as views from &quot;./path/to/generated/files/views.js&quot;;

const snapshot = await views.loginOpened.testGetValue();
assert.strictEqual(2, snapshot.length);
const first = snapshot[0]
assert.strictEqual(&quot;login_opened&quot;, first.name)
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-c++">#include &quot;mozilla/glean/GleanMetrics.h&quot;

auto optEvents = mozilla::glean::views::login_opened.TestGetValue();
auto events = optEvents.extract();
ASSERT_EQ(2UL, events.Length());
ASSERT_STREQ(&quot;login_opened&quot;, events[0].mName.get());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">var events = Glean.views.loginOpened.testGetValue();
Assert.equal(2, events.length);
Assert.equal(&quot;login_opened&quot;, events[0].name);
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-13"><a class="header" href="#testhasvalue-13"><code>testHasValue</code></a></h3>
<p>Whether or not any event was recorded for a given event metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views

assertTrue(Views.loginOpened.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Views

assertTrue(Views.INSTANCE.loginOpened.testHasValue())
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-swift">@testable import Glean

XCTAssert(Views.loginOpened.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert metrics.views.login_opened.test_has_value()
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-12"><a class="header" href="#testgetnumrecordederrors-12"><code>testGetNumRecordedErrors</code></a></h3>
<p>Get the number of errors recorded for a given event metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import mozilla.telemetry.glean.testing.ErrorType
import org.mozilla.yourApplication.GleanMetrics.Views

assertEquals(0, Views.loginOpened.testGetNumRecordedErrors(ErrorType.InvalidOverflow))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Kotlin">import mozilla.telemetry.glean.testing.ErrorType
import org.mozilla.yourApplication.GleanMetrics.Views

assertEquals(0, Views.INSTANCE.loginOpened.testGetNumRecordedErrors(ErrorType.InvalidOverflow))
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-swift">@testable import Glean

XCTAssertEqual(0, Views.loginOpened.testGetNumRecordedErrors(.invalidOverflow))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
from glean.testing import ErrorType
metrics = load_metrics(&quot;metrics.yaml&quot;)

assert 0 == metrics.views.login_opened.test_get_num_recorded_errors(
    ErrorType.INVALID_OVERFLOW
)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::ErrorType;
use metrics::views;

assert_eq!(
    0,
    views::login_opened.test_get_num_recorded_errors(ErrorType::InvalidOverflow, None)
);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as views from &quot;./path/to/generated/files/views.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

assert.strictEqual(
  1,
  await views.loginOpened.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-14"><a class="header" href="#metric-parameters-14">Metric parameters</a></h2>
<p>Example event metric definition:</p>
<pre><code class="language-yaml">views:
  login_opened:
    type: event
    description: |
      Recorded when the login view is opened.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
    extra_keys:
      source_of_login:
        description: The source from which the login view was opened, e.g. &quot;toolbar&quot;.
        type: string
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h4 id="events-require-lifetime-ping"><a class="header" href="#events-require-lifetime-ping">Events require <code>lifetime: ping</code>.</a></h4>
<blockquote>
<p>Recorded events are always sent in their respective pings and then cleared.
They cannot be persisted longer.
The <code>glean_parser</code> will reject any other lifetime.</p>
</blockquote>
<h3 id="extra-metric-parameters-13"><a class="header" href="#extra-metric-parameters-13">Extra metric parameters</a></h3>
<h4 id="extra_keys"><a class="header" href="#extra_keys"><code>extra_keys</code></a></h4>
<p>The acceptable keys on the &quot;extra&quot; object sent with events.
A maximum of 10 extra keys is allowed.</p>
<p>Each extra key contains additional metadata:</p>
<ul>
<li>
<p><code>description</code>: <strong>Required.</strong> A description of the key.</p>
</li>
<li>
<p><code>type</code>: The type of value this extra key can hold. One of <code>string</code>, <code>boolean</code>, <code>quantity</code>. Defaults to <code>string</code>.
<strong>Note</strong>: If not specified only the legacy API on <code>record</code> is available.</p>
</li>
</ul>
<h2 id="data-questions-13"><a class="header" href="#data-questions-13">Data questions</a></h2>
<ul>
<li>When and from where was the login view opened?</li>
</ul>
<h2 id="limits-14"><a class="header" href="#limits-14">Limits</a></h2>
<ul>
<li>When 500 events are queued on the client an events ping is immediately sent.</li>
<li>The <code>extra_keys</code> allows for a maximum of 10 keys.</li>
<li>The keys in the <code>extra_keys</code> list must be in dotted snake case, with a maximum length of 40 bytes, when encoded as UTF-8.</li>
<li>The values in the <code>extras</code> object have a maximum length of 100 bytes, when serialized and encoded as UTF-8.</li>
</ul>
<h2 id="reference-16"><a class="header" href="#reference-16">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/EventMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/event.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/event/struct.EventMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_event.default.html">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/event.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="custom-distribution"><a class="header" href="#custom-distribution">Custom Distribution</a></h1>
<p>Custom distributions are used to record the distribution of arbitrary values.</p>
<p>It should be used only when direct control over how the histogram buckets are computed is required.
Otherwise, look at the standard distribution metric types:</p>
<ul>
<li><a href="reference/metrics/timing_distribution.html">Timing Distributions</a></li>
<li><a href="reference/metrics/memory_distribution.html">Memory Distributions</a></li>
</ul>
<blockquote>
<p><strong>Note</strong>: Custom distributions are currently not universally supported. See below for available APIs.</p>
</blockquote>
<h2 id="recording-api-15"><a class="header" href="#recording-api-15">Recording API</a></h2>
<h3 id="accumulatesamples"><a class="header" href="#accumulatesamples"><code>accumulateSamples</code></a></h3>
<p>Accumulate the provided samples in the metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Graphics

Graphics.checkerboardPeak.accumulateSamples([23])
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics;

graphics::checkerboard_peak.accumulate_samples_signed(vec![23]);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::graphics::checkerboard_peak.AccumulateSamples({ 23 });
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.graphics.checkerboardPeak.accumulateSamples([23])
</code></pre>
</div>
</div>
</div>
<h4 id="limits-15"><a class="header" href="#limits-15">Limits</a></h4>
<ul>
<li>The maximum value of <code>bucket_count</code> is 100.</li>
<li>Only non-negative values may be recorded (<code>&gt;= 0</code>).</li>
</ul>
<h4 id="recorded-errors-17"><a class="header" href="#recorded-errors-17">Recorded errors</a></h4>
<ul>
<li><code>invalid_value</code>: If recording a negative value.</li>
</ul>
<h2 id="testing-api-15"><a class="header" href="#testing-api-15">Testing API</a></h2>
<h3 id="testgetvalue-14"><a class="header" href="#testgetvalue-14"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Graphics

// Get snapshot
val snapshot = Graphics.checkerboardPeak.testGetValue()

// Does the sum have the expected value?
assertEquals(11, snapshot.sum)

// Usually you don't know the exact timing values, but how many should have been recorded.
assertEquals(2L, snapshot.count())
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::ErrorType;
use glean_metrics::graphics;

// Does it have the expected value?
assert_eq!(23, graphics::checkerboard_peak.test_get_value(None).unwrap().sum);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

auto data = mozilla::glean::graphics::checkerboard_peak.TestGetValue().value();
ASSERT_EQ(23UL, data.sum);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">let data = Glean.graphics.checkerboardPeak.testGetValue();
Assert.equal(23, data.sum);
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-14"><a class="header" href="#testhasvalue-14"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Graphics

// Was anything recorded?
assertTrue(Graphics.checkerboardPeak.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-13"><a class="header" href="#testgetnumrecordederrors-13"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given counter metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Graphics

/// Did the metric receive a negative value?
assertEquals(1, Graphics.checkerboardPeak.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::ErrorType;
use glean_metrics::graphics;

// Were any of the values negative and thus caused an error to be recorded?
assert_eq!(
    0,
    graphics::checkerboard_peak.test_get_num_recorded_errors(ErrorType::InvalidValue));
</code></pre>
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-15"><a class="header" href="#metric-parameters-15">Metric Parameters</a></h2>
<p>Example custom distribution metric definition:</p>
<pre><code class="language-YAML">graphics:
  checkerboard_peak:
    type: custom_distribution
    description: &gt;
      Peak number of CSS pixels checkerboarded during a checkerboard event.
    range_min: 1
    range_max: 66355200
    bucket_count: 50
    histogram_type: exponential
    unit: pixels
    gecko_datapoint: CHECKERBOARD_PEAK
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<h3 id="extra-metric-parameters-14"><a class="header" href="#extra-metric-parameters-14">Extra metric parameters</a></h3>
<p>Custom distributions have the following required parameters:</p>
<ul>
<li><code>range_min</code>: (Integer) The minimum value of the first bucket</li>
<li><code>range_max</code>: (Integer) The minimum value of the last bucket</li>
<li><code>bucket_count</code>: (Integer) The number of buckets</li>
<li><code>histogram_type</code>:
<ul>
<li><code>linear</code>: The buckets are evenly spaced</li>
<li><code>exponential</code>: The buckets follow a natural logarithmic distribution</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Note</strong> Check out how these bucketing algorithms would behave on the <a href="reference/metrics/custom_distribution.html#simulator">Custom distribution simulator</a>.</p>
</blockquote>
<p>Custom distributions have the following optional parameters:</p>
<ul>
<li><code>unit</code>: (String) The unit of the values in the metric. For documentation purposes only -- does not affect data collection.</li>
<li><code>gecko_datapoint</code>: (String) This is a Gecko-specific property.
It is the name of the Gecko metric to accumulate the data from,
when using a Glean SDK in a product using GeckoView.</li>
</ul>
<h2 id="reference-17"><a class="header" href="#reference-17">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../docs/glean/private/struct.CustomDistributionMetric.html">Rust API docs</a></li>
</ul>
<h2 id="simulator-2"><a class="header" href="#simulator-2">Simulator</a></h2>
<div id="custom-data-modal-overlay">
    <div id="custom-data-modal">
        <p>Please, insert your custom data below as a JSON array.</p>
        <textarea rows="30"></textarea>
    </div>
</div>
<div id="simulator-container">
    <div id="histogram-chart-container">
        <div id="histogram-chart"></div>
        <p id="histogram-chart-legend"><p>
    </div>
    <div id="data-options">
        <h3 id="data-options-2"><a class="header" href="#data-options-2">Data options</a></h3>
        <div class="input-group">
            <label for="normally-distributed">Generate normally distributed data</label>
            <input name="data-options" value="normally-distributed" id="normally-distributed" type="radio" />
        </div>
        <div class="input-group">
            <label for="log-normally-distributed">Generate log-normally distributed data</label>
            <input name="data-options" value="log-normally-distributed" id="log-normally-distributed" type="radio" checked />
        </div>
        <div class="input-group">
            <label for="uniformly-distributed">Generate uniformly distributed data</label>
            <input name="data-options" value="uniformly-distributed" id="uniformly-distributed" type="radio" />
        </div>
        <div class="input-group" id="custom-data-input-group">
            <label for="custom">Use custom data</label>
            <input name="data-options" value="custom" id="custom" type="radio" />
        </div>
    </div>
    <div id="histogram-props">
        <h3 id="properties-2"><a class="header" href="#properties-2">Properties</a></h3>
        <div class="input-group">
            <label for="kind">Histogram type (<code>histogram_type</code>)</label>
            <select id="kind" name="kind">
                <option value="exponential" selected>Exponential</option>
                <option value="linear">Linear</option>
            </select>
        </div>
        <div class="input-group">
            <label for="lower-bound">Range minimum (<code>range_min</code>)</label>
            <input name="lower-bound" id="lower-bound" type="number" value="1" />
        </div>
        <div class="input-group">
            <label for="upper-bound">Range maximum (<code>range_max</code>)</label>
            <input name="upper-bound" id="upper-bound" type="number" value="500" />
        </div>
        <div class="input-group">
            <label for="bucket-count">Bucket count (<code>bucket_count</code>)</label>
            <input name="bucket-count" id="bucket-count" type="number" value="20" />
        </div>
    </div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/custom_distribution.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="quantity"><a class="header" href="#quantity">Quantity</a></h1>
<p>Used to record a single non-negative integer value or 0.
For example, the width of the display in pixels.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="do-not-use-quantity-for-counting"><a class="header" href="#do-not-use-quantity-for-counting">Do not use Quantity for counting</a></h2>
<blockquote>
<p>If you need to <em>count</em> something (e.g. the number of times a button is pressed)
prefer using the <a href="reference/metrics/./counter.html">Counter</a> metric type, which has a specific API for counting things.</p>
</blockquote>
<h2 id="recording-api-16"><a class="header" href="#recording-api-16">Recording API</a></h2>
<h3 id="set-8"><a class="header" href="#set-8"><code>set</code></a></h3>
<p>Sets a quantity metric to a specific value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Display

Display.width.set(width)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Display;

Display.INSTANCE.width.set(width);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">Display.width.set(width)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

metrics.display.width.set(width)
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as display from &quot;./path/to/generated/files/display.js&quot;;

display.width.set(window.innerHeight);
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

display::width.set(width);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

mozilla::glean::display::width.Set(innerHeight);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">Glean.display.width.set(innerHeight);
</code></pre>
</div>
</div>
</div>
<h4 id="limits-16"><a class="header" href="#limits-16">Limits</a></h4>
<ul>
<li>Quantities must be non-negative integers or 0.</li>
</ul>
<h4 id="recorded-errors-18"><a class="header" href="#recorded-errors-18">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_value</code></a>: If a negative value is passed in.</li>
</ul>
<h2 id="testing-api-16"><a class="header" href="#testing-api-16">Testing API</a></h2>
<h3 id="testgetvalue-15"><a class="header" href="#testgetvalue-15"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given quantity metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Display

// Does the quantity have the expected value?
assertEquals(6, Display.width.testGetValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Display;

// Was anything recorded?
assertTrue(Display.INSTANCE.width.testHasValue());
// Does the quantity have the expected value?
assertEquals(6, Display.INSTANCE.width.testGetValue());
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Does the quantity have the expected value?
XCTAssertEqual(6, try Display.width.testGetValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Does the quantity have the expected value?
assert 6 == metrics.display.width.test_get_value()
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as display from &quot;./path/to/generated/files/display.js&quot;;

assert.strictEqual(433, await display.width.testGetValue());
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean_metrics;

// Was anything recorded?
assert!(display::width.test_get_value(None).is_some());
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

ASSERT_TRUE(mozilla::glean::display::width.TestGetValue().isOk());
ASSERT_EQ(433, mozilla::glean::display::width.TestGetValue().unwrap().value());
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
Assert.equal(433, Glean.display.width.testGetValue());
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-15"><a class="header" href="#testhasvalue-15"><code>testHasValue</code></a></h3>
<p>Whether or not <strong>any</strong> value was recorded for a given quantity metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Display

// Was anything recorded?
assertTrue(Display.width.testHasValue())
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Display;

// Was anything recorded?
assertTrue(Display.INSTANCE.width.testHasValue());
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Was anything recorded?
XCTAssert(Display.width.testHasValue())
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Was anything recorded?
assert metrics.display.width.test_has_value()
</code></pre>
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-14"><a class="header" href="#testgetnumrecordederrors-14"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given quantity metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Display

// Did it record an error due to a negative value?
assertEquals(1, Display.width.testGetNumRecordedErrors(ErrorType.InvalidValue))
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-Java">import org.mozilla.yourApplication.GleanMetrics.Display;

// Did the quantity record a negative value?
assertEquals(
    1, Display.INSTANCE.width.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-Swift">@testable import Glean

// Did the quantity record a negative value?
XCTAssertEqual(1, Display.width.testGetNumRecordedErrors(.invalidValue))
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Did the quantity record an negative value?
from glean.testing import ErrorType
assert 1 == metrics.display.width.test_get_num_recorded_errors(
    ErrorType.INVALID_VALUE
)
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as display from &quot;./path/to/generated/files/display.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

assert.strictEqual(
  0,
  await display.width.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use glean::ErrorType;

use glean_metrics;

assert_eq!(
  1,
  display::width.test_get_num_recorded_errors(
    ErrorType::InvalidValue
  )
);
<span class="boring">}
</span></code></pre></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-16"><a class="header" href="#metric-parameters-16">Metric parameters</a></h2>
<p>Example quantity metric definition:</p>
<pre><code class="language-yaml">controls:
  refresh_pressed:
    type: quantity
    description: &gt;
      The width of the display, in pixels.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
    unit: pixels
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="extra-metric-parameters-15"><a class="header" href="#extra-metric-parameters-15">Extra metric parameters</a></h3>
<h4 id="unit"><a class="header" href="#unit"><code>unit</code></a></h4>
<p>Quantities have the required <code>unit</code> parameter, which is a free-form string for documentation purposes.</p>
<h2 id="data-questions-14"><a class="header" href="#data-questions-14">Data questions</a></h2>
<ul>
<li>What is the width of the display, in pixels?</li>
</ul>
<h2 id="reference-18"><a class="header" href="#reference-18">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../swift/Classes/QuantityMetricType.html">Swift API docs</a></li>
<li><a href="reference/metrics/../../../python/glean/metrics/quantity.html">Python API docs</a></li>
<li><a href="reference/metrics/../../../docs/glean/private/quantity/struct.QuantityMetric.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/classes/core_metrics_types_quantity.default.html#set">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/quantity.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="rate"><a class="header" href="#rate">Rate</a></h1>
<p>Used to count how often something happens relative to how often something else happens.
Like how many documents use a particular CSS Property,
or how many HTTP connections had an error.
You can think of it like a fraction, with a numerator and a denominator.</p>
<p>All rates start without a value.
A rate with a numerator of 0 is valid and will be sent to ensure we capture the
&quot;no errors happened&quot; or &quot;no use counted&quot; cases.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="let-the-glean-metric-do-the-counting-1"><a class="header" href="#let-the-glean-metric-do-the-counting-1">Let the Glean metric do the counting</a></h2>
<blockquote>
<p>When using a rate metric, it is important to let the Glean metric do the counting.
Using your own variable for counting and setting the metric yourself could be problematic:
ping scheduling will make it difficult to ensure the metric is at the correct value at the correct time.
Instead, count to the numerator and denominator as you go.</p>
</blockquote>
<h2 id="recording-api-17"><a class="header" href="#recording-api-17">Recording API</a></h2>
<h3 id="addtonumerator--addtodenominator"><a class="header" href="#addtonumerator--addtodenominator"><code>addToNumerator</code> / <code>addToDenominator</code></a></h3>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<p>Count numerator and denominator individually:</p>
<pre><code class="language-Rust">use glean_metrics::*;

if connection_had_error {
    network::http_connection_error.add_to_numerator(1);
}

network::http_connection_error.add_to_denominator(1);
</code></pre>
<h4 id="external-denominators"><a class="header" href="#external-denominators">External Denominators</a></h4>
<p>If the rate uses an external denominator,
adding to the denominator must be done through the denominator's
<a href="reference/metrics/./counter.html#recording-api"><code>counter</code> API</a>:</p>
<pre><code class="language-Rust">use glean_metrics;

if connection_had_error {
    network::http_connection_error.add_to_numerator(1);
}

network::http_connections.add(1);
</code></pre>
</div>
<div data-lang="Javascript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

if (aHadError) {
  mozilla::glean::network::http_connection_error.add_to_numerator(1);
}
mozilla::glean::network::http_connection_error.add_to_denominator(1);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">if (aHadError) {
  Glean.network.httpConnectionError.addToNumerator(1);
}
Glean.network.httpConnectionError.addToDenominator(1);
</code></pre>
</div>
</div>
</div>
<h4 id="recorded-errors-19"><a class="header" href="#recorded-errors-19">Recorded errors</a></h4>
<ul>
<li><code>invalid_value</code>: If either numerator or denominator is incremented by a negative value.</li>
</ul>
<h4 id="limits-17"><a class="header" href="#limits-17">Limits</a></h4>
<ul>
<li>Numerator and Denominator only increment.</li>
<li>Numerator and Denominator saturate at the largest value that can be represented as a 32-bit signed integer (<code>2147483647</code>).</li>
</ul>
<h2 id="testing-api-17"><a class="header" href="#testing-api-17">Testing API</a></h2>
<h3 id="testgetvalue-16"><a class="header" href="#testgetvalue-16"><code>testGetValue</code></a></h3>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics::*;

assert_eq!((1, 1), network::http_connection_error.test_get_value(None).unwrap());
</code></pre>
</div>
<div data-lang="Javascript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">#include &quot;mozilla/glean/GleanMetrics.h&quot;

auto pair = mozilla::glean::network::http_connection_error.TestGetValue().unwrap();
ASSERT_EQ(1, pair.first);
ASSERT_EQ(1, pair.second);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">// testGetValue will throw NS_ERROR_LOSS_OF_SIGNIFICANT_DATA on error.
Assert.deepEqual(
  { numerator: 1, denominator: 1 },
  Glean.network.httpConnectionError.testGetValue()
);
</code></pre>
</div>
</div>
</div>
<h3 id="testhasvalue-16"><a class="header" href="#testhasvalue-16"><code>testHasValue</code></a></h3>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="Javascript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-15"><a class="header" href="#testgetnumrecordederrors-15"><code>testGetNumRecordedErrors</code></a></h3>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean_metrics::*;
use glean::ErrorType;

assert_eq!(
    0,
    network::http_connection_error.test_get_num_recorded_errors(
        ErrorType::InvalidValue
    )
);
</code></pre>
</div>
<div data-lang="Javascript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab" data-info="Firefox Desktop uses testGetValue to communicate errors"></div>
</div>
</div>
<h2 id="metric-parameters-17"><a class="header" href="#metric-parameters-17">Metric parameters</a></h2>
<p>Example rate metric definition:</p>
<pre><code class="language-YAML">network:
  http_connection_error:
    type: rate
    description: &gt;
      How many HTTP connections error out out of the total connections made.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h3 id="external-denominators-1"><a class="header" href="#external-denominators-1">External Denominators</a></h3>
<p>If several rates share the same denominator
then the denominator should be defined as a <code>counter</code> and shared between
<code>rates</code> using the <code>denominator_metric</code> property:</p>
<pre><code class="language-YAML">network:
  http_connections:
    type: counter
    description: &gt;
      Total number of http connections made.
    ...

  http_connection_error:
    type: rate
    description: &gt;
      How many HTTP connections error out out of the total connections made.
    denominator_metric: network.http_connections
    ...

  http_connection_slow:
    type: rate
    description: &gt;
      How many HTTP connections were slow, out of the total connections made.
    denominator_metric: network.http_connections
    ...
</code></pre>
<h2 id="data-questions-15"><a class="header" href="#data-questions-15">Data Questions</a></h2>
<ul>
<li>How often did an HTTP connection error?</li>
<li>How many documents used a given CSS Property?</li>
</ul>
<h2 id="reference-19"><a class="header" href="#reference-19">Reference</a></h2>
<ul>
<li><a href="reference/metrics/../../../docs/glean/private/rate/struct.RateMetric.html">Rust API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/rate.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="text"><a class="header" href="#text">Text</a></h1>
<p>Records a single long Unicode text, used when the limits on <code>String</code> are too low.</p>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h2 id="important-9"><a class="header" href="#important-9">Important</a></h2>
<blockquote>
<p>This type should only be used in special cases when other metrics don't fit.
See <a href="reference/metrics/text.html#limits">limitations</a> below.<br />
Reach out to the Glean team before using this.</p>
</blockquote>
<h2 id="recording-api-18"><a class="header" href="#recording-api-18">Recording API</a></h2>
<h3 id="set-9"><a class="header" href="#set-9"><code>set</code></a></h3>
<p>Sets a text metric to a specific value.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as article from &quot;./path/to/generated/files/article.js&quot;;

article.content.set(extractedText);
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h4 id="limits-18"><a class="header" href="#limits-18">Limits</a></h4>
<ul>
<li>Text metrics can only be sent in <a href="reference/metrics/../../user/pings/custom.html">custom pings</a>.</li>
<li>Text metrics are always of data collection category 3 (<code>web_activity</code>) or category 4 (<code>highly_sensitive</code>).</li>
<li>Only <code>ping</code> and <code>application</code> lifetimes are allowed.</li>
<li>Fixed maximum text length: 200 kilobytes.
Longer text is truncated. This is measured in the number of bytes when the string is encoded in UTF-8.</li>
</ul>
<h4 id="recorded-errors-20"><a class="header" href="#recorded-errors-20">Recorded errors</a></h4>
<ul>
<li><a href="reference/metrics/../../user/metrics/error-reporting.html"><code>invalid_overflow</code></a>: if the text is too long.</li>
</ul>
<h2 id="testing-api-18"><a class="header" href="#testing-api-18">Testing API</a></h2>
<h3 id="testgetvalue-17"><a class="header" href="#testgetvalue-17"><code>testGetValue</code></a></h3>
<p>Gets the recorded value for a given text metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as article from &quot;./path/to/generated/files/article.js&quot;;

assert.strictEqual(&quot;some content&quot;, await article.content.testGetValue());
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h3 id="testgetnumrecordederrors-16"><a class="header" href="#testgetnumrecordederrors-16"><code>testGetNumRecordedErrors</code></a></h3>
<p>Gets number of errors recorded for a given text metric.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab"></div>
<div data-lang="Java" class="tab"></div>
<div data-lang="Swift" class="tab"></div>
<div data-lang="Python" class="tab"></div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as article from &quot;./path/to/generated/files/article.js&quot;;
import { ErrorType } from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

assert.strictEqual(
  0,
  await article.content.testGetNumRecordedErrors(ErrorType.InvalidValue)
);
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h2 id="metric-parameters-18"><a class="header" href="#metric-parameters-18">Metric parameters</a></h2>
<p>Example text metric definition:</p>
<pre><code class="language-yaml">article:
  content:
    type: text
    lifetime: ping
    send_in_pings:
      - research
    data_sensitivity:
      - web_activity
    description: &gt;
      The plaintext content of the displayed article.
    bugs:
      - https://bugzilla.mozilla.org/000000
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=000000#c3
    notification_emails:
      - me@mozilla.com
    expires: 2020-10-01
</code></pre>
<p>For a full reference on metrics parameters common to all metric types,
refer to the <a href="reference/metrics/../yaml/metrics.html">metrics YAML registry format</a> reference page.</p>
<h2 id="data-questions-16"><a class="header" href="#data-questions-16">Data questions</a></h2>
<ul>
<li>What article content was displayed to the user?</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/metrics/text.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="pings-2"><a class="header" href="#pings-2">Pings</a></h1>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h4 id="glean-owned-pings-are-submitted-automatically"><a class="header" href="#glean-owned-pings-are-submitted-automatically">Glean-owned pings are submitted automatically</a></h4>
<blockquote>
<p>Products do not need to submit Glean built-in pings,
as their scheduling is managed internally. The APIs
on this page are only relevant for products defining
<a href="reference/pings/../../user/pings/custom.html#defining-a-custom-ping">custom pings</a>.</p>
</blockquote>
<h2 id="submission-api"><a class="header" href="#submission-api">Submission API</a></h2>
<h3 id="submit"><a class="header" href="#submit"><code>submit</code></a></h3>
<p>Collect and queue a custom ping for eventual uploading.</p>
<p>By default, if the ping doesn't currently have any events or metrics set, <code>submit</code> will do nothing. However, if the <code>send_if_empty</code> flag is set to true in the ping definition, it will always be submitted.</p>
<p>It is not necessary for the caller to check if Glean is disabled before calling <code>submit</code>.
If Glean is disabled <code>submit</code> is a no-op.</p>
<p>For example, to submit the custom ping defined in <a href="reference/pings/../../user/pings/custom.html#defining-a-custom-ping">Adding new custom pings</a>:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-kotlin">import org.mozilla.yourApplication.GleanMetrics.Pings
Pings.search.submit(
    Pings.searchReasonCodes.performed
)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-java">import org.mozilla.yourApplication.GleanMetrics.Pings

Pings.INSTANCE.search.submit(
    Pings.INSTANCE.searchReasonCodes.performed
);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-swift">import Glean

GleanMetrics.Pings.shared.search.submit(
    reason: .performed
)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_pings

pings = load_pings(&quot;pings.yaml&quot;)

pings.search.submit(pings.search_reason_codes.PERFORMED)
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::Pings;

pings::search.submit(pings::SearchReasonCodes::Performed);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as pings from &quot;./path/to/generated/files/pings.js&quot;;

pings.search.submit(pings.searchReasonCodes.Performed);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>C++</strong></p>
<pre><code class="language-cpp">mozilla::glean_pings::Search.Submit(&quot;performed&quot;_ns);
</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class="language-js">GleanPings.search.submit(&quot;performed&quot;);
</code></pre>
</div>
</div>
</div>
<h2 id="testing-api-19"><a class="header" href="#testing-api-19">Testing API</a></h2>
<h3 id="testbeforenextsubmit"><a class="header" href="#testbeforenextsubmit"><code>testBeforeNextSubmit</code></a></h3>
<p>Runs a validation function before the ping is collected.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<pre><code class="language-kotlin">import org.mozilla.yourApplication.GleanMetrics.Search
import org.mozilla.yourApplication.GleanMetrics.Pings

// Record some data.
Search.defaultEngine.add(5);

// Instruct the ping API to validate the ping data.
var validatorRun = false
Pings.search.testBeforeNextSubmit { reason -&gt;
    assertEquals(Pings.searchReasonCodes.performed, reason)
    assertEquals(5, Search.defaultEngine.testGetValue())
    validatorRun = true
}

// Submit the ping.
Pings.search.submit(
    Pings.searchReasonCodes.performed
)

// Verify that the validator run.
assertTrue(validatorRun)
</code></pre>
</div>
<div data-lang="Java" class="tab">
<pre><code class="language-java">import org.mozilla.yourApplication.GleanMetrics.Search
import org.mozilla.yourApplication.GleanMetrics.Pings

// Record some data.
Search.INSTANCE.defaultEngine.add(5);

// Instruct the ping API to validate the ping data.
boolean validatorRun = false;
Pings.INSTANCE.search.testBeforeNextSubmit((reason) -&gt; {
    assertEquals(Pings.searchReasonCodes.performed, reason);
    assertEquals(5, Search.INSTANCE.defaultEngine.testGetValue());
    validatorRun = true;
});

// Submit the ping.
Pings.INSTANCE.search.submit(
    Pings.INSTANCE.searchReasonCodes.performed
);

// Verify that the validator run.
assertTrue(validatorRun);
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<pre><code class="language-swift">@testable import Glean

// Record some data.
Search.defaultEngine.add(5)

// Instruct the ping API to validate the ping data.
var validatorRun = false
GleanMetrics.pings.shared.search.testBeforeNextSubmit { reason in
    XCTAssertEqual(.performed, reason, &quot;Unexpected reason for search ping submitted&quot;)
    XCTAssertEqual(5, try Search.defaultEngine.testGetValue(), &quot;Unexpected value for default engine in search ping&quot;)
    validatorRun = true
}

// Submit the ping.
GleanMetrics.Pings.shared.search.submit(
    reason: .performed
)

// Verify that the validator run.
XCTAssert(validatorRun, &quot;Expected validator to be called by now.&quot;)
</code></pre>
</div>
<div data-lang="Python" class="tab">
<pre><code class="language-Python">from glean import load_metrics, load_pings

pings = load_pings(&quot;pings.yaml&quot;)
metrics = load_metrics(&quot;metrics.yaml&quot;)

# Record some data.
metrics.search.default_engine.add(5)

# Need a mutable object and plain booleans are not.
callback_was_called = [False]

def check_custom_ping(reason):
    assert reason == pings.search_reason_codes.PERFORMED
    assert 5 == metrics.search.default_engine.test_get_value()
    callback_was_called[0] = True

# Instruct the ping API to validate the ping data.
pings.search.test_before_next_submit(check_custom_ping)

# Submit the ping.
pings.search.submit(pings.search_reason_codes.PERFORMED)

# Verify that the validator run.
assert callback_was_called[0]
</code></pre>
</div>
<div data-lang="Rust" class="tab">
<pre><code class="language-Rust">use glean::Pings;
use glean_metrics;

// Record some data.
search::default_engine.add(5);

// Instruct the ping API to validate the ping data.
pings::search.test_before_next_submit(move |reason| {
    assert_eq!(pings::SearchReasonCodes::Performed, reason);
    assert_eq!(5, search::default_engine.test_get_value(None).unwrap());
});

// When the `submit` API is not directly called by the
// test code, it may be worth checking that the validator
// function run by using a canary boolean in the closure
// used in `test_before_next_submit` and asserting on its
// value after submission.

// Submit the ping.
pings::search.submit(pings::SearchReasonCodes::Performed);
</code></pre>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import * as search from &quot;./path/to/generated/files/search.js&quot;;
import * as pings from &quot;./path/to/generated/files/pings.js&quot;;

// Record some data.
search.defaultEngine.add(5);

// Instruct the ping API to validate the ping data.
let validatorRun = false;
const p = pings.search.testBeforeNextSubmit(async reason =&gt; {
  assert.strictEqual(reason, &quot;performed&quot;);
  assert.strictEqual(await search.defaultEngine.testGetValue(), 5);
  validatorRun = true;
});

// Submit the ping.
pings.search.submit(&quot;performed&quot;);
// Wait for the validation to finish.
assert.doesNotThrow(async () =&gt; await p);

// Verify that the validator run.
assert.ok(validatorRun);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab">
<p><strong>JavaScript:</strong></p>
<pre><code class="language-js">Glean.search.defaultEngine.add(5);
let submitted = false;
GleanPings.search.testBeforeNextSubmit(reason =&gt; {
  submitted = true;
  Assert.equal(5, Glean.search.defaultEngine.testGetValue());
});
GleanPings.search.submit();
Assert.ok(submitted);
</code></pre>
<p><strong>C++:</strong></p>
<pre><code class="language-cpp">mozilla::glean::search::default_engine.Add(5);
bool submitted = false;
mozilla::glean_pings::Search.TestBeforeNextSubmit([&amp;submitted](const nsACString&amp; aReason) {
  submitted = true;
  ASSERT_EQ(false, mozilla::glean::search::default_engine.TestGetValue().unwrap().ref());
});
mozilla::glean_pings::Search.Submit();
ASSERT_TRUE(submitted);
</code></pre>
</div>
</div>
</div>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/pings/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>The Glean SDKs are available for several programming languages and development environments.</p>
<p>Although there are different SDKs, each of them is based off of either
a JavaScript core or a Rust core. These cores contain the bulk of the logic
of the client libraries. Thin wrappers around them expose APIs for the target platforms.
Each SDK may also send a different set of <a href="language-bindings/../user/pings/sent-by-glean.html#available-pings-per-platform">default pings</a>
and collect a different set of <a href="language-bindings/../user/collected-metrics/metrics.html">default metrics</a>.</p>
<p>Finally, each SDK may also be<sup class="footnote-reference"><a href="#1">1</a></sup> accompanied by <code>glean_parser</code>, a Python command line utility
that provides a list of useful development tools for developers instrumenting a project using Glean.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Some SDKs are not bundled with <code>glean_parser</code> and it is left to the user to install it separately.</p>
</div>
<ul>
<li><a href="language-bindings/index.html#rust-core-based-sdks">Rust Core-based SDKs</a>
<ul>
<li><a href="language-bindings/index.html#rust">Rust</a></li>
<li><a href="language-bindings/index.html#kotlin">Kotlin</a></li>
<li><a href="language-bindings/index.html#swift">Swift</a></li>
<li><a href="language-bindings/index.html#python">Python</a></li>
</ul>
</li>
<li><a href="language-bindings/index.html#javascript-core-based-sdks">JavaScript Core-based SDKs</a>
<ul>
<li><a href="language-bindings/index.html#javascript">JavaScript</a></li>
<li><a href="language-bindings/index.html#qml">QML</a></li>
</ul>
</li>
</ul>
<h2 id="rust-core-based-sdks"><a class="header" href="#rust-core-based-sdks">Rust Core-based SDKs</a></h2>
<p>The code for the Rust Core-based SDKs is available on the
<a href="https://github.com/mozilla/glean"><code>mozilla/glean</code></a> repository.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<blockquote>
<p>These group of SDKs were previously referred to as &quot;language bindings&quot; i.e.
&quot;the Kotlin language bindings&quot; or &quot;the Python language bindings&quot;.</p>
</blockquote>
<h3 id="rust"><a class="header" href="#rust">Rust</a></h3>
<p>The Glean Rust SDK can be used with any Rust application.
It can serve a wide variety of usage patterns,
such as short-lived CLI applications as well as longer-running desktop or server applications.
It can optionally send builtin pings at startup.
It does not assume an interaction model and the integrating application is responsible to connect the respective hooks.</p>
<p>It is available as the <a href="https://crates.io/crates/glean"><code>glean</code> crate</a> on crates.io.</p>
<h3 id="kotlin"><a class="header" href="#kotlin">Kotlin</a></h3>
<p>The Glean Kotlin SDK is primarily used for integration with Android applications.
It assumes a common interaction model for mobile applications.
It sends builtin pings at startup of the integrating application.</p>
<p>It is available standalone as <code>org.mozilla.telemetry:glean</code>
or via <a href="https://github.com/mozilla-mobile/android-components/">Android Components</a> as <code>org.mozilla.components:service-glean</code>
from the <a href="https://maven.mozilla.org/?prefix=maven2">Mozilla Maven instance</a>.</p>
<p>The Kotlin SDK can also be used from Java.</p>
<p>See <a href="language-bindings/android/">Android</a> for more on integrating Glean on Android.</p>
<h3 id="swift"><a class="header" href="#swift">Swift</a></h3>
<p>The Glean Swift SDK is primarily used for integration with iOS applications.
It assumes a common interaction model for mobile applications.
It sends builtin pings at startup of the integrating application.</p>
<p>It is available as a standalone Xcode framework from the <a href="https://github.com/mozilla/glean/releases">Glean releases page</a> or bundled with the <a href="https://github.com/mozilla/application-services/releases">AppServices framework</a>.</p>
<h3 id="python"><a class="header" href="#python">Python</a></h3>
<p>The Glean Python SDK allows integration with any Python application.
It can serve a wide variety of usage patterns,
such as short-lived CLI applications as well as longer-running desktop or server applications.</p>
<p>It is available as <a href="https://pypi.org/project/glean-sdk/"><code>glean-sdk</code> on PyPI</a>.</p>
<!-- ### Firefox Desktop SDK

TODO -->
<h2 id="javascript-core-based-sdks"><a class="header" href="#javascript-core-based-sdks">JavaScript Core-based SDKs</a></h2>
<p>The code for the JavaScript Core-based SDKs is available on the
<a href="https://github.com/mozilla/glean.js"><code>mozilla/glean.js</code></a> repository.</p>
<p>This collection of SDKs is commonly referred to as <strong>Glean.js</strong>.</p>
<h3 id="javascript"><a class="header" href="#javascript">JavaScript</a></h3>
<p>The Glean JavaScript SDK allows integration with three distint JavaScript environments: websites,
web extension and Node.js.</p>
<p>It is available as <a href="https://www.npmjs.com/package/@mozilla/glean"><code>@mozilla/glean</code> on npm</a>.
This package has different entry points to access the different SDKs.</p>
<ul>
<li><code>@mozilla/glean/web</code> gives access to the websites SDK</li>
<li><code>@mozilla/glean/webext</code> gives access to the web extension SDK</li>
<li><code>@mozilla/glean/node</code> gives access to the Node.js SDK</li>
</ul>
<h3 id="qml"><a class="header" href="#qml">QML</a></h3>
<p>The Glean QML SDK allows integration with Qt/QML applications and libraries.</p>
<p>It is available as a compressed file attached to each new Glean.js release
and may be downloaded from the project
<a href="https://github.com/mozilla/glean.js/releases/">GitHub releases page</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="android-specific-information"><a class="header" href="#android-specific-information">Android-specific information</a></h1>
<p>The Glean Kotlin SDK can be used in Android applications.
The integration into the build system for Android applications can be tuned to your needs.
See the following chapters for details.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="android-build-script-configuration-options"><a class="header" href="#android-build-script-configuration-options">Android build script configuration options</a></h1>
<p>This chapter describes build configuration options that control the behavior of the Glean Kotlin SDK's Gradle plugin.
These options are not usually required for normal use.</p>
<p>Options can be turned on by setting a variable on the Gradle <a href="https://docs.gradle.org/current/dsl/org.gradle.api.plugins.ExtraPropertiesExtension.html"><code>ext</code></a> object <em>before</em> applying the Glean Gradle plugin.</p>
<h2 id="allowmetricsfromaar"><a class="header" href="#allowmetricsfromaar"><code>allowMetricsFromAAR</code></a></h2>
<p>Normally, the Glean Kotlin SDK looks for <code>metrics.yaml</code> and <code>pings.yaml</code> files in the root directory of the Glean-using project.
However, in some cases, these files may need to ship inside the dependencies of the project.
For example, this is used in the <code>engine-gecko</code> component to grab the <code>metrics.yaml</code> from the <code>geckoview</code> AAR.</p>
<pre><code class="language-groovy">ext.allowMetricsFromAAR = true
</code></pre>
<p>When this flag is set, every direct dependency of your library will be searched for a <code>metrics.yaml</code> file, and those metrics will be treated as the metrics as if they were defined by your library.
That is, API wrappers accessible from your library will be generated for those metrics.</p>
<p>The <code>metrics.yaml</code> can be added to the dependency itself by calling this on each relevant build variant:</p>
<pre><code class="language-groovy">variant.packageLibraryProvider.get().from(&quot;${topsrcdir}/path/metrics.yaml&quot;)
</code></pre>
<h2 id="gleangeneratemarkdowndocs"><a class="header" href="#gleangeneratemarkdowndocs"><code>gleanGenerateMarkdownDocs</code></a></h2>
<p>The Glean Kotlin SDK can automatically generate Markdown documentation for metrics and pings defined in the registry files, in addition to the metrics API code.</p>
<pre><code class="language-groovy">ext.gleanGenerateMarkdownDocs = true
</code></pre>
<p>Flipping the feature to <code>true</code> will generate a <code>metrics.md</code> file in <code>$projectDir/docs</code> at build-time. In general this is not necessary for projects using Mozilla's data ingestion infrastructure: in those cases human-readable documentation will automatically be viewable via the <a href="https://dictionary.telemetry.mozilla.org">Glean Dictionary</a>.</p>
<h2 id="gleandocsdirectory"><a class="header" href="#gleandocsdirectory"><code>gleanDocsDirectory</code></a></h2>
<p>The <code>gleanDocsDirectory</code> can be used to customize the path of the documentation output directory.
If <code>gleanGenerateMarkdownDocs</code> is disabled, it does nothing.
Please note that only the <code>metrics.md</code> will be overwritten: any other file available in the target directory will be preserved.</p>
<pre><code class="language-groovy">ext.gleanDocsDirectory = &quot;$rootDir/docs/user/telemetry&quot;
</code></pre>
<h2 id="gleanyamlfiles"><a class="header" href="#gleanyamlfiles"><code>gleanYamlFiles</code></a></h2>
<p>By default, the Glean Gradle plugin will look for <code>metrics.yaml</code> and <code>pings.yaml</code> files in the same directory that the plugin is included from in your application or library.
To override this, <code>ext.gleanYamlFiles</code> may be set to a list of explicit paths.</p>
<pre><code class="language-groovy">ext.gleanYamlFiles = [&quot;$rootDir/glean-core/metrics.yaml&quot;, &quot;$rootDir/glean-core/pings.yaml&quot;]
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/android-build-configuration-options.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h2 id="offline-builds-of-android-applications-that-use-glean"><a class="header" href="#offline-builds-of-android-applications-that-use-glean">Offline builds of Android applications that use Glean</a></h2>
<p>The Glean Kotlin SDK has basic support for building Android applications that use Glean in offline mode.</p>
<p>The Glean Kotlin SDK uses a Python script, <a href="https://github.com/mozilla/glean_parser/"><code>glean_parser</code></a> to generate code for metrics from the <code>metrics.yaml</code> and <code>pings.yaml</code> files when Glean-using applications are built. When online, the pieces necessary to run this script are installed automatically.</p>
<p>For offline builds, the Python environment, and packages of <code>glean_parser</code> and its dependencies must be provided prior to building the Glean-using application.</p>
<p>To build a Glean-using application in offline mode, do the following:</p>
<ul>
<li>
<p>Install Python 3.6 or later and ensure it's on the <code>PATH</code>.</p>
<ul>
<li>
<p>On Linux, installing Python from your Linux distribution's package manager is usually sufficient.</p>
</li>
<li>
<p>On macOS, installing Python from <a href="https://brew.sh/"><code>homebrew</code></a> is known to work, but other package managers may also work.</p>
</li>
<li>
<p>On Windows, we recommend installing one of the official Python installers from <a href="https://python.org">python.org</a>.</p>
</li>
</ul>
</li>
<li>
<p>Determine the version of <code>glean_parser</code> required.</p>
<ul>
<li>
<p>It can be really difficult to manually determine the version of <code>glean_parser</code> that is required for a given application, since it needs to be tracked through <code>android-components</code>, to <code>glean-core</code> and finally to <code>glean_parser</code>. The required version of <code>glean_parser</code> can be determined by running the following at the top-level of the Glean-using application:</p>
<pre><code class="language-sh">$ ./gradlew | grep &quot;Requires glean_parser&quot;
Requires glean_parser==1.28.1
</code></pre>
</li>
</ul>
</li>
<li>
<p>Download packages for <code>glean_parser</code> and its dependencies:</p>
<ul>
<li>
<p>In the root directory of the Glean-using project, create a directory called <code>glean-wheels</code> and <code>cd</code> into it.</p>
</li>
<li>
<p>Download packages for <code>glean_parser</code> and its dependencies, replacing <code>X.Y.Z</code> with the correct version of <code>glean_parser</code>:</p>
<pre><code class="language-sh">$ python3 -m pip download glean_parser==X.Y.Z
</code></pre>
</li>
</ul>
</li>
<li>
<p>Build the Glean-using project using <code>./gradlew</code>, but passing in the <code>--offline</code> flag.</p>
</li>
</ul>
<p>There are a couple of environment variables that control offline building:</p>
<ul>
<li>
<p>To override the location of the Python interpreter to use, set the <code>GLEAN_PYTHON</code> environment variable. If unset, the first Python interpreter on the <code>PATH</code> will be used.</p>
</li>
<li>
<p>To override the location of the downloaded Python wheels, set the <code>GLEAN_PYTHON_WHEELS_DIR</code> environment variable.  If unset <code>${projectDir}/glean-wheels</code> will be used.</p>
</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/android-offline-builds.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="instrumenting-android-crashes-with-the-glean-sdk"><a class="header" href="#instrumenting-android-crashes-with-the-glean-sdk">Instrumenting Android crashes with the Glean SDK</a></h1>
<p>One of the things that might be useful to collect data on in an Android application is crashes.  This guide will walk through a
basic strategy for instrumenting an Android application with crash telemetry using a custom ping.</p>
<p><strong>Note:</strong>  This is a <em>very</em> simple example of instrumenting crashes using the Glean SDK.  There will be challenges to
using this approach in a production application that should be considered.  For instance, when an app crashes it can be in an
unknown state and may not be able to do things like upload data to a server.  The recommended way of instrumenting crashes with
Android Components is called <a href="https://github.com/mozilla-mobile/android-components/tree/HEAD/components/lib/crash">lib-crash</a>, which takes into consideration things like multiple processes and persistence.</p>
<h2 id="before-you-start"><a class="header" href="#before-you-start">Before You Start</a></h2>
<p>There are a few things that need to be installed in order to proceed, mainly <a href="https://developer.android.com/studio/">Android Studio</a>.  If you include the Android SDK,
Android Studio can take a little while to download and get installed.  This walk-through assumes some knowledge of Android
application development.  Knowing where to go to create a new project and how to add dependencies to a Gradle file will be
helpful in following this guide.</p>
<h2 id="setup-build-configuration"><a class="header" href="#setup-build-configuration">Setup Build Configuration</a></h2>
<p>Please follow the instruction in the <a href="language-bindings/android/../../user/adding-glean-to-your-project/index.html">&quot;Adding Glean to your project&quot;</a> chapter in order to set up
Glean in an Android project.</p>
<h3 id="add-a-custom-metric"><a class="header" href="#add-a-custom-metric">Add A Custom Metric</a></h3>
<p>Since crashes will be instrumented with some custom metrics, the next step will be to add a <code>metrics.yaml</code> file to define the
metrics used to record the crash information and a <code>pings.yaml</code> file to define a custom ping which will give some control over
the scheduling of the uploading.  See <a href="language-bindings/android/../../user/adding-new-metrics.html">&quot;Adding new metrics&quot;</a> for more information about adding metrics.</p>
<p>What metric type should be used to represent the crash data?  While this could be implemented several ways, an <a href="language-bindings/android/../../reference/metrics/event.html">event</a> is an
excellent choice, simply because events capture information in a nice concise way and they have a built-in way of passing
additional information using the <code>extras</code> field.  If it is necessary to pass along the cause of the exception or a few lines of
description, events let us do that easily (with <a href="language-bindings/android/../../reference/metrics/event.html#limits">some limitations</a>).</p>
<p>Now that a metric type has been chosen to represent the metric, the next step is creating the <code>metrics.yaml</code>.  Inside of the
root application folder of the Android Studio project create a new file named <code>metrics.yaml</code>.  After adding the schema
definition and event metric definition, the <code>metrics.yaml</code> should look like this:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

crash:
  exception:
    type: event
    description: |
      Event to record crashes caused by unhandled exceptions
    notification_emails:
      - crashes@example.com
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
    expires:
      2021-01-01
    send_in_pings:
      - crash
    extra_keys:
      cause:
        description: The cause of the crash
      message:
        description: The exception message
</code></pre>
<p>As a brief explanation, this creates a metric called <code>exception</code> within a metric category called <code>crash</code>.  There is a text
<code>description</code> and the required <code>notification_emails</code>, <code>bugs</code>, <code>data_reviews</code>, and <code>expires</code> fields.  The <code>send_in_pings</code> field
is important to note here that it has a value of <code>- crash</code>.  This means that the crash event metric will be sent via a custom
ping named <code>crash</code> (which hasn't been created yet).  Finally, note the <code>extra_keys</code> field which has two keys defined, <code>cause</code>
and <code>message</code>.  This allows for sending additional information along with the event to be associated with these keys.</p>
<p><strong>Note:</strong>  For Mozilla applications, a mandatory <a href="https://github.com/mozilla/data-review/blob/HEAD/request.md">data review</a> is required in order to collect information with the Glean SDK.</p>
<h3 id="add-a-custom-ping"><a class="header" href="#add-a-custom-ping">Add A Custom Ping</a></h3>
<p>Define the custom ping that will help control the upload scheduling by creating a <code>pings.yaml</code> file in the same directory as
the <code>metrics.yaml</code> file.  For more information about adding custom pings, see the section on <a href="language-bindings/android/../../user/pings/custom.html">custom pings</a>.<br />
The name of the ping will be <code>crash</code>, so the <code>pings.yaml</code> file should look like this:</p>
<pre><code class="language-YAML"># Required to indicate this is a `pings.yaml` file
$schema: moz://mozilla.org/schemas/glean/pings/2-0-0

crash:
  description: &gt;
    A ping to transport crash data
  include_client_id: true
  notification_emails:
    - crash@example.com
  bugs:
    - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
  data_reviews:
    - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
</code></pre>
<p>Before the newly defined metric or ping can be used, the application must first be built.  This will cause the <a href="https://github.com/mozilla/glean_parser/">glean_parser</a>
to execute and generate the API files that represent the metric and ping that were newly defined.</p>
<p><strong>Note:</strong> If changes to the YAML files aren't showing up in the project, try running the clean task on the project before
building any time one of the Glean YAML files has been modified.</p>
<p>It is recommended that Glean be initialized as early in the application startup as possible, which is why it's good to use a
custom <code>Application</code>, like the Glean Sample App <a href="https://github.com/mozilla/glean/blob/main/samples/android/app/src/main/java/org/mozilla/samples/glean/GleanApplication.kt"><code>GleanApplication.kt</code></a>.</p>
<p>Initializing Glean in the <code>Application.onCreate()</code> is ideal for this purpose.  Start by adding the import statement to allow
the usage of the custom ping that was created, adding the following to the top of the file:</p>
<pre><code class="language-Kotlin">import org.mozilla.gleancrashexample.GleanMetrics.Pings
</code></pre>
<p>Next, register the custom ping by calling <code>Glean.registerPings(Pings)</code> in the <code>onCreate()</code> function, preferably before calling
<code>Glean.initialize()</code>.  The completed function should look something like this:</p>
<pre><code class="language-Kotlin">override fun onCreate() {
  super.onCreate()

  // Register the application's custom pings.
  Glean.registerPings(Pings)

  // Initialize the Glean library
  Glean.initialize(applicationContext)
}

</code></pre>
<p>This completes the registration of the custom ping with the Glean Kotlin SDK so that it knows about it and can manage the storage and
other important details of it like sending it when <code>send()</code> is called.</p>
<h3 id="instrument-the-app-to-record-the-event"><a class="header" href="#instrument-the-app-to-record-the-event">Instrument The App To Record The Event</a></h3>
<p>In order to make the custom <code>Application</code> class handle uncaught exceptions, extend the class definition by adding
<code>Thread.UncaughtExceptionHandler</code> as an inherited class like this:</p>
<pre><code class="language-Kotlin">class MainActivity : AppCompatActivity(), Thread.UncaughtExceptionHandler {
    ...
}
</code></pre>
<p>As part of implementing the <code>Thread.UncaughtExceptionHandler</code> interface, the custom <code>Application</code> needs to implement the
override of the <code>uncaughtException()</code> function.  An example of this override that records data and sends the ping could look
something like this:</p>
<pre><code class="language-Kotlin">override fun uncaughtException(thread: Thread, exception: Throwable) {
    Crash.exception.record(
        mapOf(
            Crash.exceptionKeys.cause to exception.cause!!.toString(),
            Crash.exceptionKeys.message to exception.message!!
        )
    )
    Pings.crash.submit()
}
</code></pre>
<p>This records data to the <code>Crash.exception</code> metric from the <code>metrics.yaml</code>.  The category of the metric is <code>crash</code> and the name
is <code>exception</code> so it is accessed it by calling <code>record()</code> on the <code>Crash.exception</code> object.  The extra information for the
<code>cause</code> and the <code>message</code> is set as well.  Finally, calling <code>Pings.crash.submit()</code> forces the <code>crash</code> ping to be scheduled to be
sent.</p>
<p>The final step is to register the custom <code>Application</code> as the default uncaught exception handler by adding the following to the
<code>onCreate()</code> function after <code>Glean.initialize(this)</code>:</p>
<pre><code class="language-Kotlin">Thread.setDefaultUncaughtExceptionHandler(this)
</code></pre>
<h3 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h3>
<p>This information didn't really get recorded by anything, as it would be rejected by the telemetry pipeline unless the
application was already known.  In order to collect telemetry from a new application, there is additional work that is
necessary that is beyond the scope of this example.  In order for data to be collected from your project, metadata must be
added to the <code>probe_scraper</code>.  The instructions for accomplishing this can be found in the <a href="https://github.com/mozilla/probe-scraper#adding-a-new-glean-repository"><code>probe_scraper</code> documentation</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/android/instrument-android-crashes-example.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="glean-javascript-sdk"><a class="header" href="#glean-javascript-sdk">Glean JavaScript SDK</a></h1>
<p>The Glean JavaScript SDK allows integration with three distinct JavaScript environments: websites,
web extension and Node.js.</p>
<p>It is available as <a href="https://www.npmjs.com/package/@mozilla/glean"><code>@mozilla/glean</code> on npm</a>.
This package has different entry points to access the different SDKs.</p>
<ul>
<li><code>@mozilla/glean/web</code> gives access to the websites SDK</li>
<li><code>@mozilla/glean/webext</code> gives access to the web extension SDK</li>
<li><code>@mozilla/glean/node</code> gives access to the Node.js SDK</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/javascript/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="plugins"><a class="header" href="#plugins">Plugins</a></h1>
<p>The Glean JavaScript SDK accepts a plugin array as an initialization parameter.</p>
<pre><code class="language-js">import Glean from &quot;@mozilla/glean/webext&quot;
// This is not a real available plugin,
// it is a hypothetical one for illustration purposes.
import HypotheticalPlugin from &quot;@mozilla/glean/plugins/hypothetical&quot;

Glean.initialize(
  &quot;my.fancy.modified.app&quot;,
  uploadStatus,
  {
    plugins: [
      new HypotheticalPlugin(&quot;with&quot;, &quot;hypothetical&quot;, &quot;arguments&quot;)
    ]
  }
);
</code></pre>
<p>Plugins attach to specific internal events on the SDK and can modify its behavior.</p>
<p>A big advantage of plugins is that they can address very specific use cases of Glean without bloating the final size of the SDK or overloading Glean's configuration object.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="on-writing-your-own-plugins"><a class="header" href="#on-writing-your-own-plugins">On writing your own plugins</a></h2>
<blockquote>
<p>It is not currently possible for users to write their own plugins,
as this feature is still in its infancy.</p>
</blockquote>
<h2 id="available-plugins"><a class="header" href="#available-plugins">Available plugins</a></h2>
<h3 id="a-hreflanguage-bindingsjavascriptpluginsencryptionhtmlpingencryptionplugina"><a class="header" href="#a-hreflanguage-bindingsjavascriptpluginsencryptionhtmlpingencryptionplugina"><a href="language-bindings/javascript/plugins/./encryption.html">PingEncryptionPlugin</a></a></h3>
<p>The <code>PingEncryptionPlugin</code> encrypts the pings payloads before pings are sent.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/javascript/plugins/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="pingencryptionplugin"><a class="header" href="#pingencryptionplugin">PingEncryptionPlugin</a></h1>
<p>The <code>PingEncryptionPlugin</code> encrypts the pings payloads before pings are sent.</p>
<p>The encryption happens after a ping is collected and before it is sent, the scope
of this plugin does not include data encryption <em>before</em> collection. In other words,
Glean will still store plain data on the user's machine and the data will only be
encrypted during transit.</p>
<p>Encrypted pings will not be compliant with the usual <a href="https://github.com/mozilla-services/mozilla-pipeline-schemas/blob/main/schemas/glean/glean/glean.1.schema.json">Glean ping schema</a>.
Instead they will follow a specific encrypted ping schema that looks like this:</p>
<pre><code class="language-js">{
  &quot;payload&quot;: &quot;eyJhbGciOiJFQ0RILUVTI...&quot;
}
</code></pre>
<p>The schema has one field, <code>payload</code>, which is an unbounded string containing the output of the
encryption of the common Glean payload. Since JSON is the supported transport for our data ingestion
platform, the encrypted payload will be in the <a href="https://tools.ietf.org/html/rfc7516#section-3.1">JWE Compact Serialization</a>
format and must include a key id (<code>kid</code>) header identifying the public key used for encryption.
A matching key is derived from the document namespace that uniquely identifies the application
instead of the key id derived from the public key.</p>
<h2 id="requesting-an-encryption-key"><a class="header" href="#requesting-an-encryption-key">Requesting an encryption key</a></h2>
<p>The encryption key is provisioned by Data SRE and must be generated before new pings can be
successfully ingested into a data store. <strong>Without a valid encryption key, the Glean pipeline will</strong>
<strong>not be able to parse the pings and they will be thrown into the error stream.</strong></p>
<p>The encryption key should be requested as part of the process of adding a Glean application id to the ingestion pipeline (see <a href="language-bindings/javascript/plugins/../../../user/adding-glean-to-your-project/index.html">this checklist</a>).</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<h3 id="entry-point"><a class="header" href="#entry-point">Entry point</a></h3>
<pre><code class="language-js">//esm
import PingEncryptionPlugin from &quot;@mozilla/glean/plugins/encryption&quot;
// cjs
const { default: PingEncryptionPlugin } = require(&quot;@mozilla/glean/plugins/encryption&quot;);
</code></pre>
<h3 id="instantiating"><a class="header" href="#instantiating">Instantiating</a></h3>
<p>The <code>PingEncryptionPlugin</code> constructor expects a
<a href="https://datatracker.ietf.org/doc/html/rfc7516#section-4.1.5">JWK</a> as a parameter.
This JWK is the key provided by Data SRE during the
<a href="language-bindings/javascript/plugins/encryption.html#requesting-an-encryption-key">&quot;Requesting an encryption key&quot;</a> step.</p>
<pre><code class="language-js">Glean.initialize({
  &quot;my.fancy.encrypted.app&quot;,
  uploadStatus,
  {
    plugins: [
         new PingEncryptionPlugin({
              &quot;crv&quot;: &quot;P-256&quot;,
              &quot;kid&quot;: &quot;fancy&quot;,
              &quot;kty&quot;: &quot;EC&quot;,
              &quot;x&quot;: &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;,
              &quot;y&quot;: &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
         })
    ]
  }
});
</code></pre>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h4 id="note-on-logpings"><a class="header" href="#note-on-logpings">Note on <code>logPings</code></a></h4>
<blockquote>
<p>The <a href="language-bindings/javascript/plugins/../../../reference/debug/logPings.html">logPings</a> debug feature can still be used if
ping encryption is turned on. Pings will be logged in their plain format,
right before encryption happens.</p>
</blockquote>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/language-bindings/javascript/plugins/encryption.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<p>A glossary with explanations and background for wording used in the Glean project.</p>
<h2 id="glean"><a class="header" href="#glean">Glean</a></h2>
<p>According to the <a href="https://www.merriam-webster.com/dictionary/glean">dictionary</a> the word “glean” means:</p>
<blockquote>
<p>to gather information or material bit by bit</p>
</blockquote>
<p>Glean is the combination of the Glean SDK, the Glean pipeline &amp; Glean tools.</p>
<p>See also: <a href="https://docs.telemetry.mozilla.org/concepts/glean/glean.html">Glean - product analytics &amp; telemetry</a>.</p>
<h2 id="glean-pipeline"><a class="header" href="#glean-pipeline">Glean Pipeline</a></h2>
<p>The general data pipeline is the infrastructure that collects, stores, and analyzes telemetry data from our products and logs from various services.
See <a href="https://docs.telemetry.mozilla.org/concepts/pipeline/gcp_data_pipeline.html">An overview of Mozilla’s Data Pipeline</a>.</p>
<p>The Glean pipeline additionally consists of</p>
<ul>
<li>the <a href="https://github.com/mozilla/probe-scraper#glean-metrics-data-files">Probe Info Service</a>,</li>
<li>the <a href="https://github.com/mozilla/mozilla-schema-generator/">schema generator</a>,</li>
<li>the <a href="https://github.com/mozilla/jsonschema-transpiler">JSON Schema transpiler</a>,</li>
<li>the <a href="https://github.com/mozilla-services/mozilla-pipeline-schemas">ping schemas</a>.</li>
</ul>
<h2 id="glean-sdks"><a class="header" href="#glean-sdks">Glean SDKs</a></h2>
<p>The Glean SDKs are a bundle of libraries with support for different platforms.
The source code is available at <a href="https://github.com/mozilla/glean">https://github.com/mozilla/glean</a> and <a href="https://github.com/mozilla/glean.js">https://github.com/mozilla/glean.js</a>.</p>
<h2 id="glean-sdks-book"><a class="header" href="#glean-sdks-book">Glean SDKs book</a></h2>
<p>This documentation.</p>
<h2 id="glean-tools"><a class="header" href="#glean-tools">Glean tools</a></h2>
<p>Glean provides additional tools for its usage:</p>
<ul>
<li><a href="https://mozilla.github.io/glean_parser/">Glean parser</a> (Source code: <a href="https://github.com/mozilla/glean_parser/">https://github.com/mozilla/glean_parser/</a>)</li>
</ul>
<h2 id="metric"><a class="header" href="#metric">Metric</a></h2>
<p>Metrics are the individual things being measured using Glean.
They are defined in <a href="appendix/../reference/yaml/metrics.html">metrics.yaml</a> files, also known as <em>registry files</em>.</p>
<p>Glean itself provides <a href="appendix/../user/collected-metrics/metrics.html">some metrics out of the box</a>.</p>
<h2 id="ping"><a class="header" href="#ping">Ping</a></h2>
<p>A ping is a bundle of related metrics, gathered in a payload to be transmitted.
The Glean SDKs provide default pings and allows for custom pings, see <a href="appendix/../user/pings/index.html">Glean Pings</a>.</p>
<h2 id="submission"><a class="header" href="#submission">Submission</a></h2>
<p>&quot;To submit&quot; means to collect &amp; to enqueue a ping for uploading.</p>
<p>The Glean SDKs store locally all the metrics set by it or by its clients.
Each ping has its own schedule to gather all its locally saved metrics and create a JSON payload with them. This is called &quot;collection&quot;.</p>
<p>Upon successful collection, the payload is queued for upload, which may not happen immediately or at all (in case network connectivity is not available).</p>
<p>Unless the user has defined their own custom pings, they don’t need to worry too much about submitting pings.</p>
<p>All the default pings have their scheduling and submission handled by the SDK.</p>
<h2 id="measurement-window"><a class="header" href="#measurement-window">Measurement window</a></h2>
<p>The measurement window of a ping is the time frame in which metrics are being actively gathered for it.</p>
<p>The measurement window start time is the moment the previous ping is submitted. In the absence of a previous ping, this time will be the time the application process started.</p>
<p>The measurement window end time is the moment the current ping gets submitted. Any new metric recorded after submission will be part of the next ping, so this pings measurement window is over.</p>
<h2 id="this-week-in-glean-twig"><a class="header" href="#this-week-in-glean-twig">This Week in Glean (TWiG)</a></h2>
<p><a href="appendix/twig.html">This Week in Glean</a> is a series of blog posts that the Glean Team at Mozilla is using to try to communicate better about our work.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/glossary.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<ul>
<li><a href="appendix/changelog/./sdk.html"><code>mozilla/glean</code></a></li>
<li><a href="appendix/changelog/./js.html"><code>mozilla/glean.js</code></a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/changelog/index.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="unreleased-changes"><a class="header" href="#unreleased-changes">Unreleased changes</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v42.3.2...main">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Removed <code>invalid_timezone_offset</code> metric (<a href="https://github.com/mozilla/glean/pull/1923">#1923</a>)</li>
</ul>
</li>
<li>Python
<ul>
<li>It is now possible to emit log messages from the networking subprocess by using the new <code>log_level</code> parameter to <code>Glean.initialize</code>. (<a href="https://github.com/mozilla/glean/pull/1918">#1918</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4232-2021-12-15"><a class="header" href="#v4232-2021-12-15">v42.3.2 (2021-12-15)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v42.3.1...v42.3.2">Full changelog</a></p>
<ul>
<li>Python
<ul>
<li>Reuse existing environment when launching subprocess (<a href="https://github.com/mozilla/glean/pull/1908">#1908</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4231-2021-12-07"><a class="header" href="#v4231-2021-12-07">v42.3.1 (2021-12-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v42.3.0...v42.3.1">Full changelog</a></p>
<ul>
<li>iOS
<ul>
<li>Fix Carthage archive release (<a href="https://github.com/mozilla/glean/pull/1891">#1891</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4230-2021-12-07"><a class="header" href="#v4230-2021-12-07">v42.3.0 (2021-12-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v42.2.0...v42.3.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>BUGFIX: Correct category &amp; name for <code>preinit_tasks_overflow</code> metric. Previously it would have been wrongly recorded as <code>preinit_tasks_overflow.glean.error</code> (<a href="https://github.com/mozilla/glean/pull/1887">#1887</a>)</li>
<li>BUGFIX: Fix to name given to the events ping when instantiated (<a href="https://github.com/mozilla/glean/pull/1885">#1885</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>BUGFIX: Make fields of <code>RecordedEventData</code> publicly accessible (<a href="https://github.com/mozilla/glean/pull/1867">#1867</a>)</li>
<li>Skip code generation in <code>indexbuild</code> build (<a href="https://github.com/mozilla/glean/pull/1889">#1889</a>)</li>
</ul>
</li>
<li>Python
<ul>
<li>Don't let environment affect subprocess module search path (<a href="https://github.com/mozilla/glean/pull/1542">#1542</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4220-2021-11-03"><a class="header" href="#v4220-2021-11-03">v42.2.0 (2021-11-03)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v42.1.0...v42.2.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Updated <code>glean_parser</code> version to 4.3.1 (<a href="https://github.com/mozilla/glean/pull/1852">#1852</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>Automatic detection of <code>tags.yaml</code> files (<a href="https://github.com/mozilla/glean/pull/1852">#1852</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4210-2021-10-18"><a class="header" href="#v4210-2021-10-18">v42.1.0 (2021-10-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v42.0.1...v42.1.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Backwards-compatible API Change: Make experiment test APIs public. (<a href="https://github.com/mozilla/glean/pull/1834">#1834</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4201-2021-10-11"><a class="header" href="#v4201-2021-10-11">v42.0.1 (2021-10-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v42.0.0...v42.0.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>BUGFIX: Avoid a crash when accessing labeled metrics by caching created objects (<a href="https://github.com/mozilla/glean/pull/1823">#1823</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Glean now officially supports Python 3.10 (<a href="https://github.com/mozilla/glean/pull/1818">#1818</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4200-2021-10-06"><a class="header" href="#v4200-2021-10-06">v42.0.0 (2021-10-06)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v41.1.1...v42.0.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Updated to Gradle 7, Android Gradle Plugin 7 and Rust Android Plugin 0.9 as well as building with Java 11 (<a href="https://github.com/mozilla/glean/pull/1801">#1801</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>Add support for the URL metric type (<a href="https://github.com/mozilla/glean/pull/1791">#1791</a>)</li>
<li>Remove reliance on <code>Operation</code> for uploading and instead use the background capabilities of <code>URLSession</code> (<a href="https://github.com/mozilla/glean/pull/1783">#1783</a>)</li>
<li>Glean for iOS is now being built with Xcode 13.0.0 (<a href="https://github.com/mozilla/glean/pull/1802">#1802</a>).</li>
</ul>
</li>
<li>Rust
<ul>
<li>BUGFIX: No panic if trying to flush ping-lifetime data after shutdown (<a href="https://github.com/mozilla/glean/pull/1800">#1800</a>)</li>
<li>BREAKING CHANGE: <code>glean::persist_ping_lifetime_data</code> is now async (<a href="https://github.com/mozilla/glean/pull/1812">#1812</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4111-2021-09-29"><a class="header" href="#v4111-2021-09-29">v41.1.1 (2021-09-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v41.1.0...v41.1.1">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>BUGFIX: Limit logging to Glean crates (<a href="https://github.com/mozilla/glean/pull/1808">#1808</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4110-2021-09-16"><a class="header" href="#v4110-2021-09-16">v41.1.0 (2021-09-16)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v41.0.0...v41.1.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>BUGFIX: Ensure RLB persists ping lifetime data on shutdown (<a href="https://github.com/mozilla/glean/pull/1793">#1793</a>)</li>
<li>Expose <code>persist_ping_lifetime_data</code> in the RLB. Consumers can call this to persist data at convenient times, data is also persisted on shutdown (<a href="https://github.com/mozilla/glean/pull/1793">#1793</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4100-2021-09-13"><a class="header" href="#v4100-2021-09-13">v41.0.0 (2021-09-13)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v40.2.0...v41.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>BUGFIX: Only clear specified storage in delayed ping io mode (<a href="https://github.com/mozilla/glean/pull/1782">#1782</a>)</li>
<li>Require Rust &gt;= 1.53.0 (<a href="https://github.com/mozilla/glean/pull/1782">#1782</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li><code>Glean.initialize</code> now requires a <code>buildInfo</code> parameter to pass in build time version information. A suitable instance is generated by <code>glean_parser</code> in <code>${PACKAGE_ROOT}.GleanMetrics.GleanBuildInfo.buildInfo</code>. Support for not passing in a <code>buildInfo</code> object has been removed. (<a href="https://github.com/mozilla/glean/pull/1752">#1752</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4020-2021-09-08"><a class="header" href="#v4020-2021-09-08">v40.2.0 (2021-09-08)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v40.1.1...v40.2.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Updated <code>glean_parser</code> version to 4.0.0</li>
</ul>
</li>
<li>Android
<ul>
<li>Add support for the URL metric type (<a href="https://github.com/mozilla/glean/pull/1778">#1778</a>)</li>
</ul>
</li>
<li>Rust
<ul>
<li>Add support for the URL metric type (<a href="https://github.com/mozilla/glean/pull/1778">#1778</a>)</li>
</ul>
</li>
<li>Python
<ul>
<li>Add support for the URL metric type (<a href="https://github.com/mozilla/glean/pull/1778">#1778</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4011-2021-09-02"><a class="header" href="#v4011-2021-09-02">v40.1.1 (2021-09-02)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v40.1.0...v40.1.1">Full changelog</a></p>
<ul>
<li>iOS
<ul>
<li>Use 'Unknown' value if system data can't be decoded as UTF-8 (<a href="https://github.com/mozilla/glean/pull/1769">#1769</a>)</li>
<li>BUGFIX: Add quantity metric type to the build (<a href="https://github.com/mozilla/glean/pull/1774">#1774</a>). Previous builds are unable to use quantity metrics</li>
</ul>
</li>
</ul>
<h1 id="v4010-2021-08-25"><a class="header" href="#v4010-2021-08-25">v40.1.0 (2021-08-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v40.0.0...v40.1.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Updated to Kotlin 1.5, Android Gradle Plugin 4.2.2 and Gradle 6.7.1 (<a href="https://github.com/mozilla/glean/pull/1747">#1747</a>)</li>
<li>The <code>glean-gradle-plugin</code> now forces a compile failure when multiple Glean versions are detected in the build (<a href="https://github.com/mozilla/glean/pull/1756">#1756</a>)</li>
<li>The <code>glean-gradle-plugin</code> does not enable a <code>glean-native</code> capability on GeckoView anymore. That will be done by GeckoView directly (<a href="https://github.com/mozilla/glean/pull/1759">#1759</a>)</li>
</ul>
</li>
</ul>
<h1 id="v4000-2021-07-28"><a class="header" href="#v4000-2021-07-28">v40.0.0 (2021-07-28)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v39.1.0...v40.0.0">Full changelog</a></p>
<ul>
<li>
<p>Android</p>
<ul>
<li>
<p><strong>Breaking Change</strong>: Split the Glean Kotlin SDK into two packages: <code>glean</code> and <code>glean-native</code> (<a href="https://github.com/mozilla/glean/pull/1595">#1595</a>).
Consumers will need to switch to <code>org.mozilla.telemetry:glean-native-forUnitTests</code>.
Old code in <code>build.gradle</code>:</p>
<pre><code>testImplementation &quot;org.mozilla.telemetry:glean-forUnitTests:${project.ext.glean_version}&quot;
</code></pre>
<p>New code in <code>build.gradle</code>:</p>
<pre><code>testImplementation &quot;org.mozilla.telemetry:glean-native-forUnitTests:${project.ext.glean_version}&quot;
</code></pre>
</li>
<li>
<p>The <code>glean-gradle-plugin</code> now automatically excludes the <code>glean-native</code> dependency if <code>geckoview-omni</code> is also part of the build.
Glean native functionality will be provided by the <code>geckoview-omni</code> package.</p>
</li>
</ul>
</li>
<li>
<p>Rust</p>
<ul>
<li>The <code>glean-ffi</code> is no longer compiled as a <code>cdylib</code>. Other language SDKs consume <code>glean-bundle</code> instead as a <code>cdylib</code>.
This doesn't affect consumers.</li>
</ul>
</li>
</ul>
<h1 id="v3910-2021-07-26"><a class="header" href="#v3910-2021-07-26">v39.1.0 (2021-07-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v39.0.4...v39.1.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Updated <code>glean_parser</code> version to 3.6.0</li>
<li>Allow Custom Distribution metric type on all platforms (<a href="https://github.com/mozilla/glean/pull/1679">#1679</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3904-2021-07-26"><a class="header" href="#v3904-2021-07-26">v39.0.4 (2021-07-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v39.0.3...v39.0.4">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Extend <code>invalid_timezone_offset</code> metric until the end of the year (<a href="https://github.com/mozilla/glean/pull/1697">#1697</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3903-2021-06-09"><a class="header" href="#v3903-2021-06-09">v39.0.3 (2021-06-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v39.0.2...v39.0.3">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Unbreak Event#record API by accepting <code>null</code> on the deprecated API.
The previous 39.0.0 release introduced the new API, but accidentally broke certain callers that just forward arguments.
This restores passing <code>null</code> (or nothing) when using the old API. It remains deprecated.</li>
</ul>
</li>
</ul>
<h1 id="v3902-2021-06-07"><a class="header" href="#v3902-2021-06-07">v39.0.2 (2021-06-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v39.0.1...v39.0.2">Full changelog</a></p>
<ul>
<li>iOS
<ul>
<li>Fix iOS release build (<a href="https://github.com/mozilla/glean/pull/1668">#1668</a>, <a href="https://github.com/mozilla/glean/pull/1669">#1669</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3901-2021-06-04"><a class="header" href="#v3901-2021-06-04">v39.0.1 (2021-06-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v39.0.0...v39.0.1">Full changelog</a></p>
<ul>
<li>iOS
<ul>
<li>Build and release Glean as an xcframework (<a href="https://github.com/mozilla/glean/pull/1663">#1663</a>)
This will now also auto-update the Glean package at https://github.com/mozilla/glean-swift.</li>
</ul>
</li>
</ul>
<h1 id="v3900-2021-05-31"><a class="header" href="#v3900-2021-05-31">v39.0.0 (2021-05-31)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v38.0.1...v39.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Add new event extras API to all implementations. See below for details (<a href="https://github.com/mozilla/glean/pull/1603">#1603</a>)</li>
<li>Updated <code>glean_parser</code> version to 3.4.0 (<a href="https://github.com/mozilla/glean/pull/1603">#1603</a>)</li>
</ul>
</li>
<li>Rust
<ul>
<li>
<p><strong>Breaking Change</strong>: Allow event extras to be passed as an object.
This replaces the old <code>HashMap</code>-based API.
Values default to <code>string</code>.
See <a href="https://mozilla.github.io/glean/book/reference/metrics/event.html#recordobject">the event documentation</a> for details.
(<a href="https://github.com/mozilla/glean/pull/1603">#1603</a>)
Old code:</p>
<pre><code>let mut extra = HashMap::new();
extra.insert(SomeExtra::Key1, &quot;1&quot;.into());
extra.insert(SomeExtra::Key2, &quot;2&quot;.into());
metric.record(extra);
</code></pre>
<p>New code:</p>
<pre><code>let extra = SomeExtra {
    key1: Some(&quot;1&quot;.into()),
    key2: Some(&quot;2&quot;.into()),
};
metric.record(extra);
</code></pre>
</li>
</ul>
</li>
<li>Android
<ul>
<li><strong>Deprecation</strong>: The old event recording API is replaced by a new one, accepting a typed object (<a href="https://github.com/mozilla/glean/pull/1603">#1603</a>).
See <a href="https://mozilla.github.io/glean/book/reference/metrics/event.html#recordobject">the event documentation</a> for details.</li>
<li>Skip build info generation for libraries (<a href="https://github.com/mozilla/glean/pull/1654">#1654</a>)</li>
</ul>
</li>
<li>Python
<ul>
<li><strong>Deprecation</strong>: The old event recording API is replaced by a new one, accepting a typed object (<a href="https://github.com/mozilla/glean/pull/1603">#1603</a>).
See <a href="https://mozilla.github.io/glean/book/reference/metrics/event.html#recordobject">the event documentation</a> for details.</li>
</ul>
</li>
<li>Swift
<ul>
<li><strong>Deprecation</strong>: The old event recording API is replaced by a new one, accepting a typed object (<a href="https://github.com/mozilla/glean/pull/1603">#1603</a>).
See <a href="https://mozilla.github.io/glean/book/reference/metrics/event.html#recordobject">the event documentation</a> for details.</li>
</ul>
</li>
</ul>
<h1 id="v3801-2021-05-17"><a class="header" href="#v3801-2021-05-17">v38.0.1 (2021-05-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v38.0.0...v38.0.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>BUGFIX: Invert the lock order in glean-core's metrics ping scheduler (<a href="https://github.com/mozilla/glean/pull/1637">#1637</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3800-2021-05-12"><a class="header" href="#v3800-2021-05-12">v38.0.0 (2021-05-12)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v37.0.0...v38.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Update documentation to recommend using Glean Dictionary instead of metrics.md (<a href="https://github.com/mozilla/glean/pull/1604">#1604</a>)</li>
</ul>
</li>
<li>Rust
<ul>
<li><strong>Breaking Change</strong>: Don't return a result from <code>submit_ping</code>. The boolean return value indicates whether a ping was submitted (<a href="https://github.com/mozilla/glean/pull/1613">#1613</a>)</li>
<li><strong>Breaking Change</strong>: Glean now schedules &quot;metrics&quot; pings, accepting a new Configuration parameter. (<a href="https://github.com/mozilla/glean/pull/1599">#1599</a>)</li>
<li>Dispatch setting the source tag to avoid a potential crash (<a href="https://github.com/mozilla/glean/pull/1614">#1614</a>)</li>
<li>Testing mode will wait for init &amp; upload tasks to finish (<a href="https://github.com/mozilla/glean/pull/1628">#1628</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>Set required fields for <code>client_info</code> before optional ones (<a href="https://github.com/mozilla/glean/pull/1633">#1633</a>)</li>
<li>Provide forward-compatibility with Gradle 6.8 (<a href="https://github.com/mozilla/glean/pull/1633">#1616</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3700-2021-04-30"><a class="header" href="#v3700-2021-04-30">v37.0.0 (2021-04-30)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v36.0.1...v37.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li><strong>Breaking Change</strong>: &quot;deletion-request&quot; pings now include the reason upload was disabled: <code>at_init</code> (Glean detected a change between runs) or <code>set_upload_enabled</code> (Glean was told of a change as it happened). (<a href="https://github.com/mozilla/glean/pull/1593">#1593</a>).</li>
<li>Attempt to upload a ping even in the face of IO Errors (<a href="https://github.com/mozilla/glean/pull/1576">#1576</a>).</li>
<li>Implement an additional check to avoid crash due to faulty timezone offset (<a href="https://github.com/mozilla/glean/pull/1581">#1581</a>)
<ul>
<li>This now records a new metric <code>glean.time.invalid_timezone_offset</code>, counting how often we failed to get a valid timezone offset.</li>
</ul>
</li>
<li>Use proper paths throughout to hopefully handle non-UTF-8 paths more gracefully (<a href="https://github.com/mozilla/glean/pull/1596">#1596</a>)</li>
<li>Updated <code>glean_parser</code> version to 3.2.0 (<a href="https://github.com/mozilla/glean/pull/1608">#1609</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>Code generator: Ensure at least pip 20.3 is available in iOS build (<a href="https://github.com/mozilla/glean/pull/1590">#1590</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3601-2021-04-09"><a class="header" href="#v3601-2021-04-09">v36.0.1 (2021-04-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v36.0.0...v36.0.1">Full changelog</a></p>
<ul>
<li>RLB
<ul>
<li>Provide an internal-use-only API to pass in raw samples for timing distributions (<a href="https://github.com/mozilla/glean/pull/1561">#1561</a>).</li>
<li>Expose Timespan's <code>set_raw</code> to Rust (<a href="https://github.com/mozilla/glean/pull/1578">#1578</a>).</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: <code>TimespanMetricType.measure</code> and <code>TimingDistributionMetricType.measure</code> won't get inlined anymore (<a href="https://github.com/mozilla/glean/pull/1560">#1560</a>).
This avoids a potential bug where a <code>return</code> used inside the closure would end up not measuring the time.
Use <code>return@measure &lt;val&gt;</code> for early returns.</li>
</ul>
</li>
<li>Python
<ul>
<li>The Glean Python bindings now use rkv's safe mode backend. This should avoid intermittent segfaults in the LMDB backend.</li>
</ul>
</li>
</ul>
<h1 id="v3600-2021-03-16"><a class="header" href="#v3600-2021-03-16">v36.0.0 (2021-03-16)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v35.0.0...v36.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Introduce a new API <code>Ping#test_before_next_submit</code> to run a callback right before a custom ping is submitted (<a href="https://github.com/mozilla/glean/pull/1507">#1507</a>).
<ul>
<li>The new API exists for all language bindings (Kotlin, Swift, Rust, Python).</li>
</ul>
</li>
<li>Updated <code>glean_parser</code> version to 2.5.0</li>
<li>Change the <code>fmt-</code> and <code>lint-</code> make commands for consistency (<a href="https://github.com/mozilla/glean/pull/1526">#1526</a>)</li>
<li>The Glean SDK can now produce testing coverage reports for your metrics (<a href="https://github.com/mozilla/glean/pull/1482/files">#1482</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Update minimal required version of <code>cffi</code> dependency to 1.13.0 (<a href="https://github.com/mozilla/glean/pull/1520">#1520</a>).</li>
<li>Ship wheels for arm64 macOS (<a href="https://github.com/mozilla/glean/pull/1534">#1534</a>).</li>
</ul>
</li>
<li>RLB
<ul>
<li>Added <code>rate</code> metric type (<a href="https://github.com/mozilla/glean/pull/1516">#1516</a>).</li>
<li>Set <code>internal_metrics::os_version</code> for MacOS, Windows and Linux (<a href="https://github.com/mozilla/glean/pull/1538">#1538</a>)</li>
<li>Expose a function <code>get_timestamp_ms</code> to get a timestamp from a monotonic clock on all supported operating systems, to be used for event timestamps (<a href="https://github.com/mozilla/glean/pull/1546">#1546</a>).</li>
<li>Expose a function to record events with an externally provided timestamp.</li>
</ul>
</li>
<li>iOS
<ul>
<li><strong>Breaking Change</strong>: Event timestamps are now correctly recorded in milliseconds (<a href="https://github.com/mozilla/glean/pull/1546">#1546</a>).
<ul>
<li>Since the first release event timestamps were erroneously recorded with nanosecond precision (<a href="https://github.com/mozilla/glean/pull/1549">#1549</a>).
This is now fixed and event timestamps are in milliseconds.
This is equivalent to how it works in all other language bindings.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="v3500-2021-02-22"><a class="header" href="#v3500-2021-02-22">v35.0.0 (2021-02-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v34.1.0...v35.0.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li><code>Glean.initialize</code> can now take a <code>buildInfo</code> parameter to pass in build time version information, and avoid calling out to the Android package manager at runtime. A suitable instance is generated by <code>glean_parser</code> in <code>${PACKAGE_ROOT}.GleanMetrics.GleanBuildInfo.buildInfo</code> (<a href="https://github.com/mozilla/glean/pull/1495">#1495</a>). Not passing in a <code>buildInfo</code> object is still supported, but is deprecated.</li>
<li>The <code>testGetValue</code> APIs now include a message on the <code>NullPointerException</code> thrown when the value is missing.</li>
<li><strong>Breaking change:</strong> <code>LEGACY_TAG_PINGS</code> is removed from <code>GleanDebugActivity</code> (<a href="https://github.com/mozilla/glean/pull/1510">#1510</a>)</li>
</ul>
</li>
<li>RLB
<ul>
<li><strong>Breaking change:</strong> <code>Configuration.data_path</code> is now a <code>std::path::PathBuf</code>(<a href="https://github.com/mozilla/glean/pull/1493">#1493</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3410-2021-02-04"><a class="header" href="#v3410-2021-02-04">v34.1.0 (2021-02-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v34.0.0...v34.1.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>A new metric <code>glean.validation.pings_submitted</code> tracks the number of pings sent. It is included in both the <code>metrics</code> and <code>baseline</code> pings.</li>
</ul>
</li>
<li>iOS
<ul>
<li>The metric <code>glean.validation.foreground_count</code> is now sent in the metrics ping (<a href="https://github.com/mozilla/glean/pull/1472">#1472</a>).</li>
<li>BUGFIX: baseline pings with reason <code>dirty_startup</code> are no longer sent if Glean did not full initialize in the previous run (<a href="https://github.com/mozilla/glean/pull/1476">#1476</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Expose the client activity API (<a href="https://github.com/mozilla/glean/pull/1481">#1481</a>).</li>
<li>BUGFIX: Publish a macOS wheel again. The previous release failed to build a Python wheel for macOS platforms (<a href="https://github.com/mozilla/glean/pull/1471">#1471</a>).</li>
</ul>
</li>
<li>RLB
<ul>
<li>BUGFIX: baseline pings with reason <code>dirty_startup</code> are no longer sent if Glean did shutdown cleanly (<a href="https://github.com/mozilla/glean/pull/1483">#1483</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3400-2021-01-29"><a class="header" href="#v3400-2021-01-29">v34.0.0 (2021-01-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.3...v34.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Other bindings detect when RLB is used and try to flush the RLB dispatcher to unblock the Rust API (<a href="https://github.com/mozilla/glean/pull/1442">#1442</a>).
<ul>
<li>This is detected automatically, no changes needed for consuming code.</li>
</ul>
</li>
<li>Add support for the client activity API (<a href="https://github.com/mozilla/glean/pull/1455">#1455</a>). This API is either automatically used or exposed by the language bindings.</li>
<li>Rename the reason <code>background</code> to <code>inactive</code> for both the <code>baseline</code> and <code>events</code> ping. Rename the reason <code>foreground</code> to <code>active</code> for the <code>baseline</code> ping.</li>
</ul>
</li>
<li>RLB
<ul>
<li>When the pre-init task queue overruns, this is now recorded in the metric <code>glean.error.preinit_tasks_overflow</code> (<a href="https://github.com/mozilla/glean/pull/1438">#1438</a>).</li>
<li>Expose the client activity API (<a href="https://github.com/mozilla/glean/pull/1455">#1455</a>).</li>
<li>Send the <code>baseline</code> ping with reason <code>dirty_startup</code>, if needed, at startup.</li>
<li>Expose all required types directly (<a href="https://github.com/mozilla/glean/pull/1452">#1452</a>).
<ul>
<li>Rust consumers will not need to depend on <code>glean-core</code> anymore.</li>
</ul>
</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: Don't crash the ping uploader when throttled due to reading too large wait time values (<a href="https://github.com/mozilla/glean/pull/1454">#1454</a>).</li>
<li>Use the client activity API (<a href="https://github.com/mozilla/glean/pull/1455">#1455</a>).</li>
<li>Update <code>AndroidX</code> dependencies (<a href="https://github.com/mozilla/glean/pull/1441">#1441</a>).</li>
</ul>
</li>
<li>iOS
<ul>
<li>Use the client activity API (<a href="https://github.com/mozilla/glean/pull/1465">#1465</a>).
Note: this now introduces a baseline ping with reason <code>active</code> on startup.</li>
</ul>
</li>
</ul>
<h1 id="v33103-2021-01-18"><a class="header" href="#v33103-2021-01-18">v33.10.3 (2021-01-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.2...v33.10.3">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Upgrade rkv to 0.17 (<a href="https://github.com/mozilla/glean/pull/1434">#1434</a>)</li>
</ul>
</li>
</ul>
<h1 id="v33102-2021-01-15"><a class="header" href="#v33102-2021-01-15">v33.10.2 (2021-01-15)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.1...v33.10.2">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>A new metric <code>glean.error.io</code> has been added, counting the times an IO error happens when writing a pending ping to disk (<a href="https://github.com/mozilla/glean/pull/1428">#1428</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>A new metric <code>glean.validation.foreground_count</code> was added to the metrics ping (<a href="https://github.com/mozilla/glean/pull/1418">#1418</a>).</li>
</ul>
</li>
<li>Rust
<ul>
<li>BUGFIX: Fix lock order inversion in RLB Timing Distribution (<a href="https://github.com/mozilla/glean/pull/1431">#1431</a>).</li>
<li>Use RLB types instead of glean-core ones for RLB core metrics. (<a href="https://github.com/mozilla/glean/pull/1432">#1432</a>).</li>
</ul>
</li>
</ul>
<h1 id="v33101-2021-01-06"><a class="header" href="#v33101-2021-01-06">v33.10.1 (2021-01-06)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.10.0...v33.10.1">Full changelog</a></p>
<p>No functional changes. v33.10.0 failed to generated iOS artifacts due to broken tests (<a href="https://github.com/mozilla/glean/pull/1421">#1421</a>).</p>
<h1 id="v33100-2021-01-06"><a class="header" href="#v33100-2021-01-06">v33.10.0 (2021-01-06)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.9.1...v33.10.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>A new metric <code>glean.validation.first_run_hour</code>, analogous to the existing <code>first_run_date</code> but with hour resolution, has been added. Only clients running the app for the first time after this change will report this metric (<a href="https://github.com/mozilla/glean/pull/1403">#1403</a>).</li>
</ul>
</li>
<li>Rust
<ul>
<li>BUGFIX: Don't require mutable references in RLB traits (<a href="https://github.com/mozilla/glean/pull/1417">#1417</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Building the Python package from source now works on musl-based Linux distributions, such as Alpine Linux (<a href="https://github.com/mozilla/glean/pull/1416">#1416</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3391-2020-12-17"><a class="header" href="#v3391-2020-12-17">v33.9.1 (2020-12-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.9.0...v33.9.1">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>BUGFIX: Don't panic on shutdown and avoid running tasks if uninitialized (<a href="https://github.com/mozilla/glean/pull/1398">#1398</a>).</li>
<li>BUGFIX: Don't fail on empty database files (<a href="https://github.com/mozilla/glean/pull/1398">#1398</a>).</li>
<li>BUGFIX: Support ping registration before Glean initializes (<a href="https://github.com/mozilla/glean/pull/1393">#1393</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3390-2020-12-15"><a class="header" href="#v3390-2020-12-15">v33.9.0 (2020-12-15)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.8.0...v33.9.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Introduce the String List metric type in the RLB. (<a href="https://github.com/mozilla/glean/pull/1380">#1380</a>).</li>
<li>Introduce the <code>Datetime</code> metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1384">#1384</a>).</li>
<li>Introduce the <code>CustomDistribution</code> and <code>TimingDistribution</code> metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1394">#1394</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3380-2020-12-10"><a class="header" href="#v3380-2020-12-10">v33.8.0 (2020-12-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.7.0...v33.8.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Introduce the Memory Distribution metric type in the RLB. (<a href="https://github.com/mozilla/glean/pull/1376">#1376</a>).</li>
<li>Shut down Glean in tests before resetting to make sure they don't mistakenly init Glean twice in parallel (<a href="https://github.com/mozilla/glean/pull/1375">#1375</a>).</li>
<li>BUGFIX: Fixing 2 <code>lock-order-inversion</code> bugs found by TSan (<a href="https://github.com/mozilla/glean/pull/1378">#1378</a>).
<ul>
<li>TSan runs on mozilla-central tests, which found two (potential) bugs where 2 different locks were acquired in opposite order in different code paths,
which could lead to deadlocks in multi-threaded code. As RLB uses multiple threads (e.g. for init and the dispatcher) by default, this can easily become an actual issue.</li>
</ul>
</li>
</ul>
</li>
<li>Python
<ul>
<li>All log messages from the Glean SDK are now on the <code>glean</code> logger, obtainable through <code>logging.getLogger(&quot;glean&quot;)</code>.  (Prior to this, each module had its own logger, for example <code>glean.net.ping_upload_worker</code>).</li>
</ul>
</li>
</ul>
<h1 id="v3370-2020-12-07"><a class="header" href="#v3370-2020-12-07">v33.7.0 (2020-12-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.6.0...v33.7.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Upgrade rkv to 0.16.0 (no functional changes) (<a href="https://github.com/mozilla/glean/pull/1355">#1355</a>).</li>
<li>Introduce the Event metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1361">#1361</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Python Linux wheels no longer work on Linux distributions released before 2014 (they now use the manylinux2014 ABI) (<a href="https://github.com/mozilla/glean/pull/1353">#1353</a>).</li>
<li>Unbreak Python on non-Linux ELF platforms (BSD, Solaris/illumos) (<a href="https://github.com/mozilla/glean/pull/1363">#1363</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3360-2020-12-02"><a class="header" href="#v3360-2020-12-02">v33.6.0 (2020-12-02)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.5.0...v33.6.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>BUGFIX: Negative timespans for the timespan metric now correctly record an <code>InvalidValue</code> error (<a href="https://github.com/mozilla/glean/pull/1347">#1347</a>).</li>
<li>Introduce the Timespan metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1347">#1347</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Network slowness or errors will no longer block the main dispatcher thread, leaving work undone on shutdown (<a href="https://github.com/mozilla/glean/pull/1350">#1350</a>).</li>
<li>BUGFIX: Lower sleep time on upload waits to avoid being stuck when the main process ends (<a href="https://github.com/mozilla/glean/pull/1349">#1349</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3350-2020-12-01"><a class="header" href="#v3350-2020-12-01">v33.5.0 (2020-12-01)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.4.0...v33.5.0">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Introduce the UUID metric type in the RLB.</li>
<li>Introduce the Labeled metric type in the RLB (<a href="https://github.com/mozilla/glean/pull/1327">#1327</a>).</li>
<li>Introduce the Quantity metric type in the RLB.</li>
<li>Introduce the <code>shutdown</code> API.</li>
<li>Add Glean debugging APIs.</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Setting a UUID metric to a value that is not in the expected UUID format will now record an error with the Glean error reporting system.</li>
</ul>
</li>
</ul>
<h1 id="v3340-2020-11-17"><a class="header" href="#v3340-2020-11-17">v33.4.0 (2020-11-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.3.0...v33.4.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>When Rkv's safe mode is enabled (<code>features = [&quot;rkv-safe-mode&quot;]</code> on the <code>glean-core</code> crate) LMDB data is migrated at first start (<a href="https://github.com/mozilla/glean/pull/1322">#1322</a>).</li>
</ul>
</li>
<li>Rust
<ul>
<li>Introduce the Counter metric type in the RLB.</li>
<li>Introduce the String metric type in the RLB.</li>
<li>BUGFIX: Track the size of the database directory at startup (<a href="https://github.com/mozilla/glean/pull/1304">#1304</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Fix too-long sleep time in uploader due to unit mismatch (<a href="https://github.com/mozilla/glean/pull/1325">#1325</a>).</li>
</ul>
</li>
<li>Swift
<ul>
<li>BUGFIX: Fix too-long sleep time in uploader due to unit mismatch (<a href="https://github.com/mozilla/glean/pull/1325">#1325</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3330-2020-11-12"><a class="header" href="#v3330-2020-11-12">v33.3.0 (2020-11-12)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.2.0...v33.3.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Do not require default-features on rkv and downgrade bincode (<a href="https://github.com/mozilla/glean/pull/1317">#1317</a>)</li>
</ul>
</li>
<li>Rust
<ul>
<li>Implement the experiments API (<a href="https://github.com/mozilla/glean/pull/1314">#1314</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3320-2020-11-10"><a class="header" href="#v3320-2020-11-10">v33.2.0 (2020-11-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.1.2...v33.2.0">Full changelog</a></p>
<ul>
<li>Python
<ul>
<li>Fix building of Linux wheels (<a href="https://github.com/mozilla/glean/pull/1303">#1303</a>)
<ul>
<li>Python Linux wheels no longer work on Linux distributions released before 2010. (They now use the manylinux2010 ABI, rather than the manylinux1 ABI.)</li>
</ul>
</li>
</ul>
</li>
<li>Rust
<ul>
<li>Introduce the RLB <code>net</code> module (<a href="https://github.com/mozilla/glean/pull/1292">#1292</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3312-2020-11-04"><a class="header" href="#v3312-2020-11-04">v33.1.2 (2020-11-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.1.1...v33.1.2">Full changelog</a></p>
<ul>
<li>No changes.  v33.1.1 was tagged incorrectly.</li>
</ul>
<h1 id="v3311-2020-11-04"><a class="header" href="#v3311-2020-11-04">v33.1.1 (2020-11-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.1.0...v33.1.1">Full changelog</a></p>
<ul>
<li>No changes.  v33.1.0 was tagged incorrectly.</li>
</ul>
<h1 id="v3310-2020-11-04"><a class="header" href="#v3310-2020-11-04">v33.1.0 (2020-11-04)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.4...v33.1.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Standardize throttle backoff time throughout all bindings. (<a href="https://github.com/mozilla/glean/pull/1240">#1240</a>)</li>
<li>Update <code>glean_parser</code> to 1.29.0
<ul>
<li>Generated code now includes a comment next to each metric containing the name of the metric in its original <code>snake_case</code> form.</li>
</ul>
</li>
<li>Expose the description of the metric types in glean_core using traits.</li>
</ul>
</li>
<li>Rust
<ul>
<li>Add the <code>BooleanMetric</code> type.</li>
<li>Add the <code>dispatcher</code> module (copied over from <a href="https://hg.mozilla.org/mozilla-central/rev/fbe0ea62f4bb50bfc5879a56667945697b2c90e7">mozilla-central</a>).</li>
<li>Allow consumers to specify a custom uploader.</li>
</ul>
</li>
<li>Android
<ul>
<li>Update the JNA dependency from 5.2.0 to 5.6.0</li>
<li>The <code>glean-gradle-plugin</code> now makes sure that only a single Miniconda installation will happen at the same time to avoid a race condition when multiple components within the same project are using Glean.</li>
</ul>
</li>
</ul>
<h1 id="v3304-2020-09-28"><a class="header" href="#v3304-2020-09-28">v33.0.4 (2020-09-28)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.3...v33.0.4">Full changelog</a></p>
<p>Note: Previous 33.0.z releases were broken. This release now includes all changes from 33.0.0 to 33.0.3.</p>
<ul>
<li>General
<ul>
<li>Update <code>glean_parser</code> to 1.28.6
<ul>
<li>BUGFIX: Ensure Kotlin arguments are deterministically ordered</li>
</ul>
</li>
</ul>
</li>
<li>Android
<ul>
<li><strong>Breaking change:</strong> Updated to the Android Gradle Plugin v4.0.1 and Gradle 6.5.1. Projects using older versions of these components will need to update in order to use newer versions of the Glean SDK.</li>
<li>Update the Kotlin Gradle Plugin to version 1.4.10.</li>
<li>Fixed the building of <code>.aar</code> releases on Android so they include the Rust shared objects.</li>
</ul>
</li>
</ul>
<h1 id="v3303-2020-09-25"><a class="header" href="#v3303-2020-09-25">v33.0.3 (2020-09-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.2...v33.0.3">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>v33.0.2 was tagged incorrectly. This release is just to correct that mistake.</li>
</ul>
</li>
</ul>
<h1 id="v3302-2020-09-25"><a class="header" href="#v3302-2020-09-25">v33.0.2 (2020-09-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.1...v33.0.2">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Fixed the building of <code>.aar</code> releases on Android so they include the Rust shared objects.</li>
</ul>
</li>
</ul>
<h1 id="v3301-2020-09-24"><a class="header" href="#v3301-2020-09-24">v33.0.1 (2020-09-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v33.0.0...v33.0.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Update <code>glean_parser</code> to 1.28.6
<ul>
<li>BUGFIX: Ensure Kotlin arguments are deterministically ordered</li>
</ul>
</li>
</ul>
</li>
<li>Android
<ul>
<li>Update the Kotlin Gradle Plugin to version 1.4.10.</li>
</ul>
</li>
</ul>
<h1 id="v3300-2020-09-22"><a class="header" href="#v3300-2020-09-22">v33.0.0 (2020-09-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.4.0...v33.0.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li><strong>Breaking change:</strong> Updated to the Android Gradle Plugin v4.0.1 and Gradle 6.5.1. Projects using older versions of these components will need to update in order to use newer versions of the Glean SDK.</li>
</ul>
</li>
</ul>
<h1 id="v3241-2020-10-01"><a class="header" href="#v3241-2020-10-01">v32.4.1 (2020-10-01)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.4.0...v32.4.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Update <code>glean_parser</code> to 1.28.6
<ul>
<li>BUGFIX: Ensure Kotlin arguments are deterministically ordered</li>
</ul>
</li>
<li>BUGFIX: Transform ping directory size from bytes to kilobytes before accumulating to <code>glean.upload.pending_pings_directory_size</code> (<a href="https://github.com/mozilla/glean/pull/1236">#1236</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3240-2020-09-18"><a class="header" href="#v3240-2020-09-18">v32.4.0 (2020-09-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.3.2...v32.4.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Allow using quantity metric type outside of Gecko (<a href="https://github.com/mozilla/glean/pull/1198">#1198</a>)</li>
<li>Update <code>glean_parser</code> to 1.28.5
<ul>
<li>The <code>SUPERFLUOUS_NO_LINT</code> warning has been removed from the glinter. It likely did more harm than good, and makes it hard to make metrics.yaml files that pass across different versions of <code>glean_parser</code>.</li>
<li>Expired metrics will now produce a linter warning, <code>EXPIRED_METRIC</code>.</li>
<li>Expiry dates that are more than 730 days (~2 years) in the future will produce a linter warning, <code>EXPIRATION_DATE_TOO_FAR</code>.</li>
<li>Allow using the Quantity metric type outside of Gecko.</li>
<li>New parser configs <code>custom_is_expired</code> and <code>custom_validate_expires</code> added. These are both functions that take the expires value of the metric and return a bool. (See <code>Metric.is_expired</code> and <code>Metric.validate_expires</code>). These will allow FOG to provide custom validation for its version-based <code>expires</code> values.</li>
</ul>
</li>
<li>Add a limit of 250 pending ping files. (<a href="https://github.com/mozilla/glean/pull/1217">#1217</a>).</li>
</ul>
</li>
<li>Android
<ul>
<li>Don't retry the ping uploader when waiting, sleep instead. This avoids a never-ending increase of the backoff time (<a href="https://github.com/mozilla/glean/pull/1217">#1217</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3232-2020-09-11"><a class="header" href="#v3232-2020-09-11">v32.3.2 (2020-09-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.3.1...v32.3.2">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Track the size of the database file at startup (<a href="https://github.com/mozilla/glean/pull/1141">#1141</a>).</li>
<li>Submitting a ping with upload disabled no longer shows an error message (<a href="https://github.com/mozilla/glean/pull/1201">#1201</a>).</li>
<li>BUGFIX: scan the pending pings directories <strong>after</strong> dealing with upload status on initialization. This is important, because in case upload is disabled we delete any outstanding non-deletion ping file, and if we scan the pending pings folder before doing that we may end up sending pings that should have been discarded. (<a href="https://github.com/mozilla/glean/pull/1205">#1205</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>Disabled code coverage in release builds (<a href="https://github.com/mozilla/glean/issues/1195">#1195</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Glean now ships a source package to pip install on platforms where wheels aren't provided.</li>
</ul>
</li>
</ul>
<h1 id="v3231-2020-09-09"><a class="header" href="#v3231-2020-09-09">v32.3.1 (2020-09-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.3.0...v32.3.1">Full changelog</a></p>
<ul>
<li>Python
<ul>
<li>Fixed the release process to generate all wheels (<a href="https://github.com/mozilla/glean/pull/1193">#1193</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3230-2020-08-27"><a class="header" href="#v3230-2020-08-27">v32.3.0 (2020-08-27)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.2.0...v32.3.0">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Handle ping registration off the main thread. This removes a potential blocking call (<a href="https://github.com/mozilla/glean/pull/1132">#1132</a>).</li>
</ul>
</li>
<li>iOS
<ul>
<li>Handle ping registration off the main thread. This removes a potential blocking call (<a href="https://github.com/mozilla/glean/pull/1132">#1132</a>).</li>
<li>Glean for iOS is now being built with Xcode 12.0.0 (Beta 5) (<a href="https://github.com/mozilla/glean/pull/1170">#1170</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3220-2020-08-25"><a class="header" href="#v3220-2020-08-25">v32.2.0 (2020-08-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.1.1...v32.2.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Move logic to limit the number of retries on ping uploading &quot;recoverable failures&quot; to glean-core. (<a href="https://github.com/mozilla/glean/pull/1120">#1120</a>)
<ul>
<li>The functionality to limit the number of retries in these cases was introduced to the Glean SDK in <code>v31.1.0</code>. The work done now was to move that logic to the glean-core in order to avoid code duplication throughout the language bindings.</li>
</ul>
</li>
<li>Update <code>glean_parser</code> to <code>v1.28.3</code>
<ul>
<li>BUGFIX: Generate valid C# code when using Labeled metric types.</li>
<li>BUGFIX: Support <code>HashSet</code> and <code>Dictionary</code> in the C# generated code.</li>
</ul>
</li>
<li>Add a 10MB quota to the pending pings storage. (<a href="https://github.com/mozilla/glean/pull/1110">#1100</a>)</li>
</ul>
</li>
<li>C#
<ul>
<li>Add support for the String List metric type (<a href="https://github.com/mozilla/glean/pull/1108">#1108</a>).</li>
<li>Enable generating the C# APIs using the glean_parser (<a href="https://github.com/mozilla/glean/pull/1092">#1092</a>).</li>
<li>Add support for the <code>EventMetricType</code> in C# (<a href="https://github.com/mozilla/glean/pull/1129">#1129</a>).</li>
<li>Add support for the <code>TimingDistributionMetricType</code> in C# (<a href="https://github.com/mozilla/glean/pull/1131">#1131</a>).</li>
<li>Implement the experiments API in C# (<a href="https://github.com/mozilla/glean/pull/1145">#1145</a>).</li>
<li>This is the last release with C# language bindings changes. Reach out to the Glean SDK team if you want to use the C# bindings in a new product and require additional features.</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Limit the number of retries for 5xx server errors on ping uploads (<a href="https://github.com/mozilla/glean/pull/1120">#1120</a>).
<ul>
<li>This kinds of failures yield a &quot;recoverable error&quot;, which means the ping gets re-enqueued. That can cause infinite loops on the ping upload worker. For python we were incorrectly only limiting the number of retries for I/O errors, another type of &quot;recoverable error&quot;.</li>
</ul>
</li>
<li><code>kebab-case</code> ping names are now converted to <code>snake_case</code> so they are available on the object returned by <code>load_pings</code> (<a href="https://github.com/mozilla/glean/pull/1122">#1122</a>).</li>
<li>For performance reasons, the <code>glinter</code> is no longer run as part of <code>glean.load_metrics()</code>. We recommend running <code>glinter</code> as part of your project's continuous integration instead (<a href="https://github.com/mozilla/glean/pull/1124">#1124</a>).</li>
<li>A <code>measure</code> context manager for conveniently measuring runtimes has been added to <code>TimespanMetricType</code> and <code>TimingDistributionMetricType</code> (<a href="https://github.com/mozilla/glean/pull/1126">#1126</a>).</li>
<li>Networking errors have changed from <code>ERROR</code> level to <code>DEBUG</code> level so they aren't displayed by default (<a href="https://github.com/mozilla/glean/pull/1166">#1166</a>).</li>
</ul>
</li>
<li>iOS
<ul>
<li>Changed logging to use <a href="https://developer.apple.com/documentation/os/logging"><code>OSLog</code></a> rather than a mix of <code>NSLog</code> and <code>print</code>. (<a href="https://github.com/mozilla/glean/pull/1133">#1133</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3211-2020-08-24"><a class="header" href="#v3211-2020-08-24">v32.1.1 (2020-08-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.1.0...v32.1.1">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Support installing glean_parser in offline mode (<a href="https://github.com/mozilla/glean/pull/1065">#1065</a>).</li>
<li>Fix a startup crash on some Android 8 (SDK=25) devices, due to a <a href="https://issuetracker.google.com/issues/110848122#comment17">bug in the Java compiler</a> (<a href="https://github.com/mozilla/glean/pull/1135">#1135</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3210-2020-08-17"><a class="header" href="#v3210-2020-08-17">v32.1.0 (2020-08-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v32.0.0...v32.1.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>The upload rate limiter has been changed from 10 pings per minute to 15 pings per minute.</li>
</ul>
</li>
</ul>
<h1 id="v3200-2020-08-03"><a class="header" href="#v3200-2020-08-03">v32.0.0 (2020-08-03)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.6.0...v32.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Limit ping request body size to 1MB. (<a href="https://github.com/mozilla/glean/pull/1098">#1098</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>Implement ping tagging (i.e. the <code>X-Source-Tags</code> header) through custom URL (<a href="https://github.com/mozilla/glean/pull/1100">#1100</a>).</li>
</ul>
</li>
<li>C#
<ul>
<li>Add support for Labeled Strings and Labeled Booleans.</li>
<li>Add support for the Counter metric type and Labeled Counter.</li>
<li>Add support for the <code>MemoryDistributionMetricType</code>.</li>
</ul>
</li>
<li>Python
<ul>
<li><strong>Breaking change:</strong> <code>data_dir</code> must always be passed to <code>Glean.initialize</code>. Prior to this, a missing value would store Glean data in a temporary directory.</li>
<li>Logging messages from the Rust core are now sent through Python's standard library <code>logging</code> module. Therefore all logging in a Python application can be controlled through the <code>logging</code> module interface.</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: Require activities executed via <code>GleanDebugView</code> to be exported.</li>
</ul>
</li>
</ul>
<h1 id="v3160-2020-07-24"><a class="header" href="#v3160-2020-07-24">v31.6.0 (2020-07-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.5.0...v31.6.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Implement JWE metric type (<a href="https://github.com/mozilla/glean/pull/1073">#1073</a>, <a href="https://github.com/mozilla/glean/pull/1062">#1062</a>).</li>
<li>DEPRECATION: <code>getUploadEnabled</code> is deprecated (respectively <code>get_upload_enabled</code> in Python) (<a href="https://github.com/mozilla/glean/pull/1046">#1046</a>)
<ul>
<li>Due to Glean's asynchronous initialization the return value can be incorrect.
Applications should not rely on Glean's internal state.
Upload enabled status should be tracked by the application and communicated to Glean if it changes.
Note: The method was removed from the C# and Python implementation.</li>
</ul>
</li>
<li>Update <code>glean_parser</code> to <code>v1.28.1</code>
<ul>
<li>The <code>glean_parser</code> linting was leading consumers astray by incorrectly suggesting that <code>deletion-request</code> be instead <code>deletion_request</code> when used for <code>send_in_pings</code>. This was causing metrics intended for the <code>deletion-request</code> ping to not be included when it was collected and submitted. Consumers that are sending metrics in the <code>deletion-request</code> ping will need to update the <code>send_in_pings</code> value in their metrics.yaml to correct this.</li>
<li>Fixes a bug in doc rendering.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="v3150-2020-07-22"><a class="header" href="#v3150-2020-07-22">v31.5.0 (2020-07-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.4.1...v31.5.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Implement ping tagging (i.e. the <code>X-Source-Tags</code> header) (<a href="https://github.com/mozilla/glean/pull/1074">#1074</a>). Note that this is not yet implemented for iOS.</li>
<li>String values that are too long now record <code>invalid_overflow</code> rather than <code>invalid_value</code> through the Glean error reporting mechanism. This affects the string, event and string list metrics.</li>
<li><code>metrics.yaml</code> files now support a <code>data_sensitivity</code> field to all metrics for specifying the type of data collected in the field.</li>
</ul>
</li>
<li>Python
<ul>
<li>The Python unit tests no longer send telemetry to the production telemetry endpoint.</li>
<li>BUGFIX: If an <code>application_version</code> isn't provided to <code>Glean.initialize</code>, the <code>client_info.app_display_version</code> metric is set to <code>&quot;Unknown&quot;</code>, rather than resulting in invalid pings.</li>
</ul>
</li>
<li>Android
<ul>
<li>Allow defining which <code>Activity</code> to run next when using the <code>GleanDebugActivity</code>.</li>
</ul>
</li>
<li>iOS
<ul>
<li>BUGFIX: The memory unit is now correctly set on the <code>MemoryDistribution</code> metric type in Swift in generated metrics code.</li>
</ul>
</li>
<li>C#
<ul>
<li>Metrics can now be generated from the <code>metrics.yaml</code> files.</li>
</ul>
</li>
</ul>
<h1 id="v3141-2020-07-20"><a class="header" href="#v3141-2020-07-20">v31.4.1 (2020-07-20)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.4.0...v31.4.1">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>BUGFIX: fix <code>int32</code> to <code>ErrorType</code> mapping. The <code>InvalidOverflow</code> had a value mismatch between glean-core and the bindings. This would only be a problem in unit tests. (<a href="https://github.com/mozilla/glean/pull/1063">#1063</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>Enable propagating options to the main product Activity when using the <code>GleanDebugActivity</code>.</li>
<li>BUGFIX: Fix the metrics ping collection for startup pings such as <code>reason=upgrade</code> to occur in the same thread/task as Glean initialize. Otherwise, it gets collected after the application lifetime metrics are cleared such as experiments that should be in the ping. (<a href="https://github.com/mozilla/glean/pull/1069">#1069</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3140-2020-07-16"><a class="header" href="#v3140-2020-07-16">v31.4.0 (2020-07-16)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.3.0...v31.4.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Enable debugging features through environment variables. (<a href="https://github.com/mozilla/glean/pull/1058">#1058</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3130-2020-07-10"><a class="header" href="#v3130-2020-07-10">v31.3.0 (2020-07-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.3...v31.3.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Remove locale from baseline ping. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609968">1609968</a>, <a href="https://github.com/mozilla/glean/pull/1016">#1016</a>)</li>
<li>Persist X-Debug-ID header on store ping. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1605097">1605097</a>, <a href="https://github.com/mozilla/glean/pull/1042">#1042</a>)</li>
<li>BUGFIX: raise an error if Glean is initialized with an empty string as the <code>application_id</code> (<a href="https://github.com/mozilla/glean/pull/1043">#1043</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: correctly set the <code>app_build</code> metric to the newly provided <code>application_build_id</code> initialization option (<a href="https://github.com/mozilla/glean/pull/1031">#1031</a>).</li>
<li>The Python bindings now report networking errors in the <code>glean.upload.ping_upload_failure</code> metric (like all the other bindings) (<a href="https://github.com/mozilla/glean/pull/1039">#1039</a>).</li>
<li>Python default upgraded to Python 3.8 (<a href="https://github.com/mozilla/glean/pull/995">#995</a>)</li>
</ul>
</li>
<li>iOS
<ul>
<li>BUGFIX: Make <code>LabeledMetric</code> subscript public, so consuming applications can actually access it (<a href="https://github.com/mozilla/glean/pull/1027">#1027</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3123-2020-06-29"><a class="header" href="#v3123-2020-06-29">v31.2.3 (2020-06-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.2...v31.2.3">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Move debug view tag management to the Rust core. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1640575">1640575</a>, <a href="https://github.com/mozilla/glean/pull/998">#998</a>)</li>
<li>BUGFIX: Fix mismatch in <code>event</code>s keys and values by using <code>glean_parser</code> version 1.23.0.</li>
</ul>
</li>
</ul>
<h1 id="v3122-2020-06-26"><a class="header" href="#v3122-2020-06-26">v31.2.2 (2020-06-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.1...v31.2.2">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>BUGFIX: Compile dependencies with <code>NDEBUG</code> to avoid linking unavailable symbols.
This fixes a crash due to a missing <code>stderr</code> symbol on older Android (<a href="https://github.com/mozilla/glean/pull/1020">#1020</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3121-2020-06-25"><a class="header" href="#v3121-2020-06-25">v31.2.1 (2020-06-25)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.2.0...v31.2.1">Full changelog</a></p>
<ul>
<li>Python
<ul>
<li>BUGFIX: Core metrics are now present in every ping, even if submit is called before initialize has a chance to complete. (<a href="https://github.com/mozilla/glean/pull/1012">#1012</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3120-2020-06-24"><a class="header" href="#v3120-2020-06-24">v31.2.0 (2020-06-24)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.1.2...v31.2.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Add rate limiting capabilities to the upload manager. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1543612">1543612</a>, <a href="https://github.com/mozilla/glean/pull/974">#974</a>)</li>
</ul>
</li>
<li>Android
<ul>
<li>BUGFIX: baseline pings with reason &quot;dirty startup&quot; are no longer sent if Glean did not full initialize in the previous run (<a href="https://github.com/mozilla/glean/pull/996">#996</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>Support for Python 3.5 was dropped (<a href="https://github.com/mozilla/glean/pull/987">#987</a>).</li>
<li>Python wheels are now shipped with Glean release builds, resulting in much smaller libraries (<a href="https://github.com/mozilla/glean/pull/1002">#1002</a>)</li>
<li>The Python bindings now use <code>locale.getdefaultlocale()</code> rather than <code>locale.getlocale()</code> to determine the locale (<a href="https://github.com/mozilla/glean/pull/1004">#1004</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3112-2020-06-23"><a class="header" href="#v3112-2020-06-23">v31.1.2 (2020-06-23)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.1.1...v31.1.2">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>BUGFIX: Correctly format the date and time in the <code>Date</code> header (<a href="https://github.com/mozilla/glean/pull/993">#993</a>).</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Additional time is taken at shutdown to make sure pings are sent and telemetry is recorded. (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1646173">1646173</a>, <a href="https://github.com/mozilla/glean/pull/983">#983</a>)</li>
<li>BUGFIX: Glean will run on the main thread when running in a <code>multiprocessing</code> subprocess (<a href="https://github.com/mozilla/glean/pull/986">#986</a>).</li>
</ul>
</li>
</ul>
<h1 id="v3111-2020-06-12"><a class="header" href="#v3111-2020-06-12">v31.1.1 (2020-06-12)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.1.0...v31.1.1">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>Dropping the version requirement for lifecycle extensions down again. Upping the required version caused problems in A-C.</li>
</ul>
</li>
</ul>
<h1 id="v3110-2020-06-11"><a class="header" href="#v3110-2020-06-11">v31.1.0 (2020-06-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.0.2...v31.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The <code>regex</code> crate is no longer required, making the Glean binary smaller (<a href="https://github.com/mozilla/glean/pull/949">#949</a>)</li>
<li>Record upload failures into a new metric (<a href="https://github.com/mozilla/glean/pull/967">#967</a>)</li>
<li>Log FFI errors as actual errors (<a href="https://github.com/mozilla/glean/pull/935">#935</a>)</li>
<li>Limit the number of upload retries in all implementations (<a href="https://github.com/mozilla/glean/pull/953">#953</a>, <a href="https://github.com/mozilla/glean/pull/968">#968</a>)</li>
</ul>
</li>
<li>Python
<ul>
<li>Additional safety guarantees for applications that use Python <code>threading</code> (<a href="https://github.com/mozilla/glean/pull/962">#962</a>)</li>
</ul>
</li>
</ul>
<h1 id="v3102-2020-05-29"><a class="header" href="#v3102-2020-05-29">v31.0.2 (2020-05-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.0.1...v31.0.2">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Fix list of included files in published crates</li>
</ul>
</li>
</ul>
<h1 id="v3101-2020-05-29"><a class="header" href="#v3101-2020-05-29">v31.0.1 (2020-05-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v31.0.0...v31.0.1">Full changelog</a></p>
<ul>
<li>Rust
<ul>
<li>Relax version requirement for <code>flate2</code> for compatibility reasons</li>
</ul>
</li>
</ul>
<h1 id="v3100-2020-05-28"><a class="header" href="#v3100-2020-05-28">v31.0.0 (2020-05-28)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v30.1.0...v31.0.0">Full changelog</a></p>
<ul>
<li>
<p>General:</p>
<ul>
<li>The version of <code>glean_parser</code> has been upgraded to v1.22.0
<ul>
<li>A maximum of 10 <code>extra_keys</code> is now enforced for event metric types.</li>
<li><strong>Breaking change</strong>: (Swift only) Combine all metrics and pings into a single generated file Metrics.swift.
<ul>
<li>For Swift users this requires to change the list of output files for the <code>sdk_generator.sh</code> script.
It now only needs to include the single file <code>Generated/Metrics.swift</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Python:</p>
<ul>
<li>BUGFIX: <code>lifetime: application</code> metrics are no longer recorded as <code>lifetime: user</code>.</li>
<li>BUGFIX: glean-core is no longer crashing when calling <code>uuid.set</code> with invalid UUIDs.</li>
<li>Refactor the ping uploader to use the new upload mechanism and add gzip compression.</li>
<li>Most of the work in <code>Glean.initialize</code> happens on a worker thread and no longer blocks
the main thread.</li>
</ul>
</li>
<li>
<p>Rust:</p>
<ul>
<li>Expose <code>Datetime</code> types to Rust consumers.</li>
</ul>
</li>
</ul>
<h1 id="v3010-2020-05-22"><a class="header" href="#v3010-2020-05-22">v30.1.0 (2020-05-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v30.0.0...v30.1.0">Full changelog</a></p>
<ul>
<li>Android &amp; iOS
<ul>
<li>Ping payloads are now compressed using gzip.</li>
</ul>
</li>
<li>iOS
<ul>
<li><code>Glean.initialize</code> is now a no-op if called from an embedded extension. This means that Glean will only run in the base application process in order to prevent extensions from behaving like separate applications with different client ids from the base application. Applications are responsible for ensuring that extension metrics are only collected within the base application.</li>
</ul>
</li>
<li>Python
<ul>
<li><code>lifetime: application</code> metrics are now cleared after the Glean-owned pings are sent,
after the product starts.</li>
<li>Glean Python bindings now build in a native Windows environment.</li>
<li>BUGFIX: <code>MemoryDistributionMetric</code> now parses correctly in <code>metrics.yaml</code> files.</li>
<li>BUGFIX: Glean will no longer crash if run as part of another library's coverage testing.</li>
</ul>
</li>
</ul>
<h1 id="v3000-2020-05-13"><a class="header" href="#v3000-2020-05-13">v30.0.0 (2020-05-13)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.1.0...v30.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>We completely replaced how the upload mechanism works.
glean-core (the Rust part) now controls all upload and coordinates the platform side with its own internals.
All language bindings implement ping uploading around a common API and protocol.
There is no change for users of Glean, the language bindings for Android and iOS have been adopted to the new mechanism already.</li>
<li>Expose <code>RecordedEvent</code> and <code>DistributionData</code> types to Rust consumers (<a href="https://github.com/mozilla/glean/pull/876">#876</a>)</li>
<li>Log crate version at initialize (<a href="https://github.com/mozilla/glean/pull/873">#873</a>)</li>
</ul>
</li>
<li>Android:
<ul>
<li>Refactor the ping uploader to use the new upload mechanism.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>Refactor the ping uploader to use the new upload mechanism.</li>
</ul>
</li>
</ul>
<h1 id="v2912-2021-01-26"><a class="header" href="#v2912-2021-01-26">v29.1.2 (2021-01-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.1.1...v29.1.2">Full changelog</a></p>
<p><strong>This is an iOS release only, built with Xcode 11.7</strong></p>
<p>Otherwise no functional changes.</p>
<ul>
<li>iOS
<ul>
<li>Build with Xcode 11.7 (<a href="https://github.com/mozilla/glean/pull/1457">#1457</a>)</li>
</ul>
</li>
</ul>
<h1 id="v2911-2020-05-22"><a class="header" href="#v2911-2020-05-22">v29.1.1 (2020-05-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.1.0...v29.1.1">Full changelog</a></p>
<ul>
<li>Android
<ul>
<li>BUGFIX: Fix a race condition that leads to a <code>ConcurrentModificationException</code>. <a href="https://bugzilla.mozilla.org/1635865">Bug 1635865</a></li>
</ul>
</li>
</ul>
<h1 id="v2910-2020-05-11"><a class="header" href="#v2910-2020-05-11">v29.1.0 (2020-05-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v29.0.0...v29.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The version of glean_parser has been upgraded to v1.20.4
<ul>
<li>BUGFIX: <code>yamllint</code> errors are now reported using the correct file name.</li>
</ul>
</li>
<li>The minimum and maximum values of a timing distribution can now be controlled by the <code>time_unit</code> parameter. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1630997">bug 1630997</a> for more details.</li>
</ul>
</li>
</ul>
<h1 id="v2900-2020-05-05"><a class="header" href="#v2900-2020-05-05">v29.0.0 (2020-05-05)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v28.0.0...v29.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The version of glean_parser has been upgraded to v1.20.2 (<a href="https://github.com/mozilla/glean/pull/827">#827</a>):
<ul>
<li><strong>Breaking change:</strong> glinter errors found during code generation will now return an error code.</li>
<li><code>glean_parser</code> now produces a linter warning when <code>user</code> lifetime metrics are set to expire. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1604854">bug 1604854</a> for additional context.</li>
</ul>
</li>
</ul>
</li>
<li>Android:
<ul>
<li>The <code>PingType.submit()</code> can now be called without a <code>null</code> by Java consumers (<a href="https://github.com/mozilla/glean/pull/853">#853</a>).</li>
</ul>
</li>
<li>Python:
<ul>
<li>BUGFIX: Fixed a race condition in the <code>atexit</code> handler, that would have resulted in the message &quot;No database found&quot; (<a href="https://github.com/mozilla/glean/pull/854">#854</a>).</li>
<li>The Glean FFI header is now parsed at build time rather than runtime. Relevant for packaging in <code>PyInstaller</code>, the wheel no longer includes <code>glean.h</code> and adds <code>_glean_ffi.py</code> (<a href="https://github.com/mozilla/glean/pull/852">#852</a>).</li>
<li>The minimum versions of many secondary dependencies have been lowered to make the Glean SDK compatible with more environments.</li>
<li>Dependencies that depend on the version of Python being used are now specified using the <a href="https://setuptools.readthedocs.io/en/latest/setuptools.html#declaring-platform-specific-dependencies">Declaring platform specific dependencies syntax in setuptools</a>. This means that more recent versions of dependencies are likely to be installed on Python 3.6 and later, and unnecessary backport libraries won't be installed on more recent Python versions.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>Glean for iOS is now being built with Xcode 11.4.1 (<a href="https://github.com/mozilla/glean/pull/856">#856</a>)</li>
</ul>
</li>
</ul>
<h1 id="v2800-2020-04-23"><a class="header" href="#v2800-2020-04-23">v28.0.0 (2020-04-23)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v27.1.0...v28.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The baseline ping is now sent when the application goes to foreground, in addition to background and dirty-startup.</li>
</ul>
</li>
<li>Python:
<ul>
<li>BUGFIX: The ping uploader will no longer display a trace back when the upload fails due to a failed DNS lookup, network outage, or related issues that prevent communication with the telemetry endpoint.</li>
<li>The dependency on <code>inflection</code> has been removed.</li>
<li>The Python bindings now use <code>subprocess</code> rather than <code>multiprocessing</code> to perform ping uploading in a separate process. This should be more compatible on all of the platforms Glean supports.</li>
</ul>
</li>
</ul>
<h1 id="v2710-2020-04-09"><a class="header" href="#v2710-2020-04-09">v27.1.0 (2020-04-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v27.0.0...v27.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>BUGFIX: baseline pings sent at startup with the <code>dirty_startup</code> reason will now include application lifetime metrics (<a href="https://github.com/mozilla/glean/pull/810">#810</a>)</li>
</ul>
</li>
<li>iOS:
<ul>
<li><strong>Breaking change:</strong> Change Glean iOS to use Application Support directory <a href="https://github.com/mozilla/glean/pull/815">#815</a>. No migration code is included. This will reset collected data if integrated without migration. Please <a href="https://github.com/mozilla/glean#contact">contact the Glean SDK team</a> if this affects you.</li>
</ul>
</li>
<li>Python
<ul>
<li>BUGFIX: Fixed a race condition between uploading pings and deleting the temporary directory on shutdown of the process.</li>
</ul>
</li>
</ul>
<h1 id="v2700-2020-04-08"><a class="header" href="#v2700-2020-04-08">v27.0.0 (2020-04-08)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v26.0.0...v27.0.0">Full changelog</a></p>
<ul>
<li>General
<ul>
<li>Glean will now detect when the upload enabled flag changes outside of the application, for example due to a change in a config file. This means that if upload is disabled while the application wasn't running (e.g. between the runs of a Python command using the Glean SDK), the database is correctly cleared and a deletion request ping is sent. See <a href="https://github.com/mozilla/glean/pull/791">#791</a>.</li>
<li>The <code>events</code> ping now includes a reason code: <code>startup</code>, <code>background</code> or <code>max_capacity</code>.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>BUGFIX: A bug where the metrics ping is sent immediately at startup on the last day of the month has been fixed.</li>
<li>Glean for iOS is now being built with Xcode 11.4.0</li>
<li>The <code>measure</code> convenience function on timing distributions and time spans will now cancel the timing if the measured function throws, then rethrow the exception (<a href="https://github.com/mozilla/glean/pull/808">#808</a>)</li>
<li>Broken doc generation has been fixed (<a href="https://github.com/mozilla/glean/pull/805">#805</a>).</li>
</ul>
</li>
<li>Kotlin
<ul>
<li>The <code>measure</code> convenience function on timing distributions and time spans will now cancel the timing if the measured function throws, then rethrow the exception (<a href="https://github.com/mozilla/glean/pull/808">#808</a>)</li>
</ul>
</li>
<li>Python:
<ul>
<li>Glean will now wait at application exit for up to one second to let its worker thread complete.</li>
<li>Ping uploading now happens in a separate child process by default. This can be disabled with the <code>allow_multiprocessing</code> configuration option.</li>
</ul>
</li>
</ul>
<h1 id="v2600-2020-03-27"><a class="header" href="#v2600-2020-03-27">v26.0.0 (2020-03-27)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v25.1.0...v26.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>The version of <code>glean_parser</code> has been updated to 1.19.0:
<ul>
<li><strong>Breaking change:</strong> The regular expression used to validate labels is
stricter and more correct.</li>
<li>Add more information about pings to markdown documentation:
<ul>
<li>State whether the ping includes client id;</li>
<li>Add list of data review links;</li>
<li>Add list of related bugs links.</li>
</ul>
</li>
<li><code>glean_parser</code> now makes it easier to write external translation functions for
different language targets.</li>
<li>BUGFIX: glean_parser now works on 32-bit Windows.</li>
</ul>
</li>
</ul>
</li>
<li>Android:
<ul>
<li><code>gradlew clean</code> will no longer remove the Miniconda installation in
<code>~/.gradle/glean</code>. Therefore <code>clean</code> can be used without reinstalling
Miniconda afterward every time.</li>
</ul>
</li>
<li>Python:
<ul>
<li><strong>Breaking Change</strong>: The <code>glean.util</code> and <code>glean.hardware</code> modules, which
were unintentionally public, have been made private.</li>
<li>Most Glean work and I/O is now done on its own worker thread. This brings the parallelism Python in line with the other platforms.</li>
<li>The timing distribution, memory distribution, string list, labeled boolean and labeled string metric types are now supported in Python (<a href="https://github.com/mozilla/glean/pull/762">#762</a>, <a href="https://github.com/mozilla/glean/pull/763">#763</a>, <a href="https://github.com/mozilla/glean/pull/765">#765</a>, <a href="https://github.com/mozilla/glean/pull/766">#766</a>)</li>
</ul>
</li>
</ul>
<h1 id="v2510-2020-02-26"><a class="header" href="#v2510-2020-02-26">v25.1.0 (2020-02-26)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v25.0.0...v25.1.0">Full changelog</a></p>
<ul>
<li>Python:
<ul>
<li>The Boolean, Datetime and Timespan metric types are now supported in Python (<a href="https://github.com/mozilla/glean/pull/731">#731</a>, <a href="https://github.com/mozilla/glean/pull/732">#732</a>, <a href="https://github.com/mozilla/glean/pull/737">#737</a>)</li>
<li>Make public, document and test the debugging features (<a href="https://github.com/mozilla/glean/pull/733">#733</a>)</li>
</ul>
</li>
</ul>
<h1 id="v2500-2020-02-17"><a class="header" href="#v2500-2020-02-17">v25.0.0 (2020-02-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v24.2.0...v25.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li><code>ping_type</code> is not included in the <code>ping_info</code> any more (<a href="https://github.com/mozilla/glean/pull/653">#653</a>), the pipeline takes the value from the submission URL.</li>
<li>The version of <code>glean_parser</code> has been upgraded to 1.18.2:
<ul>
<li><strong>Breaking Change (Java API)</strong> Have the metrics names in Java match the names in Kotlin.
See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588060">Bug 1588060</a>.</li>
<li>The reasons a ping are sent are now included in the generated markdown documentation.</li>
</ul>
</li>
</ul>
</li>
<li>Android:
<ul>
<li>The <code>Glean.initialize</code> method runs mostly off the main thread (<a href="https://github.com/mozilla/glean/pull/672">#672</a>).</li>
<li>Labels in labeled metrics now have a correct, and slightly stricter, regular expression.
See <a href="https://mozilla.github.io/glean/user/metrics/index.html#label-format">label format</a> for more information.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>The baseline ping will now include <code>reason</code> codes that indicate why it was
submitted. If an unclean shutdown is detected (e.g. due to force-close), this
ping will be sent at startup with <code>reason: dirty_startup</code>.</li>
<li>Per <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1614785">Bug 1614785</a>, the
clearing of application lifetime metrics now occurs after the metrics ping is
sent in order to preserve values meant to be included in the startup metrics
ping.</li>
<li><code>initialize()</code> now performs most of its work in a background thread.</li>
</ul>
</li>
<li>Python:
<ul>
<li>When the pre-init task queue overruns, this is now recorded in the metric
<code>glean.error.preinit_tasks_overflow</code>.</li>
<li>glinter warnings are printed to <code>stderr</code> when loading <code>metrics.yaml</code> and
<code>pings.yaml</code> files.</li>
</ul>
</li>
</ul>
<h1 id="v2420-2020-02-11"><a class="header" href="#v2420-2020-02-11">v24.2.0 (2020-02-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v24.1.0...v24.2.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>Add <code>locale</code> to <code>client_info</code> section.</li>
<li><strong>Deprecation Warning</strong> Since <code>locale</code> is now in the <code>client_info</code> section, the one
in the baseline ping (<a href="https://github.com/mozilla/glean/blob/c261205d6e84d2ab39c50003a8ffc3bd2b763768/glean-core/metrics.yaml#L28-L42"><code>glean.baseline.locale</code></a>)
is redundant and will be removed by the end of the quarter.</li>
<li>Drop the Glean handle and move state into glean-core (<a href="https://github.com/mozilla/glean/pull/664">#664</a>)</li>
<li>If an experiment includes no <code>extra</code> fields, it will no longer include <code>{&quot;extra&quot;: null}</code> in the JSON payload.</li>
<li>Support for ping <code>reason</code> codes was added.</li>
<li>The metrics ping will now include <code>reason</code> codes that indicate why it was
submitted.</li>
<li>The version of <code>glean_parser</code> has been upgraded to 1.17.3</li>
</ul>
</li>
<li>Android:
<ul>
<li>Collections performed before initialization (preinit tasks) are now dispatched off
the main thread during initialization.</li>
<li>The baseline ping will now include <code>reason</code> codes that indicate why it was
submitted. If an unclean shutdown is detected (e.g. due to force-close), this
ping will be sent at startup with <code>reason: dirty_startup</code>.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>Collections performed before initialization (preinit tasks) are now dispatched off
the main thread and not awaited during initialization.</li>
<li>Added recording of <code>glean.error.preinit_tasks_overflow</code> to report when
the preinit task queue overruns, leading to data loss. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609734">bug
1609734</a></li>
</ul>
</li>
</ul>
<h1 id="v2410-2020-01-16"><a class="header" href="#v2410-2020-01-16">v24.1.0 (2020-01-16)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v24.0.0...v24.1.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li>Stopping a non started measurement in a timing distribution will now be reported
as an <code>invalid_state</code> error.</li>
</ul>
</li>
<li>Android:
<ul>
<li>A new metric <code>glean.error.preinit_tasks_overflow</code> was added to report when
the preinit task queue overruns, leading to data loss. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1609482">bug
1609482</a></li>
</ul>
</li>
</ul>
<h1 id="v2400-2020-01-14"><a class="header" href="#v2400-2020-01-14">v24.0.0 (2020-01-14)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v23.0.1...v24.0.0">Full changelog</a></p>
<ul>
<li>General:
<ul>
<li><strong>Breaking Change</strong> An <code>enableUpload</code> parameter has been added to the <code>initialize()</code>
function. This removes the requirement to call <code>setUploadEnabled()</code> prior to calling
the <code>initialize()</code> function.</li>
</ul>
</li>
<li>Android:
<ul>
<li>The metrics ping scheduler will now only send metrics pings while the
application is running. The application will no longer &quot;wake up&quot; at 4am
using the Work Manager.</li>
<li>The code for migrating data from Glean SDK before version 19 was removed.</li>
<li>When using the <code>GleanTestLocalServer</code> rule in instrumented tests, pings are
immediately flushed by the <code>WorkManager</code> and will reach the test endpoint as
soon as possible.</li>
</ul>
</li>
<li>Python:
<ul>
<li>The Python bindings now support Python 3.5 - 3.7.</li>
<li>The Python bindings are now distributed as a wheel on Linux, macOS and
Windows.</li>
</ul>
</li>
</ul>
<h1 id="v2301-2020-01-08"><a class="header" href="#v2301-2020-01-08">v23.0.1 (2020-01-08)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v23.0.0...v23.0.1">Full changelog</a></p>
<ul>
<li>Android:
<ul>
<li>BUGFIX: The Glean Gradle plugin will now work if an app or library doesn't
have a metrics.yaml or pings.yaml file.</li>
</ul>
</li>
<li>iOS:
<ul>
<li>The released iOS binaries are now built with Xcode 11.3.</li>
</ul>
</li>
</ul>
<h1 id="v2300-2020-01-07"><a class="header" href="#v2300-2020-01-07">v23.0.0 (2020-01-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v22.1.0...v23.0.0">Full changelog</a></p>
<ul>
<li>Python bindings:
<ul>
<li>Support for events and UUID metrics was added.</li>
</ul>
</li>
<li>Android:
<ul>
<li>The Glean Gradle Plugin correctly triggers docs and API updates when registry files
change, without requiring them to be deleted.</li>
<li><code>parseISOTimeString</code> has been made 4x faster. This had an impact on Glean
migration and initialization.</li>
<li>Metrics with <code>lifetime: application</code> are now cleared when the application is started,
after startup Glean SDK pings are generated.</li>
</ul>
</li>
<li>All platforms:
<ul>
<li>The public method <code>PingType.send()</code> (in all platforms) have been deprecated
and renamed to <code>PingType.submit()</code>.</li>
<li>Rename <code>deletion_request</code> ping to <code>deletion-request</code> ping after glean_parser update</li>
</ul>
</li>
</ul>
<h1 id="v2210-2019-12-17"><a class="header" href="#v2210-2019-12-17">v22.1.0 (2019-12-17)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v22.0.0...v22.1.0">Full changelog</a></p>
<ul>
<li>Add <code>InvalidOverflow</code> error to <code>TimingDistribution</code>s (<a href="https://github.com/mozilla/glean/pull/583">#583</a>)</li>
</ul>
<h1 id="v2200-2019-12-05"><a class="header" href="#v2200-2019-12-05">v22.0.0 (2019-12-05)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.3.0...v22.0.0">Full changelog</a></p>
<ul>
<li>Add option to defer ping lifetime metric persistence (<a href="https://github.com/mozilla/glean/pull/530">#530</a>)</li>
<li>Add a crate for the nice control API (<a href="https://github.com/mozilla/glean/pull/542">#542</a>)</li>
<li>Pending <code>deletion_request</code> pings are resent on start (<a href="https://github.com/mozilla/glean/pull/545">#545</a>)</li>
</ul>
<h1 id="v2130-2019-12-03"><a class="header" href="#v2130-2019-12-03">v21.3.0 (2019-12-03)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.2.0...v21.3.0">Full changelog</a></p>
<ul>
<li>Timers are reset when disabled. That avoids recording timespans across disabled/enabled toggling (<a href="https://github.com/mozilla/glean/pull/495">#495</a>).</li>
<li>Add a new flag to pings: <code>send_if_empty</code> (<a href="https://github.com/mozilla/glean/pull/528">#528</a>)</li>
<li>Upgrade <code>glean_parser</code> to v1.12.0</li>
<li>Implement the deletion request ping in Glean (<a href="https://github.com/mozilla/glean/pull/526">#526</a>)</li>
</ul>
<h1 id="v2120-2019-11-21"><a class="header" href="#v2120-2019-11-21">v21.2.0 (2019-11-21)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.1.1...v21.2.0">Full changelog</a></p>
<ul>
<li>
<p>All platforms</p>
<ul>
<li>
<p>The experiments API is no longer ignored before the Glean SDK initialized. Calls are
recorded and played back once the Glean SDK is initialized.</p>
</li>
<li>
<p>String list items were being truncated to 20, rather than 50, bytes when using
<code>.set()</code> (rather than <code>.add()</code>). This has been corrected, but it may result
in changes in the sent data if using string list items longer than 20 bytes.</p>
</li>
</ul>
</li>
</ul>
<h1 id="v2111-2019-11-20"><a class="header" href="#v2111-2019-11-20">v21.1.1 (2019-11-20)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.1.0...v21.1.1">Full changelog</a></p>
<ul>
<li>
<p>Android:</p>
<ul>
<li>Use the <code>LifecycleEventObserver</code> interface, rather than the <code>DefaultLifecycleObserver</code>
interface, since the latter isn't compatible with old SDK targets.</li>
</ul>
</li>
</ul>
<h1 id="v2110-2019-11-20"><a class="header" href="#v2110-2019-11-20">v21.1.0 (2019-11-20)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v21.0.0...v21.1.0">Full changelog</a></p>
<ul>
<li>
<p>Android:</p>
<ul>
<li>
<p>Two new metrics were added to investigate sending of metrics and baseline pings.
See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1597980">bug 1597980</a> for more information.</p>
</li>
<li>
<p>Glean's two lifecycle observers were refactored to avoid the use of reflection.</p>
</li>
</ul>
</li>
<li>
<p>All platforms:</p>
<ul>
<li>Timespans will now not record an error if stopping after setting upload enabled to false.</li>
</ul>
</li>
</ul>
<h1 id="v2100-2019-11-18"><a class="header" href="#v2100-2019-11-18">v21.0.0 (2019-11-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v20.2.0...v21.0.0">Full changelog</a></p>
<ul>
<li>
<p>Android:</p>
<ul>
<li>
<p>The <code>GleanTimerId</code> can now be accessed in Java and is no longer a <code>typealias</code>.</p>
</li>
<li>
<p>Fixed a bug where the metrics ping was getting scheduled twice on startup.</p>
</li>
</ul>
</li>
<li>
<p>All platforms</p>
<ul>
<li>Bumped <code>glean_parser</code> to version 1.11.0.</li>
</ul>
</li>
</ul>
<h1 id="v2020-2019-11-11"><a class="header" href="#v2020-2019-11-11">v20.2.0 (2019-11-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v20.1.0...v20.2.0">Full changelog</a></p>
<ul>
<li>In earlier 20.x.x releases, the version of glean-ffi was incorrectly built
against the wrong version of glean-core.</li>
</ul>
<h1 id="v2010-2019-11-11"><a class="header" href="#v2010-2019-11-11">v20.1.0 (2019-11-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v20.0.0...v20.1.0">Full changelog</a></p>
<ul>
<li>
<p>The version of Glean is included in the Glean Gradle plugin.</p>
</li>
<li>
<p>When constructing a ping, events are now sorted by their timestamp. In practice,
it rarely happens that event timestamps are unsorted to begin with, but this
guards against a potential race condition and incorrect usage of the lower-level
API.</p>
</li>
</ul>
<h1 id="v2000-2019-11-11"><a class="header" href="#v2000-2019-11-11">v20.0.0 (2019-11-11)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v19.1.0...v20.0.0">Full changelog</a></p>
<ul>
<li>
<p>Glean users should now use a Gradle plugin rather than a Gradle script. (#421)
See <a href="https://mozilla.github.io/glean/book/user/adding-glean-to-your-project.html#integrating-with-the-build-system">integrating with the build system docs</a> for more information.</p>
</li>
<li>
<p>In Kotlin, metrics that can record errors now have a new testing method,
<code>testGetNumRecordedErrors</code>. (#401)</p>
</li>
</ul>
<h1 id="v1910-2019-10-29"><a class="header" href="#v1910-2019-10-29">v19.1.0 (2019-10-29)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v19.0.0...v19.1.0">Full changelog</a></p>
<ul>
<li>Fixed a crash calling <code>start</code> on a timing distribution metric before Glean is initialized.
Timings are always measured, but only recorded when upload is enabled (<a href="https://github.com/mozilla/glean/pull/400">#400</a>)</li>
<li>BUGFIX: When the Debug Activity is used to log pings, each ping is now logged only once (<a href="https://github.com/mozilla/glean/pull/407">#407</a>)</li>
<li>New <code>invalid state</code> error, used in timespan recording (<a href="https://github.com/mozilla/glean/pull/230">#230</a>)</li>
<li>Add an Android crash instrumentation walk-through (<a href="https://github.com/mozilla/glean/pull/399">#399</a>)</li>
<li>Fix crashing bug by avoiding assert-printing in LMDB (<a href="https://github.com/mozilla/glean/pull/422">#422</a>)</li>
<li>Upgrade dependencies, including rkv (<a href="https://github.com/mozilla/glean/pull/416">#416</a>)</li>
</ul>
<h1 id="v1900-2019-10-22"><a class="header" href="#v1900-2019-10-22">v19.0.0 (2019-10-22)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING6...v19.0.0">Full changelog</a></p>
<p>First stable release of Glean in Rust (aka glean-core).
This is a major milestone in using a cross-platform implementation of Glean on the Android platform.</p>
<ul>
<li>Fix round-tripping of timezone offsets in dates (<a href="https://github.com/mozilla/glean/pull/392">#392</a>)</li>
<li>Handle dynamic labels in coroutine tasks (<a href="https://github.com/mozilla/glean/pull/384">#394</a>)</li>
</ul>
<h1 id="v001-testing6-2019-10-18"><a class="header" href="#v001-testing6-2019-10-18">v0.0.1-TESTING6 (2019-10-18)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING5...v0.0.1-TESTING6">Full changelog</a></p>
<ul>
<li>Ignore dynamically stored labels if Glean is not initialized (<a href="https://github.com/mozilla/glean/pull/374">#374</a>)</li>
<li>Make sure ProGuard doesn't remove Glean classes from the app (<a href="https://github.com/mozilla/glean/pull/380">#380</a>)</li>
<li>Keep track of pings in all modes (<a href="https://github.com/mozilla/glean/pull/378">#378</a>)</li>
<li>Add <code>jnaTest</code> dependencies to the <code>forUnitTest</code> JAR (<a href="https://github.com/mozilla/glean/pull/382">#382</a>)</li>
</ul>
<h1 id="v001-testing5-2019-10-10"><a class="header" href="#v001-testing5-2019-10-10">v0.0.1-TESTING5 (2019-10-10)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING4...v0.0.1-TESTING5">Full changelog</a></p>
<ul>
<li>Upgrade to NDK r20 (<a href="https://github.com/mozilla/glean/pull/365">#365</a>)</li>
</ul>
<h1 id="v001-testing4-2019-10-09"><a class="header" href="#v001-testing4-2019-10-09">v0.0.1-TESTING4 (2019-10-09)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING3...v0.0.1-TESTING4">Full changelog</a></p>
<ul>
<li>Take DST into account when converting a calendar into its items (<a href="https://github.com/mozilla/glean/pull/359">#359</a>)</li>
<li>Include a macOS library in the <code>forUnitTests</code> builds (<a href="https://github.com/mozilla/glean/pull/358">#358</a>)</li>
<li>Keep track of all registered pings in test mode (<a href="https://github.com/mozilla/glean/pull/363">#363</a>)</li>
</ul>
<h1 id="v001-testing3-2019-10-08"><a class="header" href="#v001-testing3-2019-10-08">v0.0.1-TESTING3 (2019-10-08)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING2...v0.0.1-TESTING3">Full changelog</a></p>
<ul>
<li>Allow configuration of Glean through the <code>GleanTestRule</code></li>
<li>Bump <code>glean_parser</code> version to 1.9.2</li>
</ul>
<h1 id="v001-testing2-2019-10-07"><a class="header" href="#v001-testing2-2019-10-07">v0.0.1-TESTING2 (2019-10-07)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/v0.0.1-TESTING1...v0.0.1-TESTING2">Full changelog</a></p>
<ul>
<li>Include a Windows library in the <code>forUnitTests</code> builds</li>
</ul>
<h1 id="v001-testing1-2019-10-02"><a class="header" href="#v001-testing1-2019-10-02">v0.0.1-TESTING1 (2019-10-02)</a></h1>
<p><a href="https://github.com/mozilla/glean/compare/95b6bcc03616c8d7c3e3e64e99ee9953aa06a474...v0.0.1-TESTING1">Full changelog</a></p>
<h3 id="general"><a class="header" href="#general">General</a></h3>
<p>First testing release.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/changelog/sdk.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="unreleased-changes-1"><a class="header" href="#unreleased-changes-1">Unreleased changes</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.30.0...main">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/1065">#1065</a>: Delete minimal amount of data when invalid data is found while collecting ping.
<ul>
<li>Previous behaviour was to delete the whole ping when invalid data was found on the database,
new behaviour only deletes the actually invalid data and leave the rest of the ping intact.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/1065">#1065</a>: Only import metric types into the library when they are used either by the user or Glean itself.
<ul>
<li>Previously the code required to deserialize metric data from the database was always imported by the library even if the metric type was never used by the client. This effort will decrease the size of the Glean.js bundles that don't import all the metric types.</li>
</ul>
</li>
</ul>
<h1 id="v0300-2022-01-10"><a class="header" href="#v0300-2022-01-10">v0.30.0 (2022-01-10)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.29.0...v0.30.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/1045">#1045</a>: BUGFIX: Provide informative error message when unable to access database in QML.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/1077">#1077</a>: BUGFIX: Do not clear lifetime metrics before submitting <code>deletion-request</code> ping on initialize.
<ul>
<li>This bug causes malformed <code>deletion-request</code> pings in Glean is initialized with <code>uploadEnabled=false</code>.</li>
</ul>
</li>
</ul>
<h1 id="v0290-2022-01-04"><a class="header" href="#v0290-2022-01-04">v0.29.0 (2022-01-04)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.28.0...v0.29.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/1006">#1006</a>: Implement the rate metric.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/1066">#1066</a>: BUGFIX: Guarantee reported timestamps are never floating point numbers.
<ul>
<li>Floating point timestamps are rejected by the pipeline.</li>
</ul>
</li>
</ul>
<h1 id="v0280-2021-12-08"><a class="header" href="#v0280-2021-12-08">v0.28.0 (2021-12-08)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.27.0...v0.28.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/984">#984</a>: BUGFIX: Return correct upload result in case an error happens while building a ping request.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/988">#988</a>: BUGFIX: Enforce rate limitation at upload time, not at ping submission time.
<ul>
<li>Note: This change required a big refactoring of the internal uploading logic.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/994">#994</a>: Automatically restart ping upload once the rate limit window is ended.
<ul>
<li>Prior to this change, ping uploading would only be resumed once the <code>.submit()</code> API was called again, even if Glean was not throttled anymore.</li>
<li><strong>Note</strong>: this change does not apply to QML. We used the <code>setTimeout</code>/<code>clearTimeout</code> APIs in this feature and those are not available on the QML platform. Follow <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1743140">Bug 1743140</a> for updates.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/1015">#1015</a>: BUGFIX: Make attempting to call the <code>setUploadEnabled</code> API before initializing Glean a no-op.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/1016">#1016</a>: BUGFIX: Make shutdown a no-op in case Glean is not initialized.</li>
</ul>
<h1 id="v0270-2021-11-22"><a class="header" href="#v0270-2021-11-22">v0.27.0 (2021-11-22)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.26.0...v0.27.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/981">#981</a>: Update rate limits for ping submission from 15 pings/minute to 40 pings/minute.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/967">#967</a>: <strong>BREAKING CHANGE</strong>: Remove <code>debug</code> option from Glean configuration option.
<ul>
<li>The <code>Glean.setDebugViewTag</code>, <code>Glean.setSourceTags</code> and <code>Glean.setLogPings</code> should be used instead. Note that these APIs can safely be called prior to initialization.</li>
</ul>
</li>
</ul>
<h1 id="v0260-2021-11-19"><a class="header" href="#v0260-2021-11-19">v0.26.0 (2021-11-19)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.25.0...v0.26.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/965">#965</a>: Attempt to infer the Python virtualenv folder from the environment before falling back to the default <code>.venv</code>.
<ul>
<li>Users may provide a folder name through the <code>VIRTUAL_ENV</code> environment variable.</li>
<li>If the user is inside an active virtualenv the <code>VIRTUAL_ENV</code> environment variable is already set by Python. See: https://docs.python.org/3/library/venv.html.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/968">#968</a>: Add runtime arguments type checking to <code>Glean.setUploadEnabled</code> API.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/970">#970</a>: BUGFIX: Guarantee uploading is immediatelly resumed if the uploader has been stopped due to any of the uploading limits being hit.</li>
</ul>
<h1 id="v0250-2021-11-15"><a class="header" href="#v0250-2021-11-15">v0.25.0 (2021-11-15)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.24.0...v0.25.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/924">#924</a>: Only HTTPS server endpoints outside of testing mode.
<ul>
<li>In testing mode HTTP may be used. No other protocols are allowed.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/951">#951</a>: Expose Uploader, UploadResult and UploadResultStatus.
<ul>
<li>These are necessary for creating custom uploaders. Especially from TypeScript.</li>
</ul>
</li>
</ul>
<h1 id="v0240-2021-11-04"><a class="header" href="#v0240-2021-11-04">v0.24.0 (2021-11-04)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.23.0...v0.24.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/856">#856</a>: Expose the <code>@mozilla/glean/web</code> entry point for using Glean.js in websites.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/860">#856</a>: Implement the <code>PlatformInfo</code> module for the web platform.
<ul>
<li>Out of <code>os</code>, <code>os_version</code>, <code>architecture</code> and <code>locale</code>, on the web platform, we can only retrive <code>os</code> and <code>locale</code> information. The other information will default to the known value <code>Unknown</code> for all pings coming from this platform.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/856">#856</a>: Expose the <code>@mozilla/glean/web</code> entry point for using Glean.js in websites.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/908">#908</a>: BUGFIX: Guarantee internal <code>uploadEnabled</code> state always has a value.
<ul>
<li>When <code>uploadEnabled</code> was set to <code>false</code> and then Glean was restarted with it still <code>false</code>, the internal <code>uploadEnabled</code> state was not being set. That should not cause particularly harmful behaviour, since <code>undefined</code> is still a &quot;falsy&quot; value. However, this would create a stream of loud and annoying log messages.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/898">#898</a>: Implement the <code>Storage</code> module for the web platform.</li>
</ul>
<h1 id="v0230-2021-10-12"><a class="header" href="#v0230-2021-10-12">v0.23.0 (2021-10-12)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.22.0...v0.23.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/755">#755</a>: Only allow calling of <code>test*</code> functions in &quot;test mode&quot;.
<ul>
<li>Glean is put in &quot;test mode&quot; once the <code>Glean.testResetGlean</code> API called.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/811">#811</a>: Apply various fixes to the Qt entry point file.
<ul>
<li>Expose <code>ErrorType</code>. This is only useful for testing purposes;</li>
<li>Fix version of <code>QtQuick.LocalStorage</code> plugin;</li>
<li>Fix the way to access the lib from inside the <code>shutdown</code> method. Previous to this fix, it is not possible to use the <code>shutdown</code> method;</li>
<li>Expose the <code>Glean.testRestGlean</code> API.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/822">#822</a>: Fix API reference docs build step.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/825">#825</a>: Accept <code>architecture</code> and <code>osVersion</code> as initialization parameters in Qt. In Qt these values are not easily available from the environment.</li>
</ul>
<h1 id="v0220-2021-10-06"><a class="header" href="#v0220-2021-10-06">v0.22.0 (2021-10-06)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.21.1...v0.22.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/796">#796</a>: Support setting the <code>app_channel</code> metric.
<ul>
<li>As described in <a href="https://mozilla.github.io/glean/book/reference/general/initializing.html?highlight=channel#release-channels">&quot;Release channels&quot;</a>.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/799">#799</a>: Make sure Glean does not do anything else in case initialization errors.
<ul>
<li>This may happen in case there is an error creating the databases. Mostly an issue on Qt/QML where we use a SQLite database which can throw errors on initialization.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/799">#799</a>: Provide stack traces when logging errors.</li>
</ul>
<h1 id="v0211-2021-09-30"><a class="header" href="#v0211-2021-09-30">v0.21.1 (2021-09-30)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.21.0...v0.21.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/780">#780</a>: Fix the publishing step for releases. The Qt-specific build should now publish correctly.</li>
</ul>
<h1 id="v0210-2021-09-30"><a class="header" href="#v0210-2021-09-30">v0.21.0 (2021-09-30)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.20.0...v0.21.0">Full changelog</a></p>
<ul>
<li>
<p><a href="https://github.com/mozilla/glean.js/pull/754">#754</a>: Change target ECMAScript target from 2015 to 2016 when building for Qt.</p>
</li>
<li>
<p><a href="https://github.com/mozilla/glean.js/pull/779">#779</a>: Add a number of workarounds for the Qt Javascript engine.</p>
</li>
<li>
<p><a href="https://github.com/mozilla/glean.js/pull/775">#775</a>: Disallow calling test only methods outside of test mode.</p>
<ul>
<li>NOTE: Test mode is set once the API <code>Glean.testResetGlean</code> is called.</li>
</ul>
</li>
</ul>
<h1 id="v0200-2021-09-17"><a class="header" href="#v0200-2021-09-17">v0.20.0 (2021-09-17)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.19.0...v0.20.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/696">#696</a>: Expose Node.js entry point <code>@mozilla/glean/node</code>.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/695">#695</a>: Implement PlatformInfo module for the Node.js platform.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/730">#695</a>: Implement Uploader module for the Node.js platform.</li>
</ul>
<h1 id="v0190-2021-09-03"><a class="header" href="#v0190-2021-09-03">v0.19.0 (2021-09-03)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.18.1...v0.19.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/526">#526</a>: Implement mechanism to sort events reliably throughout restarts.
<ul>
<li>A new event (<code>glean.restarted</code>) will be included in the events payload of pings, in case there
was a restart in the middle of the ping measurement window.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/534">#534</a>: Expose <code>Uploader</code> base class through <code>@mozilla/glean/&lt;platform&gt;/uploader</code> entry point.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/580">#580</a>: Limit size of pings database to 250 pings or 10MB.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/580">#580</a>: BUGFIX: Pending pings at startup up are uploaded from oldest to newest.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/607">#607</a>: Record an error when incoherent timestamps are calculated for events after a restart.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/630">#630</a>: Accept booleans and numbers as event extras.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/647">#647</a>: Implement the Text metric type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/658">#658</a>: Implement rate limiting for ping upload.
<ul>
<li>Only up to 15 ping submissions every 60 seconds are now allowed.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/658">#658</a>: BUGFIX: Unblock ping uploading jobs after the maximum of upload failures are hit for a given uploading window.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/661">#661</a>: Include unminified version of library on Qt/QML builds.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/681">#681</a>: BUGFIX: Fix error in scanning events database upon initialization on Qt/QML.
<ul>
<li>This bug prevents the changes introduced in <a href="https://github.com/mozilla/glean.js/pull/526">#526</a> from working properly in Qt/QML.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/692">#692</a>: BUGFIX: Ensure events database is initialized at a time Glean is already able to record metrics.
<ul>
<li>This bug also prevents the changes introduced in <a href="https://github.com/mozilla/glean.js/pull/526">#526</a> from working properly in all platforms.</li>
</ul>
</li>
</ul>
<h1 id="v0181-2021-07-22"><a class="header" href="#v0181-2021-07-22">v0.18.1 (2021-07-22)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.18.0...v0.18.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/552">#552</a>: BUGFIX: Do not clear <code>deletion-request</code> ping from upload queue when disabling upload.</li>
</ul>
<h1 id="v0180-2021-07-20"><a class="header" href="#v0180-2021-07-20">v0.18.0 (2021-07-20)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.17.0...v0.18.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/542">#542</a>: Implement <code>shutdown</code> API.</li>
</ul>
<h1 id="v0170-2021-07-16"><a class="header" href="#v0170-2021-07-16">v0.17.0 (2021-07-16)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.16.0...v0.17.0">Full changelog</a></p>
<ul>
<li>
<p><a href="https://github.com/mozilla/glean.js/pull/529">#529</a>: Implement the URL metric type.</p>
</li>
<li>
<p><a href="https://github.com/mozilla/glean.js/pull/526">#526</a>: Implement new events sorting
logic, which allows for reliable sorting of events throughout restarts.</p>
</li>
</ul>
<h1 id="v0160-2021-07-06"><a class="header" href="#v0160-2021-07-06">v0.16.0 (2021-07-06)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.15.0...v0.16.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/346">#346</a>: Provide default HTTP client for Qt/QML platform.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/399">#399</a>: Check if there are ping data before attempting to delete it.
<ul>
<li>This change lowers the amount of log messages related to attempting to delete inexistent data.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/411">#411</a>: Tag all messages logged by Glean with the component they are coming from.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/415">#415</a>, <a href="https://github.com/mozilla/glean.js/pull/430">#430</a>: Gzip ping paylod before upload
<ul>
<li>This changes the signature of <code>Uploader.post</code> to accept <code>string | Uint8Array</code> for the <code>body</code> parameter, instead of only <code>string</code>.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/431">#431</a>: BUGFIX: Record the timestamp for events before dispatching to the internal task queue.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/462">#462</a>: Implement persistent storage for Qt/QML platform.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/466">#466</a>: Expose <code>ErrorType</code> enum, for using with the <code>testGetNumRecordedErrors</code> API.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/497">#497</a>: Implement limit of 1MB for ping request payload. Limit is calculated after gzip compression.</li>
</ul>
<h1 id="v0150-2021-06-03"><a class="header" href="#v0150-2021-06-03">v0.15.0 (2021-06-03)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.14.1...v0.15.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/389">#389</a>: BUGFIX: Make sure to submit a <code>deletion-request</code> ping before clearing data when toggling upload.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/375">#375</a>: Release Glean.js for Qt as a QML module.</li>
</ul>
<h1 id="v0141-2021-05-21"><a class="header" href="#v0141-2021-05-21">v0.14.1 (2021-05-21)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.14.0...v0.14.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/342">#342</a>: BUGFIX: Fix timespan payload representatin to match exactly the payload expected according to the Glean schema.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/343">#343</a>: BUGFIX: Report the correct failure exit code when the Glean command line tool fails.</li>
</ul>
<h1 id="v0140-2021-05-19"><a class="header" href="#v0140-2021-05-19">v0.14.0 (2021-05-19)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.13.0...v0.14.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/313">#313</a>: Send Glean.js version and platform information on X-Telemetry-Agent header instead of User-Agent header.</li>
</ul>
<h1 id="v0130-2021-05-18"><a class="header" href="#v0130-2021-05-18">v0.13.0 (2021-05-18)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.12.0...v0.13.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/313">#313</a>: Implement error recording mechanism and error checking testing API.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/319">#319</a>: BUGFIX: Do not allow recording floats with the quantity and counter metric types.</li>
</ul>
<h1 id="v0120-2021-05-11"><a class="header" href="#v0120-2021-05-11">v0.12.0 (2021-05-11)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.11.0...v0.12.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/279">#279</a>: BUGFIX: Ensure only empty pings triggers logging of &quot;empty ping&quot; messages.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/288">#288</a>: Support collecting <code>PlatformInfo</code> from <code>Qt</code> applications. Only OS name and locale are supported.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/281">#281</a>: Add the QuantityMetricType.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/303">#303</a>: Implement setRawNanos API for the TimespanMetricType.</li>
</ul>
<h1 id="v0110-2021-05-03"><a class="header" href="#v0110-2021-05-03">v0.11.0 (2021-05-03)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.10.2...v0.11.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/260">#260</a>: Set minimum node (&gt;= 12.0.0) and npm (&gt;= 7.0.0) versions.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/202">#202</a>: Add a testing API for the ping type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/253">#253</a>:
<ul>
<li>Implement the timespan metric type.</li>
<li>BUGFIX: Report event timestamps in milliseconds.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/261">#261</a>: Show a spinner while setting up python virtual environment</li>
<li><a href="https://github.com/mozilla/glean.js/pull/273">#273</a>: BUGFIX: Expose the missing <code>LabeledMetricType</code> and <code>TimespanMetricType</code> in Qt.</li>
</ul>
<h1 id="v0102-2021-04-26"><a class="header" href="#v0102-2021-04-26">v0.10.2 (2021-04-26)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.10.1...v0.10.2">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/256">#256</a>: BUGFIX: Add the missing <code>js</code> extension to the dispatcher.</li>
</ul>
<h1 id="v0101-2021-04-26"><a class="header" href="#v0101-2021-04-26">v0.10.1 (2021-04-26)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.10.0...v0.10.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/254">#254</a>: BUGFIX: Allow the usage of the Glean specific metrics API before Glean is initialized.</li>
</ul>
<h1 id="v0100-2021-04-20"><a class="header" href="#v0100-2021-04-20">v0.10.0 (2021-04-20)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.9.2...v0.10.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/228">#228</a>: Provide a Qt build with every new release.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/227">#227</a>: BUGFIX: Fix a bug that prevented using <code>labeled_string</code> and <code>labeled_boolean</code>.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/226">#226</a>: BUGFIX: Fix Qt build configuration to target ES5.</li>
</ul>
<h1 id="v092-2021-04-19"><a class="header" href="#v092-2021-04-19">v0.9.2 (2021-04-19)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.9.1...v0.9.2">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/220">#220</a>: Update <code>glean_parser</code> to version 3.1.1.</li>
</ul>
<h1 id="v091-2021-04-19"><a class="header" href="#v091-2021-04-19">v0.9.1 (2021-04-19)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.9.0...v0.9.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/219">#219</a>: BUGFIX: Fix path to ping entry point in package.json.</li>
</ul>
<h1 id="v090-2021-04-19"><a class="header" href="#v090-2021-04-19">v0.9.0 (2021-04-19)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.8.1...v0.9.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/201">#201</a>: BUGFIX: Do not let the platform be changed after Glean is initialized.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/215">#215</a>: Update the <code>glean-parser</code> to version 3.1.0.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/215">#214</a>: Improve error reporting of the Glean command.</li>
</ul>
<h1 id="v081-2021-04-14"><a class="header" href="#v081-2021-04-14">v0.8.1 (2021-04-14)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.8.0...v0.8.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/206">#206</a>: BUGFIX: Fix ping URL path.
<ul>
<li>Application ID was being reporting as <code>undefined</code>.</li>
</ul>
</li>
</ul>
<h1 id="v080-2021-04-13"><a class="header" href="#v080-2021-04-13">v0.8.0 (2021-04-13)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.7.0...v0.8.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/173">#173</a>: Drop Node.js support from webext entry points</li>
<li><a href="https://github.com/mozilla/glean.js/pull/155">#155</a>: Allow to define custom uploaders in the configuration.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/184">#184</a>: Correctly report <code>appBuild</code> and <code>appDisplayVersion</code> if provided by the user.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/198">#198</a>, <a href="https://github.com/mozilla/glean.js/pull/192">#192</a>, <a href="https://github.com/mozilla/glean.js/pull/184">#184</a>, <a href="https://github.com/mozilla/glean.js/pull/180">#180</a>, <a href="https://github.com/mozilla/glean.js/pull/174">#174</a>, <a href="https://github.com/mozilla/glean.js/pull/165">#165</a>: BUGFIX: Remove all circular dependencies.</li>
</ul>
<h1 id="v070-2021-03-26"><a class="header" href="#v070-2021-03-26">v0.7.0 (2021-03-26)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.6.1...v0.7.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/143">#143</a>: Provide a way to initialize and reset Glean.js in tests.</li>
</ul>
<h1 id="v061-2021-03-22"><a class="header" href="#v061-2021-03-22">v0.6.1 (2021-03-22)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.6.0...v0.6.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/130">#130</a>: BUGFIX: Fix destination path of CommonJS' build <code>package.json</code>.</li>
</ul>
<h1 id="v060-2021-03-22"><a class="header" href="#v060-2021-03-22">v0.6.0 (2021-03-22)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.5.0...v0.6.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/123">#123</a>: BUGFIX: Fix support for ES6 environments.
<ul>
<li>Include <code>.js</code> extensions in all local import statements.
<ul>
<li>ES6' module resolution algorithm does not currently support automatic resolution of file extensions and does not have the hability to import directories that have an index file. The extension and the name of the file being import need to <em>always</em> be specified. See: https://nodejs.org/api/esm.html#esm_customizing_esm_specifier_resolution_algorithm</li>
</ul>
</li>
<li>Add a <code>type: module</code> declaration to the main <code>package.json</code>.
<ul>
<li>Without this statement, ES6 support is disabled. See: https://nodejs.org/docs/latest-v13.x/api/esm.html#esm_enabling.:</li>
<li>To keep support for CommonJS, in our CommonJS build we include a <code>package.json</code> that overrides the <code>type: module</code> of the main <code>package.json</code> with a <code>type: commonjs</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="v050-2021-03-18"><a class="header" href="#v050-2021-03-18">v0.5.0 (2021-03-18)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.4.0...v0.5.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/96">#96</a>: Provide a ping encryption plugin.
<ul>
<li>This plugin listens to the <code>afterPingCollection</code> event. It receives the collected payload of a ping and returns an encrypted version of it using a JWK provided upon instantiation.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/95">#95</a>: Add a <code>plugins</code> property to the configuration options and create an event abstraction for triggering internal Glean events.
<ul>
<li>The only internal event triggered at this point is the <code>afterPingCollection</code> event, which is triggered after ping collection and logging, and before ping storing.</li>
<li>Plugins are built to listen to a specific Glean event. Each plugin must define an <code>action</code>, which is executed everytime the event they are listening to is triggered.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/101">#101</a>: BUGFIX: Only validate Debug View Tag and Source Tags when they are present.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/102">#102</a>: BUGFIX: Include a Glean User-Agent header in all pings.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/97">#97</a>: Add support for labeled metric types (string, boolean and counter).</li>
<li><a href="https://github.com/mozilla/glean.js/pull/105">#105</a>: Introduce and publish the <code>glean</code> command for using the <code>glean-parser</code> in a virtual environment.</li>
</ul>
<h1 id="v040-2021-03-10"><a class="header" href="#v040-2021-03-10">v0.4.0 (2021-03-10)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.3.0...v0.4.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/92">#92</a>: Remove <code>web-ext-types</code> from <code>peerDependencies</code> list.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/98">#98</a>: Add external APIs for setting the Debug View Tag and Source Tags.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/99">#99</a>: BUGFIX: Add a default ping value in the testing APIs.</li>
</ul>
<h1 id="v030-2021-02-24"><a class="header" href="#v030-2021-02-24">v0.3.0 (2021-02-24)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.2.0...v0.3.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/90">#90</a>: Provide exports for CommonJS and browser environemnts.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/90">#90</a>: BUGIFX: Accept lifetimes as strings when instantiating metric types.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/90">#90</a>: BUGFIX: Fix type declaration paths.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/90">#90</a>: BUGFIX: Make web-ext-types a peer dependency.
<ul>
<li>This is quick fix until <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1694701">Bug 1694701</a> is fixed.</li>
</ul>
</li>
</ul>
<h1 id="v020-2021-02-23"><a class="header" href="#v020-2021-02-23">v0.2.0 (2021-02-23)</a></h1>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/85">#85</a>: Include type declarations in <code>@mozilla/glean</code> webext package bundle.</li>
</ul>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.1.1...v0.2.0">Full changelog</a></p>
<h1 id="v011-2021-02-17"><a class="header" href="#v011-2021-02-17">v0.1.1 (2021-02-17)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/v0.1.0...v0.1.1">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/77">#77</a>: Include README.md file in <code>@mozilla/glean</code> package bundle.</li>
</ul>
<h1 id="v010-2021-02-17"><a class="header" href="#v010-2021-02-17">v0.1.0 (2021-02-17)</a></h1>
<p><a href="https://github.com/mozilla/glean.js/compare/46f028fb4ea7b8f312daf4666904c81d0a3eb171...v0.1.0">Full changelog</a></p>
<ul>
<li><a href="https://github.com/mozilla/glean.js/pull/73">#73</a>: Add this changelog file.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/42">#42</a>: Implement the <code>deletion-request</code> ping.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/41">#41</a>: Implement the <code>logPings</code> debug tool.
<ul>
<li>When <code>logPings</code> is enabled, pings are logged upon collection.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/40">#40</a>: Use the dispatcher in all Glean external API functions. Namely:
<ul>
<li>Metric recording functions;</li>
<li>Ping submission;</li>
<li><code>initialize</code> and <code>setUploadEnabled</code>.</li>
</ul>
</li>
<li><a href="https://github.com/mozilla/glean.js/pull/36">#36</a>: Implement the event metric type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/31">#31</a>: Implement a task Dispatcher to help in executing Promises in a deterministic order.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/26">#26</a>: Implement the setUploadEnable API.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/25">#25</a>: Implement an adapter that leverages browser APIs to upload pings.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/24">#24</a>: Implement a ping upload manager.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/23">#23</a>: Implement the initialize API and glean internal metrics.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/22">#22</a>: Implement the PingType structure and a ping maker.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/20">#20</a>: Implement the datetime metric type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/17">#17</a>: Implement the UUID metric type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/14">#14</a>: Implement the counter metric type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/13">#13</a>: Implement the string metric type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/11">#11</a>: Implement the boolean metric type.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/9">#9</a>: Implement a metrics database module.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/8">#8</a>: Implement a web extension version of the underlying storage module.</li>
<li><a href="https://github.com/mozilla/glean.js/pull/6">#6</a>: Implement an abstract underlying storage module.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/changelog/js.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="this-week-in-glean-twig-1"><a class="header" href="#this-week-in-glean-twig-1">This Week in Glean (TWiG)</a></h1>
<p>“This Week in Glean” is a series of blog posts that the Glean Team at Mozilla is using to try to communicate better about our work.
They could be release notes, documentation, hopes, dreams, or whatever: so long as it is inspired by Glean.</p>
<h2 id="blog-posts"><a class="header" href="#blog-posts">Blog posts</a></h2>
<ul>
<li>2019-10-17: <a href="https://chuttenblog.wordpress.com/2019/10/17/this-week-in-glean-glean-on-desktop-project-fog/">Glean on Desktop (Project FOG)</a></li>
<li>2019-10-24: <a href="https://fnordig.de/2019/10/24/this-week-in-glean/">A Release</a></li>
<li>2019-11-01: <a href="http://droettboom.com/blog/2019/11/01/this-week-in-glean-november-1-2019/">A detective story</a></li>
<li>2019-11-08: <a href="https://blogoftravis.wordpress.com/2019/11/08/this-week-in-glean-2019-11-08/">Instrumenting Android Crashes with Glean</a></li>
<li>2019-11-19: <a href="https://www.a2p.it/wordpress/tech-stuff/mozilla/geckoview-glean-fenix-performance-metrics/">GeckoView + Glean = Fenix performance metrics</a></li>
<li>2019-11-21: <a href="https://dianaciufo.wordpress.com/2019/10/11/glean-graphic-identity-for-mozilla-firefox/">What is the Glean logo about?</a></li>
<li>2019-11-22: <a href="https://chuttenblog.wordpress.com/2019/11/22/this-week-in-glean-glean-in-private/">Glean in Private</a></li>
<li>2019-11-29: <a href="https://fnordig.de/2019/11/29/this-week-in-glean/">Differences</a></li>
<li>2019-12-06: <a href="https://brizental.github.io/2019/12/06/this-week-in-glean-migrations.html">Migrations</a></li>
<li>2020-01-10: <a href="https://brizental.github.io/2020/01/10/this-week-in-glean-glossary.html">Glossary</a></li>
<li>2020-02-03: <a href="https://fnordig.de/2020/02/03/this-week-in-glean/">Cargo features - an investigation</a></li>
<li>2020-02-14: <a href="https://www.a2p.it/wordpress/tech-stuff/mozilla/extending-glean-build-re-usable-types-for-new-use-cases/">Extending Glean: build re-usable types for new use-cases</a></li>
<li>2020-02-21: <a href="https://chuttenblog.wordpress.com/2020/02/21/this-week-in-glean-a-distributed-team-echoes-distributed-workflow/">A Distributed Team Echoes Distributed Workflow</a></li>
<li>2020-02-28: <a href="https://wlach.github.io/blog/2020/02/this-week-in-glean-special-guest-post-mozregression-telemetry-part-1/">mozregression telemetry (part 1)</a></li>
<li>2020-03-09: <a href="https://blog.mozilla.org/data/2020/03/09/this-week-in-glean-metric-lifetimes/">Metric lifetimes</a></li>
<li>2020-03-13: <a href="https://blog.mozilla.org/data/2020/03/13/this-week-in-glean-adding-support-for-glam-on-glean/">Adding support for GLAM on Glean</a></li>
<li>2020-03-25: <a href="https://blog.mozilla.org/data/2020/03/25/this-week-in-glean-comparing-apples-to-oranges/">Comparing Apples to Oranges</a></li>
<li>2020-04-15: <a href="https://chuttenblog.wordpress.com/2020/04/15/this-week-in-glean-how-much-does-that-data-cost/">How Much Does That Data Cost</a></li>
<li>2020-04-27: <a href="https://blog.mozilla.org/data/2020/04/27/this-week-in-glean-glean-for-python-on-windows/">Glean for Python on Windows</a></li>
<li>2020-05-04: <a href="https://fnordig.de/2020/05/04/this-week-in-glean/">Bytes in Memory (on Android)</a></li>
<li>2020-05-08: <a href="https://wlach.github.io/blog/2020/05/this-week-in-glean-mozregression-telemetry-part-2/">mozregression telemetry (part 2)</a></li>
<li>2020-05-26: <a href="https://blog.mozilla.org/data/2020/05/26/how-does-the-glean-sdk-send-gzipped-pings/">How does the Glean SDK send gzipped pings</a></li>
<li>2020-06-03: <a href="https://blog.mozilla.org/data/2020/06/03/this-week-in-glean-the-glean-sdk-and-ios-application-extensions-or-a-tale-of-two-sandboxes/">The Glean SDK and iOS Application Extensions, or a Tale of Two Sandboxes</a></li>
<li>2020-06-12: <a href="https://blog.mozilla.org/data/2020/06/12/this-week-in-glean-project-fog-update-end-of-h12020/">Project FOG Update, end of H12020</a></li>
<li>2020-07-16: <a href="https://blog.mozilla.org/data/2020/07/16/mozilla-telemetry-in-2020-from-just-firefox-to-a-galaxy-of-data/">Mozilla Telemetry in 2020: From “Just Firefox” to a “Galaxy of Data”</a></li>
<li>2020-07-24: <a href="https://blog.mozilla.org/data/2020/07/24/this-week-in-glean-automated-end-to-end-tests-for-glean/">Automated end-to-end tests for Glean</a></li>
<li>2020-08-06: <a href="https://blog.mozilla.org/data/2020/08/06/experimental-integration-glean-with-unity-applications/">Experimental integration Glean with Unity applications</a></li>
<li>2020-09-01: <a href="https://blog.mozilla.org/data/2020/09/01/twig-leveraging-rust/">Leveraging Rust to build cross-platform mobile libraries</a></li>
<li>2020-09-25: <a href="https://blog.mozilla.org/data/2020/09/25/this-week-in-glean-glean-core-to-wasm-experiment/">glean-core to Wasm experiment</a></li>
<li>2020-10-06: <a href="https://blog.mozilla.org/data/2020/10/06/this-week-in-glean-fog-progress-report/">FOG Progress report</a></li>
<li>2020-10-21: <a href="https://blog.mozilla.org/data/2020/10/21/this-week-in-glean-cross-platform-language-binding-generation-with-rust-and-uniffi/">Cross-Platform Language Binding Generation with Rust and “uniffi”</a></li>
<li>2020-11-02: <a href="https://blog.mozilla.org/data/2020/11/02/this-week-in-glean-glean-js/">Glean.js</a></li>
<li>2020-11-19: <a href="https://blog.mozilla.org/data/2020/11/19/this-week-in-glean-fantastic-facts-and-where-to-find-them/">Fantastic Facts and Where To Find Them</a></li>
<li>2020-12-01: <a href="https://blog.mozilla.org/data/2020/12/01/this-week-in-glean-glean-is-frictionless-data-collection/">Glean is Frictionless Data Collection</a></li>
<li>2020-12-18: <a href="https://fnordig.de/2020/12/18/glean-in-2021/">Glean in 2021</a></li>
<li>2021-01-15: <a href="https://blog.mozilla.org/data/2021/01/15/this-week-in-glean-proposals-for-asynchronous-design/">Proposals for Asynchronous Design</a></li>
<li>2021-01-28: <a href="https://blog.mozilla.org/data/2021/01/27/this-week-in-glean-the-glean-dictionary/">The Glean Dictionary</a></li>
<li>2021-02-24: <a href="https://blog.mozilla.org/data/2021/02/24/this-week-in-glean-boring-monitoring/">Boring Monitoring</a></li>
<li>2021-03-16: <a href="https://blog.mozilla.org/data/2021/03/16/this-week-in-glean-reducing-release-friction/">Reducing Release Friction</a></li>
<li>2021-04-07: <a href="https://blog.mozilla.org/data/2021/04/07/this-week-in-glean-publishing-glean-js/">Publishing Glean.js or “How I configured an npm package that has multiple entry points”</a></li>
<li>2021-04-16: <a href="https://blog.mozilla.org/data/2021/04/16/this-week-in-glean-rustc-ios-and-an-m1/">rustc, iOS and an M1</a></li>
<li>2021-05-03: <a href="https://blog.mozilla.org/data/2021/06/02/this-week-in-glean-glean-dictionary-updates/">Glean Dictionary updates</a></li>
<li>2021-06-14: <a href="https://blog.mozilla.org/data/2021/06/11/danger-zone-handling-sensitive-data-in-glean/">⚠️Danger zone⚠️: handling sensitive data in Glean</a></li>
<li>2021-06-25: <a href="https://fnordig.de/2021/06/25/funday/">Funday!</a></li>
<li>2021-07-22: <a href="https://blog.mozilla.org/data/2021/07/22/this-week-in-glean-firefox-telemetry-is-to-glean-as-c-is-to-rust/">Firefox Telemetry is to Glean as C++ is to Rust</a></li>
<li>2021-07-26: <a href="https://blog.mozilla.org/data/2021/07/26/this-week-in-glean-shipping-glean-with-geckoview/">Shipping Glean with GeckoView</a></li>
<li>2021-08-05: <a href="https://blog.mozilla.org/data/2021/08/05/this-week-in-glean-building-a-mobile-acquisition-dashboard-in-looker/">Building a Mobile Acquisition Dashboard in Looker</a></li>
<li>2021-08-23: <a href="https://blog.mozilla.org/data/2021/08/23/this-week-in-glean-why-choosing-the-right-data-type-for-your-metric-matters/">Why choosing the right data type for your metric matters</a></li>
<li>2021-09-07: <a href="https://blog.mozilla.org/data/2021/09/07/this-week-in-glean-data-reviews-are-important-glean-parser-makes-them-easy/">Data Reviews are Important, Glean Parser makes them Easy </a></li>
<li>2021-09-17: <a href="https://blog.mozilla.org/data/2021/09/17/this-week-in-glean-glean-geckoview/">Glean &amp; GeckoView</a></li>
<li>2021-09-30: <a href="https://blog.mozilla.org/data/2021/09/30/this-week-in-glean-announcement-glean-js-v0-19-0-supports-node-js/">Glean.js v0.19.0 Supports Node.js</a></li>
<li>2021-10-18: <a href="https://blog.mozilla.org/data/2021/10/18/this-week-in-glean-designing-a-telemetry-collection-with-glean/">Designing a telemetry collection with Glean</a></li>
<li>2021-10-22: <a href="https://blog.mozilla.org/data/2021/10/22/this-week-in-glean-the-three-roles-of-data-engagements/">The Three Roles of Data Engagements</a></li>
<li>2021-11-01: <a href="https://blog.mozilla.org/data/2021/11/01/this-week-in-glean-crashes-a-buggy-glean/">Crashes &amp; a buggy Glean</a></li>
<li>2021-12-14: <a href="https://blog.mozilla.org/data/2021/12/14/this-week-in-glean-how-long-must-i-wait-before-i-can-see-my-data/">How Long Must I Wait Before I Can See My Data?</a></li>
<li>2021-12-17: <a href="https://blog.mozilla.org/data/2021/12/17/this-week-in-glean-looking-back-at-glean-in-2021/">Looking back at Glean in 2021</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/twig.md">Edit this file on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="contribution-guidelines"><a class="header" href="#contribution-guidelines">Contribution Guidelines</a></h1>
<p>There are two important questions to answer before adding new content to this book:</p>
<ul>
<li>Where to include this content?</li>
<li>In which format to present it?</li>
</ul>
<p>This guide aims to provide context for answering both questions.</p>
<h2 id="table-of-contents-3"><a class="header" href="#table-of-contents-3">Table of contents</a></h2>
<ul>
<li><a href="appendix/contribution-guidelines.html#where-to-add-new-content">Where to add new content?</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#overview">Overview</a></li>
<li><a href="appendix/contribution-guidelines.html#user-guides">User Guides</a></li>
<li><a href="appendix/contribution-guidelines.html#api-reference">API Reference</a></li>
<li><a href="appendix/contribution-guidelines.html#sdk-specific-information">SDK Specific Information</a></li>
<li><a href="appendix/contribution-guidelines.html#appendix">Appendix</a></li>
</ul>
</li>
<li><a href="appendix/contribution-guidelines.html#in-which-format-to-present-content">In which format to present content?</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#general-guidelines">General guidelines</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#link-to-other-internal-pages-and-sections-whenever-that-is-possible">Link to other internal pages and sections whenever that is possible</a></li>
<li><a href="appendix/contribution-guidelines.html#prefer-using-headers-whenever-a-new-topic-is-introduced">Prefer using headers whenever a new topic is introduced</a></li>
<li><a href="appendix/contribution-guidelines.html#favor-creating-new-pages-instead-of-adding-unrelated-content-to-an-already-existing-page">Favor creating new pages, instead of adding unrelated content to an already existing page</a></li>
</ul>
</li>
<li><a href="appendix/contribution-guidelines.html#custom-elements">Custom elements</a>
<ul>
<li><a href="appendix/contribution-guidelines.html#tabs">Tabs</a></li>
<li><a href="appendix/contribution-guidelines.html#tab-tooltips">Tab tooltips</a></li>
<li><a href="appendix/contribution-guidelines.html#custom-block-quotes">Custom block quotes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="where-to-add-new-content"><a class="header" href="#where-to-add-new-content">Where to add new content?</a></h2>
<p>This book is divided in five different sections. Each section contains pages that are of a specific
type. New content will fit in one of these section. Following is an explanation on what kind of content
fits in each section.</p>
<h3 id="overview-1"><a class="header" href="#overview-1">Overview</a></h3>
<p><em>Is the content you want to add an essay or high level explanation on some aspect of Glean?</em></p>
<p>The overview section is the place to provide important higher level context for
users of Glean. This section may include essays about Glean’s views, principles,
data practices, etc. It also contains primers on information such as what are the Glean SDKs</p>
<h3 id="user-guides"><a class="header" href="#user-guides">User Guides</a></h3>
<p><em>Is the content you want to add a general purpose guide on a Glean aspect or feature?</em></p>
<p>This section is the place for Glean SDK user guides. Pages under this section
contain prose format guides on how to include Glean in a project, how to add metrics,
how to create pings, and so on.</p>
<p>Pages on this section may link to the API Reference pages, but should not
themselves be API References.</p>
<p>Guides can be quite long, thus we should favor having one page per SDK instead
of using tabs.</p>
<h3 id="api-reference"><a class="header" href="#api-reference">API Reference</a></h3>
<p><em>Is the content you want to add a developer reference on a specific Glean API?</em></p>
<p>This section of the book contains reference for all of Glean’s user APIs.
Its pages follow a strict structure.</p>
<p>Each API description contains:</p>
<ul>
<li>A title with the name of the API.
<ul>
<li>It’s important to use titles, because they automatically generate links to that API.</li>
</ul>
</li>
<li>A brief description of what the API does.</li>
<li>Tabs with examples for using that API in each SDK.
<ul>
<li>Even if a certain SDK does not contain a given API, the tab will be included in
the tabs bar in the disabled state.</li>
</ul>
</li>
</ul>
<p>The API Reference pages should not contain any guides in prose format, they should all be linked from the User’s Guide when convenient.</p>
<h3 id="sdk-specific-information"><a class="header" href="#sdk-specific-information">SDK Specific Information</a></h3>
<p><em>Is the content you want to add a SDK specific guide on a Glean feature?</em></p>
<p>Different SDKs may require some dedicated pages, these section contains these pages.
Each SDK has a top level section under this section, specific pages live under these titles.</p>
<h3 id="appendix-1"><a class="header" href="#appendix-1">Appendix</a></h3>
<p><em>Is the content you want to add support content for the rest of the content on book?</em></p>
<p>The appendix contains support information related to the Glean SDKs or the content of this book.</p>
<h2 id="in-which-format-to-present-content"><a class="header" href="#in-which-format-to-present-content">In which format to present content?</a></h2>
<h3 id="general-guidelines"><a class="header" href="#general-guidelines">General guidelines</a></h3>
<h4 id="link-to-other-internal-pages-and-sections-whenever-that-is-possible"><a class="header" href="#link-to-other-internal-pages-and-sections-whenever-that-is-possible">Link to other internal pages and sections whenever that is possible</a></h4>
<p>Each page of the book should be written as if it were the first page a user is visiting ever.
There should be links to other pages of the book wherever there is missing context in the
current page. This is important, because documentations are first and foremost reference books,
manuals. They should not be expected to be read in order.</p>
<h4 id="prefer-using-headers-whenever-a-new-topic-is-introduced"><a class="header" href="#prefer-using-headers-whenever-a-new-topic-is-introduced">Prefer using headers whenever a new topic is introduced</a></h4>
<p><a href="https://rust-lang.github.io/mdBook/index.html">mdbook</a> (the tool used to build this book) turns
all headers into links. Which is useful to refer to specific documentation sections.</p>
<h4 id="favor-creating-new-pages-instead-of-adding-unrelated-content-to-an-already-existing-page"><a class="header" href="#favor-creating-new-pages-instead-of-adding-unrelated-content-to-an-already-existing-page">Favor creating new pages, instead of adding unrelated content to an already existing page</a></h4>
<p>This makes it easier to find content through the Summary.</p>
<h3 id="custom-elements"><a class="header" href="#custom-elements">Custom elements</a></h3>
<h4 id="tabs"><a class="header" href="#tabs">Tabs</a></h4>
<p>Tabs are useful for providing small code examples of Glean's APIs for each SDK.
A tabs section starts with the <code>tab_header</code> <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a> and ends with the <code>tab_footer</code> <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a>.
Each tab is declared in between these <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a> statements.</p>
<p>Each tab content is placed inside an html <code>div</code> tag with the <code>data-lang</code> and <code>class=&quot;tab&quot;</code> attributes.
The <code>data-lang</code> attribute contains the title of the tab. Titles must match for different tabs on the
same SDK. Whenever a user clicks in a tab with a specific title, all tabs with that same
title will be opened by default, until the user clicks in a tab with a different title.</p>
<p>Every tab section should contain tabs for all Glean SDKs, even if an SDK does not
provide the API in question. In this case, the tab div should still be there without any inner HTML.
When that is the case that tab will be rendered in a disabled state.</p>
<p>These are the tabs every tab section is expected to contain, in order:</p>
<ul>
<li>Kotlin</li>
<li>Java</li>
<li>Swift</li>
<li>Python</li>
<li>Rust</li>
<li>JavaScript</li>
<li>Firefox Desktop</li>
</ul>
<p>Finally, here is an example code for a tabs sections:</p>
<pre><code class="language-html">{{#include ../../shared/tab_header.md}}
&lt;div data-lang=&quot;Kotlin&quot; class=&quot;tab&quot;&gt;
  Kotlin information...
&lt;/div&gt;
&lt;div data-lang=&quot;Java&quot; class=&quot;tab&quot;&gt;
  Java information...
&lt;/div&gt;
&lt;div data-lang=&quot;Swift&quot; class=&quot;tab&quot;&gt;
  Swift information...
&lt;/div&gt;
&lt;div data-lang=&quot;Python&quot; class=&quot;tab&quot;&gt;
  Python information...`
&lt;/div&gt;
&lt;div data-lang=&quot;Rust&quot; class=&quot;tab&quot;&gt;
  Rust information...
&lt;/div&gt;
&lt;!--
  In this example, JavaScript and Firefox Desktop
  would show up as disabled in the final page.
--&gt;
&lt;div data-lang=&quot;JavaScript&quot; class=&quot;tab&quot;&gt;&lt;/div&gt;
&lt;div data-lang=&quot;Firefox Desktop&quot; class=&quot;tab&quot;&gt;&lt;/div&gt;
{{#include ../../shared/tab_footer.md}}
</code></pre>
<p>And this is how those tabs will look like:</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
  Kotlin information...
</div>
<div data-lang="Java" class="tab">
  Java information...
</div>
<div data-lang="Swift" class="tab">
  Swift information...
</div>
<div data-lang="Python" class="tab">
  Python information...`
</div>
<div data-lang="Rust" class="tab">
  Rust information...
</div>
<div data-lang="JavaScript" class="tab"></div>
<div data-lang="Firefox Desktop" class="tab"></div>
</div>
</div>
<h4 id="tab-tooltips"><a class="header" href="#tab-tooltips">Tab tooltips</a></h4>
<p>Tabs in a disabled i.e. tabs that do not have any content, will show a tooltip when hovered.</p>
<p>By default, this tooltip will show the message <code>&lt;lang&gt; doe not provide this API</code>. The following <code>data-*</code> attributes can be used to modify this message.</p>
<h5 id="data-bug"><a class="header" href="#data-bug"><code>data-bug</code></a></h5>
<p>This attribute expects a Bugzilla bug number. When this attribute is added a link to the provided
bug will be added to the tooltip text.</p>
<h5 id="data-info"><a class="header" href="#data-info"><code>data-info</code></a></h5>
<p>This attribute expects free form text or valid HTML. Be careful when adding long texts here. If a text needs to be
too long, consider adding it as an actual section / paragraph to the page instead of as a tooltip.</p>
<p>This is how you can use the above attributes.</p>
<pre><code class="language-html">{{#include ../../shared/tab_header.md}}
...

&lt;!-- No attribute, default text will show up. --&gt;
&lt;div data-lang=&quot;Rust&quot; class=&quot;tab&quot;&gt;&lt;/div&gt;
&lt;!-- data-bug attribute, default text will show up + link to bug. --&gt;
&lt;div data-lang=&quot;JavaScript&quot; class=&quot;tab&quot; data-bug=&quot;000000&quot;&gt;&lt;/div&gt;
&lt;!-- data-info attribute, free form text will show up. --&gt;
&lt;div data-lang=&quot;Firefox Desktop&quot; class=&quot;tab&quot; data-info=&quot;Hello, Glean world!&quot;&gt;&lt;/div&gt;
{{#include ../../shared/tab_footer.md}}
</code></pre>
<p>And this is how each tool tip is rendered.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab" data-bug="000000"></div>
<div data-lang="Firefox Desktop" class="tab" data-info="Hello, Glean world!"></div>
</div>
</div>
<h4 id="custom-block-quotes"><a class="header" href="#custom-block-quotes">Custom block quotes</a></h4>
<p>Sometimes it is necessary to bring attention to a special piece of information, or simply to provide
extra context related to the a given text.</p>
<p>In order to do that, there are three custom block quote formats available.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h5 id="info-quote"><a class="header" href="#info-quote">Info quote</a></h5>
<blockquote>
<p>An information block quote format, to provide useful extra context for a given text.</p>
</blockquote>
<div class="special-quote special-quote-warning fa fa-exclamation-triangle"></div>
<h5 id="warning-quote"><a class="header" href="#warning-quote">Warning quote</a></h5>
<blockquote>
<p>A warning block quote format, to provide useful warning related to a given text.</p>
</blockquote>
<div class="special-quote special-quote-stop fa fa-ban"></div>
<h5 id="stop-quote"><a class="header" href="#stop-quote">Stop quote</a></h5>
<blockquote>
<p>A stronger warning block quote format, to provide useful warning related to a given text in
a more emphatic format. Use these sparingly.</p>
</blockquote>
<p>To include such quotes, again you can use mdbook <a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-files">include</a> statements.</p>
<p>For the above quotes, this is the corresponding code.</p>
<pre><code class="language-markdown">{{#include ../../shared/blockquote-info.html}}

##### Info quote

&gt; An information blockquote format, to provide useful extra context for a given text.

{{#include ../../shared/blockquote-warning.html}}

##### Warning quote

&gt; A warning blockquote format, to provide useful warning related to a given text.

{{#include ../../shared/blockquote-stop.html}}

##### Stop quote

&gt; A stronger warning blockquote format, to provide useful warning related to a given text in a
&gt; more emphatic format. Use these sparingly.
</code></pre>
<p>It is possible to use any level header with these special block quotes
and also no header at all.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/appendix/contribution-guidelines.md">Edit this file on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
                <script type="text/javascript" src="../shared/tabs.js"></script>
                <script type="text/javascript" src="../shared/mermaid.min.js"></script>
                <script type="text/javascript" src="../shared/mermaid-init.js"></script>
                <script type="text/javascript" src="chart.min.js"></script>
                <script type="text/javascript" src="chart-distributions.js"></script>
                <script type="text/javascript" src="chart-distributions-ui.js"></script>
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
                
    </body>
</html>
