<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Initializing - Glean SDKs - Cross-platform Telemetry Libraries</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../shared/glean.css">
        <link rel="stylesheet" href="../../../shared/mermaid.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../index.html">Glean</a></li><li class="chapter-item affix "><li class="part-title">User Guides</li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/index.html"><strong aria-hidden="true">1.</strong> Adding Glean to your project</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/kotlin.html"><strong aria-hidden="true">1.1.</strong> Kotlin</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/swift.html"><strong aria-hidden="true">1.2.</strong> Swift</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/python.html"><strong aria-hidden="true">1.3.</strong> Python</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/javascript.html"><strong aria-hidden="true">1.4.</strong> JavaScript</a></li><li class="chapter-item "><a href="../../user/adding-glean-to-your-project/qt.html"><strong aria-hidden="true">1.5.</strong> Qt/QML</a></li></ol></li><li class="chapter-item "><a href="../../user/integrating-glean-for-product-managers.html"><strong aria-hidden="true">2.</strong> Integrating Glean for project managers</a></li><li class="chapter-item "><a href="../../user/metrics/adding-new-metrics.html"><strong aria-hidden="true">3.</strong> Metrics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/metrics/adding-new-metrics.html"><strong aria-hidden="true">3.1.</strong> Adding new metrics</a></li><li class="chapter-item "><a href="../../user/metrics/testing-metrics.html"><strong aria-hidden="true">3.2.</strong> Testing metrics</a></li><li class="chapter-item "><a href="../../user/metrics/error-reporting.html"><strong aria-hidden="true">3.3.</strong> Error reporting</a></li><li class="chapter-item "><a href="../../user/collected-metrics/metrics.html"><strong aria-hidden="true">3.4.</strong> Metrics collected by the Glean SDKs</a></li></ol></li><li class="chapter-item "><a href="../../user/pings/index.html"><strong aria-hidden="true">4.</strong> Pings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/pings/custom.html"><strong aria-hidden="true">4.1.</strong> Adding new custom pings</a></li><li class="chapter-item "><a href="../../user/pings/testing-custom-pings.html"><strong aria-hidden="true">4.2.</strong> Testing custom pings</a></li><li class="chapter-item "><a href="../../user/pings/sent-by-glean.html"><strong aria-hidden="true">4.3.</strong> Pings sent by Glean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/pings/baseline.html"><strong aria-hidden="true">4.3.1.</strong> Baseline Ping</a></li><li class="chapter-item "><a href="../../user/pings/deletion-request.html"><strong aria-hidden="true">4.3.2.</strong> Deletion Request Ping</a></li><li class="chapter-item "><a href="../../user/pings/events.html"><strong aria-hidden="true">4.3.3.</strong> Events Ping</a></li><li class="chapter-item "><a href="../../user/pings/metrics.html"><strong aria-hidden="true">4.3.4.</strong> Metrics Ping</a></li><li class="chapter-item "><a href="../../user/pings/ping-schedules-and-timings.html"><strong aria-hidden="true">4.3.5.</strong> Schedules and timings overview</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../user/debugging/index.html"><strong aria-hidden="true">5.</strong> Debugging products using Glean</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../user/debugging/android.html"><strong aria-hidden="true">5.1.</strong> Android</a></li><li class="chapter-item "><a href="../../user/debugging/ios.html"><strong aria-hidden="true">5.2.</strong> iOS</a></li><li class="chapter-item "><a href="../../user/debugging/python.html"><strong aria-hidden="true">5.3.</strong> Python</a></li><li class="chapter-item "><a href="../../user/debugging/javascript.html"><strong aria-hidden="true">5.4.</strong> JavaScript</a></li></ol></li><li class="chapter-item "><li class="part-title">API Reference</li><li class="chapter-item "><a href="../../reference/yaml/index.html"><strong aria-hidden="true">6.</strong> YAML Registry Format</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/yaml/metrics.html"><strong aria-hidden="true">6.1.</strong> Metrics</a></li><li class="chapter-item "><a href="../../reference/yaml/pings.html"><strong aria-hidden="true">6.2.</strong> Pings</a></li><li class="chapter-item "><a href="../../reference/yaml/tags.html"><strong aria-hidden="true">6.3.</strong> Tags</a></li></ol></li><li class="chapter-item expanded "><a href="../../reference/general/index.html"><strong aria-hidden="true">7.</strong> General API</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../reference/general/initializing.html" class="active"><strong aria-hidden="true">7.1.</strong> Initializing</a></li><li class="chapter-item "><a href="../../reference/general/toggling-upload-status.html"><strong aria-hidden="true">7.2.</strong> Toggling upload status</a></li><li class="chapter-item "><a href="../../reference/general/experiments-api.html"><strong aria-hidden="true">7.3.</strong> Annotating experiments</a></li><li class="chapter-item "><a href="../../reference/general/register-custom-pings.html"><strong aria-hidden="true">7.4.</strong> Registering custom pings</a></li><li class="chapter-item "><a href="../../reference/general/shutdown.html"><strong aria-hidden="true">7.5.</strong> Shut down</a></li></ol></li><li class="chapter-item "><a href="../../reference/debug/index.html"><strong aria-hidden="true">8.</strong> Debugging</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/debug/logPings.html"><strong aria-hidden="true">8.1.</strong> Log pings</a></li><li class="chapter-item "><a href="../../reference/debug/debugViewTag.html"><strong aria-hidden="true">8.2.</strong> Debug View Tag</a></li><li class="chapter-item "><a href="../../reference/debug/sourceTags.html"><strong aria-hidden="true">8.3.</strong> Source Tags</a></li></ol></li><li class="chapter-item "><a href="../../reference/metrics/index.html"><strong aria-hidden="true">9.</strong> Metric types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/metrics/boolean.html"><strong aria-hidden="true">9.1.</strong> Boolean</a></li><li class="chapter-item "><a href="../../reference/metrics/labeled_booleans.html"><strong aria-hidden="true">9.2.</strong> Labeled Booleans</a></li><li class="chapter-item "><a href="../../reference/metrics/counter.html"><strong aria-hidden="true">9.3.</strong> Counter</a></li><li class="chapter-item "><a href="../../reference/metrics/labeled_counters.html"><strong aria-hidden="true">9.4.</strong> Labeled Counters</a></li><li class="chapter-item "><a href="../../reference/metrics/string.html"><strong aria-hidden="true">9.5.</strong> String</a></li><li class="chapter-item "><a href="../../reference/metrics/labeled_strings.html"><strong aria-hidden="true">9.6.</strong> Labeled Strings</a></li><li class="chapter-item "><a href="../../reference/metrics/string_list.html"><strong aria-hidden="true">9.7.</strong> String List</a></li><li class="chapter-item "><a href="../../reference/metrics/timespan.html"><strong aria-hidden="true">9.8.</strong> Timespan</a></li><li class="chapter-item "><a href="../../reference/metrics/timing_distribution.html"><strong aria-hidden="true">9.9.</strong> Timing Distribution</a></li><li class="chapter-item "><a href="../../reference/metrics/memory_distribution.html"><strong aria-hidden="true">9.10.</strong> Memory Distribution</a></li><li class="chapter-item "><a href="../../reference/metrics/uuid.html"><strong aria-hidden="true">9.11.</strong> UUID</a></li><li class="chapter-item "><a href="../../reference/metrics/url.html"><strong aria-hidden="true">9.12.</strong> URL</a></li><li class="chapter-item "><a href="../../reference/metrics/datetime.html"><strong aria-hidden="true">9.13.</strong> Datetime</a></li><li class="chapter-item "><a href="../../reference/metrics/event.html"><strong aria-hidden="true">9.14.</strong> Event</a></li><li class="chapter-item "><a href="../../reference/metrics/custom_distribution.html"><strong aria-hidden="true">9.15.</strong> Custom Distribution</a></li><li class="chapter-item "><a href="../../reference/metrics/quantity.html"><strong aria-hidden="true">9.16.</strong> Quantity</a></li><li class="chapter-item "><a href="../../reference/metrics/rate.html"><strong aria-hidden="true">9.17.</strong> Rate</a></li><li class="chapter-item "><a href="../../reference/metrics/text.html"><strong aria-hidden="true">9.18.</strong> Text</a></li></ol></li><li class="chapter-item "><a href="../../reference/pings/index.html"><strong aria-hidden="true">10.</strong> Pings</a></li><li class="chapter-item affix "><li class="part-title">SDK Specific Information</li><li class="chapter-item "><a href="../../language-bindings/index.html"><strong aria-hidden="true">11.</strong> Overview</a></li><li class="chapter-item "><a href="../../language-bindings/android/index.html"><strong aria-hidden="true">12.</strong> Android</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/android/android-build-configuration-options.html"><strong aria-hidden="true">12.1.</strong> Android build configuration options</a></li><li class="chapter-item "><a href="../../language-bindings/android/android-offline-builds.html"><strong aria-hidden="true">12.2.</strong> Android offline builds</a></li><li class="chapter-item "><a href="../../language-bindings/android/instrument-android-crashes-example.html"><strong aria-hidden="true">12.3.</strong> Instrumenting Android crashes with Glean</a></li></ol></li><li class="chapter-item "><a href="../../language-bindings/ios/index.html"><strong aria-hidden="true">13.</strong> iOS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/ios/ios-build-configuration-options.html"><strong aria-hidden="true">13.1.</strong> iOS build configuration options</a></li></ol></li><li class="chapter-item "><a href="../../language-bindings/javascript/index.html"><strong aria-hidden="true">14.</strong> JavaScript</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/javascript/cli.html"><strong aria-hidden="true">14.1.</strong> Command Line Interface</a></li><li class="chapter-item "><a href="../../language-bindings/javascript/plugins/index.html"><strong aria-hidden="true">14.2.</strong> Plugins</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../language-bindings/javascript/plugins/encryption.html"><strong aria-hidden="true">14.2.1.</strong> Ping Encryption Plugin</a></li></ol></li></ol></li><li class="chapter-item "><li class="part-title">Appendix</li><li class="chapter-item "><a href="../../appendix/glossary.html"><strong aria-hidden="true">15.</strong> Glossary</a></li><li class="chapter-item "><a href="../../appendix/changelog/index.html"><strong aria-hidden="true">16.</strong> Changelog</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../appendix/changelog/sdk.html"><strong aria-hidden="true">16.1.</strong> mozilla/glean</a></li><li class="chapter-item "><a href="../../appendix/changelog/js.html"><strong aria-hidden="true">16.2.</strong> mozilla/glean.js</a></li></ol></li><li class="chapter-item "><a href="../../appendix/twig.html"><strong aria-hidden="true">17.</strong> This Week in Glean</a></li><li class="chapter-item "><a href="../../appendix/contribution-guidelines.html"><strong aria-hidden="true">18.</strong> Contribution Guidelines</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Glean SDKs - Cross-platform Telemetry Libraries</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mozilla/glean" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="initializing"><a class="header" href="#initializing">Initializing</a></h1>
<p>Glean needs to be initialized in order to be able to send pings,
record metrics and perform maintenance tasks. Thus it is advised that Glean be initialized as
soon as possible in an application's lifetime and importantly, before any other libraries in the
application start using Glean.</p>
<div class="special-quote special-quote-info fa fa-info-circle"></div>
<h2 id="libraries-are-not-required-to-initialize-glean"><a class="header" href="#libraries-are-not-required-to-initialize-glean">Libraries are not required to initialize Glean</a></h2>
<blockquote>
<p>Libraries rely on the same Glean singleton as the application in which they are
embedded. Hence, they are not expected to initialize Glean
as the application should already do that.</p>
</blockquote>
<h2 id="behavior-when-uninitialized"><a class="header" href="#behavior-when-uninitialized">Behavior when uninitialized</a></h2>
<p>Any API called before Glean is initialized is queued and applied at initialization.
To avoid unbounded memory growth the queue is bounded (currently to a maximum of 100 tasks),
and further calls are dropped.</p>
<p>The number of calls dropped, if any,
is recorded in the <code>glean.error.preinit_tasks_overflow</code> metric.</p>
<h2 id="behavior-once-initialized"><a class="header" href="#behavior-once-initialized">Behavior once initialized</a></h2>
<h3 id="when-upload-is-enabled"><a class="header" href="#when-upload-is-enabled">When upload is enabled</a></h3>
<p>Once initialized, if upload is enabled,
Glean applies all metric recordings and ping submissions,
for both user-defined and builtin metrics and pings.</p>
<p>This always happens asynchronously.</p>
<h3 id="when-upload-is-disabled"><a class="header" href="#when-upload-is-disabled">When upload is disabled</a></h3>
<p>If upload is disabled, any persisted metrics, events and pings (other than <code>first_run_date</code> and <code>first_run_hour</code>) are cleared.
Pending <code>deletion-request</code> pings are sent.
Subsequent calls to record metrics and submit pings will be no-ops.
Because Glean does that as part of its initialization, users are <em>required</em> to always initialize Glean.</p>
<p><strong>Glean must be initialized even if upload is disabled.</strong></p>
<p>This does not apply to special builds where telemetry is disabled at build time.
In that case, it is acceptable to not call initialize at all.</p>
<h2 id="api"><a class="header" href="#api">API</a></h2>
<h3 id="gleaninitializeconfiguration"><a class="header" href="#gleaninitializeconfiguration"><code>Glean.initialize(configuration)</code></a></h3>
<p>Initializes Glean.</p>
<p>May only be called once. Subsequent calls to <code>initialize</code> are no-op.</p>
<h4 id="configuration"><a class="header" href="#configuration">Configuration</a></h4>
<p>The available <code>initialize</code> configuration options may vary depending on the SDK.
Below are listed the configuration options available on most SDKs.</p>
<ul>
<li><code>applicationId</code>: Application identifier. For Android and iOS applications, this is the id used on the platform's respective app store and is extracted automatically from the application context.</li>
<li><code>uploadEnabled</code>: The user preference on whether or not data upload is enabled.</li>
<li><code>appChannel</code>: The application's release channel. When present, the <code>app_channel</code> will be reported in all ping's <a href="../../user/pings/index.html#the-client_info-section"><code>client_info</code></a> section.</li>
<li><code>appBuild</code>: A build identifier e.g. the build identifier generated by a CI system (e.g. &quot;1234/A&quot;). If not present, <code>app_build</code> will be reported as &quot;Unknown&quot; on all pings <a href="../../user/pings/index.html#the-client_info-section"><code>client_info</code></a> section.</li>
<li><code>appDisplayVersion</code>: The user visible version string for the application running Glean. If not present, <code>app_display_version</code> will be reported as &quot;Unknown&quot; on all pings <a href="../../user/pings/index.html#the-client_info-section"><code>client_info</code></a> section.</li>
<li><code>serverEndpoint</code>: The server pings are sent to. Defaults to <code>https://incoming.telemetry.mozilla.org</code>.</li>
<li><code>maxEvents</code>: The maximum number of events the Glean storage will hold on to before submitting the 'events' ping. Defaults to 500. Refer to the <a href="../../user/pings/events.html"><code>events</code> ping documentation</a> for more information on its scheduling.</li>
</ul>
<p>To learn about SDK specific configuration options available, refer to the <a href="#reference">Reference</a> section.</p>
<div class="special-quote special-quote-stop fa fa-ban"></div>
<h5 id="always-initialize-glean-with-the-correct-upload-preference"><a class="header" href="#always-initialize-glean-with-the-correct-upload-preference">Always initialize Glean with the correct upload preference</a></h5>
<blockquote>
<p>Glean must <strong>always</strong> be initialized with real values.</p>
<p>Always pass the user preference, e.g. <code>Glean.initialize(upload=userSettings.telemetry_enabled)</code> or the equivalent for your application.
Never call <code>Glean.initialize(upload=true)</code> if <code>true</code> is a placeholder value that later gets reset by <code>Glean.setUploadEnabled(false)</code> and vice-versa.</p>
<p>Depending on the provided placeholder value, this might trigger the generation of new client ids or the submission of bogus <a href="../../user/pings/deletion-request.html"><code>deletion-request</code> pings</a>.</p>
</blockquote>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>An excellent place to initialize Glean is within the <code>onCreate</code> method of the class that extends Android's <code>Application</code> class.</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.GleanBuildInfo
import org.mozilla.yourApplication.GleanMetrics.Pings

class SampleApplication : Application() {

    override fun onCreate() {
        super.onCreate()

        // If you have custom pings in your application, you must register them
        // using the following command. This command should be omitted for
        // applications not using custom pings.
        Glean.registerPings(Pings)

        // Initialize the Glean library.
        Glean.initialize(
            applicationContext,
            // Here, `settings()` is a method to get user preferences, specific to
            // your application and not part of the Glean API.
            uploadEnabled = settings().isTelemetryEnabled,
            buildInfo = GleanBuildInfo.buildInfo
        )
    }
}
</code></pre>
<p>The Glean Kotlin SDK does not support use across multiple processes, and must only be initialized on the application's main process. Initializing in other processes is a no-op.</p>
<p>Additionally, Glean must be initialized on the main (UI) thread of the applications main process. Failure to do so will throw an <code>IllegalThreadStateException</code>.</p>
<h3 id="consuming-glean-through-android-components"><a class="header" href="#consuming-glean-through-android-components">Consuming Glean through Android Components</a></h3>
<p>When the Glean Kotlin SDK is consumed through Android Components,
it is required to configure an HTTP client to be used for upload.</p>
<p>For example:</p>
<pre><code class="language-Kotlin">// Requires `org.mozilla.components:concept-fetch`
import mozilla.components.concept.fetch.Client

// Requires `org.mozilla.components:lib-fetch-httpurlconnection`.
// This can be replaced by other implementations, e.g. `lib-fetch-okhttp`
// or an implementation from `browser-engine-gecko`.
import mozilla.components.lib.fetch.httpurlconnection.HttpURLConnectionClient
import mozilla.components.service.glean.config.Configuration
import mozilla.components.service.glean.net.ConceptFetchHttpUploader

val httpClient = ConceptFetchHttpUploader(lazy { HttpURLConnectionClient() as Client })
val config = Configuration(httpClient = httpClient)
Glean.initialize(
   context,
   uploadEnabled = true,
   configuration = config,
   buildInfo = GleanBuildInfo.buildInfo
)
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>An excellent place to initialize Glean is within the <code>application(_:)</code> method of the class that extends the <code>UIApplicationDelegate</code> class.</p>
<pre><code class="language-Swift">import Glean
import UIKit

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_: UIApplication, didFinishLaunchingWithOptions _: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
        // If you have custom pings in your application, you must register them
        // using the following command. This command should be omitted for
        // applications not using custom pings.
        Glean.shared.registerPings(GleanMetrics.Pings)

        // Initialize the Glean library.
        Glean.shared.initialize(
            // Here, `Settings` is a method to get user preferences specific to
            // your application, and not part of the Glean API.
            uploadEnabled = Settings.isTelemetryEnabled,
            buildInfo = GleanMetrics.GleanBuild.info
        )
    }
}
</code></pre>
<p>The Glean Swift SDK does not support use across multiple processes,
and must only be initialized on the application's main process.</p>
</div>
<div data-lang="Python" class="tab">
<p>The main control for the Glean Python SDK is on the <code>glean.Glean</code> singleton.</p>
<pre><code class="language-python">from glean import Glean

Glean.initialize(
    application_id=&quot;my-app-id&quot;,
    application_version=&quot;0.1.0&quot;,
    # Here, `is_telemetry_enabled` is a method to get user preferences specific to
    # your application, and not part of the Glean API.
    upload_enabled=is_telemetry_enabled(),
)
</code></pre>
<p>Unlike in other implementations, the Python SDK does not automatically send any pings.
See the <a href="../../user/pings/custom.html">custom pings documentation</a> about adding custom pings and sending them.</p>
</div>
<div data-lang="Rust" class="tab">
<p>The Glean Rust SDK should be initialized as soon as possible.</p>
<pre><code class="language-Rust">use glean::{ClientInfoMetrics, Configuration};
let cfg = Configuration {
    data_path,
    application_id: &quot;my-app-id&quot;.into(),
    // Here, `is_telemetry_enabled` is a method to get user preferences specific to
    // your application, and not part of the Glean API.
    upload_enabled: is_telemetry_enabled(),
    max_events: None,
    delay_ping_lifetime_io: false,
    channel: None,
    server_endpoint: Some(&quot;https://incoming.telemetry.mozilla.org&quot;.into()),
    uploader: None,
    use_core_mps: true,
};

let client_info = ClientInfoMetrics {
    app_build: env!(&quot;CARGO_PKG_VERSION&quot;).to_string(),
    app_display_version: env!(&quot;CARGO_PKG_VERSION&quot;).to_string(),
};

glean::initialize(cfg, client_info);
</code></pre>
<p>The Glean Rust SDK does not support use across multiple processes, and must only be initialized on the application's main process.</p>
<p>Unlike in other implementations, the Rust SDK does not provide a default uploader.
See <a href="../../../docs/glean/net/trait.PingUploader.html"><code>PingUploader</code></a> for details.</p>
</div>
<div data-lang="JavaScript" class="tab">
<pre><code class="language-js">import Glean from &quot;@mozilla/glean/&lt;platform&gt;&quot;;

Glean.initialize(
    &quot;my-app-id&quot;,
    // Here, `isTelemetryEnabled` is a method to get user preferences specific to
    // your application, and not part of the Glean API.
    isTelemetryEnabled(),
    {
      appDisplayVersion: &quot;0.1.0&quot;
    }
);
</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info="On Firefox Desktop Glean initialization is handled internally."></div>
</div>
</div>
<h2 id="testing-api"><a class="header" href="#testing-api">Testing API</a></h2>
<p>When unit testing metrics and pings, Glean needs to be put in testing mode. Initializing
Glean for tests is referred to as &quot;resetting&quot;. It is advised that Glean is reset before each unit test
to prevent side effects of one unit test impacting others.</p>
<p>How to do that and the definition of &quot;testing mode&quot; varies per Glean SDK. Refer to the information
below for SDK specific information.</p>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Using the Glean Kotlin SDK's unit testing API requires adding
<a href="http://robolectric.org/">Robolectric 4.0 or later</a> as a testing dependency.
In Gradle, this can be done by declaring a <code>testImplementation</code> dependency:</p>
<pre><code class="language-groovy">dependencies {
    testImplementation &quot;org.robolectric:robolectric:4.3.1&quot;
}
</code></pre>
<p>In order to put the Glean Kotlin SDK into testing mode apply the JUnit <code>GleanTestRule</code> to your test class.
Testing mode will prevent issues with async calls when unit testing the Glean SDK on Kotlin. It also
enables uploading and clears the recorded metrics at the beginning of each test run.</p>
<p>The rule can be used as shown:</p>
<pre><code class="language-kotlin">@RunWith(AndroidJUnit4::class)
class ActivityCollectingDataTest {
    // Apply the GleanTestRule to set up a disposable Glean instance.
    // Please note that this clears the Glean data across tests.
    @get:Rule
    val gleanRule = GleanTestRule(ApplicationProvider.getApplicationContext())

    @Test
    fun checkCollectedData() {
      // The Glean Kotlin SDK testing APIs can be called here.
    }
}
</code></pre>
<p>This will ensure that metrics are done recording when the other test functions are used.</p>
</div>
<div data-lang="Swift" class="tab">
<p><strong>Note</strong>: There's no automatic test rule for Glean tests implemented in Swift.</p>
<p>In order to prevent issues with async calls when unit testing the Glean SDK, it is important to put
the Glean Swift SDK into testing mode. When the Glean Swift SDK is in testing mode,
it enables uploading and clears the recorded metrics at the beginning of each test run.</p>
<p>Activate it by resetting Glean in your test's setup:</p>
<pre><code class="language-swift">// All pings and metrics testing APIs are marked as `internal`
// so you need to import `Glean` explicitly in test mode.
@testable import Glean
import XCTest

class GleanUsageTests: XCTestCase {
    override func setUp() {
        Glean.shared.resetGlean(clearStores: true)
    }

    // ...
}
</code></pre>
<p>This will ensure that metrics are done recording when the other test functions are used.</p>
</div>
<div data-lang="Python" class="tab">
<p>The Glean Python SDK contains a helper function <code>glean.testing.reset_glean()</code> for resetting Glean for tests.
It has two required arguments: the application ID, and the application version.</p>
<p>Each reset of the Glean Python SDK will create a new temporary directory for Glean to store its data in.
This temporary directory is automatically cleaned up the next time the Glean Python SDK is reset or when the testing framework finishes.</p>
<p>The instructions below assume you are using <a href="https://pypi.org/project/pytest/">pytest</a> as the test runner.
Other test-running libraries have similar features, but are different in the details.</p>
<p>Create a file <code>conftest.py</code> at the root of your test directory, and add the following to reset Glean at the start of every test in your suite:</p>
<pre><code class="language-python">import pytest
from glean import testing

@pytest.fixture(name=&quot;reset_glean&quot;, scope=&quot;function&quot;, autouse=True)
def fixture_reset_glean():
    testing.reset_glean(application_id=&quot;my-app-id&quot;, application_version=&quot;0.1.0&quot;)
</code></pre>
</div>
<div data-lang="Rust" class="tab"></div>
<div data-lang="JavaScript" class="tab">
<p>The Glean JavaScript SDK contains a helper function <code>testResetGlean()</code> for resetting Glean for tests.
It expects the same list of arguments as <code>Glean.initialize</code>.</p>
<p>Each reset of the Glean JavaScript SDK will clear stores. Calling <code>testResetGlean</code> will also make
metrics and pings testing APIs available and replace ping uploading with a mock implementation that
does not make real HTTP requests.</p>
<pre><code class="language-js">import { testResetGlean } from &quot;@mozilla/glean/testing&quot;

describe(&quot;myTestSuite&quot;, () =&gt; {
    beforeEach(async () =&gt; {
        await testResetGlean(&quot;my-test-id&quot;);
    });
});

</code></pre>
</div>
<div data-lang="Firefox Desktop" class="tab" data-info='Documentation on how to reset Glean in Firefox Desktop tests can be found at <a href="https://firefox-source-docs.mozilla.org/toolkit/components/glean/user/instrumentation_tests.html" target="_blank">"Writing Instrumentation Tests"</a>'></div>
</div>
</div>
<h2 id="reference"><a class="header" href="#reference">Reference</a></h2>
<ul>
<li><a href="../../../swift/Classes/Glean.html#/s:5GleanAAC10initialize13uploadEnabled13configuration9buildInfoySb_AA13ConfigurationVAA05BuildG0VtF">Swift API docs</a></li>
<li><a href="../../../python/glean/index.html#glean.Glean.initialize">Python API docs</a></li>
<li><a href="../../../docs/glean/fn.initialize.html">Rust API docs</a></li>
<li><a href="https://mozilla.github.io/glean.js/modules/core_glean.default.html#initialize">JavaScript API docs</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/main/docs/user/reference/general/initializing.md">Edit this file on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../reference/general/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../reference/general/toggling-upload-status.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../reference/general/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../reference/general/toggling-upload-status.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../../../shared/tabs.js"></script>
        <script type="text/javascript" src="../../../shared/mermaid.min.js"></script>
        <script type="text/javascript" src="../../../shared/mermaid-init.js"></script>
        <script type="text/javascript" src="../../chart.min.js"></script>
        <script type="text/javascript" src="../../chart-distributions.js"></script>
        <script type="text/javascript" src="../../chart-distributions-ui.js"></script>


    </body>
</html>
